<?xml version = '1.0' encoding = 'utf-8'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "/usr/share/xml/docbook/schema/dtd/4.2/docbookx.dtd">
<book lang="ru" >
  <bookinfo>
    <title>Руководство по эксплуатации маршрутизатора SG-16R/SG-17R</title>
    <copyright>
      <year>2007</year>
      <holder>Сигранд</holder>
    </copyright>
  </bookinfo>
  <chapter>
    <chapterinfo>Манипуляция с программным обеспечением маршрутизатора</chapterinfo>
    <title>Программное обеспечение маршрутизатора</title>
    <section id="bootloader" >
      <title>Загрузчик</title>
      <para>
				Меню загрузчика доступно при подключении к маршрутизатору по последовательному интерфейсу. После включения питания, на экран будет выведено предложение войти в меню загрузчика. Для этого вам необходимо 3 раза быстро нажать на клавишу пробела.
			</para>
      <screen>
				ADM5120 Boot:
				
				
				CPU: Infineon 5120-175MHz
				SDRAM: 64MB
				Flash: NAND-32MB
				Boot System: Linux-5120
				Loader Version: 1.00.03
				Creation Date: 17.04.2007
				
				Press &lt;space> key tree times to enter boot menu..
					3
			</screen>
      <para>
				Если вы трижды нажали на пробел, то выведется меню загрузчика
			</para>
      <screen>
				==================================
				Bootloader Menu
				[1] Xmodem Download
				[2] TFTP Download
				[3] Print Boot Params
				[4] Set Boot Params
				[5] Check flash
				[6] Exit
				
				Please enter your number:
			</screen>
      <para>
				В этом меню доступны несколько действий:
				<itemizedlist>
          <listitem>Xmodem Download - обновление загрузчика или системы через последовательный порт по протоколу Xmodem. Данный способ обновления занимает много времени.</listitem>
          <listitem>TFTP Download - обновление системы или загрузчика с помощью TFTP сервера.</listitem>
          <listitem>Print Boot Params - показывает сетевые параметры загрузчика, основные - мак адрес и IP-адрес.</listitem>
          <listitem>Set Boot Params - установка сетевых параметров для загрузки. Подробнее эти параметры рассмотрены в разделе &quot;Обновление прошивки маршрутизатора&quot;.</listitem>
          <listitem>Check flash - проверка флэш-памяти маршрутизатора на наличие поврежденных блоков.</listitem>
        </itemizedlist>
      </para>
      <para>
				Чтобы проверить маршрутизатор на наличие поврежденных блоков, переходим в меню Check flash:
			</para>
      <screen>
				Please enter your number:5
				Flash Client Menu
				===============================
				[P]: Print existent bad blocks
				[S]: Scan flash for new bad blocks
				[E]: Erase flash
				[X]: exit
				Enter your option:
			</screen>
      <para>
        <itemizedlist>
          <listitem>Print existent bad blocks - выводит на экран информацию о выявленных в ходе предыдущих проверках поврежденных блоках.</listitem>
          <listitem>Scan flash for new bad blocks - сканирование флэш-памяти на предмет поврежденных блоков. В случае их обнаружения, они помечаются, как поврежденные, и не используются системой.</listitem>
          <listitem>Erase flash - очистка флэш-памяти. Удаляет систему с флэш-памяти.</listitem>
        </itemizedlist>
      </para>
    </section>
    <section id="update" >
      <title>Обновление прошивки маршрутизатора</title>
      <para>
				Если маршрутизатор уже сконфигурирован, то перед прошивкой следует сохранить конфигурацию, т.к. установка новой прошивки вернет все параметры в начальное состояние. Сохранение и восстановление конфигурации выполняется в веб-интерфейсе.
			</para>
      <para>
				Обновление прошивки выполняется через консольный интерфейс, для этого вам потребуется:
				<itemizedlist>
          <listitem>
            <para>
              <acronym>ПК</acronym> с COM-портом</para>
          </listitem>
          <listitem>
            <para>TFTP-сервер, доступный с маршрутизатора</para>
          </listitem>
        </itemizedlist>
      </para>
      <para>
				Для обновления прошивки необходимо, чтобы маршрутизатору был доступен TFTP-сервер, на котором расположен файл образа прошивки. В старых версиях загрузчика было необходимо, чтобы этот TFTP-сервер находился в одной сети с маршрутизатором, в новой версии добавлена возможность обновления, когда сервер доступен через шлюз.
			</para>
      <para>
				Если используется локальный TFTP-сервер, то после его настройки необходимо в каталог, являющийся для него (TFTP-сервера) корневым, скопировать файл прошивки, который можно скачать с веб-сайта <ulink url="http://www.sigrand.ru" >www.sigrand.ru</ulink>.
			</para>
      <para>
				Для доступа к консольному интерфейсу маршрутизатора необходимо COM-порт компьютера (разъем DB-9F) соединить с последовательным портом (разъем RJ-45 с надписью RS232, находящийся рядом с разъемом для питания) маршрутизатора.
			</para>
      <para>
				Для управления маршрутизатором через консольный интерфейс может использоваться любая программа управления терминалом - HyperTerminal для ОС Windows или Minicom для ОС GNU/Linux. Настройки последовательного порта следующие:
				<itemizedlist>
          <listitem>
            <para>скорость передачи: 115 200</para>
          </listitem>
          <listitem>
            <para>протокол: 8-N-1</para>
          </listitem>
          <listitem>
            <para>управление потоком: нет</para>
          </listitem>
        </itemizedlist>
      </para>
      <para>
				После запуска программы управления терминалом и установки соответствующих настроек порта, надо включить маршрутизатор. В окне программы выведется информация о маршрутизаторе с предложением войти в меню загрузчика:
			</para>
      <screen>
				ADM5120 Boot:
				
				
				CPU: ADM5120-175MHz
				SDRAM: 128MB
				Flash: NAND-32MB
				Boot System: Linux-5120
				Loader Version: 1.00.03
				Creation Date: 2004.06.04
				
				Press &lt;space> key tree times to enter boot menu..
				2
			</screen>
      <para>
				Для активации меню загрузчика надо быстро нажать на клавишу пробела 3 раза. Меню загрузчика выглядит следующим образом:
			</para>
      <screen>
				==================================
				Bootloader Menu
				[1] Xmodem Download
				[2] TFTP Download
				[3] Print Boot Params
				[4] Set Boot Params
				[5] Check flash
				[6] Exit
				
				Please enter your number:
			</screen>
      <para>
				Перед обновлением прошивки необходимо выставить сетевые параметры, которые соответствуют вашей сети. Для этого нужно перейти в пункт меню <emphasis>Set Boot Params</emphasis>, нажав клавишу 4. Здесь будет предложено указать:
				<itemizedlist>
          <listitem>
            <para>серийный номер маршрутизатора - (Enter new serial number) - можно пропустить</para>
          </listitem>
          <listitem>
            <para>версию аппаратной части - (Enter new hardware version) - можно пропустить</para>
          </listitem>
          <listitem>
            <para>
							MAC адрес сетевого интерфейса - (Enter new mac address) - можно оставить установленный MAC адрес (его значение отображено выше, Current Mac Address), или ввести новое значение.
						</para>
          </listitem>
          <listitem>
            <para>число MAC адресов - (Enter new number of mac address) - этот параметр следует пропустить (по умолчанию число MAC адресов равно 1)</para>
          </listitem>
          <listitem>
            <para>IP адрес - (Enter new IP address for this board) - следует ввести IP адрес, находящийся в одной сети с TFTP сервером</para>
          </listitem>
        </itemizedlist>
      </para>
      <para>
				Пример конфигурации приведен ниже:
			</para>
      <screen>
				Set Boot Parameters.
				==========================
				Enter new serial number:
				Serial Number unchanged.
				Enter new hardware version:
				Hardware version unchanged.
				Current mac addres: 00-05-5D-77-86-01
				Number of mac address: 1
				Enter new mac address (AA-AA-AA-AA-AA-AA):
				Enter new number of mac address (between 1-8):
				Mac address unchanged.
				IP address for this board: 10.10.10.1
				Enter new IP address for this board: 10.10.10.1
				IP updated successfully.
			</screen>
      <para>
				В приведенном примере был введен только IP адрес маршрутизатора, остальные параметры оставлены без изменений.
			</para>
      <para>
				После настройки сетевых параметров, следует выбрать пункт меню 2 (TFTP Client Download) для настройки параметров обновления с помощью TFTP сервера. Содержание этого меню приведено ниже:
			</para>
      <screen>
				Server IP: 80.66.88.167
				Gateway IP: 10.10.10.2
				Remote File bootloader: bootgw
				Remote File system: openwrt
				
				TFTP Client Menu
				===============================
				[B]: Update bootloader
				[S]: Update system
				[A]: Update all
				[P]: Set parameters
				[X]: exit
				Enter your option:
			</screen>
      <note>
        <simpara>
					Приведенное выше меню соответствует новому загрузчику, в который была добавлена возможность загрузки образов загрузчика и системы с TFTP-сервера, находящегося за маршрутизатором. Меню в старых версиях загрузчика отличается отсутствием возможности установки шлюза и обновления загрузчика.
				</simpara>
      </note>
      <para>
				Первые четыре строчки над меню содержат информацию, установленную во время последнего обновления прошивки. Для их изменения следует выбрать пункт меню set parameters нажатием клавиши p. В ответ на это будет предложено ввести:
				<itemizedlist>
          <listitem>
						IP-адрес TFTP сервера - (Please Enter TFTP Server IP) - IP адрес TFTP сервера, на котором находится файл прошивки. Можно использовать TFTP-сервер, предоставляемый компанией Сигранд -  <emphasis>sigrand.ru</emphasis>. Вводить следует IP-адрес сервера.
					</listitem>
          <listitem>
						IP-адрес шлюза - (Please enter gateway IP). Установка данного параметра позволяет обновлять прошивку с TFTP-сервера, находящегося в отличной от маршрутизатора сети.
						Шлюз должен находиться в той же сети, что и интерфейс маршрутизатора.
					</listitem>
          <listitem>
						Имя файла образа загрузчика - (Enter remote bootloader file name).
					</listitem>
          <listitem>
						Имя файла прошивки - (Enter remote system file name) - имя файла прошивки, расположенного на TFTP сервере.
					</listitem>
        </itemizedlist>
      </para>
      <screen>
				Please enter TFTP server IP : 80.66.88.167
				Please enter gateway IP : 10.10.10.2
				Enter remote bootloader file name : bootgw
				Enter remote system file name : openwrt
			</screen>
      <para>
				После настройки необходимых параметров, можно перейти к прошивке маршрутизатора или обновлению загрузчика. Для обновления загрузчика выбираем пункт меню [B]: Update bootloader:
			</para>
      <screen>
				Enter your option:b
				Starting the TFTP download(ESC to stop)...
				PASS
				File total Length: 00010DF0
				
				Eraseing flash.......
				PASS
				Programming flash....
				PASS
			</screen>
      <para>
				PASS, соответствующий строчкам Eraseing flash и Programming flash означает, что обновление загрузчика прошло успешно. FAIL говорит о возникших проблемах, как правило это неправильный IP-адрес TFTP-сервера (маршрутизатор и TFTP-сервер находятся в разных сетях) или неправильное имя файла на сервере.
			</para>
      <para>
				Для обновления прошивки маршрутизатора переходим в пункт меню [S]: Update system:
			</para>
      <screen>
				Enter your option:s
				Starting the TFTP download(ESC to stop)...................................
				PASS
				File total Length: 00B62808  Starting address: A0820000
				
				Eraseing flash.......
				PASS
				Programming flash....
				PASS
			</screen>
      <para>
				Если на экране присутствуют строчки
				<screen>
				Eraseing flash.......
				PASS
				Programming flash....
				PASS
				</screen>
				, значит обновление прошивки прошло успешно и теперь можно загрузить новую прошивку. Для этого необходимо выполнить перезагрузку маршрутизатора нажатием на кнопку RESET (или включением/выключением питания).
			</para>
      <para>
				Пункт меню [A]: Update all последовательно обновляет загрузчик и прошивку маршрутизатора.
			</para>
      <para>
				После загрузки маршрутизатора (при обычной загрузке не требуется входить в меню загрузчика, поэтому надо подождать, пока истечет таймер и начнется загрузка операционной системы (<acronym>ОС</acronym>>)) можно перейти к настройке посредством веб-интерфейса. Доступ к консоли больше не требуется, поэтому провод и соответствующее <acronym>ПО</acronym> можно отключить.
			</para>
      <para>
				В случае, если на экран была выведена строчка
				<screen>Starting the TFTP download(ESC to stop)..FAIL</screen>
				, значит загрузчику не удалось загрузить файл прошивки с указанного TFTP сервера. В этом случае следует проверить корректность указания IP адреса TFTP сервера и имени файла прошивки на нем. Если все корректно, то следует проверить настройки, введенные в пункте Set Boot Params. Может помочь смена MAC адреса и проверка, не блокирует ли сервер TFTP соединения с маршрутизатора.
			</para>
    </section>
    <section>
      <title>Установка программ</title>
      <para>
				Перед установкой пакета его надо загрузить на маршрутизатор. Сделать это можно несколькими способами:
				<itemizedlist>
          <listitem>Разместить на WWW/FTP сервере и загрузить с помощью утилиты wget</listitem>
          <listitem>Разместить на TFTP сервер и загрузить с помощью tftp клиента</listitem>
        </itemizedlist>
      </para>
      <simpara>Загрузка пакета с TFTP сервера:</simpara>
      <simpara>
				# <command>tftp</command>
        <replaceable>192.168.2.1</replaceable>
        <option>-r</option>
        <replaceable>libpthread_0.9.28-1_mipsel.ipk</replaceable>
        <option>-g</option>
      </simpara>
      <simpara>Установка пакета:</simpara>
      <para>
        <screen>
					# <command>ipkg</command>
          <option>install</option>
          <replaceable>libpthread_0.9.28-1_mipsel.ipk</replaceable>
					Installing libpthread (0.9.28-1) to root...
					Configuring libpthread
					Done.
				</screen>
      </para>
      <para>
				Если при выполнении установки пакета будет выведено сообщение <computeroutput>ERROR: Cannot satisfy the following dependencies for <replaceable>fprobe</replaceable>:</computeroutput>, следует установить указанный пакет и повторить установку текущего пакета (<replaceable>fprobe</replaceable>).
			</para>
    </section>
  </chapter>
  <chapter id="begin" >
    <title>Управление маршрутизатором</title>
    <section>
      <title>Начало работы</title>
      <para>
				В заводской конфигурации и после обновления прошивки на маршрутизаторе активен интерфейс eth0 (крайний правый порт) с IP-адресом 192.168.2.100, сетевая маска 255.255.255.0.
			</para>
      <para>
				Для конфигурации маршрутизатора необходимо соединить сетевую карту компьютера и крайний правый порт Ethernet проводом витой пары. На компьютере следует выставить IP-адрес из той же сети, в которой находится маршрутизатор (192.168.2.0/24), к примеру, 192.168.2.1, с сетевой маской 255.255.255.0.
			</para>
      <section id="web" >
        <title>Конфигурация с помощью Веб-интерфейса</title>
        <para>
					Конфигурация маршрутизатора выполняется через веб-интерфейс любым веб-браузером, поддерживающем протокол HTTPS (Internet Explorer, Opera, Safari, Mozilla Firefox). Для конфигурации необходимо в строке адреса веб-браузера ввести https://192.168.2.100, после чего будут заданы несколько вопросов касательно сертификатов шифрования, на которые следует ответить положительно. По-умолчанию, логин/пароль установлены следующие: admin/1234.
				</para>
        <section id="passwd" >
          <title>Установка пароля</title>
          <para>
            <important>Настоятельно рекомендуется поменять пароль для конфигурации, это выполняется на странице System/Security</important>
						Там же следует поменять и пароль для управления маршрутизатором через консольный интерфейс. Страница смены пароля приведена ниже:
						<figure>
              <title>Смена пароля</title>
              <graphic fileref="img/security.png" />
            </figure>
          </para>
        </section>
        <section id="hostname" >
          <title>Имя маршрутизатора</title>
          <para>
						Смена имени маршрутизатора (hostname) может быть выполнена на странице System/General, которая приведена ниже:
						<figure>
              <title>Смена имени маршрутизатора</title>
              <graphic fileref="img/general.png" />
            </figure>
          </para>
        </section>
        <section id="time" >
          <title>Синхронизация времени</title>
          <para>
						Установка сервера для синхронизации внутренних часов маршрутизатора и часового пояса выполняется на странице System/Time:
						<figure>
              <title>Синхронизация времени</title>
              <graphic fileref="img/time.png" />
            </figure>
          </para>
        </section>
        <section id="dns" >
          <title>Настройка ДНС</title>
          <para>
						Установка адреса ДНС-сервера, к которому будет обращаться маршрутизатор с ДНС запросами и имя домена, в который входит маршрутизатор, устанавливается на странице System/DNS:
					</para>
          <figure>
            <title>Настройка ДНС</title>
            <graphic width="6in" fileref="img/dns.png" />
          </figure>
        </section>
        <para>
					Информация о состоянии соединения SHDSL и E1 может быть получена на страницах General/SHDSL и General/E1 соответственно, конфигурация параметром линии связи для этих интерфейсов выполняется соответственно на страницах General/SHDSL/dsl* и General/E1/hdlc*, для более подробной информации о возможных настройках обратитесь к соответствующему разделу документации.
				</para>
        <para>
					Управление интерфейсами осуществляется на страницах, указанных в меню Network. К примеру, конфигурация интерфейсов Ethernet осуществляется на страницах Network/Interfaces/eth*, SHDSL - на страницах Network/Interfaces/dsl*, а E1 - на Network/Interfaces/hdlc*. Для активация интерфейса необходимо активировать параметры Enabled и Auto на вкладке General, расположенной на странице конфигурирования выбранного сетевого интерфейса. За более подробными инструкциями обратитесь к соответствующим страницам конфигурации маршрутизатора.
				</para>
        <para>
					В меню Tools расположены утилиты, позволяющие:
					<itemizedlist>
            <listitem>проследить за работой маршрутизатора, просмотрев логи - страницы syslog и dmesg;</listitem>
            <listitem>выполнить перезагрузку с помощью reboot;</listitem>
            <listitem>проверить работу ДНС сервера или соответствие DNS-имени IP-адресу с помощью утилиты dig;</listitem>
            <listitem>проверить работоспособность узла с помощью утилиты ping;</listitem>
            <listitem>посмотреть маршрут прохождения пакета до заданного узла в сети с помощью mtr;</listitem>
            <listitem>просмотреть сетевой трафик с помощью tcpdump.</listitem>
          </itemizedlist>
        </para>
        <para>
					Сохранение и восстановление конфигурации производится на страницах Configuration/Backup и Configuration/Restore соответственно.
				</para>
      </section>
      <section id="console" >
        <title>Конфигурация через консольный интерфейс</title>
        <para>
					Для конфигурации маршрутизатора через консольный интерфейс необходимо подключится к маршрутизатору по протоколу SSH на порт 22. Есть несколько программ, поддерживающих работу по протоколу SSH, к примеру, Putty для OS Windows и ssh для OS GNU/Linux. В качестве логина необходимо ввести root, пароль - 1234.
				</para>
        <note>
          <simpara>
						Следует заметить, что изменения, внесенные в конфигурацию маршрутизатора через консольный интерфейс будут замены после перезагрузки параметрами, указанными в веб-интерфейсе.
					</simpara>
        </note>
      </section>
      <section>
        <title>Сводная информация</title>
        <table frame="all" >
          <title>Сводная таблица</title>
          <tgroup cols="3" >
            <colspec colname="c1" />
            <colspec colname="c2" />
            <colspec colname="c3" />
            <thead>
              <row>
                <entry nameend="c2" namest="c1" >Параметр</entry>
                <entry>Значение</entry>
              </row>
            </thead>
            <tbody>
              <row>
                <entry nameend="c2" namest="c1" >IP-адрес (крайний правый порт)</entry>
                <entry>192.168.2.100</entry>
              </row>
              <row>
                <entry nameend="c2" namest="c1" >Сетевая маска</entry>
                <entry>255.255.255.0</entry>
              </row>
              <row>
                <entry nameend="c2" namest="c1" >Веб-интерфейс</entry>
              </row>
              <row>
                <entry/>
                <entry>Протокол</entry>
                <entry>HTTPS</entry>
              </row>
              <row>
                <entry/>
                <entry>Логин</entry>
                <entry>admin</entry>
              </row>
              <row>
                <entry/>
                <entry>Пароль</entry>
                <entry>1234</entry>
              </row>
              <row>
                <entry nameend="c2" namest="c1" >Консольный интерфейс</entry>
              </row>
              <row>
                <entry/>
                <entry>Протокол</entry>
                <entry>SSH</entry>
              </row>
              <row>
                <entry/>
                <entry>Логин</entry>
                <entry>root</entry>
              </row>
              <row>
                <entry/>
                <entry>Пароль</entry>
                <entry>1234</entry>
              </row>
            </tbody>
          </tgroup>
        </table>
      </section>
    </section>
    <section id="logging" >
      <title>Логирование событий</title>
      <para>
				Из-за особенности используемой встроенной памяти (flash-память) логи не сохраняются локально на маршрутизаторе, а пишутся в специальный буфер, доступный для просмотра через Tools/syslog. Маршрутизатор имеет несколько параметров, управляющих логированием:
			</para>
      <figure>
        <title>Логирование</title>
        <graphic width="6in" fileref="img/logging.png" />
      </figure>
      <para>
        <itemizedlist>
          <listitem>Circular buffer - размер буфера</listitem>
          <listitem>Enable remote syslog logging - включение логирования на удаленный syslog-сервер</listitem>
          <listitem>Remote syslog server - адрес удаленного syslog-сервера</listitem>
        </itemizedlist>
      </para>
      <note>
        <simpara>
					При включении логирования на удаленный сервер, продолжается запись событий в локальный буфер.
				</simpara>
      </note>
      <note>
        <simpara>
					Для того, чтобы удаленный syslog-сервер принимал логи от маршрутизатора, его необходимо запустить с опцией &quot;-r&quot;. Логирование производится по протоколу udp, 514 порт.
				</simpara>
      </note>
    </section>
    <section id="adm5120sw" >
      <title>Настройка встроенного Ethernet коммутатора</title>
      <para>
				Настройка коммутатора осуществляется на странице System/Switch, на который устанавливается соотношение между физическими портами коммутатора (нумерация идет справа налево, т.е. Port 0 соответствует крайнему правому разъему маршрутизатора). Отнесение нескольких портов к одному интерфейсу создает для них единую физическую среду, т.е. они начинают работать, как порты одного коммутатора. Окно конфигурации представлено на рисунке:
				<figure>
          <title>Конфигурация коммутатора</title>
          <graphic fileref="img/switch-1.png" />
        </figure>
      </para>
      <simpara>В приведенной выше конфигурации 0 и 1 порты коммутатора отнесены к сетевому интерфейсу eth0, в то время как 2 и 3 порты являются независимыми.</simpara>
      <note>
        <simpara>После внесения изменений необходимо перезагрузить маршрутизатор.</simpara>
      </note>
    </section>
	<section>
		<title>Установление зависимостей SHDSL - Ethernet</title>
		<para>
			Для создания сложных взаимосвязей между интерфейсами была добавлена возможность
			управления состоянием Ethernet порта в зависимости от состояния соответствующего ему
			SHDSL порта
		</para>
		<para>
			На данный момент управление соответствием осуществляется через консольный
			интерфейс, и устанавливается в конфигурационном файле /etc/sigrand/dsl2eth.map.
		</para>
		<para>
			Изначально файл /etc/sigrand/dsl2eth.map пустой. Пример его заполнения показан в файле 
			/etc/sigrand/dsl2eth.map.example и выглядит следующим образом:
			<screen>
				dsl0 eth0
				dsl1 eth1
			</screen>
		</para>
		<para>
			Это означает, что интерфейсу eth0 соответствует интерфейс dsl0, а eth1 - dsl1, и если линк на dsl0 
			упадет, что так же будет отключен линк на eth0. Редактировать файл можно любым текстовым редактором, к примеру следующей командой:
		</para>
		<simpara>
			<command>nano</command> <replaceable>/etc/sigrand/dsl2eth.map</replaceable>
		</simpara>
		<para>
			После внесения изменений в конфигурационный файл рекомендуется перезагрузить маршрутизатор.
		</para>
    </section>
	<section id="eoc">
		<title id="eoc.title">Мониторинг SHDSL каналов</title>
		<important>
			<para>
				Мониторинг поддерживают только модули MR17H.
			</para>
		</important>
		<para>
			Мониторинг SHDSL каналов позволяет получить информацию о соотношении Сигнал/Шум и уровне затухания в линии связи. В случае, если в линии связи используются регенераторы <emphasis>SG-17E</emphasis>, то можно получать информацию о состоянии этих регенераторов и их количестве.
		</para>
		<para>
			Мониторинг каналов осуществляется программой <emphasis>eocd</emphasis>, работающей в режиме демона. На данный момент его конфигурация осуществляется через консольный интерфейс маршрутизатора.
		</para>
		<para>
			Для работы демон <emphasis>eocd</emphasis> использует конфигурационный файл (по-умолчанию расположенный по пути /etc/eocd/eocd.conf), который состоит из двух разделов:
		</para>
		<itemizedlist>
			<listitem><para>channels - содержит список интерфейсов операционной системы, определяет роль каждого из них в SHDSL канале и содержит ссылку на конфигурационный профиль.</para></listitem>
			<listitem><para>span_profiles - содержит список профилей каналов. На данный момент не используется, но для каждого элемента из <emphasis>channels</emphasis> должен быть соответствующий профиль.</para></listitem>
		</itemizedlist>
		<para>
			Пример раздела <emphasis>channels</emphasis>:
		</para>
		<screen>
			channels = (
			{
				name = "dsl0";				// Имя интерфейса в ОС
				master = 1;				// Роль интерфейса: 1 - master, 0 - slave
			
				repeaters = 1;				// На данный момент не используется
				conf_profile = "span#1";		// Имя профайла в разделе
				apply_conf = 0;				// Применять конфигурацию из conf_profile
			<emphasis>span_profiles</emphasis>
			},
			{
				name = "dsl1";
				master = 1;
			
				repeaters = 1;
				conf_profile = "span#1";
				apply_conf = 0;
			}
			);
		</screen>
		<para>
			Параметры для SHDSL интерфейса могут быть установлены как через веб-интерфейс, так и через конфигурационный файл eocd.conf. Установка через конфигурационный файл является более приоритетной, поэтому для настройки SHDSL интерфейсов через веб-интерфейс, установите значение параметра apply_conf в 0 (как показано выше).
		</para>
		<para>
			Запуск демона возможен со следующими параметрами:
		</para>
		<itemizedlist>
			<listitem><para>-d, --daemon - запуск в режиме демона. Без этого ключа <emphasis>eocd</emphasis> не отключится от терминала и будет выводить на него диагностические сообщения.</para></listitem>
			<listitem><para>-c, --config_path=path - путь к конфигурационному файлу (по-умолчанию используется конфигурационный файл /etc/eocd/eocd.conf).</para></listitem>
			<listitem><para>-l, --debuglev=level - уровень отладки, допустимые значения 0, 1, 2.</para></listitem>
		</itemizedlist>
		<para>
			Для запуска демона можно использовать следующую команду:
		</para>
		<para>
			<command>eocd</command> <option>-d</option>
		</para>
		<para>
			После запуска демон выдаст сообщение на консоль и в системный лог (<command>logread</command>), и должен быть виден в списке процессов (<command>ps</command>).
		</para>
		<para>
			Демон должен быть запущен как на маршрутизаторе, работающем в режиме <emphasis>master</emphasis>, так и на втором маршрутизаторе, работающем в режиме <emphasis>slave</emphasis>.
		</para>
		<important>
			<para>Если при запуске демона он не сможет подключить указанные в конфигурационном файле интерфейсы (к примеру, если не загружен драйвер), то он выдаст в системный лог диагностическое сообщение (прочитать его можно с помощью команды <emphasis>logread</emphasis>).</para>
		</important>
		<note>
			<para>
				EOCD автоматически запускается при загрузке системы, поэтому после его конфигурации можете либо перезагрузить его вручную, убив запущенный процесс и запустив его снова командой, приведённой выше, либо выполнить перезагрузку маршрутизатора.
			</para>
		</note>
		<para>
			Для мониторинга SHDSL канала используется утилита <command>eoc-info</command>, для получения подробной информации об её использовании используется ключ <option>--help</option>.
		</para>
		<important>
			<para>Получение информации о канале возможно только на мастере, выполнение <command>eoc-info</command> на слейве не покажет информации о канале.</para>
		</important>
		<para>
			Для получения краткой информации о состоянии канала используется команда <command>eoc-info</command> <option>-s</option>. Она показывает состояние каждого канала: сколько регенераторов обнаружено, и установлено ли соединение со слейвом (маршрутизатор, работающий в режиме <emphasis>slave</emphasis>). В ее выводе <emphasis>offline</emphasis> показывает, что соединение со вторым маршрутизатором не установлено. В этом случае число регенераторов показывает, до какого регенератора было установлено соединение.
		</para>
		<para>
			Для получения более детальной информации надо указать имя интерфейса: <command>eoc-info</command> <option>-i</option> <replaceable>dsl0</replaceable>. В выводе команды будет полная информация о всех юнитах в тракте - мастера, слейва и всех регенераторов. Для получения информации о конкретном юните используется опция <option>-u</option> и номер юнита: 1 - мастер, 2 - слейв, 3 - первый регенератор и т.д.
		</para>
		<para>
			При выводе детальной информации доступна информация о параметрах линии связи:
		</para>
		<itemizedlist>
			<listitem><para>SNR Margin - соотношение сигнал/шум</para></listitem>
			<listitem><para>Loop Attenuation - затухание</para></listitem>
		</itemizedlist>
		<para>
			Есть две группы, в которые входят параметры линии связи:
		</para>
		<itemizedlist>
			<listitem><para>NetSide - сторона мастера</para></listitem>
			<listitem><para>CustomerSide - сторона клиента</para></listitem>
		</itemizedlist>
		<para>
			Соответственно, на местере есть только сторона слейва, на слейве - только сторона мастера. У каждого регенератора есть обе стороны.
		</para>
	</section>
    <section id="cfg" >
      <title>Сохранение/восстановление конфигурации</title>
      <para>
				Веб-интерфейс позволяет сохранять текущую, восстанавливать сохраненную или заводскую конфигурацию маршрутизатора.
			</para>
      <para>
				Сохранение конфигурации выполняется на странице Configuration/Backup:
			</para>
      <figure id="backup">
        <title>Сохранение конфигурации</title>
        <graphic width="6in" fileref="img/config-backup.png" />
      </figure>
      <para>
				При нажатии на кнопку Backup будет предложено сохранить файл конфигурации, который в последствии можно будет загрузить.
			</para>
      <para>
				Восстановление конфигурации выполняется на странице Configuration/Restore:
			</para>
      <figure id="restore">
        <title>Восстановление конфигурации</title>
        <graphic width="6in" fileref="img/config-restore.png" />
      </figure>
      <para>
				На вкладке default можно восстановить заводскую конфигурацию нажатием на кнопку Restore default.
			</para>
      <para>
				После восстановления конфигурации, необходимо перезагрузить маршрутизатор.
			</para>
    </section>
	</chapter>
	<chapter id="iface">
		<title>Настройка сетевых интерфейсов</title>
		<section>
			<anchor id="iface.common" />
			<title>Общие параметры</title>
				<para>
					В этом разделе рассматриваются общие параметры конфигурации для всех типов сетевых интерфейсов.
				</para>
				<section>
					<title id="iface.status.status">Вкладка Status</title>
					<para>
						На вкладке <emphasis>Status</emphasis> отображается основная информация о выбранном интерфейсе, а так же предоставляется возможность останова, запуска, и перезапуска интерфейса. Информация о сетевых параметрах интерфейса:
					</para>
					<figure>
						<title>Сетевые параметры</title>
						<graphic width="6in" fileref="img/iface-stat.png" />
					</figure>
					<para>
						Состояние интерфейса (запущен или нет) можно определить по строке флагов. Если в ней содержится слово <emphasis>UP</emphasis>, то интерфейс запущен (к примеру, <emphasis>UP BROADCAST MULTICAST</emphasis>).
					</para>
					<para>
						Маршруты, привязанные к интерфейсу:
					</para>
					<figure>
						<title>Сетевые маршруты</title>
						<graphic width="6in" fileref="img/iface-stat-routes.png" />
					</figure>
					<para>
						Записи в таблице ARP:
					</para>
					<figure>
						<title>Таблица ARP</title>
						<graphic width="6in" fileref="img/iface-stat-arp.png" />
					</figure>
					<para>
						Информация о работе встроенного коммутатора:
					</para>
					<figure>
						<title>Встроенный коммутатор</title>
						<graphic width="6in" fileref="img/iface-stat-switch.png" />
					</figure>
					<para>
						Информация о шейпере трафика, работающего на интерфейсе:
					</para>
					<figure>
						<title>Шейпер трафика</title>
						<graphic width="6in" fileref="img/iface-stat-tc.png" />
					</figure>
					<para>
						Управление интерфейсом:
					</para>
					<figure>
						<title>Управлени интерфейсом</title>
						<graphic width="6in" fileref="img/iface-stat-buttons.png" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								Кнопка <emphasis>Start interface</emphasis> позволяет запустить ("поднять") интерфейс, если на вкладке General установлен флажок <emphasis>enabled</emphasis>.
							</para>
						</listitem>
						<listitem>
							<para>
								Кнопка <emphasis>Shutdown interface</emphasis> останавливает интерфейс ("опускает").
							</para>
						</listitem>
						<listitem>
							<para>
								Кнопка <emphasis>Restart interface</emphasis> останавливает/запускает интерфейс.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="general">
					<title>Вкладка General</title>
					<para>
						Опции на вкладке <emphasis>General</emphasis> позволяют сделать интерфейс активным, а также выбрать способ установки ip-адреса.
					</para>
					<figure>
						<title>Вкладка General</title>
						<graphic width="6in" fileref="img/iface-general.png" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Description</emphasis> - описание интерфейса, не используется системой.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Enabled</emphasis> - интерфейс активен.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Auto</emphasis> - активация интерфейса при загрузке.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Method</emphasis> - метод установки IP-адреса.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Depended on</emphasis> - интерфейс, от которого зависит данный интерфейс. При запуске данного интерфейса сперва будет запущен интерфейс, от которого он зависит.
							</para>
						</listitem>
					</itemizedlist>
					<note>
						<para>
							После установлении флажка <emphasis>enabled</emphasis> интерфейс не будет автоматически запущен. Запуск интерфейса производится после сохранения параметров на вкладках Options, Specific и др., либо после нажатии кнопки <emphasis>Start interface</emphasis> на вкладке <emphasis>Status</emphasis>.
						</para>
					</note>
					<para>
						Возможно несколько методов установки IP-адреса:
					</para>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>None</emphasis> - не конфигурируемый, ip-адрес не устанавливается.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Static address</emphasis> - статический, ручной ввод пользователем.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Zero configuration</emphasis> - автоматический способ присвоения ip-адреса, позволяющий построить работающую сеть без ручного присвоения ip-адресов и без серверов DNS/DHCP.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Dynamic address</emphasis> - динамический ip-адрес () - адрес назначается сетевыми сервисами: DHCP/PPTP/...
							</para>
						</listitem>
					</itemizedlist>
					<note>
						<para>
							При выборе статического адреса необходимо ввести соответствующую информацию на вкладке <emphasis>Method</emphasis>.
						</para>
						<para>
							При конфигурации сети с помощью Zeroconf интерфейсу будет назначен ip-адрес из диапазона 169.254.*.
						</para>
						<para>
							При выборе динамического ip-адреса, адрес и необходимые сетевые настройки будут получены от DHCP сервера.
						</para>
					</note>
				</section>
				<section id="method">
					<title>Вкладка Method</title>
					<para>
						На вкладке <emphasis>Method</emphasis> осуществляется установка сетевых параметров:
					</para>
					<figure>
						<title>Вкладка Method</title>
						<graphic fileref="img/iface-method.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Static address</emphasis> - IP-адрес.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Netmask</emphasis> - маска сети.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Broadcast</emphasis> - широковещательный адрес.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Gateway</emphasis> - маршрут по-умолчанию.
							</para>
						</listitem>
					</itemizedlist>
					<note>
						<para>
							Обязательными для заполнения являются только первые два поля, при не заполнении поля широковещательного адреса, он будет высчитан автоматически.
						</para>
					</note>
				</section>
				<section id="options">
					<title>Вкладка Options</title>
					<para>
						Переключатели на вкладке <emphasis>Options</emphasis> управляют поведением интерфейса:
					</para>
					<figure>
						<title>Вкладка Options</title>
						<graphic fileref="img/iface-options.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Accept redirects</emphasis> - в активном состоянии позволяет принимать ICMP перенаправления. Например, если есть лучший маршрут до какого-либо узла чем тот, по которому был послан пакет клиентом, маршрутизатор клиенту может отправить (как правило всегда так и происходит) icmp-перенаправление с указанием, через какой маршрутизатор лучше в следующий раз отправлять пакеты.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Forwarding</emphasis> - при активном состоянии включает режим маршрутизатора - пересылку пакеты с интерфейса на интерфейс (в соответствии с правилами фаервола).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Proxy ARP</emphasis> - включение режима Proxy ARP, что предоставляет третий способ соединения сетей (помимо моста и стандартной IP-маршрутизации).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>RP Filter</emphasis> - управляет возможностью проверки пути к отправителю (reversed path) в соответствии с RFC 1812. Активное состояние включает такую проверку и рекомендуется для хостов с одним сетевым интерфейсом и маршрутизаторов тупиковых сетей.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="spec">
					<title>Вкладка Specific</title>
					<para>
						Данная вкладка содержит параметры, которые специфичные для данного интерфейса. Для интерфейсов Ethernet и SHDSL (и других) здесь можно установить MAC-адрес.
					</para>
					<figure>
						<title>Вкладка Specific</title>
						<graphic fileref="img/iface-specific.png" width="6in" />
					</figure>
				</section>
			</section>
		<section id="dsl">
			<title>Конфигурация интерфейса SHDSL</title>
			<section>
				<title>Настройка параметров интерфейса</title>
				<para>
					Для соединения по SHDSL один маршрутизатор работает в режиме мастера (master), второй - в режиме слейва (slave). Конфигурация SHDSL соединения зависит от модели маршрутизатора и используемых модулей. Настройка интерфейса SHDSL выполняется на странице System/SHDSL/dsl*.
				</para>
				<section id="dsl.mr16h">
					<title>Маршрутизатор SG-16R</title>
					<note>
						<para>
							Драйвер для SHDSL маршрутизатора SG-16R называется MR16H, его имя отображается в заголовке конфигурационного окна.
						</para>
					</note>
					<para>
						Маршрутизаторы SG-16R поддерживают два способа конфигурирования интерфейса SHDSL (MR16H) - <emphasis>local</emphasis> и <emphasis>preact</emphasis>.
					</para>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>local -</emphasis> конфигурация параметров линии связи задаётся на обоих маршрутизаторах.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>preact -</emphasis> конфигурация параметров линии связи задаётся на мастере, а слейв получает настройки при установлении соединения. На данный момент при использовании этого режима максимальная скорость ограничена до 2304 Кбит/с.
							</para>
						</listitem>
					</itemizedlist>
					<important>
						<para>
							Метод конфигурирования должен совпадать на обоих маршрутизаторах.
						</para>
					</important>
					<figure>
						<title>Конфигурация SHDSL (MR16H)</title>
						<graphic fileref="img/shdsl-link.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Rate</emphasis> - пропускная способность линии связи, Кбит/c.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Mode</emphasis> - режим: мастер (master), слейв (slave).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Coding</emphasis> - метод кодирования.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Config</emphasis> - способ конфигурирования.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Annex, CRC, Fill, Inversion</emphasis> - настройки относятся к кодированию и заполнению сигнала, используются для обеспечения совместимости оборудования.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="dsl.mr17h">
					<title>Маршрутизатор SG-17R</title>
					<note>
						<para>
							Драйвер для SHDSL маршрутизатора SG-17R (и модулей MR-17H*) называется MR17H, его имя отображается в заголовке конфигурационного окна.
						</para>
					</note>
					<para>
						Настройка скорости соединения, режима синхронизации и режима кодирования выполняется только на мастере, слейв получает эти настройки во время инициализации соединения. Окно конфигурирования показано ниже:
					</para>
					<figure>
						<title>Конфигурация SHDSL (MR17H)</title>
						<graphic fileref="img/shdsl-link-mr17h.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Mode</emphasis> - режим: мастер (master), слейв (slave).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Clock mode</emphasis> - режим синхронизации, по-умолчанию используется режим <emphasis>plesio</emphasis> (плезиохронный). Перед выбором режима <emphasis>sync</emphasis> (синхронного) следует удостовериться, что всё оборудование, находящееся на линии связи (регенераторы, маршрутизаторы) поддерживают данный режим.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Rate</emphasis> - пропускная способность линии связи, Кбит/c.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Coding</emphasis> - метод кодирования.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Annex, CRC, Fill, Inversion</emphasis> - настройки относятся к кодированию и заполнению сигнала, используются для обеспечения совместимости оборудования.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Power</emphasis> - включить подачу питания для регенераторов, находящихся на линии.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="dsl.status">
					<title>Установка и статус соединения</title>
					<para>
						После сохранения настроек через некоторый промежуток времени соединение будет установлено, о чем будут сигнализировать светодиоды на лицевой панели маршрутизатора. Так же информацию о состоянии соединения можно просмотреть на вкладке статуса:
					</para>
					<figure>
						<title>Информация о состоянии соединения SHDSL (MR16H)</title>
						<graphic fileref="img/shdsl-status.png" width="6in" />
					</figure>
					<para>
						Вкладка статуса для MR17H отображает более подробную информацию. Если соединение не установлено, выводится следующая информация:
					</para>
					<figure>
						<title>Информация о неустановленном соединении SHDSL (MR17H)</title>
						<graphic fileref="img/shdsl-status-mr17h.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Link state</emphasis> - состояние соединения: <emphasis>offline</emphasis> - соединение не установленно, <emphasis>online</emphasis> - соединение установленно.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Power balance</emphasis> - баланс питания относительно земли. В норме на одном проводе +120 В, на другом - 120 В. Если перекос больше 30 В или отсутствует земля - это означает несбалансированность питания, загорается светодиод unbalanced на модуле SHDSL. Значение <emphasis>balanced</emphasis> этого параметра соответствует нормальной работе, <emphasis>unbalanced</emphasis> - несбалансированности питания.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Power overload</emphasis> - перегрузка питания. Слишком большое число регенераторов на линии, настроенных на питание от данного маршрутизатора, вызывает перегрузку питания. На модуле SHDSL загорается светодиод overload. Значение <emphasis>no overload</emphasis> этого параметра соответствует нормальной работе, <emphasis>overload</emphasis> - перегрузке питания.
							</para>
						</listitem>
					</itemizedlist>
					<para>
						При установленном соединении добавляется следующая информация:
					</para>
					<figure>
						<title>Информация об установленном соединении SHDSL (MR17H)</title>
						<graphic fileref="img/shdsl-status-mr17h-2.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Actual rate</emphasis> - скорость установленного соединения, Кбит/с.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Actual line code</emphasis> - метод кодирования.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Actual clock mode</emphasis> - режим синхронизации.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>SNR margin</emphasis> - соотношение сигнал/шум в линии связи.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Loop attenuation</emphasis> - затухание сигнала в линии связи.
							</para>
						</listitem>
					</itemizedlist>
					<note>
						<para>
							Соединения SHDSL будет установлено, если интерфейс dsl* активен, т.е. для него настроены сетевые параметры (установлен флажок <emphasis>enabled</emphasis> и интерфейс активен, подробнее - см. следующий раздел).
						</para>
					</note>
				</section>
			</section>
			<section>
				<title>
					Настройка сетевых параметров
				</title>
				<para>
					Настройка сетевых параметров аналогична настройке Ethernet соединения и выполняется на странице Network/Interfaces/dsl*.
				</para>
			</section>
		</section>
		<section>
			<title>Конфигурация интерфейса E1</title>
			<para>
				Маршрутизатор поддерживает несколько протоколов для работы с интерфейсом E1: HDLC, ETHER-HDLC, CISCO-HDLC, FR, PPP, X25. Конфигурация интерфейса выполняется на странице System/E1/hdlc*.
			</para>
			<section>
				<title>Настройка параметров интерфейса</title>
				<section>
					<title>Настройка протокола CISCO-HDLC</title>
					<para>
						Настройка некоторых параметров устанавливается в &quot;два этапа&quot;: т.е. сперва выбирается значение параметра, затем внесенные изменения сохраняются, и после перезагрузки страницы добавляются опции, относящиеся к выбранному параметру.
					</para>
					<para>
						Для настройки протокола CISCO-HDLC необходимо в выпадающем списке HDLC protocol выбрать значение CISCO-HDLC:
					</para>
					<figure>
						<title>Выбор протокола</title>
						<graphic fileref="img/hdlc-select_prot.png" />
					</figure>
					<para>
						Для активации страницы с настройками, относящимся к выбранному протоколу, необходимо сохранить внесенные изменения. После перезагрузки страница примет следующий вид:
					</para>
					<figure>
						<title>Конфигурация CISCO-HDLC</title>
						<graphic fileref="img/hdlc-params.png" />
					</figure>
					<itemizedlist>
						<listitem>Interval - время в секундах между пакетами поддержания соединения (keepalive packets)</listitem>
						<listitem>
							Timeout - время в секундах после последнего полученного пакета поддержания соединения, по истечению которого соединение считается разорванным.
						</listitem>
						<listitem>
							Е1 framed mode - структурированный режим, при котором канал разбивается на таймслоты. В этом режиме для соединения задается карта таймслотов, которая должна совпадать с картой на другом конце соединения.
						</listitem>
						<listitem>
							Use time slot 16 - по умолчанию в интерфейсе Е1 зарезервированы 0 и 16 слоты, которые могу быть использованы для служебной информации. Активация этого параметра позволяет использовать таймслот 16 для передачи данных.
						</listitem>
						<listitem>Slotmap - карта таймслотов. После сохранения из карты будут удалены служебные таймслоты.</listitem>
						<listitem>
							E1 internal transmit clock - использовать внутренний генератор частоты. Как правило, в соединении должно быть хотя бы одно устройство с внутренним генератором частоты.
						</listitem>
						<listitem>E1 CRC4 multiframe - включение режима CRC4.</listitem>
						<listitem>
							E1 CAS multiframe - включение режима CAS, используемого, как правило, при работе с АТС оборудованием. В этом режиме таймслот 16 зарезервирован для служебного использования.
						</listitem>
						<listitem>E1 HDB3/AMI line code - способ кодирования сигнала на линии связи.</listitem>
						<listitem>CRC - способ контроля ошибок.</listitem>
					</itemizedlist>
					<para>
						Пропускная способность одного таймслота составляет 64 Кбит/c, т.о. максимальная пропускная способность интерфейса Е1 в unframed mode составляет 2 Мбит/с.
					</para>
					<section>
						<title>Конфигурация framed mode</title>
						<para>
							Для работы интерфейса в framed mode необходимо активировать параметр E1 framed mode и ввести карту таймслотов, например &quot;2-9,17-27 (именно в таком формате, без пробела между диапазонами)&quot;. На другом конце соединения должна быть установлена такая же карта слотов. Строго говоря, все параметры, за исключением E1 internal transmit clock, должны быть согласованы с двух сторон.
						</para>
						<para>
							При такой конфигурации карты таймслотов, максимальная пропускная способность канала составит 17 * 64 Кбит/с = 1088 Кбит/с, что подтверждается тестами.
						</para>
					</section>
					<section>
						<title>Конфигурация unframed mode</title>
						<para>
							Для настройки интерфейса на режим работы unframed mode, параметр E1 framed mode должен быть неактивным. После внесения изменений (деактивация параметра) и сохранения, будут доступны следующие параметры настройки:
						</para>
						<figure>
							<title>Unframed mode</title>
							<graphic fileref="img/hdlc-unfamed.png" />
						</figure>
						<para>
							В этом режиме параметров конфигурации меньше, чем во framed mode и все они сводятся к настройке линии связи.
						</para>
					</section>
				</section>
			</section>
			<section>
				<title>Настройка сетевых параметров</title>
				<para>
							В данной версии ПО, установленного на маршрутизаторе, нет возможности задавать сетевые параметры через веб-интерфейс настройки, поэтому эту часть конфигурации требуется выполнить вручную. В первую очередь, необходимо убедиться, что на странице настройки сетевого интерфейса Network/Interfaces/hdlc*/General параметры Enabled и Auto неактивны:
							<figure>
					<title>Настройка интерфейса</title>
					<graphic fileref="img/hdlc-general.png" />
				</figure>
				</para>
				<para>
							После внесения необходимых изменений, необходимо активировать консоль маршрутизатора: либо подключившись к нему по последовательному порту, либо по сети по протоколу SSH.
						</para>
				<simpara>
							Соединение Е1 имеет тип точка-точка. Для активация соединения необходимо выполнить следующую команду:
						</simpara>
				<para>
							# <command>ifconfig</command>
				<replaceable>hdlc0</replaceable>
				<replaceable>192.168.200.1</replaceable> pointopoint <replaceable>192.168.200.2</replaceable>
				<itemizedlist>
					<listitem>hdlc0 - сетевой интерфейс</listitem>
					<listitem>192.168.200.1 - IP-адрес соединения на стороне маршрутизатора</listitem>
				</itemizedlist>
				</para>
				<simpara>
							Если соединение не установилось, то надо деактивировать/активировать сетевой интерфейс:
						</simpara>
				<simpara>
							# <command>ifconfig</command>
				<replaceable>hdlc0</replaceable> down
						</simpara>
				<simpara>
							# <command>ifconfig</command>
				<replaceable>hdlc0</replaceable> up
						</simpara>
				<simpara>
							Для активация соединения после загрузки маршрутизатора, необходимо выполнить следующие команды:
						</simpara>
				<simpara>
							# <command>echo</command>
				<replaceable>&quot;ifconfig hdlc0 192.168.200.1 pointopoint 192.168.200.2&quot;</replaceable> >> <replaceable>/etc/init.d/S90my_hdlc</replaceable>
				</simpara>
				<simpara>
							# <command>echo</command>
				<replaceable>&quot;ifconfig hdlc0 down&quot;</replaceable> >> <replaceable>/etc/init.d/S90my_hdlc</replaceable>
				</simpara>
				<simpara>
							# <command>echo</command>
				<replaceable>&quot;ifconfig hdlc0 up&quot;</replaceable> >> <replaceable>/etc/init.d/S90my_hdlc</replaceable>
				</simpara>
				<simpara>
							Созданный файл необходимо сделать исполняемым:
						</simpara>
				<simpara>
							# <command>chmod</command>
				<option>+x</option>
				<replaceable>/etc/init.d/S90my_hdlc</replaceable>
				</simpara>
			</section>
		</section>
		<section id="ifaces">
			<title>Динамические интерфейсы</title>
			<section>
				<title>Работа с динамическими интерфейсами</title>
				<para>
					На странице Network/Interfaces возможно добавить или удалить динамические интерфейсы, которые не являются физическими интерфейсами, а предназначены для работы поверх них. На данный момент существуют следующие динамические интерфейсы:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Bridge</emphasis> - динамический интерфейс для создания моста.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>PPPoE</emphasis> - PPP over Ethernet.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>PPtP</emphasis> - Point-to-Point Tunneling Protocol.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Bonding</emphasis> - объединение интерфейсов.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Для создания нового динамического интерфейса необходимо выбрать его тип и нажать кнопку <emphasis>Add</emphasis>.
				</para>
				<figure>
					<title>Создание динамического интерфейса</title>
					<graphic width="6in" fileref="img/ifaces-add.png" />
				</figure>
				<para>
					Добавленный динамический интерфейс отобразится в списке сетевых интерфейсов:
				</para>
				<figure>
					<title>Динамический интерфейс в списке сетевых интерфейсов</title>
					<graphic fileref="img/ifaces-list.png" />
				</figure>
				<para>
					Чтобы удалить динамический интерфейс выберите его имя в списке интерфейсов и нажмите кнопку <emphasis>Delete</emphasis>.
				</para>
				<figure>
					<title>Удаление динамического интерфейса</title>
					<graphic width="6in" fileref="img/ifaces-del.png" />
				</figure>
			</section>
			<section id="bonding">
				<title>Настройка режима Bonding</title>
				<para>
					Режим Bonding позволяет объединять несколько физических соединений в одно логическое (с помощью создания динамического интерфейса <emphasis>bond</emphasis>). К примеру, два SHDSL канала можно объединить в один, увеличив пропускную способность соединения.
				</para>
				<para>
					Для настройки режима Bonding в первую очередь необходимо настроить физические интерфейсы (к примеру, SHDSL или Ethernet). Интерфейсы, которые будут входить в Bonding, должны быть активны и запущены (см. <link linkend="iface.common">настройку сетевых интерфейсов</link>). Для интерфейса должен быть установлен флажок <emphasis>enabled</emphasis>, т.е. его конфигурация должна иметь следующий вид:
				</para>
				<figure>
					<title>Настройка физического интерфейса</title>
					<graphic fileref="img/bond-real-iface.png" width="6in" />
				</figure>
				<para>
					Динамический интерфейс создаётся на странице Network/Interfaces, на которой в разделе Add dynamic interface необходимо выбрать в качестве протокола Bonding:
				</para>
				<figure>
					<title>Создание динамического интерфейса</title>
					<graphic fileref="img/bond-add.png" width="6in" />
				</figure>
				<para>
					После нажатия кнопки <emphasis>Add</emphasis> созданный интерфейс отобразится в списке сетевых интерфейсов.
				</para>
				<note>
					<para>
						Если вы хотите сконфигурировать несколько bonding-интерфейсов, следует добавить сразу необходимое количество динамических интерфейсов, перед их запуском. Это связано с тем, что после запуска первого bonding-интерфейса, запуск новых bonding-интерфейсов будет возможен только после перезагрузки.
					</para>
				</note>
				<para>
					Для настройки интерфейса необходимо перейти на страницу Network/Interfaces/bond*, вкладку Specific, где указать, какие физические интерфейсы будут использоваться этим динамическим интерфейсом для передачи данных. К примеру, при настройке SHDSL Bonding, можно ввести dsl0 и dsl1:
				</para>
				<figure>
					<title>Привязка к физическим интерфейсам</title>
					<graphic fileref="img/bond-specific.png" width="6in" />
				</figure>
				<para>
					После сохранения настроек переходим на вкладку General. Здесь необходимо выставить флажки <emphasis>enabled</emphasis> и <emphasis>auto</emphasis>, чтобы интерфейс автоматически запускался при загрузке маршрутизатора. Если для динамического интерфейса необходимо назначить IP-адрес, то в параметре <emphasis>Method</emphasis> надо выбрать необходимый метод установки IP-адреса и произвести его настройку (в случае статического IP-адреса - прописать адрес на вкладке <emphasis>Method</emphasis>).
				</para>
				<figure>
					<title>Конфигурация динамического интерфейса</title>
					<graphic fileref="img/bond-general.png" width="6in" />
				</figure>
				<para>
					После сохранения настроек на вкладке General, динамический интерфейс будет автоматически запущен. При этом IP-адреса реальных интерфейсов, если они были установлены, будут сброшены. Для всех интерфейсов (динамического и входящих в него физических) будет установлен один MAC-адрес, который будет соответствовать MAC-адресу одного из физических интерфейсов.
				</para>
				<note>
					<para>
						Аналогичные настройки необходимо произвести на втором маршрутизаторе.
					</para>
				</note>
				<note>
					<para>При разрыве одного из физических соединений, трафик будет передаваться по оставшемуся соединению.</para>
				</note>
			</section>
			<section id="bridge">
				<title>Настройка моста</title>
				<para>
					Работа маршрутизатора в режиме моста (bridging) позволяет прозрачно передавать трафик между интерфейсами, имитируя работу коммутатора. Для этого создается специальный сетевой динамический интерфейс с именем <emphasis>br</emphasis>, с которым ассоциируются сетевые интерфейсы, между которыми будет передаваться трафик.
				</para>
				<figure>
					<title>Пример моста</title>
					<graphic width="6in" fileref="img/bridge.png" />
				</figure>
				<para>
					В приведенном выше рисунке мост состоит из двух интерфейсов - Ethernet-интерфейса eth0 и SHDSL-интерфейса dsl0 - и объединяет в одну сеть компьютеры PC1 и PC2.
				</para>
				<note>
					<para>
						Следует заметить, что маршрутизатор, работающий в режиме моста и сети, между которыми он передаёт трафик, не обязательно должны находиться в одном адресном пространстве, как это требуется при настройке маршрутизации трафика.
					</para>
					<para>
						Более того, у такого маршрутизатора вообще может не быть IP-адреса. Однако, если необходимо управление маршрутизатором, то ему необходимо назначить IP-адрес, входящий в ту же сеть, что и компьютер, с которого будет производиться управление. В нашем примере, маршрутизаторам можно назначить IP-адреса 192.168.90.10 и 192.168.90.11.
					</para>
				</note>
				<para>
					На следующем рисунке изображена сеть, аналогичная предыдущей, но с использованием технологии объединения каналов (bonding), позволяющей увеличить производительность сети. В этом случае мост состоит из Ethernet-интерфейса eth0 и объединенных SHDSL-интерфейсов dsl0 и dsl1 в один интерфейс bond0:
				</para>
				<figure>
					<title>Пример моста с объединением интерфейсов</title>
					<graphic width="6in" fileref="img/bridge+bonding.png" />
				</figure>
				<para>
					Так же, как и для настройки режима Bonding, в первую очередь необходимо настроить физические интерфейсы, которые будут входить в мост: они должны быть активны (см. <link linkend="iface.common">настройку сетевых интерфейсов</link>). Для интерфейсов должен быть установлен флажок <emphasis>enabled</emphasis>, т.е. их конфигурация должна иметь следующий вид:
				</para>
				<figure>
					<title>Настройка физического интерфейса</title>
					<graphic fileref="img/bond-real-iface.png" width="6in" />
				</figure>
				<para>
					Создание динамического интерфейса происходит на странице Network/Interfaces, на которой в меню Add dynamic interface надо выбрать в качестве протокола Bridge:
				</para>
				<figure>
					<title>Создание интерфейса</title>
					<graphic width="6in" fileref="img/bridge-add.png" />
				</figure>
				<para>
					После добавления динамического интерфейса он появится в списке сетевых интерфейсов. Для его настройки перейдём на страницу Network/Interfaces/br* и выберем вкладку Specific, на которой определим список интерфейсов, входящих в мост. Для этого в поле Interfaces укажем имена сетевых интерфейсов:
				</para>
				<figure>
					<title>Привязка к физическим интерфейсам</title>
					<graphic width="6in" fileref="img/bridge-specific.png" />
				</figure>
				<para>
					После сохранения настроек перейдём на вкладку General, на которой установим флажки <emphasis>enabled</emphasis> и <emphasis>auto</emphasis> для автоматического запуска интерфейса во время загрузки маршрутизатора:
				</para>
				<figure>
					<title>Конфигурация динамического интерфейса</title>
					<graphic fileref="img/bridge-general.png" width="6in" />
				</figure>
				<important>
					<para>
						Начиная с версии прошивки 879 больше нет необходимости указывать зависимый интерфейс в поле Depended on - интерфейс моста автоматически запускает интерфейсы, из которых он состоит.
					</para>
				</important>
				<note>
					<para>
						Если для динамического интерфейса необходимо назначить IP-адрес, то в параметре <emphasis>Method</emphasis> надо выбрать необходимый метод установки IP-адреса и произвести его настройку (в случае статического IP-адреса - прописать адрес на вкладке <emphasis>Method</emphasis>).
					</para>
				</note>
				<important>
					<para>
						Запуск интерфейса <emphasis>br*</emphasis> приводит к сбросу IP-адресов с физических интерфейсов, которые в него входят. Таким образом, если настройка осуществляется через физический интерфейс, который входит в мост, управление над маршрутизатором может быть потеряно. Чтобы этого избежать, необходимо назначить динамическому интерфейсу <emphasis>br*</emphasis> IP-адрес.
					</para>
				</important>
				<para>
					Эту же процедуру повторяем на втором маршрутизаторе, и через пару минут, в течении которых &quot;мост&quot; распознает топологию сети и проведёт небольшой этап самообучения, начнется передача пакетов между интерфейсами.
				</para>
			</section>
			<section id="pptp">
				<title>Настройка соединения PPtP</title>
				<para>
					<emphasis>PPtP</emphasis> - Point-to-point tunneling protocol - туннельный протокол типа точка-точка, позволяющий создать виртуальную частную сеть (VPN) поверх физической сети.
				</para>
				<para>
					Для создания соединения необходимо добавить динамический интерфейс PPtP. Это выполняется на странице Network/Interfaces:
				</para>
				<figure>
					<title>Добавления интерфейса PPtP</title>
					<graphic fileref="img/pptp-add.png" width="6in" />
				</figure>
				<para>
					После добавления, следует снова перейти на страницу Network/Interfaces, чтобы обновить список доступных интерфейсов. Настройка интерфейса выполняется на странице Network/Interfaces/pptp*. Рассмотрим специфичные для данного интерфейса параметры:
				</para>
				<figure>
					<title>Вкладка Specific</title>
					<graphic fileref="img/pptp-specific.png" width="6in" />
				</figure>
				<itemizedlist>
					<listitem><para>Server - имя или IP-адрес сервера PPtP, к которому будет выполняться подключение.</para></listitem>
					<listitem><para>Username - имя пользователя.</para></listitem>
					<listitem><para>Password - пароль.</para></listitem>
					<listitem><para>Default route - является ли это соединение маршрутом по-умолчанию.</para></listitem>
					<listitem><para>PPPD Options - параметры, которые будет переданы демону PPPD при подключении.</para></listitem>
				</itemizedlist>
				<important>
					<para>
						После создания и первого редактирования настроек соединение будет инициализировано, независимо от параметров на вкладке General.
					</para>
				</important>
				<para>
					Активировать соединение и включить его автоматическую инициализацию после загрузки маршрутизатора можно на вкладке General:
				</para>
				<figure>
					<title>Вкладка General</title>
					<graphic fileref="img/pptp-general.png" width="6in" />
				</figure>
				<note>
					<para>
						При данном виде сетевого подключения параметр Method игнорируется и может принимать любые значения.
					</para>
				</note>
				<note>
					<para>
						На данный момент подключение по PPtP с использованием шифрования MPPE невозможно.
					</para>
				</note>
			</section>
			<section id="pppoe">
				<title>Настройка соединения PPPoE</title>
				<para>
					<emphasis>PPPoE</emphasis> - Point-to-point protocol over Ethernet - сетевой протокол передачи кадров PPP через Ethernet. Так же, как <emphasis>PPtP</emphasis> это туннелирующий протокол, но работающий непосредственно поверх Ethernet, создающий соединение типа точка-точка. Использование PPP предоставляет возможности аутентификации, сжатия трафика и его шифрования.
				</para>
				<para>
					Для создания соединения необходимо добавить динамический интерфейс PPPoE на странице Network/Interfaces:
				</para>
				<figure>
					<title>Добавление интерфейса PPPoE</title>
					<graphic fileref="img/pppoe-add.png" width="6in" />
				</figure>
				<para>
					После добавления, следует снова перейти на страницу Network/Interfaces, чтобы обновить список доступных интерфейсов. Настройка интерфейса выполняется на странице Network/Interfaces/pppoe*. Рассмотрим специфичные для данного интерфейса параметры:
				</para>
				<figure>
					<title>Вкладка Specific</title>
					<graphic fileref="img/pppoe-specific.png" width="6in" />
				</figure>
				<itemizedlist>
					<listitem><para>Interface - физический интерфейс, в сети которого находится PPPoE сервер (eth0, eth1, ...)</para></listitem>
					<listitem><para>Service - маршрутизатор будет устанавливать соединение с теми серверами PPPoE, которые предоставляют данный сервис. В большинстве случаев этот параметр не используется.</para></listitem>
					<listitem><para>Access Concentrator - маршрутизатор будет устанавливать соединение только с указанным концентратором. Используется в случае наличия нескольких серверов PPPoE.</para></listitem>
					<listitem><para>Default route - является ли это соединение маршрутом по-умолчанию.</para></listitem>
					<listitem><para>Username - имя пользователя.</para></listitem>
					<listitem><para>Password - пароль.</para></listitem>
					<listitem><para>PPPD Options - параметры, которые будет переданы демону PPPD при подключении.</para></listitem>
				</itemizedlist>
				<para>
					Активировать соединение и включить его автоматическую инициализацию после загрузки маршрутизатора можно на вкладке General:
				</para>
				<figure>
					<title>Вкладка General</title>
					<graphic fileref="img/pppoe-general.png" width="6in" />
				</figure>
			</section>
			<section id="vlan">
				<title>Настройка интерфейсов VLAN</title>
				<para>
					Использование технологии VLAN позволяет разделить трафик пользователей в единой физической среде передачи данных. Для это в каждый Ethernet-кадр добавляет заголовок, относящий данный кадр к тому или иному VLAN. Каждый VLAN идентифицируется своим номером - <emphasis>VLAN ID</emphasis>, в диапазоне от 0 до 4094. Для работы с сетями VLAN на основе физического интерфейса создаётся интерфейс VLAN, с определённым VLAN ID.
				</para>
				<para>
					Для создания интерфейса VLAN необходимо создать динамический интерфейс VLAN на странице Network/Interfaces. Для этого в форме "Add VLAN interface" выбираем интерфейс, поверх которого будет работать интерфейс VLAN, и вводим номер VLAN - VLAN ID.
				</para>
				<figure>
					<title>Добавление интерфейса VLAN</title>
					<graphic fileref="img/vlan-add.png" width="6in" />
				</figure>
				<tip>
					<para>
						Интерфейс VLAN может работать как поверх физических интерфейсов (SHDSL, Ethernet), так и поверх динамических (Bonding, Bridge).
					</para>
				</tip>
				<para>
					После добавления, интерфейс VLAN будет показан в списке интерфейсов в виде "ИНТЕРФЕЙСvНОМЕР_ВЛАН", т.е. если интерфейс VLAN создаётся для интерфейса bond0 и VLAN ID 4, то имя интерфейса VLAN будет <emphasis>bond0v4</emphasis>. В системе интерфейс отображается как <emphasis>bond0.4</emphasis>.
				</para>
				<para>
					Теперь над интерфейсом можно выполнять стандартные действия: назначать IP-адрес, добавлять его в бондинг или бридж.
				</para>
			</section>
		</section>
  </chapter>
  <chapter id="dhcp_server">
    <title>Настройка сетевых служб</title>
    <section>
      <title>DHCP-сервер</title>
      <para>
				Настройка DHCP-сервера выполняется независимо для каждого сетевого интерфейса и производится на вкладке Network/настраиваемый сетевой интерфейс/DHCP. На этой странице представлены конфигурационные параметры, управляющие работой DHCP-сервера, а так же параметры сетевой конфигурации, которые передаются клиенту.
			</para>
      <para>
				Общий вид страницы конфигурации представлен на рисунке:
				<figure>
          <title>Настройка DHCP-сервера</title>
          <graphic fileref="img/eth-dhcp.png" />
        </figure>
      </para>
      <para>
				Настройки DHCP-сервера:
				<itemizedlist>
          <listitem>За активацию DHCP-сервера отвечает опция Enable DHCP server</listitem>
          <listitem>Значения Start IP и End IP указывают диапазон IP адресов, из которого будет выбираться адрес для клиента</listitem>
        </itemizedlist>
      </para>
      <para>
				Сетевые настройки, которые будут переданы клиенту:
				<itemizedlist>
          <listitem>Netmask - задает сетевую маску</listitem>
          <listitem>Default router - маршрут по-умолчанию</listitem>
          <listitem>Default lease time - время, на которое выдается IP адрес. По истечению этого времени клиент должен снова обратиться к DHCP-серверу для подтверждения использования выданного ранее адреса или получения нового</listitem>
          <listitem>DNS server - IP адрес DNS-сервера, к которому будет обращаться клиент для разрешения доменных имен</listitem>
          <listitem>Domain - домен, который будет присвоен клиенту</listitem>
          <listitem>NTP server - IP адрес сервера точного времени</listitem>
          <listitem>WINS server - IP адрес WINS сервера</listitem>
        </itemizedlist>
      </para>
      <note>
        <simpara>После сохранения настроек, DHCP сервер будет запущен либо перезапущен автоматически.</simpara>
      </note>
      <para>
				Существует возможность присваивать определенным машинам статические IP адреса. Идентификация машин производится по значению MAC адреса сетевой карты. Форма для привязки IP адреса к MAC адресу находится внизу страницы конфигурации и представлена на рисунке:
				<figure>
          <title>Список статических IP-адресов</title>
          <graphic fileref="img/eth-dhcp-add.png" />
        </figure>
      </para>
      <para>
				Изначально форма пуста. Добавление значений производится с помощью формы, вызываемой по нажатию на кнопку 
				<inlinemediaobject>
          <imageobject>
            <imagedata fileref="img/eth-dhcp-button-plus.png" />
          </imageobject>
        </inlinemediaobject>
				 справа от заголовка таблицы:
				 <figure>
          <title>Форма привязки IP к MAC</title>
          <graphic fileref="img/eth-dhcp-add-form.png" />
        </figure>
        <itemizedlist>
          <listitem>Host name - задает имя машины, для которой выполняется привязка адреса. Это значение носит справочный характер и используется только в правиле, и может не соответствовать фактическому имени машины</listitem>
          <listitem>IP Address - IP адрес, который будет присвоен данной машине</listitem>
          <listitem>MAC Address - MAC адрес сетевой карты машины. Именно при совпадении с этим адресом происходит присвоение указанного IP адреса</listitem>
        </itemizedlist>
      </para>
      <para>
				После заполнения полей, необходимо сохранить внесенные изменения. После этого, в список статических IP адресов будет добавлен новый адрес, а на экране появится новая форма для добавления следующего IP адреса. После добавления всех статических адресов, форму можно закрыть.
				<figure>
          <title>Обновленный список IP-адресов</title>
          <graphic fileref="img/eth-dhcp-add-list.png" />
        </figure>
      </para>
      <para>
				Существующие в таблице записи можно изменить с помощью кнопки 
				<inlinemediaobject>
          <imageobject>
            <imagedata fileref="img/eth-dhcp-button-e.png" />
          </imageobject>
        </inlinemediaobject>
				, находящейся справа от правила. Удаление правила осуществляется кнопкой 
				<inlinemediaobject>
          <imageobject>
            <imagedata fileref="img/eth-dhcp-button-x.png" />
          </imageobject>
        </inlinemediaobject>
				.
			</para>
    </section>
	<section id="pptp_server">
		<title>PPTP-сервер</title>
		<para>
			PPTP-сервер позволяет организовать ВПН - виртуальную частную сеть - поверх обычной сети. Для этого пользователи подключаются к ВПН-серверу, и в случае успешной авторизации получает доступ к ресурсам частной сети. Функции ВПН-сервера в маршрутизаторе выполняет PPTP-сервер - point-to point tunneling protocol.
		</para>
		<para>
			Страница конфигурации находится в Services/PPTP server и приведена ниже:
			<figure>
				<title>Конфигурация PPTP-сервера</title>
				<graphic fileref="img/pptpd.png" width="6in" />
			</figure>
		</para>
		<para>
			Активация ВПН-сервера выполняется установкой флажка напротив параметра <emphasis>Enable PPTP server</emphasis>. Настройка сервера состоит из двух стадий - конфигурации самого сервера и добавления пользователей, которые могут к нему подключаться. Рассмотрим параметры конфигурации сервера:
		</para>
		<itemizedlist>
			<listitem>Name - имя ВПН-сервера. Используется при аутентификации. У пользователя в *-secret файле значение имени сервера должно совпадать с этим, либо там должна стоять "звездочка".</listitem>
			<listitem>Local IP range - диапазон IP-адресов, которые будут присвоены соединению на стороне сервера.</listitem>
			<listitem>Remote IP range - диапазон IP-адресов, которые будут присвоены соединению на стороне клиента.</listitem>
			<listitem>
				Механизмы аутентификации. Имеют три значения - <emphasis>none</emphasis> - не определено,  <emphasis>require</emphasis> - обязателен, <emphasis>refuse</emphasis> - запрещен к использованию
				<itemizedlist>
					<listitem>PAP Mode - метод PAP</listitem>
					<listitem>CHAP Mode - метод CHAP</listitem>
					<listitem>MS CHAP Mode - метод MS CHAP</listitem>
					<listitem>MS CHAPv2 Mode - метод MS CHAPv2</listitem>
				</itemizedlist>
			</listitem>
			<listitem>MPPE Mode - использовать шифрование трафика по алгоритму MPPE (Microsoft Point-to-Point Encryption)</listitem>
			<listitem>DNS server - адреса первичного и вторичного сервера DNS, которые будут переданы клиенту</listitem>
			<listitem>WINS server - адрес WINS сервера</listitem>
			<listitem>PPPD options - опции, которые будут переданы серверу pptp</listitem>
		</itemizedlist>
		<para id="auth_ppp">
			После внесения изменений, конфигурацию необходимо сохранить. Для добавления пользователей ВПН-сервера, перейдем на страницу System/Security/PPP secrets:
		</para>
		<figure>
			<title>Пользователи ВПН-сервера</title>
			<graphic fileref="img/chap-list-empty.png" width="6in" />
		</figure>
		<para>
			Вкладка CHAP содержит пользователей, использующих систему аутентификации CHAP (в т.ч. обе версии MS CHAP), вкладка PAP - соответственно пользователей, использующих PAP. Пример добавления нового пользователя показан ниже:
		</para>
		<figure id="auth_ppp_edit">
			<title>Добавление нового пользователя</title>
			<graphic fileref="img/chap-add.png" width="6in" />
		</figure>
		<itemizedlist>
			<listitem>Username - имя пользователя</listitem>
			<listitem>Password - пароль пользователя</listitem>
			<listitem>Server - имя сервера ВПН, "звездочка" - любой</listitem>
			<listitem>IP address - IP-адрес, выдаваемый клиенту. "Звездочка" - любой.</listitem>
		</itemizedlist>
	</section>
	<section id="dns_server">
		<title>Сервер DNS</title>
		<para>Сервер ДНС отвечает за преобразование доменного имени в IP-адрес. Его настройка осуществляется на странице Services/DNS server:</para>
		<figure>
			<title>Настройка сервера ДНС</title>
			<graphic fileref="img/dns_server.png" width="6in" />
		</figure>
		<para>
			Для активации сервера ДНС необходимо поставить флажок напротив <emphasis>Enable DNS server</emphasis>. Добавление новой зоны осуществляется в форме Zones, в которой отображаются зоны, обслуживаемые сервером ДНС:
		</para>
		<figure id="dns_zones">
			<title>Зоны сервера ДНС</title>
			<graphic fileref="img/dns_server-zones.png" width="6in" />
		</figure>
		<para id="dns_zone_add">
			При добавлении новой зоны, необходимо ввести следующие параметры:
			<itemizedlist>
				<listitem>Zone id - идентификатор зоны, можно ввести имя зоны (этим идентификатором называется файл, в котором хранится зона)</listitem>
				<listitem>Zone - имя зоны (доменное имя, для которого создается зона)</listitem>
				<listitem>Enable - активна ли зона</listitem>
				<listitem>Name server - авторитетный сервер ДНС для домена</listitem>
				<listitem>Admin - адрес электронной почты администратора зоны</listitem>
				<listitem>Refresh - время, через которые ведомые сервера ДНС (slave) будут обновлять зону</listitem>
				<listitem>TTL - время, которое запись зоны может храниться в кэше</listitem>
				<listitem>retry - время, через которое ведомый сервер в случае неудачи повторит попытку обновить зону</listitem>
				<listitem>expire - время, через которое информация о зоне перестает считаться действительной</listitem>
			</itemizedlist>
		</para>
		<para>
			После добавления соответствующая запись появится в таблице зон. Пример добавления показан ниже:
		</para>
		<figure>
			<title>Добавление зоны</title>
			<graphic fileref="img/dns_server-add-zone.png" width="6in" />
		</figure>
		<para>
			Переход на добавление записей в зону осуществляется щелчком мыши по идентификатору или имени зоны. При добавлении новой записи нужно ввести следующие параметры:
			<itemizedlist>
				<listitem>Domain or host - имя (или IP-адрес, если зона реверсивная)</listitem>
				<listitem>
					Type of record - тип записи. Возможны следующие значения:
					<itemizedlist>
						<listitem>A - указывает IP-адрес, соответствующий имени</listitem>
						<listitem>CNAME - синоним другого имени. В этом случае в качестве DATA указывается соответствующее имя</listitem>
						<listitem>MX - имя почтового сервера для данного домена</listitem>
						<listitem>NS - указывает авторитетный сервер ДНС для зоны (по сути - делегирование зоны)</listitem>
						<listitem>PTR - указывает имя для данного IP-адреса. Используется в реверсивной зоне)</listitem>
						<listitem>TXT - дополнительная текстовая информация</listitem>
					</itemizedlist>
				</listitem>
				<listitem>Priority - приоритет текущей записи MX</listitem>
				<listitem>Data - данные записи - доменное имя или IP-адрес, либо какая-то текстовая информация</listitem>
			</itemizedlist>
		</para>
		<para>Пример добавления новой записи показа ниже:</para>
		<figure>
			<title>Добавление записи в зону</title>
			<graphic fileref="img/dns_server-record-add.png" width="6in" />
		</figure>
		<para>
			Пример зоны после добавления записей:
		</para>
		<figure>
			<title>Записи зоны ДНС</title>
			<graphic fileref="img/dns_server-records.png" width="6in" />
		</figure>
	</section>
  </chapter>
  <chapter id="routes">
    <title>Управление трафиком</title>
    <section>
      <title>Добавление сетевых маршрутов</title>
      <para>
				Сетевые маршруты определяют, через какие маршрутизаторы доступна та или иная сеть. Добавление маршрутов осуществляется на странице настройки того сетевого интерфейса, через который он пролегает. К примеру, сеть имеет следующую структуру:
			</para>
      <figure>
        <title>Пример: структура сети</title>
        <graphic width="6in" fileref="img/routes-network.png" />
      </figure>
      <para>
				Наш маршрутизатор имеет обозначение SG16R, и подключен к двум маршрутизаторам - GW1 и GW2 через интерфейсы eth0 (Ethernet) и dsl0 (SHDSL) соответственно. Видно, что добавление маршрутов для сетей будет иметь вид:
				<itemizedlist>
          <listitem>Network1: сеть 192.168.100./24 через маршрутизатор 192.168.1.2</listitem>
          <listitem>Network2: сеть 192.168.3.0/24 через маршрутизатор 192.168.2.1</listitem>
          <listitem>Network3: сеть 192.168.20.0/24 через маршрутизатор 192.168.2.1</listitem>
        </itemizedlist>
      </para>
      <para>
				Проанализировав маршруты, приходим к выводу, что маршрут на первую сеть относится к интерфейсу eth0, а на вторую и третью - к dsl0. Поэтому и добавление маршрутов через веб-интерфейс будет производится на страницах соответствующих интерфейсов.
			</para>
      <note>
        <simpara>
					Маршрут на сеть Network3 добавляется так же как и для сети Network 2 через маршрутизатор GW2 по причине того, что маршрутизатор SG16R не имеет прямого подключения к маршрутизатору GW3 и вынужден обращаться к нему через GW2.
				</simpara>
      </note>
      <para>
				Для добавления маршрута переходим на страницу конфигурации соответствующего маршруту интерфейса (к примеру, Network/Interfaces/eth0), где выбираем вкладку Routes:
			</para>
      <figure>
        <title>Пустой список маршрутов</title>
        <graphic width="6in" fileref="img/routes-list_empty.png" />
      </figure>
      <para>
				Изначально список пустой. Для добавления нового маршрута, нажимаем на кнопку со значком &quot;+&quot; и заполняем поля в новом окне:
			</para>
      <figure>
        <title>Добавление маршрута</title>
        <graphic fileref="img/routes-add.png" />
      </figure>
      <para>
				После добавления маршрута, информация о нем появится в таблице маршрутов:
			</para>
      <figure>
        <title>Список маршрутов</title>
        <graphic width="6in" fileref="img/routes-list_full2.png" />
      </figure>
      <para>
				Добавленные маршруты можно редактировать или удалять с помощью соответствующих кнопок. При удалении маршрута, потребуется подтвердить свои действия в диалоговом окне:
			</para>
      <figure>
        <title>Удаление маршрута</title>
        <graphic fileref="img/routes-confirm.png" />
      </figure>
      <para>
				Чтобы внесенные изменения вступили в силу, необходимо &quot;перезагрузить&quot; интерфейс, т.е. на вкладке General выключить/включить его. Если же через этот интерфейс осуществляется управление маршрутизатором, то необходимо перезагрузиться.
			</para>
      <note>
        <simpara>
					Это будет исправлено в будущих версиях ПО для маршрутизатора: после добавления маршрута изменения будут вступать в силу автоматически без перезагрузки интерфейса.
				</simpara>
      </note>
    </section>
    <section id="filter" >
      <title>Управление фаерволом</title>
      <para>
				Фаервол используется, чтобы ограничить доступ к тем или иным сетевым ресурсам, основываясь на IP-адресах, портах отправителя и назначения, или используемого протокола.
			</para>
      <para>
				Активация фаервола осуществляется на странице Network/Firewall:
			</para>
      <figure>
        <title>Активация фаервола</title>
        <graphic width="6in" fileref="img/fw-activate.png" />
      </figure>
      <para>
				Работа фаервола основана на прохождением пакетов цепочек правил, где каждое правило определяет одно из действий: прием или отброс пакета, основываясь на одном или нескольких критериях. Добавление правил осуществляется на странице Network/Firewall/Filter. Для каждой цепочки устанавливается действие по-умолчанию - политика, т.е. в случае, если пакет не попал ни под один критерий:
			</para>
      <figure id="filter_policy">
        <title>Политики цепочек</title>
        <graphic width="6in" fileref="img/fw-policy.png" />
      </figure>
      <note>
        <simpara>
					При установлении политики в значение DROP для цепочки INPUT или OUTPUT, удостоверьтесь, что в этих цепочках есть разрешающие правила, иначе управление маршрутизатором может быть потеряно.
				</simpara>
      </note>
      <para>
				Для правила определены следующие действия:
				<itemizedlist>
          <listitem>ACCEPT - прием пакета</listitem>
          <listitem>DROP - отброс пакета без отправки уведомления источнику пакета</listitem>
          <listitem>REJECT - отброс пакета с отправкой уведомления</listitem>
        </itemizedlist>
      </para>
      <para>
				Цепочку FORWARD проходят пакеты, являющиеся транзитными, т.е. идущие с одного интерфейса маршрутизатора на другой:
			</para>
      <figure id="filter_forward">
        <title>Цепочка FORWARD</title>
        <graphic width="6in" fileref="img/fw-forward.png" />
      </figure>
      <para>
				В цепочку INPUT попадают пакеты, предназначающиеся маршрутизатору:
			</para>
      <figure id="filter_input">
        <title>Цепочка INPUT</title>
        <graphic width="6in" fileref="img/fw-input.png" />
      </figure>
      <para>
				В цепочку OUTPUT попадают пакеты, источником которых является маршрутизатор:
			</para>
      <figure id="filter_output">
        <title>Цепочка OUTPUT</title>
        <graphic width="6in" fileref="img/fw-output.png" />
      </figure>
      <para>
				Добавление правил осуществляется нажатием кнопки &quot;+&quot;, и заполнением формы, открывшейся в новом окне:
			</para>
      <figure id="filter_add">
        <title>Добавление правила</title>
        <graphic fileref="img/fw-add.png" />
      </figure>
      <para>
        <itemizedlist>
          <listitem>Short name - имя правила. Должно включать только английские буквы и цифры</listitem>
          <listitem>Enable - активно ли правило</listitem>
          <listitem>Source - IP-адрес или сеть источника пакета</listitem>
          <listitem>Destination - IP-адрес или сеть получателя пакета</listitem>
          <listitem>Protocol - протокол</listitem>
          <listitem>Source port - порт источника пакета</listitem>
          <listitem>Destination port - порт получателя пакета</listitem>
          <listitem>Action - действие, выполняемое над пакетом</listitem>
        </itemizedlist>
      </para>
      <para>
				Удаление и редактирование правила осуществляется соответственно кнопками &quot;x&quot; и &quot;e&quot;.
			</para>
      <note>
        <simpara>
					Если внесенные вами изменения не вступают в силу, проверьте, что вы активировали фаервол на странице Network/Firewall.
				</simpara>
      </note>
    </section>
    <section id="nat" >
      <title>NAT</title>
      <para>
				NAT - network address translation - позволяет заменять адреса источника или отправителя пакета.
			</para>
      <para>
				НАТ является частью фаервола, поэтому схема управления остается той же, меняется только действие. Все сетевые пакеты, являются ли они транзитными или предназначаются маршрутизатору, попадают сперва в цепочку PREROUTING, где над ними может быть выполнено несколько действий. В этой цепочке не рекомендуется производить фильтрацию пакетов, для этого надо использовать цепочку FORWARD фаервола. Цепочка PREROUTING предназначена для выполнения DNAT - destination NAT, т.е. замена адреса получателя пакета.
			</para>
      <figure id="nat_prerouting">
        <title>Цепочка PREROUTING</title>
        <graphic width="6in" fileref="img/nat-prerouting.png" />
      </figure>
      <para>
				В цепочку POSTROUTING идут пакеты, выходящие с маршрутизатора, транзитные или сгенерированные на маршрутизаторе. В этой цепочке можно выполнить SNAT - source NAT - замену адреса отправителя, с указанием адреса, либо MASQUERADE - смысл тот же, только адрес замена будет выбираться автоматически (удобно при работе с динамическими интерфейсами и IP-адресами).
			</para>
      <figure id="nat_postrouting">
        <title>Цепочка POSTROUTING</title>
        <graphic width="6in" fileref="img/nat-postrouting.png" />
      </figure>
      <para>
				Для этих цепочек так же выставляются политики, т.е. действия для пакетов, не попавшие ни под одно правило:
			</para>
      <figure>
        <title>Политики цепочек</title>
        <graphic width="6in" fileref="img/nat-policy.png" />
      </figure>
    <note>
        <simpara>
			Т.к. в цепочку PREROUTING попадают пакеты, предназначающиеся самому маршрутизатору, перед выставлением политики DROP убедитесь, что в цепочке есть правило, разрешающее прохождение пакетов для управления маршрутизатором.
		</simpara>
      </note>
	<para>
				Добавление правил осуществляется нажатием кнопки &quot;+&quot;, расположенной рядом с заголовком соответствующей таблицы:
	</para>
      <figure id="nat_add">
        <title>Добавление правила</title>
        <graphic fileref="img/nat-add.png" />
      </figure>
      <para>
				Добавление правила и поля аналогично добавлению правила в фаерволе (Network/Firewall/Filter), добавляется только одно новое поле:
				<itemizedlist>
          <listitem>Nat to address - IP-адрес, которым будет заменяться адрес отправителя или получателя, в зависимости от действия. При выполнении действий, отличных от SNAT и DNAT, заполнение поля необязательно.</listitem>
        </itemizedlist>
      </para>
      <para>
				Редактирование и удаление правил осуществляется с помощью кнопок &quot;e&quot; и &quot;x&quot;, расположенных рядом с правилом.
			</para>
      <para>
				Для работы НАТа необходимо активировать фаервол на странице Network/Firewall.
			</para>
    </section>
	<section id="qos">
		<title>Качество обслуживания</title>
		<para>
			Качество обслуживания (QoS - quality of service) позволяет изменить очередность прохождения трафика на интерфейсе. Разные дисциплины обслуживания предоставляют разные возможности по управлению трафиком и его классификации.
		</para>
		<section id="pfifo_fast">
			<title>Бесклассовая дисциплина pfifo_fast</title>
			<para>
				Стандартная дисциплина обслуживания трафика, реализующая простой механизм First In First Out. Состоит из трех полос - 0, 1 и 2. Полоса 0 обслуживается до тех пор, пока в ней есть пакеты, ожидающие передачи. Затем аналогичным образом обслуживаются полосы 1 и 2.
			</para>
			<para>
				Распределять трафик по полосам можно с помощью установки битов ToS - Type of Service, которая производится средствами фаервола. Существует четыре бита ToS, в каждый момент времени может быть установлен только один:
			</para>
			<itemizedlist>
				<listitem><para>Minimum Delay - минимальная задержка</para></listitem>
				<listitem><para>Maximum Throughput - максимальная пропускная способность</para></listitem>
				<listitem><para>Maximum Reliability - максимальная надежность</para></listitem>
				<listitem><para>Minimum Cost - минимальная стоимость канала</para></listitem>
			</itemizedlist>
			<important><para>В текущей версии веб-интерфейса маршрутизатора отсутствует возможность установки битов ToS. Для этого можно воспользоваться консольным интерфейсом маршрутизатора.</para></important>
		</section>
		<section id="sfq">
			<title>Бесклассовая дисциплина SFQ</title>
			<para>
				SFQ - Stochastic Fairness Queueing - дисциплина честного планирования. Она оперирует таким понятием, как "поток" - сессия TCP или поток данных UDP, для каждого из которого создается своя очередь в рамках этой дисциплины. Дисциплина поочередно (round robin) переключается между очередями, не позволяя какому-либо потоку использовать весь канал монопольно.
			</para>
		</section>
		<section id="tbf">
			<title>Бесклассовая дисциплина TBF</title>
			<para>
				Token Bucket Filter (TBF) - простая бесклассовая дисциплина, пропускающая поступающие пакеты со скоростью, не превышающей заданной. Эта дисциплина относится весьма бережливо к ресурсам системы, поэтому в случае, если надо просто ограничить скорость исходящего трафика - это лучший выбор.
			</para>
			<para>
				Смысл работы данной дисциплины заключается в следующем. Поступающие для передачи пакеты записываются в буффер дисциплины, откуда они с заданной скоростью поступают на исходящий интерфейс. Возможно три ситуации:
				<itemizedlist>
					<listitem><para>Пакеты поступают со скоростью, равной скорости передачи их на исходящий интерфейс. В этом случае пакеты проходят через интерфейс без задержек.</para></listitem>
					<listitem><para>Пакеты поступают со скоростью, меньшей скорости передачи их на исходящий интерфейс. В этом случае при кратковременном возрастании скорости входящего трафика - он будет накоплен во входящей очереди и передан с заданной скоростью.</para></listitem>
					<listitem><para>Пакеты поступают со скоростью, превышающей скорость передачи их на исходящий интерфейс. В этом случае через некоторое время пакеты начнут сбрасываться.</para></listitem>
				</itemizedlist>
			</para>
			<para>Дисциплина имеет несколько параметров, позволяющих управлять ее работой:</para>
			<figure>
				<title>Конфигурирования TBF</title>
				<graphic fileref="img/qos-tbf.png" width="6in" />
			</figure>
			<itemizedlist>
				<listitem><para>Rate - скорость, с которой поступающий трафик передается на исходящий интерфейс</para></listitem>
				<listitem><para>Tocken Buffer - число байт, передаваемых в момент времени на исходящий интерфейс</para></listitem>
				<listitem><para>Limit - размер буфера в байтах, в который записываются поступающие пакеты, если скорость их поступления превышает скорость их передачи на исходящий интерфейс. При превышении этого параметра пакеты будут сбрасываться.</para></listitem>
				<listitem><para>Latency - время, которое пакет может находиться, ожидая передачи на исходящий интерфейс. По истечении этого времени, пакет будет сброшен.</para></listitem>
			</itemizedlist>
			<important>
				<para>
					Одновременно можно выставлять либо <emphasis>Limit</emphasis>, либо <emphasis>Latency.</emphasis>
				</para>
			</important>
		</section>
		<section id="htb">
			<title>Классовая дисциплина HTB</title>
			<para>
				Дисциплина HTB позволяет отдать предпочтение определенным пользователям или типам трафика, определяя их на основании IP-адресов или портов отправителя/получателя в разные классы трафика.
			</para>
			<para>
				В первую очередь следует отметить, что управлять скоростью можно только исходящего трафика (что, в общем, вполне разумно), поэтому при добавлении правил шейпинга необходимо определить интерфейс, на котором этот трафик будет исходящим.
			</para>
			<para>
				Реализация QoS на основе классовой дисциплины HTB состоит из двух этапов - создания класса и распределения трафика по классам в соответствии с определенными критериями с помощью фильтров. Классы, определяющие скорость трафика, могут добавляться как в корень, так и в другие подклассы, образуя иерархию классов. Фильтры добавляются в корень иерархии.
			</para>
			<tip>
				<para>
					Особенность подклассов в том, что скорость одного подкласса может быть увеличена (в пределах скорости родительского класса) за счет <emphasis>неиспользуемой</emphasis> скорости другого подкласса.
				</para>
			</tip>
			<figure id="qos_class">
				<title>Классы трафика</title>
				<graphic fileref="img/qos-class.png" width="6in" />
			</figure>
			<figure id="qos_filter">
				<title>Фильтры, направляющие трафик в классы</title>
				<graphic fileref="img/qos-filter.png" width="6in" />
			</figure>
			<para>
				Рассмотрим в качестве примера простую сеть, схема которой представленна ниже:
			</para>
			<figure>
				<title>Пример сети</title>
				<graphic fileref="img/tc-network.png" width="6in"/>
			</figure>
			<para>
				К примеру, если мы хотим ограничить пропускную способность канала для входящего трафика к хосту PC2, то нам необходимо работать с интерфейсом eth1 маршрутизатора, поскольку через него проходит исходящий трафик к хосту PC2. В качестве примера  ограничим весь трафик, поступающий на PC2, для этого нам необходимо создать класс, в который будет поступать трафик, идущий к хосту PC2:
			</para>
			<figure id="qos_class_add">
				<title>Добавление класса</title>
				<graphic fileref="img/qos-class-add.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem><para>Short name - имя добавляемого класса. Используется при классификации трафика в фильтре</para></listitem>
				<listitem><para>Enable - активен ли класс</para></listitem>
				<listitem><para>Parent class - родительский класс. root - корневой класс. При добавлении класса в некорневой класс - добавляемый класс будет <emphasis>подклассом</emphasis></para></listitem>
				<listitem><para>Rate - пропускная способность, выделяемая классу</para></listitem>
				<listitem><para>Ceil - максимальная пропускная способность подкласса (в случае, если другой подкласс этого же класса использует не всю предоставленную ему пропускную способность)</para></listitem>
			</itemizedlist>
			<para>
				Чтобы избежать путаницы, заранее рассмотрим принятые сокращения, описывающие скорость:
				<itemizedlist>
					<listitem>mbps = 1024 kbps = 1024 * 1024 bps => byte/s => 1024 килобайт в секунду</listitem>
					<listitem>mbit = 1024 kbit => kilo bit/s => 1024 килобит в секунду</listitem>
				</itemizedlist>
			</para>
			<para>
				Теперь нам необходимо классифицировать трафик, идущий к хосту PC2. Для этого нам необходимо создать фильтр:
			</para>
			<figure id="qos_filter_add">
				<title>Добавление фильтра</title>
				<graphic fileref="img/qos-filter-add.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem><para>Short name - имя фильтра</para></listitem>
				<listitem><para>Enable - активен ли фильтр</para></listitem>
				<listitem><para>Prio - приоритет фильтра. Чем меньше значение приоритета - тем он выше</para></listitem>
				<listitem><para>Protocol - классификация трафика по используемому протоколу</para></listitem>
				<listitem><para>Src - классификация трафика по адресу отправителя пакета</para></listitem>
				<listitem><para>Dst - классификация трафика по адресу получателя пакета</para></listitem>
				<listitem><para>Src port - классификация трафика по номеру порта отправителя пакета</para></listitem>
				<listitem><para>Dst port - классификация трафика по номеру порта получателя пакета</para></listitem>
				<listitem><para>Class - в какой класс направить пакет</para></listitem>
			</itemizedlist>
			<para>
				В приведенным ваше примере мы ограничили входящую скорость для хоста PC2. Но исходящая осталась неограниченной. Чтобы исправить положение, необходимо определить, какой интерфейс является исходящем для трафика с PC2. Это зависит от того, кто запрашивает трафик с PC2, в нашем случае это может быть только PC1, следовательно интерфейс, через который пойдет трафик к PC1, будет eth0. Поэтому для ограничения исходящего трафика необходимо создать класс с требуемой скоростью и добавить фильтр, который будет отправлять трафик, идущий от хоста PC2 (src 192.168.90.2) направлять в нужный класс.
			</para>
		</section>
	</section>
  </chapter>
  <chapter id="multiplexing">
	  <title>Мультиплексирование</title>
		<section>
			<title>Конфигурация</title>
			<para>
				Мультиплексирование используется для передачи трафика с одного интерфейса на другой, минуя центральный процессор. <emphasis>SG-17R</emphasis> позволяет одновременно мультиплексировать и маршрутизировать сетевой трафик.
			</para>
			<para>
				В общем виде это можно представить так:
			</para>
			<figure>
				<title>Схема сети</title>
				<graphic fileref="img/multiplexing1.png" width="6in" />
			</figure>
			<para>
				В приведенном примере к маршрутизаторам SG-17R подключено два канала Е1, а так же сеть TCP/IP по Ethernet. Два маршрутизатора соединены между собой через SHDSL. Максимальная скорость SHDSL составляет 5696 кбит/c, т.е. по одному каналу SHDSL можно передать два канала Е1 (2048 кбит/с каждый), и останется неиспользованными 1600 кбит/с.
			</para>
			<para>
				Для передачи потоков Е1 используется мультиплексирование: оба входных потока Е1 мультиплексируются в канал SHDSL, по которому они передаются на второй маршрутизатор, где происходит демультиплексирование, и потоки расходятся к клиентам. Оставшаяся полоса SHDSL используется для передачи TCP/IP трафика между двумя Ethernet сетями.
			</para>
			<para>
				Для мультиплексирования в маршрутизаторе выделена шина, состоящая из 16 линий, каждая из которых содержит 256 тайм-слотов. Каждый тайм-слот на линии соответствует тайм-слоту в Е1 или SHDSL, т.е. имеет скорость 64 кбит/с. E1 содержит 32 тайм-слота, SHDSL - 89 тайм-слотов. Интерфейсы E1 (hdlc) и SHDSL (dsl) могут выставлять на нее данные, полученные из физической линии, и принимать данные, выставленные другим интерфейсом.
			</para>
			<figure>
				<title>Физическая организация мультиплексирования</title>
				<graphic fileref="img/multiplexing-line.png" width="6in" />
			</figure>
			<para>
				Все устройства, участвующие в мультиплексировании трафика, должны тактироваться одним сигналом. Для этого при настройке мультиплексирования необходимо указать, какой интерфейс будет задавать тактовый сигнал на линию мультиплексирования.
			</para>
			<para>
				Маршрутизатор может иметь два задающих источника синхросигнала для мультиплексирования, каждый из которых определяет <emphasis>домен</emphasis>. Каждая линия относится либо к домену А, либо к домену В, соответственно, все интерфейсы, относящиеся к этой линии, так же относятся либо к домену А, либо к В. Задающий синхросигнал можно использовать либо локальный, либо удаленный.
			</para>
			<important>
				<para>
					В одном домене должно быть одно и только одно устройство (интерфейс), задающее тактовый сигнал! Все остальные устройства домена должны быть установлены в режим <emphasis>clock slave</emphasis>. Таким образом, от одного устройства тактируются все устройства, находящиеся в данном домене.
				</para>
			</important>
			<para>
				Для настройки мультиплексирования задаются следующие параметры (для каждого интерфейса, участвующего в мультиплексировании):
			</para>
			<itemizedlist>
				<listitem><para><emphasis>rline - </emphasis>номер линии, на которую интерфейс будет выставлять данные, полученные из физической линии</para></listitem>
				<listitem><para><emphasis>rfs - </emphasis>номер тайм-слота линии, начиная с которого на нее выставляются данные этим интерфейсом</para></listitem>
				<listitem><para><emphasis>tline - </emphasis>номер линии, с которой данный интерфейс забирает данные (выставленные другим интерфейсом, участвующим в мультиплексировании) для передачи в физическую линию</para></listitem>
				<listitem><para><emphasis>tfs - </emphasis>номер тайм-слота линии, начиная с которого с нее забираются данные</para></listitem>
				<listitem><para><emphasis>mxrate - </emphasis>число тайм-слотов, отводимых для  мультиплексирования (для интерфейсов SHDSL)</para></listitem>
				<listitem><para><emphasis>mxsmap - </emphasis>карта слотов, используемых для мультиплексирования (для интерфейсов Е1). Эта карта не должна пересекаться с картой, которая задается при конфигурации интерфейса Е1 для передачи IP трафика. Задается в виде "1-16", "16-31", ...</para></listitem>
				<listitem><para><emphasis>clkm - </emphasis>если 1, устройство является источником синхронизации для данного домена, если 0 -  приемником</para></listitem>
				<listitem><para><emphasis>clkab - </emphasis>0 - устройство принадлежит домену А, 1 - к домену B</para></listitem>
				<listitem><para><emphasis>clkr - </emphasis>1 - использовать для тактирования внешний клок, 0 - использовать для тактирования локальный клок</para></listitem>
				<listitem><para><emphasis>mxen - </emphasis>1 - устройство принимает участие в мультиплексировании, 0 - устройство используется только для IP трафика</para></listitem>
			</itemizedlist>
			<important>
				<para>
					Тайм-слот в Е1 может использоваться <emphasis>только</emphasis> либо для мультиплексирования, либо для маршрутизации, поэтому карта тайм-слотов, задаваемых для мультиплексирования параметром <parameter>mxsmap</parameter> не должна пересекаться с картой тайм-слотов, указанных при конфигурации Е1 для использования в передаче IP-трафика.
				</para>
			</important>
			<para>
				Настройка мультиплексирования выполняется на странице System/Multiplexing:
			</para>
			<figure>
				<title>Конфигурация мультиплексирования</title>
				<graphic fileref="img/mux-web.png" width="6in" />
			</figure>
			<para>
				Если при конфигурации были допущены ошибки, будет показана диагностическая информация:
			</para>
			<screen>
			Checking status:
			Errors detected:
				
			WARNING: Line2: timeslots 45 written but not read
			WARNING: Line3: timeslots 55 read but not written
			</screen>
		</section>
		<section>
			<title>Примеры конфигурации</title>
			<para>Рассмотрим работу мультиплексирования на примере следующей сети:</para>
			<figure>
				<title>Пример сети</title>
				<graphic fileref="img/multiplexing-ex1.png" width="6in" />
			</figure>
			<para>
				Требуется передать два канала Е1 (unframed mode) от АТС к Клиенту 1 и Клиенту 2 по каналу SHDSL.
			</para>
			<para>
				Т.к. источник сигнала для обоих каналов Е1 один - АТС, то не имеет значения, какой из интерфейсов Е1 будет тактировать линии мультиплексирования. В нашем распоряжении имеется 16 линий, имеющих по 256 тайм-слотов. Для удобства, мы задействуем две из них - одну для приема трафика, вторую - для передачи.
			</para>
			<para>
				Схема мультиплексирования будет выглядеть следующим образом:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						Интерфейс Е1 <parameter>hdlc0</parameter> получает из физической лини данные и выставляет их на линию 0 (с нулевого тайм-слота). Для передачи в физическую линию данные берутся с линии 1, с нулевого тайм-слота. Так же этот интерфейс является источником синхронизации для данного домена.
					</para>
				</listitem>
				<listitem>
					<para>
						Интерфейс E1 <parameter>hdlc1</parameter> работает так же, как <parameter>hdlc0</parameter>, только выставляет и забирает данные начиная с 32 тайм-слота (и не подает синхросигнал, т.е. работает в режиме <emphasis>clock slave</emphasis>).
					</para>
				</listitem>
				<listitem>
					<para>
						Интерфейс SHDSL <parameter>dsl0</parameter> выставляет данные, полученные из физической линии, на линию 1 (откуда их заберут интерфейсы E1), а данные для передачи в физическую линию берет с линии 0 (куда их выставляют интерфейсы Е1). Число тайм-слотов, которые использует интерфейс для мультиплексирования, равно 64 (по 32 с каждого интерфейса Е1).
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Описанная схема проиллюстрирована ниже:
			</para>
			<figure>
				<title>Взаимодействие интерфейсов на линии 0</title>
				<graphic fileref="img/multiplexing-ex1-1-line0.png" width="6in" />
			</figure>
			<figure>
				<title>Взаимодействие интерфейсов на линии 1</title>
				<graphic fileref="img/multiplexing-ex1-1-line1.png" width="6in" />
			</figure>
			<para>
				Для реализации этой схемы необходимо установить следующие параметры:
			</para>
			<itemizedlist>
				<listitem>
					<para>Интерфейс E1 <emphasis>hdlc0</emphasis></para>
					<itemizedlist>
						<listitem>
							<para><parameter>rline = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>rfs = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tline = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tfs = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>mxsmap = "0-31"</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkm = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkr = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkab = 0</parameter></para>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>Интерфейс E1 <emphasis>hdlc1</emphasis></para>
					<itemizedlist>
						<listitem>
							<para><parameter>rline = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>rfs = 32</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tline = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tfs = 32</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>mxsmap = "0-31"</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkm = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkr = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkab = 0</parameter></para>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>Интерфейс SHDSL <emphasis>dsl0</emphasis></para>
					<itemizedlist>
						<listitem>
							<para><parameter>rline = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>rfs = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tline = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tfs = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>mxrate = 64</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkm = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkr = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkab = 0</parameter></para>
						</listitem>
					</itemizedlist>
				</listitem>
			</itemizedlist>
			<note>
				<para>
					Так же для этих интерфейсов необходимо активировать мультиплексирование - установить параметр <parameter>mxen</parameter>.
				</para>
			</note>
			<para>
				Следуя этой логике, конфигурацию на втором маршрутизаторе можно выполнить аналогичным образом. Единственное отличие, в нашем случае, будет заключаться в изменении интерфейса, являющегося источником синхронизации. Эту функцию будет выполнять интерфейс SHDSL <parameter>dsl0</parameter>, т.к. именно он получает мультиплексированный поток от первого маршрутизатора, подключенного к АТС.
			</para>
			<tip>
				<para>
					Вообще, не обязательно для приема и отправки информации использовать разные линии. Для этих целей можно задействовать одну линию, правильно указав тайм-слоты, начиная с которых каждый интерфейс выставляет или забирает данные с линии. Пример такой конфигурации приведен ниже:
				</para>
			</tip>
			<figure>
				<title>Использование одной линии для выставления и получения данных</title>
				<graphic fileref="img/multiplexing-ex1-2-line.png" width="6in" />
			</figure>
		</section>
  </chapter>
	<chapter id="snmp">
		<title>SNMP</title>
		<section id="intro">
			<title>Введение в SNMP</title>
			<para>
				<emphasis>SNMP</emphasis> - Simple Network Management Protocol - простой протокол управления сетями. Протокол позволяет производить мониторинг сетевых устройств (маршрутизаторов, мультиплексоров, мостов и др.) и сервисов (веб-серверов, почтовых серверов, серверов ДНС) и управлять их конфигурацией.
			</para>
			<para>
				Управление и мониторинг осуществляется по схеме агент-менеджер. Агент - ПО, работающее на сетевом устройстве, которое подлежит мониторингу или управлению, менеджер - ПО, собирающее информацию с агентов для мониторинга либо управления. Взаимодействие, как правило, осуществляется с помощью транспортного протокола UDP, порт 161. Так же возможно использование протокола TCP.
			</para>
			<para>
				Объекты, над которыми можно выполнять операции (чтения или записи) адресуются по уникальным номерам. Например, 1.3.6.1.2.1.1.1 соответствует объекту SysDescr - описанию системы, который может иметь следующее значение: <emphasis>STRING Linux gm-2-mpr 2.6.16 #1 Tue Nov 7 21:37:48 NOVT 2007 mips</emphasis>.
			</para>
			<para>
				<abbrev>MIB</abbrev> - Management Information Base - база данных информации управления. MIB описывает объекты и какие операции над ними можно выполнять. Если объект входит в состав MIB, то к нему можно обращаться по имени, а не по числовому индексу. 
			</para>
			<para>
				Аутентификации производится на основе "сообщества" - каждый агент относится к тому или иному сообществу. При получении команды производится проверка, принадлежит ли он к сообществу, указанному в команде. Если да - команда будет принята и обработана, иначе - проигнорирована. Сообщество представляет из себя простую строку, по-умолчанию используется два сообщества - public для просмотра объектов, private - для их изменения.
			</para>
		</section>
		<section id="support">
			<title>Уровень поддержки SNMP маршрутизатором</title>
			<para>
				Для поддержки протокола SNMP на маршрутизаторе используется свободный программный пакет <emphasis>net-snmp</emphasis>, поддерживающий все актуальные версии протокола SNMP, в состав которого входит демон <emphasis>snmpd</emphasis>, выполняющий функции агента.
			</para>
			<para>
				Маршрутизатором поддерживается <emphasis>MIB-2</emphasis>, предоставляющий общую информацию о системе (информацию о сетевых интерфейсах, таблицы маршрутизации, системную информацию), а так же <emphasis>HDSL2-SHDSL-LINE-MIB</emphasis>, содержащий объекты, используемые для мониторинга и управления каналами SHDSL.
			</para>
			<para>
				MIB-2 является стандартной MIB и входит в состав большинства менеджеров, в то время как HDSL2-SHDSL-LINE-MIB является специфичным для определённого типа устройств. Загрузить этот файл можно либо из источников в Интернете, либо по <ulink url="http://sigrand.ru/temp/HDSL2-SHDSL-LINE-MIB-rfc4319.txt">ссылке</ulink>.
			</para>
			<para>
				На данный момент по SNMP доступен только мониторинг маршрутизатора и SHDSL каналов и регенераторов, возможность управления будет добавлена в ближайшее время.
			</para>
		</section>
		<section id="snmpd">
			<title>Конфигурация SNMPD</title>
			<para>
				Конфигурация демона <emphasis>snmpd</emphasis> хранится в файле <emphasis>/etc/snmp/snmpd.conf</emphasis> и заключается в установлении прав доступа на получение и изменение объектов.
			</para>
			<para>
				Содержимое конфигурационного файла имеет следующий вид:
			</para>
			<programlisting>
				com2sec  ro  default    public
				com2sec  rw  localhost  private
				
				group  public   v1   ro
				group  public   v2c  ro
				group  public   usm  ro
				group  private  v1   rw
				group  private  v2c  rw
				group  private  usm  rw
				
				view  all  included  .1
				
				access  public   ""  any  noauth  exact  all  none  none
				access  private  ""  any  noauth  exact  all  all   all
			</programlisting>
			<para>
				Директива <emphasis>com2sec</emphasis> устанавливает соответствие между сообществом и именем безопасности, а так же устаналивает адреса, которые могут относится к этим сообществам. В приведенном выше конфигурационном файле первая директива определяет, что сообщество public соответствует безопасности ro, и ему соответствуют любые IP-адреса. Вторая директива определяет соответствие сообществу private безопасности rw, и ограничивают доступ только самим маршрутизатором.
			</para>
			<para>
				Директива <emphasis>group</emphasis> определяет, к какой группе какая безопасность относится. В нашем примере, к группе public относится безопасность ro, а к группе private - безопасность rw. v1, v2c, usm определяют модель безопасности. v1 относится к протоколу SNMP первой версии, v2c - ко второй, usm - SNMPv3.
			</para>
			<para>
				Директива <emphasis>view</emphasis> определяет имя области видимости, и что в неё входит. В нашем случае имя области видимости - all, и в неё входит всё дерево MIB.
			</para>
			<para>
				Последняя директива <emphasis>access</emphasis> определяет права доступа различных групп. В нашем примере обеим группам разрешён доступ без аутентификации, но группе public - только для чтения, а группе private - для чтения и записи.
			</para>
			<para>
				Более подробную информацию вы можете найти на сайте проекта net-snmp, в частности по <ulink url="http://net-snmp.sourceforge.net/wiki/index.php/Vacm">ссылке</ulink>.
			</para>
		</section>
		<section>
			<title>Связь SNMPD с EOCD</title>
			<para>
				<emphasis>SNMPD</emphasis> получает информацию о состоянии SHDSL-канала от демона <emphasis>EOCD</emphasis>. Таким образом, чтобы иметь возможность получать информацию о состоянии SHDSL-канала через SNMP, необходимо сконфигурировать демон EOCD. После того, как информация будет доступна через утилиту <command>eoc-info</command> - информацию можно будет получить через SNMP. Подробнее о назначении и конфигурации демона EOCD можно прочитать в разделе <link linkend="eoc" endterm="eoc.title" />.
			</para>
		</section>
		<section>
			<title>Пример использования</title>
			<para>
				В качестве примера рассмотрим мониторинг SHDSL-канала маршрутизатора. Для этого получим информацию о числе регенераторов, затухании сигнала и соотношении сигнал/шум.
			</para>
			<para>
				Числовое имя объекта, соответствующего числу регенераторов, обнаруженных на линии (Hdsl2ShdslStatusNumAvailRepeaters) равно 1.1.3.6.1.2.1.10.48.1.2.1.1.
				Для затухания сигнала (Hdsl2ShdslEndpointCurrAtn) это имя равно 1.1.3.6.1.2.1.10.48.1.5.1.1.11.1.2.1 для клиентской стороны (слейва) и 1.3.6.1.2.1.10.48.1.5.1.1.11.2.1.1 для мастера, а для соотношения сигнал/шум (Hdsl2ShdslEndpointCurrSnrMgn) - 1.3.6.1.2.1.10.48.1.5.1.2.11.1.2.1 и 1.3.6.1.2.1.10.48.1.5.1.2.11.2.1.1 соответственно. Значения этих параметров приведены ниже:
			</para>
			<programlisting>
				1.3.6.1.2.1.10.48.1.2.1.1.11 = Gauge32 0
				1.3.6.1.2.1.10.48.1.5.1.1.11.1.2.1 = INTEGER 0
				1.3.6.1.2.1.10.48.1.5.1.1.11.2.1.1 = INTEGER 0
				1.3.6.1.2.1.10.48.1.5.1.2.11.1.2.1 = INTEGER 19
				1.3.6.1.2.1.10.48.1.5.1.2.11.2.1.1 = INTEGER 17
			</programlisting>
			<para>
				Т.е. число регенераторов равно 0, затухание сигнала на обоих сторонах соединения - 0 dB, соотношение сигнал/шум на клиентской стороне 19 dB, на стороне мастера - 17 dB.
			</para>
			<para>
				При использовании специализированного ПО, поддерживающего загрузку MIB-ов, возможно получение информации в более удобной форме.
			</para>
		</section>
		<section>
			<title>Поддерживаемое ПО для управвления по SNMP</title>
			<para>
				Для реализации поддержки протокола SNMP используется свободный программный пакет <emphasis>net-snmp</emphasis>, что позволяет работать со всеми программными продуктами, совместимыми с net-snmp.
			</para>
			<para>
				Дополнительно был проведён краткий обзор доступного программного обеспечения, результаты которого представлены ниже.
			</para>
			<section>
				<title>The Dude</title>
				<para>
					<emphasis>The Dude</emphasis> - бесплатный программный продукт для работы по протоколу SNMP, работает под ОС MS Windows.
				</para>
				<figure>
					<title>The Dude</title>
					<graphic fileref="img/thedude.png" width="6in" />
				</figure>
				<para>
					Достоинства:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Автоматически определяет устройства сети.
						</para>
					</listitem>
					<listitem>
						<para>
							Рисует карту сети, позволяет добавлять на карту новые устройства, выводить на карту значения SNMP-переменных.
						</para>
					</listitem>
					<listitem>
						<para>
							Выполняет мониторинг устройств, построение графиков в режиме реального времени.
						</para>
					</listitem>
					<listitem>
						<para>
							Имеет несколько удобных встроенных утилит для сетевого администрирования и мониторинга (терминалы, snmpwalk).
						</para>
					</listitem>
					<listitem>
						<para>
							Удобные режимы просмотра SNMP информации (список, дерево, таблица).
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Недостатки:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Неправильно отображаются индексы интерфейсов в табличном представлении.
						</para>
					</listitem>
					<listitem>
						<para>
							Возможно некорректное отображение SnmpAdminString для имён SHDSL профилей.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Домашняя страница проекта: <ulink url="http://www.mikrotik.com/thedude.php">The Dude</ulink>.
				</para>
			</section>
			<section>
				<title>MIB Browser</title>
				<para>
					<emphasis>MIB Browser</emphasis>, разработка компании iReasoning, доступна в платной и бесплатной версии, различающихся лицензиями и функиональностью. Заявлена поддержка платформ Windows, Mac OS X и Linux.
				</para>
				<figure>
					<title>The Dude</title>
					<graphic fileref="img/mibbrowser.png" width="6in" />
				</figure>
				<para>
					Достоинства:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Удобный интерфейс.
						</para>
					</listitem>
					<listitem>
						<para>
							Табличный просмотр SNMP таблиц.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Недостатки:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Бесплатная версия не поддерживает SNMPv3, позволяет загружать дополнительно к имеющимся не более 5 MIB.
						</para>
					</listitem>
					<listitem>
						<para>
							Возможно некорректное отображение SnmpAdminString для имён SHDSL профилей.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Домашняя страница проекта: <ulink url="http://www.ireasoning.com/mibbrowser.shtml">MIB Browser</ulink>.
				</para>
			</section>
			<section>
				<title>OpenNMS</title>
				<para>
					<emphasis>OpenNMS</emphasis> - веб-приложение, написано на языке Java, использует для работы СУБД PostreSQL и Apache Tomcat, позволяет вести мониторинг промышленных сетей. Является свободным программным обеспечением (бесплатным), доступно для платформ, на которых работает Apache Tomcat (как правило, это Linux сервера).
				</para>
				<figure>
					<title>OpenNMS</title>
					<graphic fileref="img/opennms.png" width="6in" />
				</figure>
				<para>
					Достоинства:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Судя по всему, OpenNMS использует <emphasis>net-snmp</emphasis> для работы по протоколу SNMP, что даёт полную совместимость с оборудованием <emphasis>Sigrand</emphasis>.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Домашняя страница проекта: <ulink url="http://www.opennms.org/index.php/Main_Page">OpenNMS</ulink>.
				</para>
			</section>
		</section>
	</chapter>
	<chapter>
		<title>Примеры конфигурации</title>
		<section id="scheme1">
			<title>Организация независимых каналов между Ethernet-интерфейсами</title>
			<para>
				Данный пример рассматривает организацию независимых каналов между Ethernet-портами устройств, соединённых через SHDSL (функциональность 1 и 2).
			</para>
			<para>
				Рассмотрим организацию передачи данных с порта eth3 одного устройства на порт eth3 другого устройства через соединения SHDSL. При необходимости, можно задействовать все порты устройств (eth0, eth1, eth2). Схему взаимодействия между устройствами можно изобразить следующим образом:
			</para>
			<figure>
				<title>Схема взаимодействия устройств</title>
				<graphic fileref="img/scheme1-struct.png" width="6in" />
			</figure>
			<para>
				Устройства соединены двумя каналами SHDSL, которые объединены в бондинг. Поверх этого бондинга создан VLAN с VLAN ID равным 4. Бридж реализует передачу пакетов между интерфейсами bond0v4 (интерфейс VLAN) и eth3.
			</para>
			<para>
				Конфигурация начинается с настройки физического соединения между маршрутизаторами (см. <link linkend="dsl">настройку SHDSL</link>).
			</para>
			<para>
				Затем создадим бондинг из интерфейсов dsl0 и dsl1 (см. <link linkend="bonding">настройку Bonding</link>). В результате у нас будет интерфейс <emphasis>bond0</emphasis>.
			</para>
			<para>
				Далее, нам необходимо создать VLAN поверх бондинга. Число интерфейсов VLAN зависит от того, между сколькими портами эзернет мы будем организовывать независимую передачу данных - по одному VLAN на каждый порт. Детально процедура настройки интерфейса VLAN рассмотрена в соответствующем <link linkend="vlan">разделе</link>. Т.е. нам надо создать VLAN интерфейс поверх интерфейса bond0 с номером VLAN ID равным 4. В итоге мы получим интерфейс <emphasis>bond0v4</emphasis>.
			</para>
			<para>
				Заключительным этапом является создание моста (см. <link linkend="bridge">настройка моста</link>). Мост состоит из интерфейсов <emphasis>bond0v4</emphasis> и <emphasis>eth3</emphasis>, между которыми осуществляется передача трафика. Число интерфейсов моста так же зависит от числа портов, между которыми организуется обмен трафиком - на каждый порт один мост. Ниже приведена вкладка Specific страницы конфигурации интерфейса моста.
			</para>
			<figure>
				<title>Вкладка Specific интерфейса моста (br*)</title>
				<graphic fileref="img/scheme1-bridge.png" width="6in" />
			</figure>
			<para>
				Таким образом, если мы хотим организовать передачу между портами eth2, мы должны создать ещё один VLAN поверх интерфейса <emphasis>bond0</emphasis>, к примеру с VLAN ID 3, создать ещё один интерфейс моста, и добавить в него интерфейсы <emphasis>bond0v3</emphasis> и <emphasis>eth2</emphasis>.
			</para>
			<note>
				<para>
					Если необходимо организовать управление устройством по порту, который участвует в передачи данных (добавлен в мост), то его IP-адрес (по которому производится настройка) необходимо назначить интерфейсу моста, в который входит данный порт. Более подробно это описывается в соответствующей <link linkend="manage">главе</link>.
				</para>
			</note>
		</section>
		<section id="scheme3">
			<title>Распределение трафика по Ethernet-портам в зависимости от VLAN ID</title>
			<para>
				Допустим, мы хотим организовать передачу VLAN-трафика, поступающего на trunk-порт одного устройства через SHDSL-канал, а на втором устройстве, в зависимости от номера VLAN ID, передавать трафик (со снятым тегом VLAN) на соответствующий ethernet-порт. Это т.н. "функциональность 3".
			</para>
			<figure>
				<title>Структурная схема</title>
				<graphic fileref="img/scheme3-struct.png" width="6in" />
			</figure>
			<para>
				Идея построения схемы заключается в том, что на устройстве SG2, один из ethernet-портов которого выступает в роли trunk-порта, создаются интерфейсы VLAN, трафик которых надо передать на соответствующие порты другого устройства.
			</para>
			<para>
				К примеру, к устройству SG2 (например, к четвёртому ethernet-порту) подключена сеть, в которой работает несколько сетей VLAN с номерами 3 и 4. Нам необходимо соединить сеть с VLAN ID 3 с сетью, подключённой к третьему ethernet-порту устройства SG1. Так же необходимо соединить сеть с VLAN ID 4 с сетью, подключённой к четвёртому ethernet-порту устройства SG1. Следует заметить, что сети, подключённые к SG2 являются обычными LAN сетями, поэтому передаваемый туда трафик должен идти без заголовков VLAN.
			</para>
			<para>
				Настройка данной схемы разбивается на два этапа: конфигурация SG1 и конфигурация SG2. Подразумевается, что физическое соединение между устройствами (например, по SHDSL) уже настроено. В нашем примере мы используем бондинг поверх каналов SHDSL.
			</para>
			<section>
				<title>Конфигурация SG1</title>
				<para>
					В общем, конфигурация заключается в создании интерфейсов VLAN поверх интерфейса бондинга и создании моста между соответствующим интерфейсом ethernet и интерфейсом VLAN. Рассмотрим это более детально.
				</para>
				<para>
					Создадим на основе интерфейса <emphasis>bond0</emphasis> интерфейс VLAN с VLAN ID <emphasis>4</emphasis> (см. <link linkend="vlan">настройка VLAN</link>). Созданный интерфейс имеет имя <emphasis>bond0v4</emphasis>. Здесь же создадим интерфейс моста, к примеру, его имя будет <emphasis>br0</emphasis>.
				</para>
				<para>
					Настроим интерфейсы, которые войдут в состав моста: <emphasis>bond0v4</emphasis> и <emphasis>eth3</emphasis>. Настройка заключается в активации флажка Enabled на вкладке General страницы конфигурации интерфейса.
				</para>
				<para>
					Перейдём на страницу настройки моста, вкладку Specific. Укажем интерфейсы, между которыми будет передаваться трафик: <emphasis>bond0v4</emphasis> и <emphasis>eth3</emphasis>.
				</para>
				<figure>
					<title>Привязка к физическим интерфейсам</title>
					<graphic fileref="img/scheme3-sg1-br-specific.png" width="6in" />
				</figure>
				<para>
					На вкладке General активируем флажки Enabled и Auto.
				</para>
				<para>
					Если необходимо организовать передачу нескольких VLAN на порты SG1, то приведённая последовательность действий повторяется для каждой VLAN. В данной конфигурации максимальное число VLAN равно 4, оно ограничено числом ethernet-портов устройства.
				</para>
			</section>
			<section>
				<title>Конфигурация SG2</title>
				<para>
					Перед настройкой нам необходимо решить, какой из ethernet-портов устройства будет выполнять функции trunk-порта, т.е. к которому будут подключены сети VLAN.
				</para>
				<para>
					Для выбранного trunk-порта создаются интерфейс VLAN, и соответствующий ему интерфейс VLAN на основе интерфейса бондинга. Затем создаётся мост между соответствующим интерфейсом VLAN trunk-порта и интерфейсом VLAN бондинга. Идея заключается в том, что каждый интерфейс VLAN, созданный поверх trunk-порта, получает свой трафик и передаёт его "своему" интерфейсу бондинга. На втором устройстве (SG1) бондинг передаёт его соответствующему ethernet-порту. Рассмотрим эти действия подробнее.
				</para>
				<para>
					Конфигурация начинается с создания интерфейсов VLAN с одинаковыми VLAN ID на интерфейсах бондинга (к примеру, <emphasis>bond0</emphasis>) и ethernet-порта, выбранного в роли trunk-порта (<emphasis>eth3</emphasis>). Пусть созданные интерфейсы имеют имена <emphasis>bond0v4</emphasis> и <emphasis>eth3v4</emphasis>. Здесь же создадим интерфейсы моста, по одному на каждую пару интерфейсов VLAN.
				</para>
				<para>
					Настроим интерфейсы, входящие в состав моста. Для этого выставим флажки Enabled на вкладке General для интерфейсов <emphasis>eth3</emphasis> (т.к. это trunk-порт), <emphasis>bond0v4</emphasis> и <emphasis>eth3v4</emphasis>.
				</para>
				<para>
					Перейдём к настройке интерфейса моста: откроем вкладку Specific и укажем, из каких интерфейсов будет состоять мост, в нашем примере это интерфейсы <emphasis>bond0v4</emphasis> и <emphasis>eth3v4</emphasis>.
				</para>
				<para>
					На вкладке General активируем флажки Enabled и Auto. Таким образом, мы получаем один или несколько интерфейсов моста, передающих трафик между интерфейсами VLAN, созданными поверх trunk-порта и поверх бондинга.
				</para>
			</section>
		</section>
		<section id="manage">
			<title>Организация управления устройством через интерфейс, входящий в состав моста или бондинга</title>
			<para>
				В случае, если порт, через который осуществляется управление устройством, необходимо добавить в состав моста или бондинга, IP-адрес, используемый для управления, следует назначить интерфейсу, в состав которого включается порт. Например, порт eth0 используется для управления и ему назначен IP-адрес 192.168.2.100. Тогда, при включении этого порта в состав моста (интерфейса br0), то интерфейсу br0 назначается IP-адрес 192.168.2.100.
			</para>
			<para>
				Т.к. в случае непоследовательных действий есть вероятность потери управления над устройством, рассмотрим эту конфигурацию более подробно на примере <link linkend="scheme1">организации независимых каналов между Ethernet-интерфейсами</link>.
			</para>
			<para>
				Допустим, мы управляем устройством через порт <emphasis>eth0</emphasis> по IP-адресу 192.168.2.100, и хотим включить этот порт в мост для организации передачи данных, т.е. реализовать т.н. "функциональность 1". Но т.к. этот порт используется для управления, необходима другая последовательность действий по организации моста.
			</para>
			<para>
				Допустим, мы выполнили последовательность действий, описанных в приведённом выше разделе, а именно: настроили физическое соединение, создали бондинг и необходимый VLAN поверх него (<emphasis>bond0v1</emphasis>). Теперь нам необходимо создать мост. Здесь последовательность действий немного меняется. Создадим интерфейс моста, пусть у него будет имя <emphasis>br1</emphasis>. Перейдём на его страницу настройки, выберем вкладку Specific и пропишем нужные нам интерфейсы: eth0 и bond0v1.
			</para>
			<figure>
				<title>Добавление интерфейсов в мост</title>
				<graphic fileref="img/scheme1-mng-br-specific.png" width="6in" />
			</figure>
			<para>
				Затем перейдём на вкладку General и выберем статический (Static) метод назначения адреса. На данном этапе нельзя активировать интерфейс (выставлять флажки Enabled и Auto)!
			</para>
			<figure>
				<title>Установка метода назначения IP-адреса</title>
				<graphic fileref="img/scheme1-mng-br-general1.png" width="6in" />
			</figure>
			<para>
				Перейдём на вкладку Method, где пропишем нужный IP-адрес и маску сети.
			</para>
			<figure>
				<title>Назначение IP-адреса</title>
				<graphic fileref="img/scheme1-mng-br-method.png" width="6in" />
			</figure>
			<para>
				И в завершении вернёмся на вкладку General и активируем флажки Enabled и Auto.
			</para>
			<figure>
				<title>Запуск моста</title>
				<graphic fileref="img/scheme1-mng-br-general2.png" width="6in" />
			</figure>
			<para>
				После сохранения настроек с интерфейса eth0 будет снят IP-адрес, а на интерфейс моста будет назначен введённый нами IP-адрес, через который возможно дальнейшее управление устройством.
			</para>
			<tip>
				<para>
					В случае, если на интерфейс моста назначается тот же IP-адрес, что был на интерфейсе порта, возможно пропадание на некоторое время связи с устройством. Связано это с тем, что MAC-адрес моста соответствует одному из интерфейсов, которые в него входят, и если будет выбран MAC-адрес не интерфейса порта, которому принадлежал IP-адрес, то надо будет заместить в локальном ARP-кэше компьютера старое соответствие MAC-адреса IP-адресу. Сделать это можно либо вручную, удалив соответствующую запись из ARP-кэша, либо подождав некоторое время.
				</para>
			</tip>
		</section>
		<section id="manage_vlan">
			<title>Ограничение доступа к управлению устройством с помощью VLAN</title>
			<para>
				Для ограничения доступа к управлению устройством можно использовать технологию VLAN. Для этого на основе интерфейса, через который осуществляется управления, создаётся интерфейс VLAN, которому назначается IP-адрес, а адрес с нижележащего интерфейса снимается.
			</para>
			<para>
				Рассмотрим ограничение доступа по VLAN на том же примере <link linkend="scheme1">организации независимых каналов между Ethernet-интерфейсами</link>.
			</para>
			<para>
				Предположим, что мы управляем устройством через порт eth0 используя IP-адрес 192.168.2.100. Нам требуется использовать порт eth0 для передачи данных, как было рассмотрено в приведённом выше примере, и организовать управление устройством с компьютера, относящемуся к определённой сети VLAN.
			</para>
			<para>
				Выполним часть последовательности действий, описанных в приведённом выше разделе, а именно: настроим физическое соединение, создадим бондинг и необходимый VLAN поверх него (<emphasis>bond0v1</emphasis>). Теперь нам необходимо создать мост. Перейдём на страницу управления динамическими интерфейсами (Network/Interfaces) и создадим интерфейс моста, пусть у него будет имя <emphasis>br1</emphasis>. Тут же создадим на основе нового интерфейса моста <emphasis>br1</emphasis> VLAN с нужным нам VLAN ID, пусть имя нового интерфейса будет <emphasis>br1v7</emphasis>.
			</para>
			<figure>
				<title>Создание интерфейса VLAN на основе моста</title>
				<graphic fileref="img/scheme1-mng-vlan-add_br_vlan.png" width="6in" />
			</figure>
			<para>
				Перейдём на страницу настройки интерфейса моста <emphasis>br1</emphasis>, выберем вкладку Specific и пропишем нужные нам интерфейсы: eth0 и bond0v1.
			</para>
			<figure>
				<title>Добавление интерфейсов в мост</title>
				<graphic fileref="img/scheme1-mng-br-specific.png" width="6in" />
			</figure>
			<para>
				Затем перейдём на вкладку General и активируем интерфейс - поставим флажок Enabled (Auto выставлять не надо - это заблокирует доступ к устройству).
			</para>
			<figure>
				<title>Активация интерфейса моста</title>
				<graphic fileref="img/scheme1-mng-vlan-br-general.png" width="6in" />
			</figure>
			<para>
				Теперь перейдём к настройке интерфейса VLAN, созданного на основе сконфигурированного интерфейса моста. Для этого перейдём на его страницу конфигурации и выберем вкладку General, на которой выберем статический (Static) способ установки IP-адреса.
			</para>
			<figure>
				<title>Установка метода назначения IP-адреса</title>
				<graphic fileref="img/scheme1-mng-vlan-br_vlan-general1.png" width="6in" />
			</figure>
			<para>
				Перейдём на вкладку Method, где пропишем нужный IP-адрес и маску сети.
			</para>
			<figure>
				<title>Назначение IP-адреса</title>
				<graphic fileref="img/scheme1-mng-vlan-br_vlan-method.png" width="6in" />
			</figure>
			<para>
				И в завершении вернёмся на вкладку General и активируем флажки Enabled и Auto.
			</para>
			<figure>
				<title>Запуск интерфейса VLAN</title>
				<graphic fileref="img/scheme1-mng-vlan-br_vlan-general2.png" width="6in" />
			</figure>
			<para>
				Запуск интерфейса VLAN приведёт к запуску интерфейса моста, в итоге с интерфейса <emphasis>eth0</emphasis> будет снят IP-адрес, а на интерфейс VLAN, созданного на основе моста, будет назначен указанный нами IP-адрес.
			</para>
			<important>
				<para>
					После запуска интерфейса VLAN страница не будет загружена до конца, т.к. доступ к устройству без тега VLAN будет закрыт. С этого момента управлять устройством можно только с VLAN, номер которой совпадает с указанным при создании интерфейса VLAN <emphasis>VLAN ID</emphasis>.
				</para>
			</important>
		</section>
	</chapter>
</book>
