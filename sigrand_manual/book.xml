<?xml version = '1.0' encoding = 'utf-8'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "/usr/share/xml/docbook/schema/dtd/4.2/docbookx.dtd">
<book lang="ru">
	<bookinfo>
		<title>Руководство пользователя SG-16R/SG-17R</title>
		<copyright>
			<year>2007</year>
			<year>2008</year>
			<holder>ООО "Сигранд"</holder>
		</copyright>
		<author>Казанцев А.В.</author>
		<legalnotice>
			<para>
				Все торговые марки, знаки и зарегистрированные права на именования, упомянутые в настоящем документе, принадлежат соответствующим правообладателям.
			</para>
		</legalnotice>
		<abstract>
			<para>
				В данном руководстве рассмотрены вопросы конфигурации и эксплуатации маршрутизаторов ООО "Сигранд" 16-й и 17-й серии (SG-16R и SG-17R соответственно).
			</para>
			<para>
				Приводится краткое описание характеристик и возможностей маршрутизатора, условий его эксплуатации, параметров сетевых интерфейсов, а так же описание поддерживаемых модулей.
			</para>
			<para>
				Поясняются процедуры настройки сетевых интерфейсов и сервисов, а так же различных режимов работы маршрутизатора: мультиплексирование, бриджирование, объединение каналов (бондинг), VLAN, QoS и другие.
			</para>
		</abstract>
	</bookinfo>
	<chapter>
		<title>Описание маршрутизатора SG-16R/SG-17R</title>
		<para>
			Маршрутизаторы Sigrand SG-16R, Sigrand SG-17R предназначены для организации межсетевого взаимодействия в сетях с произвольной конфигурацией, в которых используются различные протоколы и физические канальные уровни. Маршрутизатор SG-17R имеет наращиваемую модульную архитектуру и работает с модулями Е1 и SHDSL. Так же имеется возможность увеличения дальности связи при сохранении требуемой скорости при использовании совместно с маршрутизаторами SG-17R регенераторов SG-17E, при этом возможно получать информацию о канале связи со всех регенераторов, работающих на линии.
		</para>
		<para>
			Программное обеспечение маршрутизатора разрабатывается на основе операционной системы GNU/Linux с ядром версии 2.6 и распространяется в соответствии с лицензией GNU GPL.
		</para>
		<important>
			<title>Ограничение ответственности</title>
			<para>
				Фирма-изготовитель, по понятным соображениям, не может нести ответственность за работоспособность ПО, разработанного сторонними лицами и не прошедшего тестирования на совместимость с базовым ПО устройства в ООО «Сигранд». Также, мы не можем нести ответственность за последствия применения такого ПО, приведшего к неработоспособности или ограничению функциональности устройства.
			</para>
		</important>
		<para>
			Маршрутизаторы SG-16R и SG-17R имеют следующий функционал:
		</para>
		<itemizedlist>
			<listitem>
				<para>
					Конфигурация через веб-интерфейс.
				</para>
			</listitem>
			<listitem>
				<para>
					Сохранение и восстановление конфигурации.
				</para>
			</listitem>
			<listitem>
				<para>
					Сохранение настроек сменных интерфейсов с привязкой к номеру слота.
				</para>
			</listitem>
			<listitem>
				<para>
					Логирование событий.
				</para>
			</listitem>
			<listitem>
				<para>
					Независимая настройка Ethernet-портов коммутатора.
				</para>
			</listitem>
			<listitem>
				<para>
					Дополнительные Ethernet-сервисы на основе VLAN технологий.
				</para>
			</listitem>
			<listitem>
				<para>
					Мультиплексирование синхронных каналов и/или маршрутизация IP трафика.
				</para>
			</listitem>
			<listitem>
				<para>
					В режиме мультиплексирования при использовании многопарного соединения, агрегирование остатков полос от потоков E1 в один логический канал для транспорта Ethernet.
				</para>
			</listitem>
			<listitem>
				<para>
					Бриджирование трафика и объединение физических интерфейсов для увеличения скорости передачи данных.
				</para>
			</listitem>
			<listitem>
				<para>
					Поддержка сетевых интерфейсов: SHDSL, E1, Ethernet.
				</para>
			</listitem>
			<listitem>
				<para>
					Работа с SHDSL интерфейсами: SG-17 и SG-17+, обеспечивающие скорости 5.7 и 14 Мбит/c по одной паре (для SG-17R).
				</para>
			</listitem>
			<listitem>
				<para>
					При использовании SHDSL интерфейсов, обеспечение удалённого питания для регенераторов SG-17E (для SG-17R).
				</para>
			</listitem>
			<listitem>
				<para>
					Поддержка сетевых служб: DHCP, PPTP, DNS.
				</para>
			</listitem>
			<listitem>
				<para>
					Управление трафиком: NAT, Firewall, QoS.
				</para>
			</listitem>
			<listitem>
				<para>
					Встроенный мониторинг SHDSL тракта в соответствии со стандартом G.SHDSL (G.991.2).
				</para>
			</listitem>
			<listitem>
				<para>
					Поддержка SNMP: MIB-II, HDSL2-SHDSL-LINE-MIB.
				</para>
			</listitem>
			<listitem>
				<para>
					Безопасное VPN соединение при использовании протоколов: IPSec, PPPoE, PPtP.
				</para>
			</listitem>
		</itemizedlist>
	</chapter>
	<chapter>
		<title>Комплектация поставки</title>
		<section>
			<title>SG-16R</title>
			<itemizedlist>
				<listitem>
					<para>
						Маршрутизатор.
					</para>
				</listitem>
				<listitem>
					<para>
						Блок питания от сети 220В/50Гц (для настольной версии) или сетевой шнур для подключения к сети 220В/50Гц (для стоечного форм-фактора).
					</para>
				</listitem>
				<listitem>
					<para>
						Переходник DB-9F — RJ-45 для подключения к терминальному порту маршрутизатора.
					</para>
				</listitem>
				<listitem>
					<para>
						Компакт-диск с программным обеспечением и документацией.
					</para>
				</listitem>
				<listitem>
					<para>
						Гарантийный талон.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Схема переходника DB-9F — RJ-45 приведена на рисунке.
			</para>
			<figure>
				<title>Схема переходника DB-9F — RJ-45</title>
				<graphic fileref="img/hw-rj45_db9f.png" width="6in"/>
			</figure>
		</section>
		<section>
			<title>SG-17R</title>
			<itemizedlist>
				<listitem>
					<para>
						Шасси маршрутизатора.
					</para>
				</listitem>
				<listitem>
					<para>
						При типе питания DC 36-72В — ответная часть разъёма питания; при типе питания 220В/50Гц — сетевой шнур питания.
					</para>
				</listitem>
				<listitem>
					<para>
						Терминальный провод DB-9M — DB-9F.
					</para>
				</listitem>
				<listitem>
					<para>
						Компакт-диск с программным обеспечением и документацией.
					</para>
				</listitem>
				<listitem>
					<para>
						Гарантийный талон.
					</para>
				</listitem>
			</itemizedlist>
		</section>
	</chapter>
	<chapter id="hw">
		<title>Аппаратное описание</title>
		<section id="hw.desc">
			<title>Характеристики и параметры устройства</title>
			<section id="hw.desc.common">
				<title>Общие параметры</title>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Процессор</emphasis> — 32-разрядный MIPS процессор с ядром 4KC, производительность 227 MIPS.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Оперативная память</emphasis> — 64MB SDRAM.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Дисковая память</emphasis> — 32MB flash.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Интерфейсы</emphasis>:
						</para>
						<itemizedlist>
							<listitem>
								<para>
									4 Ethernet/Fast Ethernet, auto negotiations, auto MDI/MDI-X.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>RS-232C</emphasis> — для управления маршрутизатором.
								</para>
							</listitem>
							<listitem>
								<para>
									4 интерфейсных слота для установки модулей (для SG-17R).
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
					<listitem>
						<para>
							<emphasis>Габариты</emphasis> — 438х258х43 мм.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Вес</emphasis> — 1,2 кг.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Питание</emphasis> — 220B/50 Гц или 36-72В постоянного тока (в зависимости от модели и поставки).
						</para>
					</listitem>
				</itemizedlist>
			</section>
			<section id="hw.desc.shdsl">
				<title>Параметры линейного интерфейса SHDSL</title>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Тип разъема</emphasis>: RJ-45 (розетка).
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Тип интерфейса</emphasis>: G.SHDSL (рекоменд. ITU-T G.991.2.bis).
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Тип соединения</emphasis>: точка-точка.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Количество проводов линии связи</emphasis>: 2 (одна пара). Используются контакты 4 и 5.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Скорость передачи</emphasis>:
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<emphasis>SG-16</emphasis>: 6 Мбит/с
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>SG-17</emphasis>: 5.7 Мбит/с
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>SG-17+</emphasis>: 14 Мбит/с
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
					<listitem>
						<para>
							<emphasis>Линейный код</emphasis>: TCPAM.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Вид связи</emphasis>: полный дуплекс.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Дистанционное питание</emphasis> (для моделей с поддержкой дистанционного питания)
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<emphasis>Напряжение</emphasis>: 240В.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>Максимальный ток</emphasis>: 50мА.
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
				</itemizedlist>
			</section>
			<section id="hw.desc.e1">
				<title>Параметры интерфейса Е1</title>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Тип разъема</emphasis>: RJ-45 (розетка).
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Число проводов в линии связи</emphasis>: 4 (две пары). Контакты 4, 5 используются для передачи, 1, 2 — для приёма.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Линейный код (ITU-T G.703)</emphasis>: HDB3, AMI.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Скорость передачи данных</emphasis>: Nx64 кбит/c, где N=1:32, для каждого из интерфейсов Е1  (64:2048 кбит/с с шагом 64 кбит/с).
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Расстояние до оборудования DTE, км</emphasis>: 2,4 (для кабеля 0,5 мм), 1,6 (для кабеля 0,4 мм).
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Цикловая структура (framing)</emphasis>: G.704.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Сверхциклы (superframe)</emphasis>: CRC4, CAS.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Отключение цикловой структуры (unframed mode)</emphasis>: есть.
						</para>
					</listitem>
				</itemizedlist>
			</section>
			<section id="hw.desc.rs232">
				<title id="hw.desc.rs232.title">Параметры интерфейса RS-232C</title>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Тип разъема</emphasis>:
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<emphasis>SG-16R</emphasis>: RJ-45 (розетка).
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>SG-17R</emphasis>: DB-9F.
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
					<listitem>
						<para>
							<emphasis>Скорость передачи, бит/сек</emphasis>: 115 200.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Протокол</emphasis>: 8-N-1.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Управление потоком</emphasis>: нет.
						</para>
					</listitem>
				</itemizedlist>
			</section>
			<section>
				<title>Условия эксплуатации</title>
				<para>
					Маршрутизатор предназначен для эксплуатации в закрытом отапливаемом помещении при следующих климатических условиях:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Температура воздуха</emphasis>: 10 .. 40 °C.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Относительная влажность воздуха</emphasis>: до 85%.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Атмосферное давление</emphasis>: 84 .. 107 кПа.
						</para>
					</listitem>
				</itemizedlist>
			</section>
		</section>
		<section id="hw.shdsl.details">
			<title>Характеристики SHDSL</title>
			<section id="hw.shdsl.details.tcpam">
				<title id="hw.shdsl.details.tcpam.title">Особенности применения кодировок TCPAM</title>
				<para>
					Кодирование TCPAM (Trellis-Coded Pulse Amplitude Modulation), используемое для передачи информации по стандарту G.SHDSL (G.991.2), имеет несколько вариантов, отличающихся степенью сложности алгоритма кодирования. Большим скоростям передачи соответствует режим с большим количеством позиций модуляции (TCPAM32), на малых скоростях используется режим с меньшим числом позиций модуляции (TCPAM16). Соответственно, с увеличением сложности алгоритма кодирования, снижается помехоустойчивость канала, и наоборот.
				</para>
				<para>
					Поэтому, при настройке скорости линии, следует обращать особое внимание на алгоритм кодирования TCPAM и, при необходимости, изменять линейный код для достижения наилучшего результата.
				</para>
				<para>
					В таблице приведены соответствия значений кодировок скоростям линии.
				</para>
				<table frame="all" align="center">
					<title>Таблица соответствий линейного кода скорости линии</title>
					<tgroup cols="2" >
						<thead>
							<row>
								<entry>Линейный код</entry>
								<entry>Диапазон допустимых скоростей, кбит/с</entry>
							</row>
						</thead>
						<tbody>
							<row>
								<entry>TCPAM128</entry>
								<entry>до 14080 (нижняя граница пока не определена)</entry>
							</row>
							<row>
								<entry>TCPAM64</entry>
								<entry>до 7168 (нижняя граница пока не определена)</entry>
							</row>
							<row>
								<entry>TCPAM32</entry>
								<entry>2560-5696</entry>
							</row>
							<row>
								<entry>TCPAM16</entry>
								<entry>192-2496</entry>
							</row>
						</tbody>
					</tgroup>
				</table>
			</section>
			<section id="hw.shdsl.details.speed">
				<title>Дальность связи и скорость соединения</title>
				<section>
					<title>Условия тестирования</title>
					<para>
						Информация о дальности связи и скорости соединения приведена ниже. Результаты получены на линиях длиной, при которой коэффициент ошибок (Bit Error Rate, BER) равен или меньше 10<superscript>-7</superscript>. Указанная дальность проверена экспериментальным путём на контрольной линии связи лаборатории компании.
					</para>
					<para>
						Результаты, полученные при эксплуатации на реальных линиях связи, могут отличаться от приведённых значений ввиду отличий параметров этих линий от эталонной.
					</para>
					<para>
						Разные серии маршрутизаторов и разные модули имеют различные показатели дальности/скорости.
					</para>
				</section>
				<section>
					<title>SG-16</title>
					<para>
						Таблица дальности/скорости для SHDSL версии SG-16 представлена ниже.
					</para>
					<table frame="all" align="center">
						<title>Таблица дальности/скорости для SG-16</title>
						<tgroup cols="3">
							<thead>
								<row>
									<entry>Скорость, кбит/с</entry>
									<entry>Кабель сечением 0,4 мм, км</entry>
									<entry>Кабель сечением 0,5 мм, км</entry>
								</row>
							</thead>
							<tbody>
								<row>
									<entry>6016</entry>
									<entry>1,8</entry>
									<entry>2,2</entry>
								</row>
								<row>
									<entry>4608</entry>
									<entry>2,0</entry>
									<entry>2,6</entry>
								</row>
								<row>
									<entry>3072</entry>
									<entry>3,0</entry>
									<entry>4,2</entry>
								</row>
								<row>
									<entry>2304</entry>
									<entry>3,8</entry>
									<entry>5,4</entry>
								</row>
								<row>
									<entry>1536</entry>
									<entry>4,4</entry>
									<entry>6,4</entry>
								</row>
								<row>
									<entry>1024</entry>
									<entry>5,0</entry>
									<entry>7,6</entry>
								</row>
								<row>
									<entry>512</entry>
									<entry>5,8</entry>
									<entry>9,0</entry>
								</row>
								<row>
									<entry>256</entry>
									<entry>6,6</entry>
									<entry>10,0</entry>
								</row>
								<row>
									<entry>128</entry>
									<entry>7,4</entry>
									<entry>11,4</entry>
								</row>
								<row>
									<entry>64</entry>
									<entry>7,4</entry>
									<entry>11,4</entry>
								</row>
							</tbody>
						</tgroup>
					</table>
				</section>
				<section>
					<title>SG-17</title>
					<para>
						Таблица дальности/скорости для SHDSL версии SG-17 представлена ниже.
					</para>
					<table frame="all" align="center">
						<title>Таблица дальности/скорости для SG-17</title>
						<tgroup cols="4">
							<thead>
								<row>
									<entry>Скорость, кбит/с</entry>
									<entry>Кабель сечением 0,5 мм, км</entry>
									<entry>Кабель сечением 0,9 мм, км</entry>
									<entry>Кабель сечением 1,2 мм, км</entry>
								</row>
							</thead>
							<tbody>
								<row>
									<entry>5696</entry>
									<entry>2,6</entry>
									<entry>5,0</entry>
									<entry>8,6</entry>
								</row>
								<row>
									<entry>4608</entry>
									<entry>3,6</entry>
									<entry>5,6</entry>
									<entry>9,6</entry>
								</row>
								<row>
									<entry>4096</entry>
									<entry>4,0</entry>
									<entry>7,4</entry>
									<entry>12,4</entry>
								</row>
								<row>
									<entry>3072</entry>
									<entry>5,0</entry>
									<entry>8,0</entry>
									<entry>13,4</entry>
								</row>
								<row>
									<entry>2304</entry>
									<entry>5,4</entry>
									<entry>11,2</entry>
									<entry>19,0</entry>
								</row>
								<row>
									<entry>2048</entry>
									<entry>6,2</entry>
									<entry>13,0</entry>
									<entry>22,2</entry>
								</row>
								<row>
									<entry>1536</entry>
									<entry>7,0</entry>
									<entry>15,8</entry>
									<entry>26,6</entry>
								</row>
								<row>
									<entry>1024</entry>
									<entry>7,8</entry>
									<entry>17,4</entry>
									<entry>29,6</entry>
								</row>
								<row>
									<entry>768</entry>
									<entry>8,4</entry>
									<entry>18,6</entry>
									<entry>31,6</entry>
								</row>
								<row>
									<entry>512</entry>
									<entry>9,0</entry>
									<entry>20,0</entry>
									<entry>33,8</entry>
								</row>
								<row>
									<entry>384</entry>
									<entry>9,6</entry>
									<entry>21,0</entry>
									<entry>35,8</entry>
								</row>
								<row>
									<entry>192</entry>
									<entry>10,4</entry>
									<entry>23,0</entry>
									<entry>40,0</entry>
								</row>
							</tbody>
						</tgroup>
					</table>
				</section>
				<section>
					<title>SG-17+</title>
					<para>
						Таблица дальности/скорости для SHDSL версии SG-17+ представлена ниже.
					</para>
					<table frame="all">
						<title>Таблица дальности/скорости для SG-17+</title>
						<tgroup cols="2" align="center">
							<thead>
								<row>
									<entry>Скорость, кбит/с</entry>
									<entry>Кабель сечением 0,5 мм, км</entry>
								</row>
							</thead>
							<tbody>
								<row>
									<entry>14080</entry>
									<entry>1,2</entry>
								</row>
								<row>
									<entry>12800</entry>
									<entry>1,2</entry>
								</row>
								<row>
									<entry>11520</entry>
									<entry>1,4</entry>
								</row>
								<row>
									<entry>10240</entry>
									<entry>2,0</entry>
								</row>
								<row>
									<entry>9216</entry>
									<entry>2,2</entry>
								</row>
								<row>
									<entry>8192</entry>
									<entry>2,4</entry>
								</row>
								<row>
									<entry>7168</entry>
									<entry>3,0</entry>
								</row>
								<row>
									<entry>6144</entry>
									<entry>3,4</entry>
								</row>
								<row>
									<entry>5696</entry>
									<entry>3,6</entry>
								</row>
								<row>
									<entry>5120</entry>
									<entry>3,8</entry>
								</row>
								<row>
									<entry>4608</entry>
									<entry>4,0</entry>
								</row>
								<row>
									<entry>4096</entry>
									<entry>4,4</entry>
								</row>
								<row>
									<entry>3072</entry>
									<entry>5,0</entry>
								</row>
								<row>
									<entry>2304</entry>
									<entry>5,4</entry>
								</row>
								<row>
									<entry>2048</entry>
									<entry>6,2</entry>
								</row>
								<row>
									<entry>1536</entry>
									<entry>7,0</entry>
								</row>
								<row>
									<entry>1024</entry>
									<entry>7,8</entry>
								</row>
								<row>
									<entry>768</entry>
									<entry>8,4</entry>
								</row>
								<row>
									<entry>512</entry>
									<entry>9,0</entry>
								</row>
								<row>
									<entry>384</entry>
									<entry>9,6</entry>
								</row>
								<row>
									<entry>192</entry>
									<entry>10,4</entry>
								</row>
							</tbody>
						</tgroup>
					</table>
				</section>
			</section>
			<section>
				<title>Совместимость оборудования по интерфейсу SHDSL</title>
				<para>
					Таблица совместимости оборудования по интерфейсу SHDSL приведена ниже. SG-16R относится к серии SG-16, а SG-17R — к серии SG-17.
				</para>
				<table frame="all" align="center">
					<title>Совместимость оборудования по интерфейсу SHDSL</title>
					<tgroup cols="4">
						<thead>
							<row>
								<entry>Серия/версия интерфейса</entry>
								<entry>SG-16</entry>
								<entry>SG-17</entry>
								<entry>SG-17+</entry>
							</row>
						</thead>
						<tbody>
							<row>
								<entry>SG-16</entry>
								<entry>+</entry>
								<entry>-</entry>
								<entry>-</entry>
							</row>
							<row>
								<entry>SG-17</entry>
								<entry>-</entry>
								<entry>+</entry>
								<entry>+</entry>
							</row>
						</tbody>
					</tgroup>
				</table>
			</section>
			<section>
				<title>Подключение линии связи</title>
				<important>
					<para>
						Перед подключением линии связи удостоверьтесь, что на ней отсутствуют термопредохранители. Установка маршрутизаторов на таких линиях приводит к значительному снижению скоростных параметров. Так же невозможна работа на линиях, оснащённых катушками Пупина (пупинизированных линиях).
					</para>
				</important>
				<warning>
					<para>
						Удостоверьтесь, что предоставленная Вам линия связи не имеет посторонних источников электрического напряжения, и не подключена к какому-либо постороннему оборудованию АТС! Несоблюдение этого правила может привести к выводу из строя как маршрутизаторов, так и посторонней аппаратуры на линии связи!
					</para>
				</warning>
				<para>
					Для нормальной работы маршрутизаторов и обеспечения заданных параметров линия связи должна соответствовать следующим требованиям:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Кабель не должен иметь замыканий жил и утечек на "землю" и на иные, в том числе и не подключённые к чему-либо, проводники. Линия связи не должна иметь ответвлений.
						</para>
					</listitem>
					<listitem>
						<para>
							В многопарном кабеле жилы должны быть взяты из одной пары.
						</para>
					</listitem>
					<listitem>
						<para>
							Параллельное включение нескольких пар (например, для уменьшения активного сопротивления) не допускается.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Отступление от указанных выше требований может привести к снижению показателей, или к полной неработоспособности линии связи.
				</para>
				<para>
					Для подключения линии связи к маршрутизатору, установите вилку RJ-45 на кабель. Маршрутизатор использует только одну пару проводов, контакты 4 и 5, остальные контакты не задействованы.
				</para>
				<figure>
					<title>Разъём RJ-45</title>
					<graphic fileref="img/hw-rj45.png" width="6in"/>
				</figure>
				<para>
					Затем подключите кабель к разъёму SHDSL маршрутизатора.
				</para>
			</section>
		</section>
		<section id="hw.sg-16r">
			<title>Внешний вид, назначение индикаторов и разъёмов SG-16R</title>
			<para>
				Маршрутизатор Sigrand SG-16R поставляется в настольном форм-факторе и в форм-факторе 19" для монтажа в коммуникационную стойку.
			</para>
			<para>
				Вид передней панели маршрутизатора с одним и двумя каналами SHDSL, выполненного в форм-факторе 19", представлен ниже.
			</para>
			<figure>
				<title>Вид передней панели маршрутизатора с одним каналом SHDSL в форм-факторе 19"</title>
				<graphic fileref="img/hw-sg16-1dsl-front-text.png" width="6in"/>
			</figure>
			<figure>
				<title>Вид передней панели маршрутизатора с двумя каналами SHDSL в форм-факторе 19"</title>
				<graphic fileref="img/hw-sg16-2dsl-front-text.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Порты Ethernet</emphasis> — RJ-45 порты для подключения по интерфейсу Ethernet.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Порты SHDSL</emphasis> — RJ-45 порты для подключения по интерфейсу SHDSL.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>PGND</emphasis> — клемма для подключения заземления.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Консольный порт</emphasis> — RJ-45 порт для управления маршрутизатором.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Индикаторы Ethernet</emphasis> — каждому каналу соответствует два индикатора:
					</para>
					<itemizedlist>
						<listitem>
							<para>
								Верхний — <emphasis>FD/C</emphasis>:
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>Горит</emphasis> — полнодуплексный режим работы (Full duplex).
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Не горит</emphasis> — полудуплексный режим работы (Half duplex).
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Мигает</emphasis> — наличие коллизии в канале (Collision).
									</para>
								</listitem>
							</itemizedlist>
						</listitem>
						<listitem>
							<para>
								Нижний — <emphasis>LINK</emphasis>:
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>Горит</emphasis> — связь с удалённым устройством есть.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Не горит</emphasis> — связи с удалённым устройством нет.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Мигает</emphasis> — идёт обмен данными.
									</para>
								</listitem>
							</itemizedlist>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>
						<emphasis>Индикаторы SHDSL</emphasis>
					</para>
					<itemizedlist>
						<listitem>
							<para>
								Верхний — <emphasis>ERR</emphasis>:
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>Не горит</emphasis> — нет сбойных пакетов.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Мигает</emphasis> — получен сбойный пакет.
									</para>
								</listitem>
							</itemizedlist>
						</listitem>
						<listitem>
							<para>
								Нижний — <emphasis>LINK</emphasis>:
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>Горит</emphasis> — связь с удалённым устройством есть.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Не горит</emphasis> — связи с удалённым устройством нет.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Мигает</emphasis> — процесс установки связи.
									</para>
								</listitem>
							</itemizedlist>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>
						<emphasis>Выключатель питания</emphasis> — выключатель питания маршрутизатора.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Индикатор питания</emphasis> — горит, когда маршрутизатор включён.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Вид задней панели маршрутизатора с питанием 220В/50Гц в форм-факторе 19" показан ниже.
			</para>
			<figure>
				<title>Вид задней панели маршрутизатора с питанием 220В/50Гц в форм-факторе 19"</title>
				<graphic fileref="img/hw-sg16-back-text.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Разъём питания</emphasis> — для подключения к сети 220В/50Гц.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Вид задней панели маршрутизатора с питанием AC 220В/50Гц и DC 36-72В в форм-факторе 19" показан ниже.
			</para>
			<figure>
				<title>Вид задней панели маршрутизатора с питанием AC 220В/50Гц и DC 36-72В в форм-факторе 19"</title>
				<graphic fileref="img/hw-sg16-back-ac_dc-text.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Разъём питания DC 36-72В</emphasis> — для подключения к источнику питания постоянного тока 36-72В.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Разъём питания AC 220В/50Гц</emphasis> — для подключения к сети 220В/50Гц.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Переключатель питания</emphasis> — переключатель питания DC 36-72B / AC 220В/50Гц.
					</para>
				</listitem>
			</itemizedlist>
		</section>
		<section id="hw.sg-17r">
			<title>Внешний вид, назначение индикаторов и разъёмов SG-17R</title>
			<para>
				Маршрутизатор Sigrand SG-17R поставляется в форм-факторе 19" для монтажа в коммуникационную стойку. Вид передней панели без установленных модулей представлен на рисунке.
			</para>
			<figure>
				<title>Передняя панель без сменных модулей</title>
				<graphic fileref="img/hw-sg17-front-empty-text.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>A,B,C,D</emphasis> — слоты для установки сменных модулей.
					</para>
					<important>
						<para>
							В текущее время слот <emphasis>D</emphasis> не может быть использован для установки модуля.
						</para>
					</important>
				</listitem>
				<listitem>
					<para>
						<emphasis>Консольный порт</emphasis> — RS-232C порт для управления маршрутизатором.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Порты Ethernet</emphasis> — RJ-45 порты для подключения по интерфейсу Ethernet.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Индикация портов Ethernet</emphasis> — каждому каналу соответствует два индикатора:
					</para>
					<itemizedlist>
						<listitem>
							<para>
								Верхний — <emphasis>FD/C</emphasis>:
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>Горит</emphasis> — полнодуплексный режим работы (Full duplex).
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Не горит</emphasis> — полудуплексный режим работы (Half duplex).
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Мигает</emphasis> — наличие коллизии в канале (Collision).
									</para>
								</listitem>
							</itemizedlist>
						</listitem>
						<listitem>
							<para>
								Нижний — <emphasis>LINK</emphasis>:
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>Горит</emphasis> — связь с удалённым устройством есть.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Не горит</emphasis> — связи с удалённым устройством нет.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Мигает</emphasis> — идёт обмен данными.
									</para>
								</listitem>
							</itemizedlist>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>
						<emphasis>Кнопка включения питания</emphasis> — кнопка включения маршрутизатора.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Индикатор питания</emphasis> — горит, когда маршрутизатор включён.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Вид задней панели маршрутизатора с питанием 36-72В постоянного тока (DC) показан ниже.
			</para>
			<figure>
				<title>Вид задней панели маршрутизатора с питанием 36-72В DC</title>
				<graphic fileref="img/hw-sg17-back-dc-text.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Разъём питания</emphasis> — для подключения к источнику питания постоянного тока 36-72В.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Вид задней панели маршрутизатора с питанием 220В/50Гц показан ниже.
			</para>
			<figure>
				<title>Вид задней панели маршрутизатора с питанием 220В/50Гц</title>
				<graphic fileref="img/hw-sg17-back-ac-text.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Разъём питания</emphasis> — для подключения к сети 220В/50Гц.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Вид передней панели с установленными модулями SHDSL и E1 представлен ниже.
			</para>
			<figure>
				<title>Передняя панель с установленными модулями</title>
				<graphic fileref="img/hw-sg17-front-modules-text.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Модули SHDSL</emphasis> — два двухканальных модуля SHDSL с дистанционным питанием.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Модули Е1</emphasis> — два двухканальных модуля Е1.
					</para>
				</listitem>
			</itemizedlist>
		</section>
		<section id="hw.modules">
			<title>Сменные интерфейсы</title>
			<para>
				При использовании маршрутизатора SG-17R имеется возможность расширять его функциональные возможности за счёт использования сменных модулей — на данный момент это модули SHDSL и E1.
			</para>
			<section id="hw.modules.dsl">
				<title>Модули SHDSL</title>
				<para>
					Существует несколько типов модулей SHDSL:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Один канал SHDSL без дистанционного питания (MR-17H1).
						</para>
					</listitem>
					<listitem>
						<para>
							Два канала SHDSL без дистанционного питания (MR-17H2).
						</para>
					</listitem>
					<listitem>
						<para>
							Один канал SHDSL с дистанционным питанием (MR-17H1P2).
						</para>
					</listitem>
					<listitem>
						<para>
							Два канала SHDSL с дистанционным питанием (MR-17H2P2).
						</para>
					</listitem>
				</itemizedlist>
				<figure>
					<title>Модуль на один канал SHDSL без дистанционного питания (MR-17H1)</title>
					<graphic fileref="img/hw-module-17h1-text.png" width="6in"/>
				</figure>
				<figure>
					<title>Модуль на один канал SHDSL с дистанционным питанием (MR-17H1P2)</title>
					<graphic fileref="img/hw-module-17h1p2-text.png" width="6in"/>
				</figure>
				<figure>
					<title>Модуль на два канала SHDSL без дистанционного питания (MR-17H2)</title>
					<graphic fileref="img/hw-module-17h2-text.png" width="6in"/>
				</figure>
				<figure>
					<title>Модуль на два канала SHDSL с дистанционным питанием (MR-17H2P2)</title>
					<graphic fileref="img/hw-module-17h2p2-text.png" width="6in"/>
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Порты SHDSL</emphasis> — RJ-45 порты для подключения по интерфейсу SHDSL.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Индикаторы SHDSL</emphasis>
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<emphasis>ERR</emphasis>:
								</para>
								<itemizedlist>
									<listitem>
										<para>
											<emphasis>Не горит</emphasis> — нет сбойных пакетов.
										</para>
									</listitem>
									<listitem>
										<para>
											<emphasis>Мигает</emphasis> — получен сбойный пакет.
										</para>
									</listitem>
								</itemizedlist>
							</listitem>
							<listitem>
								<para>
									<emphasis>LINK</emphasis>:
								</para>
								<itemizedlist>
									<listitem>
										<para>
											<emphasis>Горит</emphasis> — связь с удалённым устройством есть.
										</para>
									</listitem>
									<listitem>
										<para>
											<emphasis>Не горит</emphasis> — связи с удалённым устройством нет.
										</para>
									</listitem>
									<listitem>
										<para>
											<emphasis>Мигает</emphasis> — процесс установки связи.
										</para>
									</listitem>
								</itemizedlist>
							</listitem>
							<listitem>
								<para>
									<emphasis>UNB</emphasis>:
								</para>
								<itemizedlist>
									<listitem>
										<para>
											<emphasis>Горит</emphasis> — нарушен баланс питания относительно земли. В норме на одном проводе +120 В, на другом — 120 В. Если перекос больше 30 В или отсутствует земля — это означает несбалансированность питания.
										</para>
									</listitem>
									<listitem>
										<para>
											<emphasis>Не горит</emphasis> — баланс питания в норме.
										</para>
									</listitem>
								</itemizedlist>
							</listitem>
							<listitem>
								<para>
									<emphasis>OVL</emphasis>:
								</para>
								<itemizedlist>
									<listitem>
										<para>
											<emphasis>Горит</emphasis> — перегрузка питания. Это вызвано слишком большим числом (больше 4) регенераторов на линии, настроенных на питание от данного маршрутизатора.
										</para>
									</listitem>
									<listitem>
										<para>
											<emphasis>Не горит</emphasis> — перегрузки питания нет.
										</para>
									</listitem>
								</itemizedlist>
							</listitem>
						</itemizedlist>
					</listitem>
				</itemizedlist>
			</section>
			<section id="hw.modules.e1">
				<title>Модули Е1</title>
				<para>
					Существует несколько типов модулей Е1:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Один канал Е1 (MR-17G).
						</para>
					</listitem>
					<listitem>
						<para>
							Два канала Е1 (MR-17G2).
						</para>
					</listitem>
				</itemizedlist>
				<figure>
					<title>Модуль на один канал E1 (MR-17G)</title>
					<graphic fileref="img/hw-module-1e1-text.png" width="6in"/>
				</figure>
				<figure>
					<title>Модуль на два канала E1 (MR-17G2)</title>
					<graphic fileref="img/hw-module-2e1-text.png" width="6in"/>
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Порты E1</emphasis> — RJ-45 порты для подключения по интерфейсу E1.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Индикаторы E1</emphasis>
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<emphasis>Горит</emphasis> — связь с удалённым устройством есть.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>Не горит</emphasis> — связи с удалённым устройством нет.
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
				</itemizedlist>
			</section>
			<section id="hw.modules.install">
				<title>Установка сменных интерфейсов</title>
				<important>
					<para>
						Для установки модулей можно использовать только слоты A, B и C маршрутизатора.
					</para>
				</important>
				<figure>
					<title>Передняя панель без сменных модулей</title>
					<graphic fileref="img/hw-sg17-front-empty-text.png" width="6in"/>
				</figure>
				<para>
					Установка модуля выполняется следующим образом:
				</para>
				<orderedlist>
					<listitem>
						<para>
							Выключить питание маршрутизатора.
						</para>
					</listitem>
					<listitem>
						<para>
							Снять с маршрутизатора заглушку, закрывающую слот.
						</para>
					</listitem>
					<listitem>
						<para>
							Установить модуль в слот.
						</para>
					</listitem>
					<listitem>
						<para>
							Зафиксировать его при помощи крепёжных винтов.
						</para>
					</listitem>
					<listitem>
						<para>
							Включить питание маршрутизатора и произвести настройку установленного модуля.
						</para>
					</listitem>
				</orderedlist>
			</section>
		</section>
	</chapter>
	<chapter>
		<title>Начало работы с маршрутизатором</title>
		<section id="firstboot">
			<title id="firstboot.title">Подготовка к первому включению</title>
			<important>
				<para>
					Удостоверьтесь в отсутствии внешних повреждений, возможно, полученных при транспортировке устройства. В случае наличия таковых, просьба немедленно связаться со службой гарантийной поддержки ООО «Сигранд».
				</para>
			</important>
			<warning>
				<para>
					В случае, если устройство перевозилось или хранилось при отрицательной температуре — включение его допускается только по истечении часа нахождения при комнатной температуре!
				</para>
			</warning>
			<para>
				Извлеките маршрутизатор из упаковки и расположите его на столе или иной ровной горизонтальной поверхности. Подключите соответствующее питание (220В/50Гц или DC 36-72В).
			</para>
			<para>
				Если требуется управление маршрутизатором по консольному интерфейсу, например, для обновления прошивки маршрутизатора (см. <link linkend="update" endterm="update.title"/>, или для диагностики процесса загрузки, соедините консольный порт маршрутизатора с последовательным портом компьютера с помощью переходника (для SG-16R) или терминального провода (для SG-17R).
			</para>
			<para>
				Для управления маршрутизатором по консольному интерфейсу используется любая терминальная программа — HyperTerminal для ОС Windows или Minicom для ОС GNU/Linux. Настройки последовательного порта приведены выше, в разделе <link linkend="hw.desc.rs232" endterm="hw.desc.rs232.title"/>.
			</para>
			<para>
				Для настройки маршрутизатора через веб-интерфейс соедините его интерфейс eth0 с сетевым адаптером компьютера или портом коммутатора локальной сети при помощи стандартного патч-корда.
			</para>
			<para>
				Включение маршрутизатора производится выключателем питания, расположенным на лицевой панели.
			</para>
		</section>
		<section id="bootloader">
			<title>Загрузчик</title>
			<para>
				Меню загрузчика доступно при подключении к маршрутизатору по консольному интерфейсу. После включения питания, на экран будет выведено предложение войти в меню загрузчика. Для этого вам необходимо 3 раза быстро нажать на клавишу пробела.
			</para>
			<screen>
				ADM5120 Boot:
				
				
				CPU: Infineon 5120-175MHz
				SDRAM: 64MB
				Flash: NAND-32MB
				Boot System: Linux-5120
				Loader Version: 1.00.03
				Creation Date: 17.04.2007
				
				Press &lt;space> key tree times to enter boot menu..
					3
			</screen>
			<para>
				Если вы трижды нажали на пробел, то выведется меню загрузчика:
			</para>
			<screen>
				==================================
				Bootloader Menu
				[1] Xmodem Download
				[2] TFTP Download
				[3] Print Boot Params
				[4] Set Boot Params
				[5] Check flash
				[6] Exit
				
				Please enter your number:
			</screen>
			<para>
				В этом меню доступны несколько действий:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Xmodem Download</emphasis> — обновление загрузчика или системы через последовательный порт по протоколу Xmodem. Данный способ обновления занимает много времени.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>TFTP Download</emphasis> — обновление системы или загрузчика с помощью TFTP сервера.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Print Boot Params</emphasis> — показывает сетевые параметры загрузчика, основные — мак адрес и IP-адрес.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Set Boot Params</emphasis> — установка сетевых параметров для загрузки. Подробнее эти параметры рассмотрены в разделе &quot;Обновление прошивки маршрутизатора&quot;.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Check flash</emphasis> — проверка флэш-памяти маршрутизатора на наличие поврежденных блоков.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Чтобы проверить маршрутизатор на наличие поврежденных блоков, переходим в меню Check flash:
			</para>
			<screen>
				Please enter your number:5
				Flash Client Menu
				===============================
				[P]: Print existent bad blocks
				[S]: Scan flash for new bad blocks
				[E]: Erase flash
				[X]: exit
				Enter your option:
			</screen>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Print existent bad blocks</emphasis> — выводит на экран информацию о выявленных в ходе предыдущих проверках поврежденных блоках.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Scan flash for new bad blocks</emphasis> — сканирование флэш-памяти на предмет поврежденных блоков. В случае их обнаружения, они помечаются, как поврежденные, и не используются системой.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Erase flash</emphasis> — очистка флэш-памяти. Удаляет систему с флэш-памяти.
					</para>
				</listitem>
			</itemizedlist>
		</section>
		<section id="update">
			<title id="update.title">Обновление прошивки маршрутизатора</title>
			<important>
				<para>
					Перед перепрошивкой следует сохранить конфигурацию (см. раздел <link linkend="cfg" endterm="cfg.title" />), т.к. установка новой прошивки вернёт все параметры в исходное состояние, а так же сбросит установленные производителем MAC-адреса (см. раздел <link linkend="mac-address" endterm="mac-address.title" />).
				</para>
			</important>
			<para>
				Обновление прошивки выполняется через консольный интерфейс, для этого вам потребуется:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						Компьютер с последовательным интерфейсом.
					</para>
				</listitem>
				<listitem>
					<para>
						TFTP-сервер, доступный с маршрутизатора.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Для обновления прошивки необходимо, чтобы маршрутизатору был доступен TFTP-сервер, на котором расположен файл образа прошивки. В старых версиях загрузчика было необходимо, чтобы этот TFTP-сервер находился в одной сети с маршрутизатором, в новой версии добавлена возможность обновления, когда сервер доступен через шлюз.
			</para>
			<para>
				Если используется локальный TFTP-сервер, то после его настройки необходимо в каталог, являющийся для него (TFTP-сервера) корневым, скопировать файл прошивки, который можно скачать с веб-сайта <ulink url="http://www.sigrand.ru">www.sigrand.ru</ulink>. Последняя версия прошивки находится по адресу <ulink url="http://sigrand.ru/temp/sigrand">http://sigrand.ru/temp/sigrand</ulink>.
			</para>
			<para>
				Как подготовить маршрутизатор для управления по консольному интерфейсу написано в разделе <link linkend="firstboot" endterm="firstboot.title"/>. После запуска программы управления терминалом и установки соответствующих настроек порта, надо включить маршрутизатор. В окне программы выведется информация о маршрутизаторе с предложением войти в меню загрузчика:
			</para>
			<screen>
				ADM5120 Boot:
				
				
				CPU: ADM5120-175MHz
				SDRAM: 128MB
				Flash: NAND-32MB
				Boot System: Linux-5120
				Loader Version: 1.00.03
				Creation Date: 2004.06.04
				
				Press &lt;space> key tree times to enter boot menu..
				2
			</screen>
			<para>
				Для активации меню загрузчика надо быстро нажать на клавишу пробела 3 раза. Меню загрузчика выглядит следующим образом:
			</para>
			<screen>
				==================================
				Bootloader Menu
				[1] Xmodem Download
				[2] TFTP Download
				[3] Print Boot Params
				[4] Set Boot Params
				[5] Check flash
				[6] Exit
				
				Please enter your number:
			</screen>
			<para>
				Перед обновлением прошивки необходимо выставить сетевые параметры, которые соответствуют вашей сети. Для этого нужно перейти в пункт меню <emphasis>Set Boot Params</emphasis>, нажав клавишу 4. Здесь будет предложено указать:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Серийный номер маршрутизатора</emphasis> — (Enter new serial number) — можно пропустить.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Версию аппаратной части</emphasis> — (Enter new hardware version) — можно пропустить.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>MAC-адрес сетевого интерфейса</emphasis> — (Enter new mac address) — можно оставить установленный MAC адрес (его значение отображено выше, Current Mac Address), или ввести новое значение.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Число MAC адресов</emphasis> — (Enter new number of mac address) — этот параметр следует пропустить (по умолчанию число MAC адресов равно 1).
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>IP-адрес</emphasis> — (Enter new IP address for this board) — следует ввести IP адрес, находящийся в одной сети с TFTP сервером.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Пример конфигурации приведен ниже:
			</para>
			<screen>
				Set Boot Parameters.
				==========================
				Enter new serial number:
				Serial Number unchanged.
				Enter new hardware version:
				Hardware version unchanged.
				Current mac addres: 00-05-5D-77-86-01
				Number of mac address: 1
				Enter new mac address (AA-AA-AA-AA-AA-AA):
				Enter new number of mac address (between 1-8):
				Mac address unchanged.
				IP address for this board: 10.10.10.1
				Enter new IP address for this board: 10.10.10.1
				IP updated successfully.
			</screen>
			<para>
				В приведенном примере был введен только IP адрес маршрутизатора, остальные параметры оставлены без изменений.
			</para>
			<para>
				После настройки сетевых параметров, следует выбрать пункт меню 2 (TFTP Client Download) для настройки параметров обновления с помощью TFTP сервера. Содержание этого меню приведено ниже:
			</para>
			<screen>
				Server IP: 80.66.88.167
				Gateway IP: 10.10.10.2
				Remote File bootloader: bootgw
				Remote File system: openwrt
				
				TFTP Client Menu
				===============================
				[B]: Update bootloader
				[S]: Update system
				[A]: Update all
				[P]: Set parameters
				[X]: exit
				Enter your option:
			</screen>
			<note>
				<para>
					Приведённое выше меню соответствует новому загрузчику, в который была добавлена возможность загрузки образов загрузчика и системы с TFTP-сервера, находящегося за маршрутизатором. Меню в старых версиях загрузчика отличается отсутствием возможности установки шлюза и обновления загрузчика.
				</para>
			</note>
			<para>
				Первые четыре строчки над меню содержат информацию, установленную во время последнего обновления прошивки. Для их изменения следует выбрать пункт меню set parameters нажатием клавиши p. В ответ на это будет предложено ввести:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>IP-адрес TFTP сервера</emphasis> — (Please Enter TFTP Server IP) — IP адрес TFTP сервера, на котором находится файл прошивки. Можно использовать TFTP-сервер, предоставляемый компанией Сигранд —  <emphasis>sigrand.ru</emphasis>. Вводить следует IP-адрес сервера.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>IP-адрес шлюза</emphasis> — (Please enter gateway IP). Установка данного параметра позволяет обновлять прошивку с TFTP-сервера, находящегося в отличной от маршрутизатора сети. Шлюз должен находиться в той же сети, что и интерфейс маршрутизатора.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Имя файла образа загрузчика</emphasis> — (Enter remote bootloader file name).
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Имя файла прошивки</emphasis> — (Enter remote system file name) — имя файла прошивки, расположенного на TFTP сервере.
					</para>
				</listitem>
			</itemizedlist>
			<screen>
				Please enter TFTP server IP : 80.66.88.167
				Please enter gateway IP : 10.10.10.2
				Enter remote bootloader file name : bootgw
				Enter remote system file name : openwrt
			</screen>
			<para>
				После настройки необходимых параметров, можно перейти к прошивке маршрутизатора или обновлению загрузчика. Для обновления загрузчика выбираем пункт меню [B]: Update bootloader:
			</para>
			<screen>
				Enter your option:b
				Starting the TFTP download(ESC to stop)...
				PASS
				File total Length: 00010DF0
				
				Eraseing flash.......
				PASS
				Programming flash....
				PASS
			</screen>
			<para>
				PASS, соответствующий строчкам Eraseing flash и Programming flash означает, что обновление загрузчика прошло успешно. FAIL говорит о возникших проблемах, как правило это неправильный IP-адрес TFTP-сервера (маршрутизатор и TFTP-сервер находятся в разных сетях) или неправильное имя файла на сервере.
			</para>
			<para>
				Для обновления прошивки маршрутизатора переходим в пункт меню [S]: Update system:
			</para>
			<screen>
				Enter your option:s
				Starting the TFTP download(ESC to stop)...................................
				PASS
				File total Length: 00B62808  Starting address: A0820000
				
				Eraseing flash.......
				PASS
				Programming flash....
				PASS
			</screen>
			<para>
				Если на экране присутствуют строчки:
			</para>
			<screen>
				Eraseing flash.......
				PASS
				Programming flash....
				PASS
			</screen>
			<para>
				— значит, обновление прошивки прошло успешно и теперь можно загрузить новую прошивку. Для этого необходимо выполнить перезагрузку маршрутизатора нажатием на кнопку RESET (или включением/выключением питания).
			</para>
			<para>
				Пункт меню [A]: Update all последовательно обновляет загрузчик и прошивку маршрутизатора.
			</para>
			<para>
				После загрузки маршрутизатора (при обычной загрузке не требуется входить в меню загрузчика, поэтому надо подождать, пока истечёт таймер и начнётся загрузка операционной системы), можно перейти к настройке посредством веб-интерфейса. Доступ к консоли больше не требуется, поэтому провод и соответствующее <acronym>ПО</acronym> можно отключить.
			</para>
			<para>
				В случае, если на экран была выведена строчка:
			</para>
			<screen>Starting the TFTP download(ESC to stop)..FAIL</screen>
			<para>
				— значит, загрузчику не удалось загрузить файл прошивки с указанного TFTP сервера. В этом случае следует проверить корректность указания IP адреса TFTP сервера и имени файла прошивки на нем. Если все корректно, то следует проверить настройки, введенные в пункте Set Boot Params. Может помочь смена MAC адреса и проверка, не блокирует ли сервер TFTP соединения с маршрутизатора.
			</para>
		</section>
		<section>
			<title>Установка программ</title>
			<para>
				Функциональность маршрутизатора может быть расширена за счёт установки дополнительного программного обеспечения, поставляемого в виде пакетов.
			</para>
			<para>
				Перед установкой пакета его надо загрузить на маршрутизатор. Сделать это можно несколькими способами:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						Разместить на WWW/FTP сервере и загрузить с помощью утилиты <command>wget</command>.
					</para>
				</listitem>
				<listitem>
					<para>
						Разместить на TFTP сервере и загрузить с помощью <command>tftp</command> клиента.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Загрузка пакета с TFTP сервера:
			</para>
			<para>
				# <command>tftp</command>
				<replaceable>192.168.2.1</replaceable>
				<option>-r</option>
				<replaceable>libpthread_0.9.28-1_mipsel.ipk</replaceable>
				<option>-g</option>
			</para>
			<para>
				Установка пакета:
			</para>
			<screen>
				# <command>ipkg</command>
				<option>install</option>
				<replaceable>libpthread_0.9.28-1_mipsel.ipk</replaceable>
				Installing libpthread (0.9.28-1) to root...
				Configuring libpthread
				Done.
			</screen>
			<para>
				Если при выполнении установки пакета будет выведено сообщение <computeroutput>ERROR: Cannot satisfy the following dependencies for <replaceable>fprobe</replaceable>:</computeroutput>, следует установить указанный пакет и повторить установку текущего пакета (<replaceable>fprobe</replaceable>).
			</para>
		</section>
		<section id="mac-address">
			<title id="mac-address.title">MAC-адреса сетевых интерфейсов</title>
			<para>
				MAC-адреса для сетевых интерфейсов (Ethernet, SHDSL, E1) хранятся в конфигурационном файле (kdb).
			</para>
			<para>
				На данный момент существует два способа начального присвоения MAC-адресов:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						При <emphasis>первой</emphasis> после перепрошивки загрузке маршрутизатора происходит генерация случайных MAC-адресов для интерфейсов eth* и dsl0, dsl1. Такая генерация MAC-адресов не может гарантировать их уникальности для нескольких маршрутизаторов — т.е., два маршрутизатора могут сгенерировать одинаковые MAC-адреса. Чтобы свести вероятность повторения адресов к минимуму — первую загрузку следует производить, когда маршрутизатор подключён к сети ethernet, желательно с интенсивным трафиком — это увеличит случайность в генерации адресов.
					</para>
				</listitem>
				<listitem>
					<para>
						Затем запускается скрипт, реализующий второй способ присвоения MAC-адресов — получение списка MAC-адресов со специализированного сервера. Скрипт проверяет, доступен ли данный сервер — и если доступен, загружает с него список уникальных MAC-адресов, которые затем назначает сетевым интерфейсам. Данный способ доступен и используется только производителем маршрутизатора. При успешном обновлении MAC-адресов будет выдано соответствующее сообщение:
					</para>
					<screen>
	Updating MAC addresses
					</screen>
					<para>
						В случае, если указанный выше сервер недоступен, будет выдано соответствующее сообщение, попытки обновления MAC-адресов при последующих загрузках предприниматься не будут.
					</para>
					<screen>
	MAC-address server is unreachable. You can update your MAC-address
	manually by running:
	/etc/init.d/updatekdb force
					</screen>
				</listitem>
			</itemizedlist>
			<para>
				От изготовителя маршрутизатор поставляется с MAC-адресами, полученными со специализированного сервера, что гарантирует их уникальность для всех возможных интерфейсов маршрутизатора.
			</para>
			<para>
				Так как MAC-адреса хранятся в конфигурационном файле — после перепрошивки они будут потеряны. Чтобы этого не произошло, перед перепрошивкой следует сохранить конфигурацию маршрутизатора (см. раздел <link linkend="cfg" endterm="cfg.title" />), а затем произвести её восстановление.
			</para>
		</section>
	</chapter>
	<chapter id="configure">
		<title>Управление маршрутизатором</title>
		<section>
			<title>Конфигурация маршрутизатора</title>
			<para>
				В заводской конфигурации и после обновления прошивки на маршрутизаторе активен интерфейс eth0 с IP-адресом 192.168.2.100, сетевая маска 255.255.255.0.
			</para>
			<para>
				Для конфигурации маршрутизатора необходимо соединить сетевую карту компьютера и Ethernet-порт eth0 патч-кордом. На компьютере следует выставить IP-адрес из той же сети, в которой находится маршрутизатор (192.168.2.0/24), к примеру, 192.168.2.1, с сетевой маской 255.255.255.0.
			</para>
			<section id="web">
				<title>Конфигурация с помощью Веб-интерфейса</title>
				<para>
					Конфигурация маршрутизатора выполняется через веб-интерфейс любым веб-браузером, поддерживающем протокол HTTPS (Internet Explorer, Opera, Safari, Mozilla Firefox). Для конфигурации необходимо в строке адреса веб-браузера ввести https://192.168.2.100, после чего будут заданы несколько вопросов касательно сертификатов шифрования, на которые следует ответить положительно. По-умолчанию, логин/пароль установлены следующие: admin/1234.
				</para>
				<section id="passwd" >
					<title>Установка пароля</title>
					<important>
						<para>
							Настоятельно рекомендуется поменять пароль для конфигурации, это выполняется на странице System/Security.
						</para>
					</important>
					<para>
						Там же следует поменять и пароль для управления маршрутизатором через консольный интерфейс. Страница смены пароля приведена ниже.
					</para>
					<figure>
						<title>Смена пароля</title>
						<graphic fileref="img/security.png" />
					</figure>
				</section>
				<section id="hostname" >
					<title>Имя маршрутизатора</title>
					<para>
						Смена имени маршрутизатора (hostname) может быть выполнена на странице System/General, которая приведена ниже.
					</para>
					<figure>
						<title>Смена имени маршрутизатора</title>
						<graphic fileref="img/general.png" />
					</figure>
				</section>
				<section id="time">
					<title>Синхронизация времени</title>
					<para>
						Установка сервера для синхронизации внутренних часов маршрутизатора и часового пояса выполняется на странице System/Time.
					</para>
					<figure>
						<title>Синхронизация времени</title>
						<graphic fileref="img/time.png" />
					</figure>
				</section>
				<section id="dns">
					<title>Настройка DNS</title>
					<para>
						Установка адреса DNS-сервера, к которому будет обращаться маршрутизатор с DNS запросами и имя домена, в который входит маршрутизатор, устанавливается на странице System/DNS.
					</para>
					<figure>
						<title>Настройка DNS</title>
						<graphic width="6in" fileref="img/dns.png" />
					</figure>
				</section>
				<para>
					Информация о состоянии соединения SHDSL и E1 может быть получена на страницах General/SHDSL и General/E1 соответственно, конфигурация параметром линии связи для этих интерфейсов выполняется соответственно на страницах General/SHDSL/dsl* и General/E1/hdlc*, для более подробной информации о возможных настройках обратитесь к соответствующему разделу документации.
				</para>
				<para>
					Управление интерфейсами осуществляется на страницах, указанных в меню Network. К примеру, конфигурация интерфейсов Ethernet осуществляется на страницах Network/Interfaces/eth*, SHDSL — на страницах Network/Interfaces/dsl*, а E1 — на Network/Interfaces/hdlc*. Для активация интерфейса необходимо активировать параметры Enabled и Auto на вкладке General, расположенной на странице конфигурирования выбранного сетевого интерфейса. За более подробными инструкциями обратитесь к соответствующим страницам конфигурации маршрутизатора.
				</para>
				<para>
					В меню Tools расположены утилиты, позволяющие:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Проследить за работой маршрутизатора, просмотрев логи — страницы <emphasis>syslog</emphasis> и <emphasis>dmesg</emphasis>;
						</para>
					</listitem>
					<listitem>
						<para>
							Выполнить перезагрузку с помощью <emphasis>reboot</emphasis>;
						</para>
					</listitem>
					<listitem>
						<para>
							Проверить работу сервера DNS или соответствие DNS-имени IP-адресу с помощью утилиты <emphasis>dig</emphasis>;
						</para>
					</listitem>
					<listitem>
						<para>
							Проверить работоспособность узла с помощью утилиты <emphasis>ping</emphasis>;
						</para>
					</listitem>
					<listitem>
						<para>
							Посмотреть маршрут прохождения пакета до заданного узла в сети с помощью <emphasis>mtr</emphasis>;
						</para>
					</listitem>
					<listitem>
						<para>
							Просмотреть сетевой трафик с помощью <emphasis>tcpdump</emphasis>.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Сохранение и восстановление конфигурации производится на страницах Configuration/Backup и Configuration/Restore соответственно.
				</para>
			</section>
			<section id="console">
				<title>Конфигурация через консольный интерфейс</title>
				<para>
					Для конфигурации маршрутизатора через консольный интерфейс необходимо подключиться к нему по последовательному интерфейсу с помощью терминальной программы, либо по сети через Ethernet-порт по протоколу SSH (порт 22). Есть несколько программ, поддерживающих работу по протоколу SSH, к примеру, Putty для OS Windows и ssh для OS GNU/Linux. В качестве логина необходимо ввести root, пароль — 1234.
				</para>
				<note>
					<para>
						Следует заметить, что изменения, внесённые в конфигурацию маршрутизатора через консольный интерфейс, будут замены после перезагрузки параметрами, указанными в веб-интерфейсе.
					</para>
				</note>
			</section>
			<section>
				<title>Сводная информация</title>
				<table frame="all">
					<title>Сводная таблица</title>
					<tgroup cols="3">
						<colspec colname="c1"/>
						<colspec colname="c2"/>
						<colspec colname="c3"/>
						<thead>
							<row>
								<entry nameend="c2" namest="c1">Параметр</entry>
								<entry>Значение</entry>
							</row>
						</thead>
						<tbody>
							<row>
								<entry nameend="c2" namest="c1">IP-адрес (крайний правый порт)</entry>
								<entry>192.168.2.100</entry>
							</row>
							<row>
								<entry nameend="c2" namest="c1">Сетевая маска</entry>
								<entry>255.255.255.0</entry>
							</row>
							<row>
								<entry nameend="c2" namest="c1">Веб-интерфейс</entry>
							</row>
							<row>
								<entry/>
								<entry>Протокол</entry>
								<entry>HTTPS</entry>
							</row>
							<row>
								<entry/>
								<entry>Логин</entry>
								<entry>admin</entry>
							</row>
							<row>
								<entry/>
								<entry>Пароль</entry>
								<entry>1234</entry>
							</row>
							<row>
								<entry nameend="c2" namest="c1">Консольный интерфейс</entry>
							</row>
							<row>
								<entry/>
								<entry>Протокол</entry>
								<entry>SSH</entry>
							</row>
							<row>
								<entry/>
								<entry>Логин</entry>
								<entry>root</entry>
							</row>
							<row>
								<entry/>
								<entry>Пароль</entry>
								<entry>1234</entry>
							</row>
						</tbody>
					</tgroup>
				</table>
			</section>
		</section>
		<section id="logging">
			<title>Логирование событий</title>
			<para>
				Из-за особенности используемой встроенной памяти (flash-память) системные события (логи) не сохраняются локально на маршрутизаторе, а пишутся в специальный буфер, доступный для просмотра через Tools/syslog. Маршрутизатор имеет несколько параметров, управляющих логированием:
			</para>
			<figure>
				<title>Логирование</title>
				<graphic width="6in" fileref="img/logging.png" />
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Circular buffer</emphasis> — размер буфера.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Enable remote syslog logging</emphasis> — включение логирования на удалённый syslog-сервер.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Remote syslog server</emphasis> — адрес удаленного syslog-сервера.
					</para>
				</listitem>
			</itemizedlist>
			<note>
				<para>
					При включении логирования на удалённый сервер, продолжается запись событий в локальный буфер.
				</para>
			</note>
			<note>
				<para>
					Для того, чтобы удалённый syslog-сервер принимал логи от маршрутизатора, его необходимо запустить с опцией &quot;-r&quot;. Логирование производится по протоколу udp, 514 порт.
				</para>
			</note>
		</section>
		<section id="adm5120sw">
			<title>Настройка встроенного Ethernet коммутатора</title>
			<para>
				Настройка коммутатора осуществляется на странице System/Switch, на который устанавливается соотношение между физическими портами коммутатора (нумерация идет справа налево, т.е. Port 0 соответствует крайнему правому разъему маршрутизатора). Отнесение нескольких портов к одному интерфейсу создает для них единую физическую среду, т.е. они начинают работать, как порты одного коммутатора. Окно конфигурации представлено на рисунке:
			</para>
			<figure>
				<title>Конфигурация коммутатора</title>
				<graphic fileref="img/switch-1.png" />
			</figure>
			<para>
				В приведённой выше конфигурации 0 и 1 порты коммутатора отнесены к сетевому интерфейсу eth0, в то время как 2 и 3 порты являются независимыми.
			</para>
			<note>
				<para>
					После внесения изменений необходимо перезагрузить маршрутизатор.
				</para>
			</note>
		</section>
		<section>
			<title>Установление зависимостей SHDSL — Ethernet</title>
			<para>
				Для создания сложных взаимосвязей между интерфейсами была добавлена возможность
				управления состоянием Ethernet порта в зависимости от состояния соответствующего ему
				SHDSL порта
			</para>
			<para>
				На данный момент управление соответствием осуществляется через консольный
				интерфейс, и устанавливается в конфигурационном файле /etc/sigrand/dsl2eth.map.
			</para>
			<para>
				Изначально файл /etc/sigrand/dsl2eth.map пустой. Пример его заполнения показан в файле 
				/etc/sigrand/dsl2eth.map.example и выглядит следующим образом:
			</para>
			<screen>
	dsl0 eth0
	dsl1 eth1
			</screen>
			<para>
				Это означает, что интерфейсу eth0 соответствует интерфейс dsl0, а eth1 — dsl1, и если линк на dsl0 
				упадет, что так же будет отключен линк на eth0. Редактировать файл можно любым текстовым редактором, к примеру следующей командой:
			</para>
			<para>
				<command>nano</command> <replaceable>/etc/sigrand/dsl2eth.map</replaceable>
			</para>
			<para>
				После внесения изменений в конфигурационный файл рекомендуется перезагрузить маршрутизатор.
			</para>
		</section>
		<section id="eoc">
			<title id="eoc.title">Мониторинг SHDSL каналов</title>
			<note>
				<para>
					Мониторинг поддерживают только модули MR17H.
				</para>
			</note>
			<note>
				<para>
					Получение статистики по каналу на данный возможно только с мастера.
				</para>
			</note>
			<section>
				<title>Мониторинг через веб-интерфейс</title>
				<para>
					Мониторинг SHDSL каналов позволяет получить информацию о различных параметрах и произошедших ошибках в линии связи. В случае, если в линии связи используются регенераторы <emphasis>SG-17E</emphasis>, то можно получать информацию о состоянии этих регенераторов и их количестве.
				</para>
				<para>
					Просмотр статистики параметров канала доступен на странице System->SHDSL-EOC->имя_интерфейса, на вкладке Statistic. На вкладке General отображается общая статистика соединения.
				</para>
				<figure>
					<title>Общая статистика соединения</title>
					<graphic fileref="img/eocd-stat-general.png" width="6in" />
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Channel link</emphasis> — состояние соединения между демонами EOCd. Если соединение установлено, но значение этого параметра установлено в <emphasis>offline</emphasis> — значит демоны EOCd не смогли установить между собой соединение. Это может быть вызвано несколькими причинами: один из демонов EOCd может быть не запущен, либо соответствующий интерфейс не управляется через EOCd.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Regenerators</emphasis> — фактическое число регенераторов на линии.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Wire pairs</emphasis> — число пар в канале.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Rate, Annex</emphasis> — скорость и дополнения.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Каждому юниту в канале (мастеру, слейву и регенераторам) соответствует своя вкладка, на которой отображаются параметры линии связи для данного юнита. Так, вкладки STU-C и STU-R соответствуют мастеру и слейву, а SRU1 — SRU8 — регенераторам.
				</para>
				<para>
					Параметры производительности, характеризующие SHDSL канал:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Errored Second (ES)</emphasis> — количество секундных интервалов, в которые была обнаружена одна или более CRC аномалий или более одного LOSW дефекта. При работе с данным параметром необходимо учитывать правила приоритетов параметров (см. <link linkend="shdsl.rules">правила приоритетов</link>).
						</para>
						<note>
							<para>
								<emphasis>Loss of Sync Defect (LOSW defect)</emphasis> – потеря синхронизации. В плезиохронном режиме дефект потери синхронизации должен обозначаться, когда не менее трех последовательно полученных кадров содержат ошибки синхронизации. Данные ошибки индицируются группой битов в кадре: Frame Sync Word, Stuff Bits и Stuff Bit Ids. Индикация LOSW очищается после получения не менее двух кадров не содержащих ошибок синхронизации, следующих друг за другом.
							</para>
						</note>
					</listitem>
					<listitem>
						<para>
							<emphasis>Severely Errored Second (SES)</emphasis> — количество односекундных интервалов, в течение которых произошло не менее 50-ти CRC аномалий или более одного LOSW дефекта. (50 CRC аномалий в течение одной секунды соответствуют 30% некорректных кадров для стандартной длины кадра). При работе с данным параметром необходимо учитывать правила приоритетов параметров.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>LOSW Second (LOSWS)</emphasis> — количество секундных интервалов, в течение которых обнаружено более одного LOSW дефекта.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Unavailable Second (UAS)</emphasis> — количество секундных интервалов, в течение которых SHDSL канал недоступен. Канал считается доступным после сбоя по прошествии 10 секунд, в течение которых не зарегистрировано ни одного SES. Данные 10 секунд исключаются из числа секунд, в которые канал был недоступен.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Code Violation (CV)</emphasis> — количество CRC аномалий, обнаруженных за период, в течение которого производился мониторинг. При работе с данным параметром необходимо учитывать правила приоритетов параметров, которые будут описаны ниже.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Таблица <emphasis>state</emphasis> показывает текущие параметры линии (SNR и LoopAttn) и ошибки с момента начала мониторинга канала.
				</para>
				<figure>
					<title>Таблица state</title>
					<graphic fileref="img/eocd-stat-unit-state.png" width="6in" />
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Side</emphasis> — сторона.
						</para>
						<note>
							<para>
								Есть две группы, в которые входят параметры линии связи:
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>NetSide</emphasis> — сторона мастера (линия связи, идущая к мастеру).
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>CustSide</emphasis> — сторона клиента (линия связи, идущая к слейву).
									</para>
								</listitem>
							</itemizedlist>
						</note>
					</listitem>
					<listitem>
						<para>
							<emphasis>Pair</emphasis> — номер пары проводов.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Таблица <emphasis>relative counters</emphasis> содержит те же параметры, что и таблица <emphasis>state</emphasis>, предоставляя возможность их сбрасывания, чтобы проводить замеры в определённые промежутки времени.
				</para>
				<figure>
					<title>Таблица relative counters</title>
					<graphic fileref="img/eocd-stat-unit-relative.png" width="6in" />
				</figure>
				<para>
					Таблица <emphasis>current intervals</emphasis> содержит ошибки за последние 15 минут и последний день. Значения обновляются, соответственно, каждые 15 минут и каждый день.
				</para>
				<figure>
					<title>Таблица current intervals</title>
					<graphic fileref="img/eocd-stat-unit-curr.png" width="6in" />
				</figure>
				<para>
					Так же для каждой пары проводов и каждой стороны (NetSide и CustSide) ведутся таблицы, хранящие 15 минутные и дневные интервалы, в течении которых были ошибки. В таблицах хранится последние 96 15-ти минутных интервалов, и последние 30 — дневных.
				</para>
				<figure>
					<title>Таблица 15-ти минутных интервалов для CustSide</title>
					<graphic fileref="img/eocd-stat-unit-15min.png" width="6in" />
				</figure>
				<figure>
					<title>Таблица дневных интервалов для CustSide</title>
					<graphic fileref="img/eocd-stat-unit-1day.png" width="6in" />
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Monitoring</emphasis> — процент времени, в течении которого мониторился канал.
						</para>
					</listitem>
				</itemizedlist>
			</section>
			<section>
				<title>Мониторинг через консоль</title>
				<para>
					Для мониторинга SHDSL канала используется утилита <command>eoc-info</command>, для получения подробной информации об её использовании используется ключ <option>--help</option>.
				</para>
				<para>
					Для получения краткой информации о состоянии канала используется команда <command>eoc-info</command> <option>-s</option>. Она показывает состояние каждого канала: сколько регенераторов обнаружено, и установлено ли соединение со слейвом (маршрутизатор, работающий в режиме <emphasis>slave</emphasis>). В ее выводе <emphasis>offline</emphasis> показывает, что соединение со вторым маршрутизатором не установлено. В этом случае число регенераторов показывает, до какого регенератора было установлено соединение.
				</para>
				<para>
					Для получения более детальной информации надо указать имя интерфейса: <command>eoc-info</command> <option>-i</option> <replaceable>dsl0</replaceable>. В выводе команды будет полная информация о всех юнитах в тракте — мастера, слейва и всех регенераторов. Для получения информации о конкретном юните используется опция <option>-u</option> и название юнита: STU-C, STU-R, SRU1..SRU8.
				</para>
			</section>
			<section id="shdsl.rules">
				<title>Правила приоритетов параметров производительности SHDSL канала</title>
				<itemizedlist>
					<listitem>
						<para>
							На параметр <emphasis>UAS</emphasis> не налагается запретов.
						</para>
					</listitem>
					<listitem>
						<para>
							Параметры <emphasis>ES</emphasis> и <emphasis>SES</emphasis> запрещаются, если установлена индикация <emphasis>UAS</emphasis>.
						</para>
					</listitem>
					<listitem>
						<para>
							Параметр <emphasis>CV</emphasis> запрещается, если установлена индикация <emphasis>SES</emphasis>.
						</para>
					</listitem>
				</itemizedlist>
			</section>
		</section>
		<section id="cfg">
			<title id="cfg.title">Сохранение/восстановление конфигурации</title>
			<para>
				Веб-интерфейс позволяет сохранять текущую, восстанавливать сохраненную или заводскую конфигурацию маршрутизатора.
			</para>
			<para>
				Сохранение конфигурации выполняется на странице Configuration/Backup:
			</para>
			<figure id="backup">
				<title>Сохранение конфигурации</title>
				<graphic width="6in" fileref="img/config-backup.png" />
			</figure>
			<para>
				При нажатии на кнопку Backup будет предложено сохранить файл конфигурации, который в последствии можно будет загрузить.
			</para>
			<para>
				Восстановление конфигурации выполняется на странице Configuration/Restore:
			</para>
			<figure id="restore">
				<title>Восстановление конфигурации</title>
				<graphic width="6in" fileref="img/config-restore.png" />
			</figure>
			<para>
				На вкладке default можно восстановить заводскую конфигурацию нажатием на кнопку Restore default.
			</para>
			<para>
				После восстановления конфигурации, необходимо перезагрузить маршрутизатор.
			</para>
		</section>
	</chapter>
	<chapter id="iface">
		<title>Настройка сетевых интерфейсов</title>
		<section>
			<anchor id="iface.common" />
			<title>Общие параметры</title>
				<para>
					В этом разделе рассматриваются общие параметры конфигурации для всех типов сетевых интерфейсов.
				</para>
				<section>
					<title id="iface.status.status">Вкладка Status</title>
					<para>
						На вкладке <emphasis>Status</emphasis> отображается основная информация о выбранном интерфейсе, а так же предоставляется возможность останова, запуска, и перезапуска интерфейса. Информация о сетевых параметрах интерфейса:
					</para>
					<figure>
						<title>Сетевые параметры</title>
						<graphic width="6in" fileref="img/iface-stat.png" />
					</figure>
					<para>
						Состояние интерфейса (запущен или нет) можно определить по строке флагов. Если в ней содержится слово <emphasis>UP</emphasis>, то интерфейс запущен (к примеру, <emphasis>UP BROADCAST MULTICAST</emphasis>).
					</para>
					<para>
						Маршруты, привязанные к интерфейсу:
					</para>
					<figure>
						<title>Сетевые маршруты</title>
						<graphic width="6in" fileref="img/iface-stat-routes.png" />
					</figure>
					<para>
						Записи в таблице ARP:
					</para>
					<figure>
						<title>Таблица ARP</title>
						<graphic width="6in" fileref="img/iface-stat-arp.png" />
					</figure>
					<para>
						Информация о работе встроенного коммутатора:
					</para>
					<figure>
						<title>Встроенный коммутатор</title>
						<graphic width="6in" fileref="img/iface-stat-switch.png" />
					</figure>
					<para>
						Информация о шейпере трафика, работающего на интерфейсе:
					</para>
					<figure>
						<title>Шейпер трафика</title>
						<graphic width="6in" fileref="img/iface-stat-tc.png" />
					</figure>
					<para>
						Управление интерфейсом:
					</para>
					<figure>
						<title>Управлени интерфейсом</title>
						<graphic width="6in" fileref="img/iface-stat-buttons.png" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								Кнопка <emphasis>Start interface</emphasis> позволяет запустить ("поднять") интерфейс, если на вкладке General установлен флажок <emphasis>enabled</emphasis>.
							</para>
						</listitem>
						<listitem>
							<para>
								Кнопка <emphasis>Shutdown interface</emphasis> останавливает интерфейс ("опускает").
							</para>
						</listitem>
						<listitem>
							<para>
								Кнопка <emphasis>Restart interface</emphasis> останавливает/запускает интерфейс.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="general">
					<title>Вкладка General</title>
					<para>
						Опции на вкладке <emphasis>General</emphasis> позволяют сделать интерфейс активным, а также выбрать способ установки ip-адреса.
					</para>
					<figure>
						<title>Вкладка General</title>
						<graphic width="6in" fileref="img/iface-general.png" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Description</emphasis> — описание интерфейса, не используется системой.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Enabled</emphasis> — интерфейс активен. Это делает возможным запуск интерфейса другим интерфейсом (интерфейсом бондинга или моста), но интерфейс не будет запущен независимо. В частности, интерфейс можно запустить нажатием кнопки <emphasis>Start interface</emphasis> на вкладке <emphasis>Status</emphasis>.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Auto</emphasis> — независимый запуск интерфейса. Интерфейс будет запущен при загрузке маршрутизатора, либо при сохранении настроек на страницах конфигурации.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Method</emphasis> — метод установки IP-адреса.
							</para>
							<note>
								<para>
									Для интерфейса Е1, при выборе протоколов, отличных от ETHER-HDLC, изменение данного параметра невозможно. Метод установки IP-адреса всегда Point-to-Point, и производится на вкладке <emphasis>Method</emphasis>.
								</para>
							</note>
						</listitem>
						<listitem>
							<para>
								<emphasis>Depended on</emphasis> — интерфейс, от которого зависит данный интерфейс. При запуске данного интерфейса сперва будет запущен интерфейс, от которого он зависит.
							</para>
							<note>
								<para>
									Для интерфейса VLAN изменение данного параметра невозможно — для него здесь всегда указывается его физический интерфейс.
								</para>
							</note>
						</listitem>
					</itemizedlist>
					<para>
						Возможно несколько методов установки IP-адреса:
					</para>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>None</emphasis> — не конфигурируемый, IP-адрес не устанавливается.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Static address</emphasis> — статический, ручной ввод пользователем. Ввод адреса производится на вкладке <emphasis>Method</emphasis>.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Zero configuration</emphasis> — автоматический способ присвоения ip-адреса, позволяющий построить работающую сеть без ручного присвоения IP-адресов и без серверов DHCP. В этом случае интерфейсу будет назначен IP-адрес из диапазона 169.254.*.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Dynamic address</emphasis> — динамический IP-адрес  — адрес назначается сервером DHCP.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="method">
					<title>Вкладка Method</title>
					<para>
						На вкладке <emphasis>Method</emphasis> осуществляется установка сетевых параметров:
					</para>
					<figure>
						<title>Вкладка Method</title>
						<graphic fileref="img/iface-method.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Static address</emphasis> — IP-адрес.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Netmask</emphasis> — маска сети.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Broadcast</emphasis> — широковещательный адрес.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Gateway</emphasis> — маршрут по-умолчанию.
							</para>
						</listitem>
					</itemizedlist>
					<note>
						<para>
							Обязательными для заполнения являются только первые два поля, при не заполнении поля широковещательного адреса, он будет высчитан автоматически.
						</para>
					</note>
				</section>
				<section id="options">
					<title>Вкладка Options</title>
					<para>
						Переключатели на вкладке <emphasis>Options</emphasis> управляют поведением интерфейса:
					</para>
					<figure>
						<title>Вкладка Options</title>
						<graphic fileref="img/iface-options.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Accept redirects</emphasis> — в активном состоянии позволяет принимать ICMP перенаправления. Например, если есть лучший маршрут до какого-либо узла чем тот, по которому был послан пакет клиентом, маршрутизатор клиенту может отправить (как правило всегда так и происходит) icmp-перенаправление с указанием, через какой маршрутизатор лучше в следующий раз отправлять пакеты.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Forwarding</emphasis> — при активном состоянии включает режим маршрутизатора — пересылку пакеты с интерфейса на интерфейс (в соответствии с правилами межсетевого экрана).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Proxy ARP</emphasis> — включение режима Proxy ARP, что предоставляет третий способ соединения сетей (помимо моста и стандартной IP-маршрутизации).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>RP Filter</emphasis> — управляет возможностью проверки пути к отправителю (reversed path) в соответствии с RFC 1812. Активное состояние включает такую проверку и рекомендуется для хостов с одним сетевым интерфейсом и маршрутизаторов тупиковых сетей.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="spec">
					<title>Вкладка Specific</title>
					<para>
						Данная вкладка содержит параметры, которые специфичные для данного интерфейса. Для интерфейсов Ethernet и SHDSL (и других) здесь можно установить MAC-адрес.
					</para>
					<figure>
						<title>Вкладка Specific</title>
						<graphic fileref="img/iface-specific.png" width="6in" />
					</figure>
				</section>
			</section>
		<section id="dsl">
			<title>Конфигурация интерфейса SHDSL</title>
			<section>
				<title>Настройка параметров интерфейса</title>
				<para>
					Для соединения по SHDSL один маршрутизатор работает в режиме мастера (master), второй — в режиме слейва (slave). Конфигурация SHDSL соединения зависит от модели маршрутизатора и используемых модулей. Настройка интерфейса SHDSL выполняется на странице System/SHDSL/dsl*.
				</para>
				<section id="dsl.mr16h">
					<title>Маршрутизатор SG-16R</title>
					<note>
						<para>
							Драйвер для SHDSL маршрутизатора SG-16R называется MR16H, его имя отображается в заголовке конфигурационного окна.
						</para>
					</note>
					<para>
						Маршрутизаторы SG-16R поддерживают два способа конфигурирования интерфейса SHDSL (MR16H) — <emphasis>local</emphasis> и <emphasis>preact</emphasis>.
					</para>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>local -</emphasis> конфигурация параметров линии связи задаётся на обоих маршрутизаторах.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>preact -</emphasis> конфигурация параметров линии связи задаётся на мастере, а слейв получает настройки при установлении соединения. На данный момент при использовании этого режима максимальная скорость ограничена до 2304 Кбит/с.
							</para>
						</listitem>
					</itemizedlist>
					<important>
						<para>
							Метод конфигурирования должен совпадать на обоих маршрутизаторах.
						</para>
					</important>
					<figure>
						<title>Конфигурация SHDSL (MR16H)</title>
						<graphic fileref="img/shdsl-link-mr16h.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Rate</emphasis> — пропускная способность линии связи, Кбит/c.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Mode</emphasis> — режим: мастер (master), слейв (slave).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Coding</emphasis> — метод кодирования. Подробнее см. раздел <link linkend="hw.shdsl.details.tcpam" endterm="hw.shdsl.details.tcpam.title"/>.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Config</emphasis> — способ конфигурирования.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Annex</emphasis> — выбор дополнений.
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>Annex A</emphasis> — используется для совместимости с SG-16B предыдущих версий, а так же для работы на скоростях ниже 192 и выше 5696 кбит/с (с локальной настройкой). В режиме preact при использовании Annex A максимальная скорость ограничена до 2304 кбит/с.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Annex B</emphasis> — равноценен режиму Annex A.
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>Annex F</emphasis> — используется по-умолчанию. В режиме preact максимальная скорость 5696 кбит/с, в режиме local — 6016.
									</para>
								</listitem>
								<important>
									<para>
										На обоих маршрутизаторах должны быть выставлены одинаковые значения параметра!
									</para>
								</important>
							</itemizedlist>
						</listitem>
						<listitem>
							<para>
								<emphasis>CRC</emphasis> — значение контрольной суммы пакета.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Fill</emphasis> — выбор байта для заполнения канала, когда нет пакетов на передачу.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Inversion</emphasis> — логическое инвертирование всего потока.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="dsl.mr17h">
					<title>Маршрутизатор SG-17R</title>
					<note>
						<para>
							Драйвер для SHDSL маршрутизатора SG-17R (и модулей MR-17H*) называется MR17H, его имя отображается в заголовке конфигурационного окна.
						</para>
					</note>
					<important>
						<para>
							Прочтите раздел про <link linkend="modules.settings" endterm="modules.settings.title" />.
						</para>
					</important>
					<para>
						Настройка скорости соединения, режима синхронизации и режима кодирования выполняется только на мастере, слейв получает эти настройки во время инициализации соединения. Окно конфигурирования показано ниже:
					</para>
					<figure>
						<title>Конфигурация SHDSL (MR17H)</title>
						<graphic fileref="img/shdsl-link-mr17h.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Control type</emphasis> — режим управления интерфейсом:
							</para>
							<itemizedlist>
								<listitem>
									<para>
										<emphasis>Manual</emphasis> — задание настроек со страницы конфигурирования интерфейса (с текущей страницы).
									</para>
								</listitem>
								<listitem>
									<para>
										<emphasis>EOCd</emphasis> — интерфейс управляет демоном EOCd. Это позволяет вести мониторинг SNMP параметров интерфейса, а в будущем — управлять интерфейсом по SNMP. Для получения подробной информации смотри раздел <link linkend="dsl-eoc">Конфигурация через демон EOCd</link>.
									</para>
								</listitem>
							</itemizedlist>
						</listitem>
						<listitem>
							<para>
								<emphasis>Mode</emphasis> — режим: мастер (master), слейв (slave).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Clock mode</emphasis> — режим синхронизации, по-умолчанию используется режим <emphasis>plesio</emphasis> (плезиохронный). Перед выбором режима <emphasis>sync</emphasis> (синхронного) следует удостовериться, что всё оборудование, находящееся на линии связи (регенераторы, маршрутизаторы) поддерживают данный режим.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Rate</emphasis> — пропускная способность линии связи, Кбит/c. В выпадающем списке приведены не все доступные скорости — для ввода произвольной скорости следует выбрать значение <emphasis>other</emphasis>, что приведёт к появлению поля ввода. После сохранения, введённое значение будет округлено до ближайшего корректного значения скорости.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Coding</emphasis> — метод кодирования. Подробнее см. раздел <link linkend="hw.shdsl.details.tcpam" endterm="hw.shdsl.details.tcpam.title"/>.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>PBO Forced</emphasis> — снижение уровня выходного сигнала на указанное значение дБ. Используется для уменьшения влияния на оборудование, работающее по тому же кабелю. Данный параметр оказывает влияние на скорость/дальность соединения.
							</para>
							<para>
								Понижение уровня сигнала можно производить на всех сегментах линии связи — для этого значения снижения уровня сигнала указываются через двоеточие. Например, "3:0:12" снижает уровень сигнала на участке STU-C — SRU1 на 3 дБ, на участке SRU1 — SRU2 уровень сигнала не снижается, на участке SRU2 — STU-R — на 12 дБ. Если снижение задано не для всех участков, то на оставшихся понижения уровня сигнала не будет.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Annex</emphasis> — выбор дополнений. Какие-либо рекомендации по использованию отсутствуют, оба дополнения равноценны.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>CRC</emphasis> — значение контрольной суммы пакета.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Fill</emphasis> — выбор байта для заполнения канала, когда нет пакетов на передачу.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Inversion</emphasis> — логическое инвертирование всего потока.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Power</emphasis> — включить подачу питания для регенераторов, находящихся на линии.
							</para>
						</listitem>
					</itemizedlist>
				</section>
				<section id="dsl.status">
					<title>Установка и статус соединения</title>
					<para>
						После сохранения настроек через некоторый промежуток времени соединение будет установлено, о чем будут сигнализировать светодиоды на лицевой панели маршрутизатора. Так же информацию о состоянии соединения можно просмотреть на вкладке статуса:
					</para>
					<figure>
						<title>Информация о состоянии соединения SHDSL (MR16H)</title>
						<graphic fileref="img/shdsl-status-mr16h.png" width="6in" />
					</figure>
					<para>
						Вкладка статуса для MR17H отображает более подробную информацию. Если соединение не установлено, выводится следующая информация:
					</para>
					<figure>
						<title>Информация о неустановленном соединении SHDSL (MR17H)</title>
						<graphic fileref="img/shdsl-status-mr17h-offline.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Link state</emphasis> — состояние соединения: <emphasis>offline</emphasis> — соединение не установлено, <emphasis>online</emphasis> — соединение установлено.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Power balance</emphasis> — баланс питания относительно земли. В норме на одном проводе +120 В, на другом — 120 В. Если перекос больше 30 В или отсутствует земля — это означает несбалансированность питания, загорается светодиод unbalanced на модуле SHDSL. Значение <emphasis>balanced</emphasis> этого параметра соответствует нормальной работе, <emphasis>unbalanced</emphasis> — несбалансированности питания.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Power overload</emphasis> — перегрузка питания. Слишком большое число регенераторов на линии, настроенных на питание от данного маршрутизатора, вызывает перегрузку питания. На модуле SHDSL загорается светодиод overload. Значение <emphasis>no overload</emphasis> этого параметра соответствует нормальной работе, <emphasis>overload</emphasis> — перегрузке питания.
							</para>
						</listitem>
					</itemizedlist>
					<para>
						При установленном соединении добавляется следующая информация:
					</para>
					<figure>
						<title>Информация об установленном соединении SHDSL (MR17H)</title>
						<graphic fileref="img/shdsl-status-mr17h-online.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Actual rate</emphasis> — скорость установленного соединения, Кбит/с.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Actual line code</emphasis> — метод кодирования.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Actual clock mode</emphasis> — режим синхронизации.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>SNR margin</emphasis> — соотношение сигнал/шум в линии связи.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Loop attenuation</emphasis> — затухание сигнала в линии связи.
							</para>
						</listitem>
					</itemizedlist>
					<note>
						<para>
							Соединения SHDSL будет установлено, если интерфейс dsl* активен, т.е. для него настроены сетевые параметры (установлен флажок <emphasis>enabled</emphasis> и интерфейс активен, подробнее — см. следующий раздел).
						</para>
					</note>
				</section>
			</section>
			<section id="dsl-eoc">
				<title>Конфигурация через демон EOCd</title>
				<para>
					Для управления интерфейсом через EOCd необходимо выбрать соответствующий тип конфигурации в настройке параметров интерфейса (параметр <emphasis>Control type</emphasis>). Конфигурация интерфейса через демон EOCd заключается в создании профиля соединения и применения этого профиля к интерфейсу.
				</para>
				<section>
					<title>Создание и редактирование профиля</title>
					<para>
						Создание и редактирования профиля соединения производится на странице System->SHDSL-EOC->Profiles, вид которой представлен ниже.
					</para>
					<figure>
						<title>Создание и редактирование профилей соединения</title>
						<graphic fileref="img/eocd-profiles.png" width="6in" />
					</figure>
					<para>
						В профиле соединения доступны не все параметры соединения, поддерживаемые модулем. Это ограничение связано со спецификой стандарта SNMP для интерфейса SHDSL. Доступные параметры — Rate, Annex, Power, Encoding — полностью соответствуют параметрам на странице конфигурации интерфейса (см. <link linkend="dsl.mr17h">конфигурация SHDSL</link>).
					</para>
				</section>
				<section id="dsl-eoc.settings">
					<title>Применение профиля к интерфейсу</title>
					<para>
						Применение профиля соединения к интерфейсу осуществляется на странице System->SHDSL-EOC->имя_интерфейса.
					</para>
					<figure>
						<title>Применение профиля соединения</title>
						<graphic fileref="img/eocd-apply-profile.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Mode</emphasis> — режим работы интерфейса — мастер/слейв.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Regenerators</emphasis> — справочный параметр, отражающий число регенераторов, которое должно быть на линии. Позволяет сравнить фактическое число регенераторов с тем, которое было установлено.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>ConfProfile</emphasis> — профиль соединения, который используется демоном EOCd для управления интерфейсом.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>PBO Forced</emphasis> — снижение уровня выходного сигнала на указанное значение дБ. Используется для уменьшения влияния на оборудование, работающее по тому же кабелю. Данный параметр оказывает влияние на скорость/дальность соединения.
							</para>
							<para>
								Понижение уровня сигнала можно производить на всех сегментах линии связи — для этого значения снижения уровня сигнала указываются через двоеточие. Например, "3:0:12" снижает уровень сигнала на участке STU-C — SRU1 на 3 дБ, на участке SRU1 — SRU2 уровень сигнала не снижается, на участке SRU2 — STU-R — на 12 дБ. Если снижение задано не для всех участков, то на оставшихся понижения уровня сигнала не будет.
							</para>
						</listitem>
					</itemizedlist>
				</section>
			</section>
			<section>
				<title>
					Настройка сетевых параметров
				</title>
				<para>
					Настройка сетевых параметров аналогична настройке Ethernet соединения и выполняется на странице Network/Interfaces/dsl*.
				</para>
			</section>
		</section>
		<section id="e1">
			<title>Конфигурация интерфейса E1</title>
			<para>
				Маршрутизатор поддерживает несколько протоколов для работы с интерфейсом E1 (для совместимости с разными видами оборудования DTE и различными прикладными протоколами): HDLC, ETHER-HDLC, CISCO-HDLC, FR, PPP, X25. Конфигурация интерфейса выполняется на странице System/E1/E1_*.
			</para>
			<important>
				<para>
					Прочтите раздел про <link linkend="modules.settings" endterm="modules.settings.title"/>.
				</para>
			</important>
			<section>
				<title>Настройка параметров интерфейса</title>
				<section>
					<title>Настройка протокола CISCO-HDLC</title>
					<para>
						Настройка некоторых параметров устанавливается в &quot;два этапа&quot;: т.е. сперва выбирается значение параметра, затем внесенные изменения сохраняются, и после перезагрузки страницы добавляются опции, относящиеся к выбранному параметру.
					</para>
					<para>
						Для настройки протокола CISCO-HDLC необходимо в выпадающем списке HDLC protocol выбрать значение CISCO-HDLC:
					</para>
					<figure>
						<title>Выбор протокола</title>
						<graphic fileref="img/cisco-hdlc_select-prot.png" width="6in" />
					</figure>
					<para>
						Для активации страницы с настройками, относящимся к выбранному протоколу, необходимо сохранить внесенные изменения. После перезагрузки страница примет следующий вид:
					</para>
					<figure>
						<title>Конфигурация CISCO-HDLC</title>
						<graphic fileref="img/cisco-hdlc-framed.png" width="6in" />
					</figure>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>Interval</emphasis> — время в секундах между пакетами поддержания соединения (keepalive packets).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Timeout</emphasis> — время в секундах после последнего полученного пакета поддержания соединения, по истечению которого соединение считается разорванным.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Е1 framed mode</emphasis> — структурированный режим, при котором канал разбивается на таймслоты. В этом режиме для соединения задается карта таймслотов, которая должна совпадать с картой на другом конце соединения.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Use time slot 16</emphasis> — по умолчанию в интерфейсе Е1 зарезервированы 0 и 16 слоты, которые могу быть использованы для служебной информации. Активация этого параметра позволяет использовать таймслот 16 для передачи данных.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Slotmap</emphasis> — карта таймслотов. После сохранения из карты будут удалены служебные таймслоты.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>E1 CRC4 multiframe</emphasis> — включение режима CRC4.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>E1 CAS multiframe</emphasis> — включение режима CAS, используемого, как правило, при работе с АТС оборудованием. В этом режиме таймслот 16 зарезервирован для служебного использования.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>E1 external transmit clock</emphasis> — использовать внешний источник тактирования. По-умолчанию используется внутренний.
							</para>
							<note>
								<para>
									Если для данного интерфейса включено мультиплексирование (MXEN=1), то используются параметры из таблицы мультиплексирования (CLKM, CLKR). Если мультиплексирование выключено, то используется данный параметр.
								</para>
							</note>
						</listitem>
						<listitem>
							<para>
								<emphasis>E1 long haul mode</emphasis> — при включенном режиме long haul расстояние от маршрутизатора до подключённого к нему оборудования DTE может достигать 1600 метров по кабелю сечением 0,4 мм, и 2400 по кабелю сечением 0,5 мм. При отключении, эта дистанция ограничена 400 метрами.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>E1 HDB3/AMI line code</emphasis> — способ кодирования сигнала на линии связи.
							</para>
							<important>
								<para>
									Рекомендация ITU-T G.703 требует использования линейного кода HDB3!
								</para>
							</important>
						</listitem>
						<listitem>
							<para>
								<emphasis>CRC</emphasis> — значение контрольной суммы пакета.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Fill</emphasis> — выбор байта для заполнения канала, когда нет пакетов на передачу.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>Inversion</emphasis> — логическое инвертирование всего потока.
							</para>
						</listitem>
					</itemizedlist>
					<para>
						Пропускная способность одного таймслота составляет 64 Кбит/c, т.о. максимальная пропускная способность интерфейса Е1 в unframed mode составляет 2 Мбит/с.
					</para>
					<section>
						<title>Конфигурация framed mode</title>
						<para>
							Для работы интерфейса в framed mode необходимо активировать параметр <emphasis>E1 framed mode</emphasis> и ввести карту таймслотов, например &quot;2-9,17-27&quot; (именно в таком формате, без пробела между диапазонами). На другом конце соединения должна быть установлена такая же карта слотов. Строго говоря, все параметры, за исключением <emphasis>E1 external transmit clock</emphasis>, должны быть согласованы с двух сторон.
						</para>
						<para>
							При такой конфигурации карты таймслотов, максимальная пропускная способность канала составит 17 * 64 Кбит/с = 1088 Кбит/с, что подтверждается тестами.
						</para>
					</section>
					<section>
						<title>Конфигурация unframed mode</title>
						<para>
							Для настройки интерфейса на режим работы unframed mode, параметр <emphasis>E1 framed mode</emphasis> должен быть неактивным. После внесения изменений (деактивация параметра) и сохранения, будут доступны следующие параметры настройки:
						</para>
						<figure>
							<title>Unframed mode</title>
							<graphic fileref="img/cisco-hdlc-unframed.png" width="6in" />
						</figure>
						<para>
							В этом режиме параметров конфигурации меньше, чем во framed mode, и все они сводятся к настройке линии связи.
						</para>
					</section>
				</section>
			</section>
			<section>
				<title>Настройка сетевых параметров</title>
				<para>
					Настройка сетевых параметров интерфейса зависит от выбранного протокола. При выборе <emphasis>ETHER-HDLC</emphasis> выполняется обычная настройка интерфейса: доступен любой метод задания IP-адреса, как при настройке интерфейсов Ethernet или SHDSL.
				</para>
				<para>
					При выборе любого другого протокола тип соединения становится <emphasis>Point-to-Point</emphasis>, т.е. маршрутизатор связывается непосредственно с другом устройством. Соответственно, меняется и способ установки IP-адреса. Рассмотрим конфигурацию P-t-P соединения подробнее.
				</para>
				<para>
					Перейдём на страницу Network/Interfaces/E1_*, вкладку Specific. Введём IP-адреса Point-to-Point соединения: локальный и удалённый адреса.
				</para>
				<figure>
					<title>Назначение Point-to-Point адресов</title>
					<graphic fileref="img/no_ether-hdlc-specific.png" width="6in" />
				</figure>
				<para>
					Следующим шагом настройки является активация интерфейса на вкладке General.
				</para>
				<figure>
					<title>Активация интерфейса E1</title>
					<graphic fileref="img/hdlc-general.png" width="6in" />
				</figure>
			</section>
		</section>
		<section id="ifaces">
			<title>Динамические интерфейсы</title>
			<section>
				<title>Работа с динамическими интерфейсами</title>
				<para>
					На странице Network/Interfaces возможно добавить или удалить динамические интерфейсы, которые не являются физическими интерфейсами, а предназначены для работы поверх них. На данный момент существуют следующие динамические интерфейсы:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Bridge</emphasis> — динамический интерфейс для создания моста.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>PPPoE</emphasis> — PPP over Ethernet.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>PPtP</emphasis> — Point-to-Point Tunneling Protocol.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Bonding</emphasis> — объединение интерфейсов.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Для создания нового динамического интерфейса необходимо выбрать его тип и нажать кнопку <emphasis>Add</emphasis>.
				</para>
				<figure>
					<title>Создание динамического интерфейса</title>
					<graphic width="6in" fileref="img/ifaces-add.png" />
				</figure>
				<para>
					Добавленный динамический интерфейс отобразится в списке сетевых интерфейсов:
				</para>
				<figure>
					<title>Динамический интерфейс в списке сетевых интерфейсов</title>
					<graphic fileref="img/ifaces-list.png" />
				</figure>
				<para id="ifaces.del">
					Чтобы удалить динамический интерфейс выберите его имя в списке интерфейсов и нажмите кнопку <emphasis>Delete</emphasis>.
				</para>
				<figure>
					<title>Удаление динамического интерфейса</title>
					<graphic width="6in" fileref="img/ifaces-del.png" />
				</figure>
			</section>
			<section id="bonding">
				<title>Настройка режима Bonding</title>
				<para>
					Режим Bonding позволяет объединять несколько физических соединений в одно логическое (с помощью создания динамического интерфейса <emphasis>bond</emphasis>). К примеру, два SHDSL канала можно объединить в один, увеличив пропускную способность соединения.
				</para>
				<important>
					<para>
						В режиме Bonding поддерживается объединение только ethernet интерфейсов. В системе все интерфейсы являются ethernet, за исключением <emphasis>E1</emphasis>, который только при использовании протокола <emphasis>ETHER-HDLC</emphasis> является ethernet интерфейсом. При использовании других протоколов (HDLC, CISCO-HDLC, ...) E1 является <emphasis>hdlc</emphasis> интерфейсом.
					</para>
				</important>
				<important>
					<para>
						Пропускная способность интерфейсов, добавляемых в бондинг, должна быть одинаковой, иначе пропускная способность бондинга будет ниже арифметической суммы скоростей интерфейсов, в него входящих. Это связано с особенностями используемого алгоритма, который в будущем будет измененён.
					</para>
					<para>
						Под пропускной способностью интерфейсов имеется ввиду не скорость соединения, а именно пропускная способность, доступная для IP-трафика. Это означает, что если имеется два соединения (dsl0 и dsl1) со скоростью 5690 Kbit, и интерфейс dsl0 используется для мультиплексирования 16-ти тайм-слотов Е1 — то для IP-трафика по интерфейсу dsl0 доступно 5690 - 1024, т.е. 4666 Kbps. Таким образом, скорости интерфейсов не равны. Чтобы их выровнять, можно разделить канал Е1 (если это возможно) и мультиплексировать его в два интерфейса — dsl0 и dsl1.
					</para>
					<para>
						Бондинг может работать с интерфейсами, имеющими разную скорость, просто это получается менее эффективно, чем при объединении интерфейсов с одинаковой скоростью. Приблизительные расчёты показывают, что пропускная способность бондинга при использовании разных по скорости интерфейсов (в случае <emphasis>двух</emphasis> интерфейсов) равна: (скорость быстрого интерфейса * 2) - (разница в скорости интерфейсов * 2).
					</para>
					<para>
						Т.е., если у нас есть интерфейс dsl0 со скоростью 5690 и интерфейс dsl1 со скоростью 3584, итоговая скорость бондинга составляет: (5690 * 2) - ( (5690 - 3584) * 2) = 11380 - (2106 * 2) = 11380 - 4212 = 7168.
					</para>
					<para>
						На самом деле, экспериментальные данные показывают, что бондинг с использованием двух интерфейсов со скоростью 5690 имеет пропускную способность 10270 (10,27 Mbps), т.е. почти на мегабит меньше расчётной. Использование же бондинга на интерфейсах со скоростью 5690 и 3584 даёт пропускную способность 6180 (6,18 Mbps), т.е. так же меньше на 1 мегабит расчётной скорости.
					</para>
				</important>
				<para>
					Для настройки режима Bonding в первую очередь необходимо настроить физические интерфейсы (к примеру, SHDSL или Ethernet). Интерфейсы, которые будут входить в Bonding, должны быть активны и запущены (см. <link linkend="iface.common">настройку сетевых интерфейсов</link>). Для интерфейса должен быть установлен флажок <emphasis>enabled</emphasis>, т.е. его конфигурация должна иметь следующий вид:
				</para>
				<figure>
					<title>Настройка физического интерфейса</title>
					<graphic fileref="img/bond-real-iface.png" width="6in" />
				</figure>
				<para>
					Динамический интерфейс создаётся на странице Network/Interfaces, на которой в разделе Add dynamic interface необходимо выбрать в качестве протокола Bonding:
				</para>
				<figure>
					<title>Создание динамического интерфейса</title>
					<graphic fileref="img/bond-add.png" width="6in" />
				</figure>
				<para>
					После нажатия кнопки <emphasis>Add</emphasis> созданный интерфейс отобразится в списке сетевых интерфейсов.
				</para>
				<note>
					<para>
						Если вы хотите сконфигурировать несколько bonding-интерфейсов, следует добавить сразу необходимое количество динамических интерфейсов, перед их запуском. Это связано с тем, что после запуска первого bonding-интерфейса, запуск новых bonding-интерфейсов будет возможен только после перезагрузки.
					</para>
				</note>
				<para>
					Для настройки интерфейса необходимо перейти на страницу Network/Interfaces/bond*, вкладку Specific, где указать, какие физические интерфейсы будут использоваться этим динамическим интерфейсом для передачи данных. К примеру, при настройке SHDSL Bonding, можно ввести dsl0 и dsl1:
				</para>
				<figure>
					<title>Привязка к физическим интерфейсам</title>
					<graphic fileref="img/bond-specific.png" width="6in" />
				</figure>
				<para>
					После сохранения настроек переходим на вкладку General. Здесь необходимо выставить флажки <emphasis>enabled</emphasis> и <emphasis>auto</emphasis>, чтобы интерфейс автоматически запускался при загрузке маршрутизатора. Если для динамического интерфейса необходимо назначить IP-адрес, то в параметре <emphasis>Method</emphasis> надо выбрать необходимый метод установки IP-адреса и произвести его настройку (в случае статического IP-адреса — прописать адрес на вкладке <emphasis>Method</emphasis>).
				</para>
				<figure>
					<title>Конфигурация динамического интерфейса</title>
					<graphic fileref="img/bond-general.png" width="6in" />
				</figure>
				<para>
					После сохранения настроек на вкладке General, динамический интерфейс будет автоматически запущен. При этом IP-адреса реальных интерфейсов, если они были установлены, будут сброшены. Для всех интерфейсов (динамического и входящих в него физических) будет установлен один MAC-адрес, который будет соответствовать MAC-адресу одного из физических интерфейсов.
				</para>
				<note>
					<para>
						Аналогичные настройки необходимо произвести на втором маршрутизаторе.
					</para>
				</note>
				<note>
					<para>При разрыве одного из физических соединений, трафик будет передаваться по оставшемуся соединению.</para>
				</note>
			</section>
			<section id="bridge">
				<title>Настройка моста</title>
				<para>
					Работа маршрутизатора в режиме моста (bridging) позволяет прозрачно передавать трафик между интерфейсами, имитируя работу коммутатора. Для этого создаётся специальный сетевой динамический интерфейс с именем <emphasis>br</emphasis>, с которым ассоциируются сетевые интерфейсы, между которыми будет передаваться трафик.
				</para>
				<important>
					<para>
						Мост поддерживает передачу трафика только между ethernet-интерфейсами. В системе все интерфейсы являются ethernet, за исключением <emphasis>E1</emphasis>, который только при использовании протокола <emphasis>ETHER-HDLC</emphasis> является ethernet интерфейсом. При использовании других протоколов (HDLC, CISCO-HDLC, ...) E1 является <emphasis>hdlc</emphasis> интерфейсом.
					</para>
				</important>
				<figure>
					<title>Пример моста</title>
					<graphic width="6in" fileref="img/bridge.png" />
				</figure>
				<para>
					В приведенном выше рисунке мост состоит из двух интерфейсов — Ethernet-интерфейса eth0 и SHDSL-интерфейса dsl0 — и объединяет в одну сеть компьютеры PC1 и PC2.
				</para>
				<note>
					<para>
						Следует заметить, что маршрутизатор, работающий в режиме моста и сети, между которыми он передаёт трафик, не обязательно должны находиться в одном адресном пространстве, как это требуется при настройке маршрутизации трафика.
					</para>
					<para>
						Более того, у такого маршрутизатора вообще может не быть IP-адреса. Однако, если необходимо управление маршрутизатором, то ему необходимо назначить IP-адрес, входящий в ту же сеть, что и компьютер, с которого будет производиться управление. В нашем примере, маршрутизаторам можно назначить IP-адреса 192.168.90.10 и 192.168.90.11.
					</para>
				</note>
				<para>
					На следующем рисунке изображена сеть, аналогичная предыдущей, но с использованием технологии объединения каналов (bonding), позволяющей увеличить производительность сети. В этом случае мост состоит из Ethernet-интерфейса eth0 и объединенных SHDSL-интерфейсов dsl0 и dsl1 в один интерфейс bond0:
				</para>
				<figure>
					<title>Пример моста с объединением интерфейсов</title>
					<graphic width="6in" fileref="img/bridge+bonding.png" />
				</figure>
				<para>
					Так же, как и для настройки режима Bonding, в первую очередь необходимо настроить физические интерфейсы, которые будут входить в мост: они должны быть активны (см. <link linkend="iface.common">настройку сетевых интерфейсов</link>). Для интерфейсов должен быть установлен флажок <emphasis>enabled</emphasis>, т.е. их конфигурация должна иметь следующий вид:
				</para>
				<figure>
					<title>Настройка физического интерфейса</title>
					<graphic fileref="img/bond-real-iface.png" width="6in" />
				</figure>
				<para>
					Создание динамического интерфейса происходит на странице Network/Interfaces, на которой в меню Add dynamic interface надо выбрать в качестве протокола Bridge:
				</para>
				<figure>
					<title>Создание интерфейса</title>
					<graphic width="6in" fileref="img/bridge-add.png" />
				</figure>
				<para>
					После добавления динамического интерфейса он появится в списке сетевых интерфейсов. Для его настройки перейдём на страницу Network/Interfaces/br* и выберем вкладку Specific, на которой определим список интерфейсов, входящих в мост. Для этого в поле Interfaces укажем имена сетевых интерфейсов:
				</para>
				<figure>
					<title>Привязка к физическим интерфейсам</title>
					<graphic width="6in" fileref="img/bridge-specific.png" />
				</figure>
				<note>
					<para>
						Количество интерфейсов в мосту может быть больше двух.
					</para>
				</note>
				<important>
					<para>
						Физический интерфейс может быть добавлен только в <emphasis>один</emphasis> интерфейс моста! К примеру, нельзя создать интерфейсы br0 (eth0, dsl0) и br1 (eth1, dsl0), т.к. dsl0 может быть добавлен только в один интерфейс моста. Для преодоления этого ограничения воспользуйтесь технологией VLAN (см. соответствующий раздел и примеры использования).
					</para>
				</important>
				<para>
					После сохранения настроек перейдём на вкладку General, на которой установим флажки <emphasis>enabled</emphasis> и <emphasis>auto</emphasis> для автоматического запуска интерфейса во время загрузки маршрутизатора:
				</para>
				<figure>
					<title>Конфигурация динамического интерфейса</title>
					<graphic fileref="img/bridge-general.png" width="6in" />
				</figure>
				<important>
					<para>
						Начиная с версии прошивки 879 больше нет необходимости указывать зависимый интерфейс в поле Depended on — интерфейс моста автоматически запускает интерфейсы, из которых он состоит.
					</para>
				</important>
				<note>
					<para>
						Если для динамического интерфейса необходимо назначить IP-адрес, то в параметре <emphasis>Method</emphasis> надо выбрать необходимый метод установки IP-адреса и произвести его настройку (в случае статического IP-адреса — прописать адрес на вкладке <emphasis>Method</emphasis>).
					</para>
				</note>
				<important>
					<para>
						Запуск интерфейса <emphasis>br*</emphasis> приводит к сбросу IP-адресов с физических интерфейсов, которые в него входят. Таким образом, если настройка осуществляется через физический интерфейс, который входит в мост, управление над маршрутизатором может быть потеряно. Чтобы этого избежать, необходимо назначить динамическому интерфейсу <emphasis>br*</emphasis> IP-адрес.
					</para>
				</important>
				<para>
					Эту же процедуру повторяем на втором маршрутизаторе, и через пару минут, в течении которых &quot;мост&quot; распознает топологию сети и проведёт небольшой этап самообучения, начнется передача пакетов между интерфейсами.
				</para>
			</section>
			<section id="pptp">
				<title>Настройка соединения PPtP</title>
				<para>
					<emphasis>PPtP</emphasis> — Point-to-point tunneling protocol — туннельный протокол типа точка-точка, позволяющий создать виртуальную частную сеть (VPN) поверх физической сети.
				</para>
				<para>
					Для создания соединения необходимо добавить динамический интерфейс PPtP. Это выполняется на странице Network/Interfaces:
				</para>
				<figure>
					<title>Добавления интерфейса PPtP</title>
					<graphic fileref="img/pptp-add.png" width="6in" />
				</figure>
				<para>
					После добавления, следует снова перейти на страницу Network/Interfaces, чтобы обновить список доступных интерфейсов. Настройка интерфейса выполняется на странице Network/Interfaces/pptp*. Рассмотрим специфичные для данного интерфейса параметры:
				</para>
				<figure>
					<title>Вкладка Specific</title>
					<graphic fileref="img/pptp-specific.png" width="6in" />
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Server</emphasis> — имя или IP-адрес сервера PPtP, к которому будет выполняться подключение.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Username</emphasis> — имя пользователя.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Password</emphasis> — пароль.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Default route</emphasis> — является ли это соединение маршрутом по-умолчанию.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>PPPD Options</emphasis> — параметры, которые будет переданы демону PPPD при подключении.
						</para>
					</listitem>
				</itemizedlist>
				<important>
					<para>
						После создания и первого редактирования настроек соединение будет инициализировано, независимо от параметров на вкладке General.
					</para>
				</important>
				<para>
					Активировать соединение и включить его автоматическую инициализацию после загрузки маршрутизатора можно на вкладке General:
				</para>
				<figure>
					<title>Вкладка General</title>
					<graphic fileref="img/pptp-general.png" width="6in" />
				</figure>
				<note>
					<para>
						При данном виде сетевого подключения параметр Method игнорируется и может принимать любые значения.
					</para>
				</note>
				<note>
					<para>
						На данный момент подключение по PPtP с использованием шифрования MPPE невозможно.
					</para>
				</note>
			</section>
			<section id="pppoe">
				<title>Настройка соединения PPPoE</title>
				<para>
					<emphasis>PPPoE</emphasis> — Point-to-point protocol over Ethernet — сетевой протокол передачи кадров PPP через Ethernet. Так же, как <emphasis>PPtP</emphasis> это туннелирующий протокол, но работающий непосредственно поверх Ethernet, создающий соединение типа точка-точка. Использование PPP предоставляет возможности аутентификации, сжатия трафика и его шифрования.
				</para>
				<para>
					Для создания соединения необходимо добавить динамический интерфейс PPPoE на странице Network/Interfaces:
				</para>
				<figure>
					<title>Добавление интерфейса PPPoE</title>
					<graphic fileref="img/pppoe-add.png" width="6in" />
				</figure>
				<para>
					После добавления, следует снова перейти на страницу Network/Interfaces, чтобы обновить список доступных интерфейсов. Настройка интерфейса выполняется на странице Network/Interfaces/pppoe*. Рассмотрим специфичные для данного интерфейса параметры:
				</para>
				<figure>
					<title>Вкладка Specific</title>
					<graphic fileref="img/pppoe-specific.png" width="6in" />
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Interface</emphasis> — физический интерфейс, в сети которого находится PPPoE сервер (eth0, eth1, ...).
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Service</emphasis> — маршрутизатор будет устанавливать соединение с теми серверами PPPoE, которые предоставляют данный сервис. В большинстве случаев этот параметр не используется.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Access Concentrator</emphasis> — маршрутизатор будет устанавливать соединение только с указанным концентратором. Используется в случае наличия нескольких серверов PPPoE.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Default route</emphasis> — является ли это соединение маршрутом по-умолчанию.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Username</emphasis> — имя пользователя.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Password</emphasis> — пароль.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>PPPD Options</emphasis> — параметры, которые будет переданы демону PPPD при подключении.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Активировать соединение и включить его автоматическую инициализацию после загрузки маршрутизатора можно на вкладке General:
				</para>
				<figure>
					<title>Вкладка General</title>
					<graphic fileref="img/pppoe-general.png" width="6in" />
				</figure>
			</section>
			<section id="vlan">
				<title>Настройка интерфейсов VLAN</title>
				<para>
					Использование технологии VLAN позволяет разделить трафик пользователей в единой физической среде передачи данных. Для это в каждый Ethernet-кадр добавляет заголовок, относящий данный кадр к тому или иному VLAN. Каждый VLAN идентифицируется своим номером — <emphasis>VLAN ID</emphasis>, в диапазоне от 0 до 4094. Для работы с сетями VLAN на основе физического интерфейса создаётся интерфейс VLAN, с определённым VLAN ID.
				</para>
				<para>
					Для создания интерфейса VLAN необходимо создать динамический интерфейс VLAN на странице Network/Interfaces. Для этого в форме "Add VLAN interface" выбираем интерфейс, поверх которого будет работать интерфейс VLAN, и вводим номер VLAN — VLAN ID.
				</para>
				<figure>
					<title>Добавление интерфейса VLAN</title>
					<graphic fileref="img/vlan-add.png" width="6in" />
				</figure>
				<tip>
					<para>
						Интерфейс VLAN может работать как поверх физических интерфейсов (SHDSL, Ethernet), так и поверх динамических (Bonding, Bridge).
					</para>
				</tip>
				<para>
					После добавления, интерфейс VLAN будет показан в списке интерфейсов в виде "ИНТЕРФЕЙСvНОМЕР_ВЛАН", т.е. если интерфейс VLAN создаётся для интерфейса bond0 и VLAN ID 4, то имя интерфейса VLAN будет <emphasis>bond0v4</emphasis>. В системе интерфейс отображается как <emphasis>bond0.4</emphasis>.
				</para>
				<para>
					Теперь над интерфейсом можно выполнять стандартные действия: назначать IP-адрес, добавлять его в бондинг или бридж.
				</para>
			</section>
		</section>
		<section id="modules.settings">
			<title id="modules.settings.title">Принцип хранения настроек для модулей</title>
			<para>
				До версии прошивки <emphasis>890</emphasis> настройки интерфейсов привязывались к имени интерфейса, что вызывало проблемы при работе с модулями, т.к. при добавлении нового модуля имена интерфейсов могли изменяться, и настройки применялись не к тому модулю.
			</para>
			<para>
				С версии <emphasis>890</emphasis> аппаратные настройки привязываются к PCI-слоту, а сетевые, в случае изменения имени интерфейса, копируются. Т.е., если при добавлении нового модуля, имя интерфейса старого модуля изменилось с <emphasis>dsl0</emphasis> на <emphasis>dsl1</emphasis>, то сетевые настройки будут скопированы с dsl0 на dsl1.
			</para>
			<para>
				Основное отличие хранения между аппаратными и сетевыми настройками в том, что если модуль временно извлечь и включить маршрутизатор, сетевые настройки <emphasis>удалятся</emphasis>, а аппаратные <emphasis>останутся</emphasis>. Таким образом, при последующем возвращении модуля и включении маршрутизатора, модуль будет сконфигурирован по-старому, но без сетевых настроек.
			</para>
			<para>
				Так же поддерживается применение настроек для совместимых модулей: к примеру, если использовался одноканальный модуль, и он заменён на двухканальный, то настройки будут применены к первому каналу нового модуля.
			</para>
			<para>
				Если же использовался двухканальный модуль, и вместо него включается одноканальный, то настройки (сетевые и аппаратные) будут применены к новому модулю, аппаратные настройки второго канала сохранятся, а сетевые — <emphasis>удалятся</emphasis>. Таким образом, при возвращении двухканального модуля он получит свои аппаратные настройки (и сетевые для первого канала).
			</para>
			<para>
				Различие между аппаратными и сетевыми настройками сделано из-за технических ограничений.
			</para>
		</section>
	</chapter>
	<chapter id="dhcp_server">
    	<title>Настройка сетевых служб</title>
    	<section>
			<title>DHCP-сервер</title>
			<para>
				Настройка DHCP-сервера выполняется независимо для каждого сетевого интерфейса и производится на странице Network/сетевой интерфейс, вкладка DHCP, либо Services/DHCP Server.
			</para>
			<important>
				<para>
					Перед активацией DHCP-сервера необходимо запустить интерфейс (активировать флажки <emphasis>Enabled</emphasis> и <emphasis>Auto</emphasis>), на котором он будет работать, а так же назначить интерфейсу IP-адрес.
				</para>
			</important>
			<para>
				Ниже представлена страница настройки DHCP-сервера.
			</para>
			<figure>
				<title>Настройка DHCP-сервера</title>
				<graphic fileref="img/dhcp.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Enable DHCP Server</emphasis> — активировать DHCP-сервер для данного интерфейса.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Start IP</emphasis>, <emphasis>End IP</emphasis> — начало и конец диапазона IP-адресов для выдачи клиентам DHCP.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Netmask</emphasis> — сетевая маска сети, для которой выдаются IP-адреса.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Default router</emphasis> — маршрут по-умолчанию.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Default lease time</emphasis> — время, на которое выдаётся IP-адрес. По истечении этого времени клиент должен снова обратиться к DHCP-серверу для подтверждения использования выданного ранее адреса или получения нового.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>DNS server</emphasis> — IP-адрес DNS-сервера, к которому будет обращаться клиент для разрешения доменных имен.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Domain</emphasis> — домен, в который будет входить клиент DHCP-сервера.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>NTP server</emphasis> — IP-адрес сервера точного времени.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>WINS server</emphasis> — IP-адрес WINS-сервера.
					</para>
				</listitem>
			</itemizedlist>
			<note>
				<para>
					После сохранения настроек, DHCP-сервер будет запущен либо перезапущен автоматически.
				</para>
			</note>
			<para>
				Существует возможность присваивать определённым машинам статические IP-адреса. Идентификация машин производится по значению MAC-адреса сетевой карты. Форма для привязки IP-адреса к MAC-адресу находится внизу страницы конфигурации и представлена на рисунке:
			</para>
			<figure id="dhcp_server.static_add">
				<title>Форма привязки IP к MAC</title>
				<graphic fileref="img/dhcp-static-add.png" width="6in"/>
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Host name</emphasis> — задаёт имя машины, для которой выполняется привязка адреса. Это значение носит справочный характер и используется только в правиле, может не соответствовать фактическому имени машины.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>IP Address</emphasis> — IP-адрес, который будет присвоен данной машине.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>MAC Address</emphasis> — MAC-адрес сетевой карты машины, по которому будет производиться привязка IP-адреса.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				После сохранения изменений в таблице статических адресов появится новая запись.
			</para>
			<figure>
				<title>Обновленный список IP-адресов</title>
				<graphic fileref="img/dhcp-static-list.png" width="6in"/>
			</figure>
    	</section>
		<section id="pptp_server">
			<title>PPTP-сервер</title>
			<para>
				PPTP-сервер позволяет организовать VPN — виртуальную частную сеть — поверх обычной сети. Для этого пользователи подключаются к VPN-серверу, и в случае успешной авторизации получает доступ к ресурсам частной сети. Функции VPN-сервера в маршрутизаторе выполняет PPTP-сервер — point-to-point tunneling protocol.
			</para>
			<para>
				Страница конфигурации находится в Services/PPTP server и приведена ниже:
				<figure>
					<title>Конфигурация PPTP-сервера</title>
					<graphic fileref="img/pptpd.png" width="6in" />
				</figure>
			</para>
			<para>
				Активация VPN-сервера выполняется установкой флажка напротив параметра <emphasis>Enable PPTP server</emphasis>. Настройка сервера состоит из двух стадий — конфигурации самого сервера и добавления пользователей, которые могут к нему подключаться. Рассмотрим параметры конфигурации сервера:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Name</emphasis> — имя VPN-сервера. Используется при аутентификации. У пользователя в *-secret файле значение имени сервера должно совпадать с этим, либо там должна стоять "звездочка".
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Local IP range</emphasis> — диапазон IP-адресов, которые будут присвоены соединению на стороне сервера.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Remote IP range</emphasis> — диапазон IP-адресов, которые будут присвоены соединению на стороне клиента.
					</para>
				</listitem>
				<listitem>
					<para>
						Механизмы аутентификации. Имеют три значения — <emphasis>none</emphasis> — не определено,  <emphasis>require</emphasis> — обязателен, <emphasis>refuse</emphasis> — запрещён к использованию.
					</para>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>PAP Mode</emphasis> — метод PAP.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>CHAP Mode</emphasis> — метод CHAP.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>MS CHAP Mode</emphasis> — метод MS CHAP.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>MS CHAPv2 Mode</emphasis> — метод MS CHAPv2.
							</para>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>
						<emphasis>MPPE Mode</emphasis> — использовать шифрование трафика по алгоритму MPPE (Microsoft Point-to-Point Encryption).
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>DNS server</emphasis> — адреса первичного и вторичного сервера DNS, которые будут переданы клиенту.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>WINS server</emphasis> — адрес WINS сервера.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>PPPD options</emphasis> — опции, которые будут переданы серверу pptp.
					</para>
				</listitem>
			</itemizedlist>
			<para id="auth_ppp">
				После внесения изменений, конфигурацию необходимо сохранить. Для добавления пользователей VPN-сервера, перейдем на страницу System/Security/PPP secrets:
			</para>
			<figure>
				<title>Пользователи VPN-сервера</title>
				<graphic fileref="img/chap-list-empty.png" width="6in" />
			</figure>
			<para>
				Вкладка CHAP содержит пользователей, использующих систему аутентификации CHAP (в т.ч. обе версии MS CHAP), вкладка PAP — соответственно пользователей, использующих PAP. Пример добавления нового пользователя показан ниже:
			</para>
			<figure id="auth_ppp_edit">
				<title>Добавление нового пользователя</title>
				<graphic fileref="img/chap-add.png" width="6in" />
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Username</emphasis> — имя пользователя.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Password</emphasis> — пароль пользователя.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Server</emphasis> — имя сервера VPN, "*" — любой.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>IP address</emphasis> — IP-адрес, выдаваемый клиенту. "*" — любой.
					</para>
				</listitem>
			</itemizedlist>
		</section>
		<section id="dns_server">
			<title>Сервер DNS</title>
			<para>
				Сервер DNS отвечает за преобразование доменного имени в IP-адрес. Его настройка осуществляется на странице Services/DNS server.
			</para>
			<figure>
				<title>Настройка сервера DNS</title>
				<graphic fileref="img/dns_server.png" width="6in" />
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Enable DNS server</emphasis> — активировать сервер DNS.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Forwarder DNS 1</emphasis> — сервер DNS №1, к которому следует перенаправлять запросы в случае, если локальный сервер DNS не может дать ответ.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Forwarder DNS 2</emphasis> — сервер DNS №2, к которому следует перенаправлять запросы в случае, если локальный сервер DNS не может дать ответ.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Данный сервер DNS может выступать в роли авторитетного сервера для домена, т.е. хранить информацию о записях (NS, A, CNAME, ...) домена. Для этого необходимо создать файл зоны, в котором хранится информация о домене и его записях. Список зон сервера DNS отображается в форме Zones.
			</para>
			<figure id="dns_server.dns_zones">
				<title>Зоны сервера DNS</title>
				<graphic fileref="img/dns_server-zones.png" width="6in" />
			</figure>
			<para>
				Создание и редактирование файла зоны выполняется в форме Zones по нажатию соответствующей кнопки.
			</para>
			<figure id="dns_server.zone_add">
				<title>Добавление зоны</title>
				<graphic fileref="img/dns_server-add-zone.png" width="6in" />
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Zone id</emphasis> — идентификатор зоны (этим идентификатором называется файл, в котором хранится зона).
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Zone</emphasis> — имя зоны (доменное имя, для которого создаётся зона).
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Enable</emphasis> — активна ли зона.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Name server</emphasis> — авторитетный сервер DNS для домена.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Admin</emphasis> — адрес электронной почты администратора зоны.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Refresh</emphasis> — время, через которые ведомые сервера DNS (slave) будут обновлять зону.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>TTL</emphasis> — время, которое запись зоны может храниться в кэше.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>retry</emphasis> — время, через которое ведомый сервер в случае неудачи повторит попытку обновить зону.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>expire</emphasis> — время, через которое информация о зоне перестает считаться действительной.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				После добавления зоны соответствующая запись появится в таблице зон.
			</para>
			<para>
				Переход на страницу добавления записей в зону осуществляется щелчком мыши по идентификатору или имени зоны. В результате откроется страница с таблицей, содержащей записи для данной зоны. Форма добавления новой записи представлена ниже.
			</para>
			<figure id="dns_server.zone_record_add">
				<title>Добавление записи в зону</title>
				<graphic fileref="img/dns_server-record-add.png" width="6in" />
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Domain or host</emphasis> — имя (или IP-адрес, если зона обратная).
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Type of record</emphasis> — тип записи. Возможны следующие значения:
					</para>
					<itemizedlist>
						<listitem>
							<para>
								<emphasis>A</emphasis> — указывает IP-адрес, соответствующий имени.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>CNAME</emphasis> — синоним другого имени. В этом случае в качестве DATA указывается соответствующее имя.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>MX</emphasis> — имя почтового сервера для данного домена.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>NS</emphasis> — указывает авторитетный сервер DNS для домена (по сути — делегирование домена).
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>PTR</emphasis> — указывает имя для данного IP-адреса. Используется в обратной зоне.
							</para>
						</listitem>
						<listitem>
							<para>
								<emphasis>TXT</emphasis> — дополнительная текстовая информация.
							</para>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>
						<emphasis>Priority</emphasis> — приоритет для записи MX.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Data</emphasis> — данные записи — доменное имя или IP-адрес, либо какая-то текстовая информация.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				После сохранения в таблице будет показана новая запись для зоны.
			</para>
			<figure>
				<title>Таблица записей для зоны</title>
				<graphic fileref="img/dns_server-records.png" width="6in" />
			</figure>
		</section>
	</chapter>
	<chapter id="traffic">
		<title>Управление трафиком</title>
		<section id="routes">
			<title id="routes.title">Добавление сетевых маршрутов</title>
			<para>
				Сетевые маршруты определяют, через какие маршрутизаторы доступна та или иная сеть. Добавление маршрутов осуществляется на странице настройки того сетевого интерфейса, через который он пролегает. К примеру, сеть имеет следующую структуру:
			</para>
			<figure>
				<title>Пример: структура сети</title>
				<graphic width="6in" fileref="img/routes-network.png" />
			</figure>
			<para>
				Наш маршрутизатор имеет обозначение SG16R, и подключен к двум маршрутизаторам — GW1 и GW2 через интерфейсы eth0 (Ethernet) и dsl0 (SHDSL) соответственно. Видно, что добавление маршрутов для сетей будет иметь вид:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						Network1: сеть 192.168.100./24 через маршрутизатор 192.168.1.2
					</para>
				</listitem>
				<listitem>
					<para>
						Network2: сеть 192.168.3.0/24 через маршрутизатор 192.168.2.1
					</para>
				</listitem>
				<listitem>
					<para>
						Network3: сеть 192.168.20.0/24 через маршрутизатор 192.168.2.1
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Проанализировав маршруты, приходим к выводу, что маршрут на первую сеть относится к интерфейсу eth0, а на вторую и третью — к dsl0. Поэтому и добавление маршрутов через веб-интерфейс будет производится на страницах соответствующих интерфейсов.
			</para>
			<note>
				<para>
					Маршрут на сеть Network3 добавляется так же как и для сети Network 2 через маршрутизатор GW2 по причине того, что маршрутизатор SG16R не имеет прямого подключения к маршрутизатору GW3 и вынужден обращаться к нему через GW2.
				</para>
			</note>
			<para>
				Для добавления маршрута переходим на страницу конфигурации соответствующего маршруту интерфейса (к примеру, Network/Interfaces/eth0), где выбираем вкладку Routes:
			</para>
			<figure>
				<title>Пустой список маршрутов</title>
				<graphic width="6in" fileref="img/routes-list_empty.png" />
			</figure>
			<para>
				Изначально список пустой. Для добавления нового маршрута, нажимаем на кнопку со значком &quot;+&quot; и заполняем поля в новом окне:
			</para>
			<figure>
				<title>Добавление маршрута</title>
				<graphic fileref="img/routes-add.png" />
			</figure>
			<para>
				После добавления маршрута, информация о нём появится в таблице маршрутов:
			</para>
			<figure id="routes.list">
				<title>Список маршрутов</title>
				<graphic width="6in" fileref="img/routes-list_full2.png" />
			</figure>
			<para>
				Чтобы внесённые изменения вступили в силу, необходимо &quot;перезагрузить&quot; интерфейс, т.е. на вкладке Status нажать на кнопку <emphasis>Restart interface</emphasis>.
			</para>
		</section>
		<section id="fw">
			<title>Управление межсетевым экраном</title>
			<para>
				Межсетевой экран используется, чтобы ограничить доступ к тем или иным сетевым ресурсам, основываясь на IP-адресах, портах отправителя и назначения, или используемого протокола.
			</para>
			<para>
				Активация межсетевого экрана осуществляется на странице Network/Firewall:
			</para>
			<figure>
				<title>Активация межсетевого экрана</title>
				<graphic width="6in" fileref="img/fw-activate.png" />
			</figure>
			<para>
				Работа межсетевого экрана основана на прохождением пакетов цепочек правил, где каждое правило определяет одно из действий: прием или отброс пакета, основываясь на одном или нескольких критериях. Добавление правил осуществляется на странице Network/Firewall/Filter. Для каждой цепочки устанавливается действие по-умолчанию — политика, т.е. в случае, если пакет не попал ни под один критерий:
			</para>
			<figure id="filter_policy">
				<title>Политики цепочек</title>
				<graphic width="6in" fileref="img/fw-policy.png" />
			</figure>
			<note>
				<para>
					При установлении политики в значение DROP для цепочки INPUT или OUTPUT, удостоверьтесь, что в этих цепочках есть разрешающие правила, иначе управление маршрутизатором может быть потеряно.
				</para>
			</note>
			<para>
				Для правила определены следующие действия:	
			</para>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>ACCEPT</emphasis> — приём пакета.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>DROP</emphasis> — отброс пакета без отправки уведомления источнику пакета.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>REJECT</emphasis> — отброс пакета с отправкой уведомления.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Цепочку FORWARD проходят пакеты, являющиеся транзитными, т.е. идущие с одного интерфейса маршрутизатора на другой:
			</para>
			<figure id="filter_forward">
				<title>Цепочка FORWARD</title>
				<graphic width="6in" fileref="img/fw-forward.png" />
			</figure>
			<para>
				В цепочку INPUT попадают пакеты, предназначающиеся маршрутизатору:
			</para>
			<figure id="filter_input">
				<title>Цепочка INPUT</title>
				<graphic width="6in" fileref="img/fw-input.png" />
			</figure>
			<para>
				В цепочку OUTPUT попадают пакеты, источником которых является маршрутизатор:
			</para>
			<figure id="filter_output">
				<title>Цепочка OUTPUT</title>
				<graphic width="6in" fileref="img/fw-output.png" />
			</figure>
			<para>
				Добавление правил осуществляется нажатием кнопки &quot;+&quot;, и заполнением формы, открывшейся в новом окне:
			</para>
			<figure id="filter_add">
				<title>Добавление правила</title>
				<graphic fileref="img/fw-add.png" />
			</figure>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Short name</emphasis> — имя правила. Должно включать только английские буквы и цифры.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Enable</emphasis> — активно ли правило.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Source</emphasis> — IP-адрес или сеть источника пакета.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Destination</emphasis> — IP-адрес или сеть получателя пакета.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Protocol</emphasis> — протокол.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Source port</emphasis> — порт источника пакета.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Destination port</emphasis> — порт получателя пакета.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>Action</emphasis> — действие, выполняемое над пакетом.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Удаление и редактирование правила осуществляется соответственно кнопками &quot;x&quot; и &quot;e&quot;.
			</para>
			<note>
				<para>
					Если внесённые вами изменения не вступают в силу, проверьте, что вы активировали межсетевой экран на странице Network/Firewall.
				</para>
			</note>
		</section>
		<section id="nat">
			<title>NAT</title>
			<para>
				NAT — network address translation — позволяет заменять адреса источника или отправителя пакета.
			</para>
			<para>
				NAT является частью межсетевого экрана, поэтому схема управления остаётся той же, меняется только действие. Все сетевые пакеты, являются ли они транзитными или предназначаются маршрутизатору, попадают сперва в цепочку PREROUTING, где над ними может быть выполнено несколько действий. В этой цепочке не рекомендуется производить фильтрацию пакетов, для этого надо использовать цепочку FORWARD. Цепочка PREROUTING предназначена для выполнения DNAT — destination NAT, т.е. замена адреса получателя пакета.
			</para>
			<figure id="nat_prerouting">
				<title>Цепочка PREROUTING</title>
				<graphic width="6in" fileref="img/nat-prerouting.png" />
			</figure>
			<para>
				В цепочку POSTROUTING идут пакеты, выходящие с маршрутизатора, транзитные или сгенерированные на маршрутизаторе. В этой цепочке можно выполнить SNAT — source NAT — замену адреса отправителя, с указанием адреса, либо MASQUERADE — смысл тот же, только адрес замена будет выбираться автоматически (удобно при работе с динамическими интерфейсами и IP-адресами).
			</para>
			<figure id="nat_postrouting">
				<title>Цепочка POSTROUTING</title>
				<graphic width="6in" fileref="img/nat-postrouting.png" />
			</figure>
			<para>
				Для этих цепочек так же выставляются политики, т.е. действия для пакетов, не попавшие ни под одно правило:
			</para>
			<figure>
				<title>Политики цепочек</title>
				<graphic width="6in" fileref="img/nat-policy.png" />
			</figure>
			<note>
				<para>
					Т.к. в цепочку PREROUTING попадают пакеты, предназначающиеся самому маршрутизатору, перед выставлением политики DROP убедитесь, что в цепочке есть правило, разрешающее прохождение пакетов для управления маршрутизатором.
				</para>
			</note>
			<para>
				Добавление правил осуществляется нажатием кнопки &quot;+&quot;, расположенной рядом с заголовком соответствующей таблицы:
			</para>
			<figure id="nat_add">
				<title>Добавление правила</title>
				<graphic fileref="img/nat-add.png" />
			</figure>
			<para>
				Добавление правила и поля аналогично добавлению правила в межсетевом экране (Network/Firewall/Filter), добавляется только одно новое поле:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>Nat to address</emphasis> — IP-адрес, которым будет заменяться адрес отправителя или получателя, в зависимости от действия. При выполнении действий, отличных от SNAT и DNAT, заполнение поля необязательно.
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Редактирование и удаление правил осуществляется с помощью кнопок &quot;e&quot; и &quot;x&quot;, расположенных рядом с правилом.
			</para>
			<para>
				Для работы НАТа необходимо активировать межсетевой экран на странице Network/Firewall.
			</para>
		</section>
		<section id="qos">
			<title>Качество обслуживания</title>
			<para>
				Качество обслуживания (QoS — quality of service) позволяет изменить очередность прохождения трафика на интерфейсе. Разные дисциплины обслуживания предоставляют разные возможности по управлению трафиком и его классификации.
			</para>
			<section id="pfifo_fast">
				<title>Бесклассовая дисциплина pfifo_fast</title>
				<para>
					Стандартная дисциплина обслуживания трафика, реализующая простой механизм First In First Out. Состоит из трех полос — 0, 1 и 2. Полоса 0 обслуживается до тех пор, пока в ней есть пакеты, ожидающие передачи. Затем аналогичным образом обслуживаются полосы 1 и 2.
				</para>
				<para>
					Распределять трафик по полосам можно с помощью установки битов ToS — Type of Service, которая производится средствами межсетевого экрана. Существует четыре бита ToS, в каждый момент времени может быть установлен только один:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Minimum Delay</emphasis> — минимальная задержка.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Maximum Throughput</emphasis> — максимальная пропускная способность.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Maximum Reliability</emphasis> — максимальная надежность.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Minimum Cost</emphasis> — минимальная стоимость канала.
						</para>
					</listitem>
				</itemizedlist>
				<important>
					<para>
						В текущей версии веб-интерфейса маршрутизатора отсутствует возможность установки битов ToS. Для этого можно воспользоваться консольным интерфейсом маршрутизатора.
					</para>
				</important>
			</section>
			<section id="sfq">
				<title>Бесклассовая дисциплина SFQ</title>
				<para>
					SFQ — Stochastic Fairness Queueing — дисциплина честного планирования. Она оперирует таким понятием, как "поток" — сессия TCP или поток данных UDP, для каждого из которого создается своя очередь в рамках этой дисциплины. Дисциплина поочередно (round robin) переключается между очередями, не позволяя какому-либо потоку использовать весь канал монопольно.
				</para>
			</section>
			<section id="tbf">
				<title>Бесклассовая дисциплина TBF</title>
				<para>
					Token Bucket Filter (TBF) — простая бесклассовая дисциплина, пропускающая поступающие пакеты со скоростью, не превышающей заданной. Эта дисциплина относится весьма бережливо к ресурсам системы, поэтому в случае, если надо просто ограничить скорость исходящего трафика — это лучший выбор.
				</para>
				<para>
					Смысл работы данной дисциплины заключается в следующем. Поступающие для передачи пакеты записываются в буффер дисциплины, откуда они с заданной скоростью поступают на исходящий интерфейс. Возможно три ситуации:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Пакеты поступают со скоростью, равной скорости передачи их на исходящий интерфейс. В этом случае пакеты проходят через интерфейс без задержек.
						</para>
					</listitem>
					<listitem>
						<para>
							Пакеты поступают со скоростью, меньшей скорости передачи их на исходящий интерфейс. В этом случае при кратковременном возрастании скорости входящего трафика — он будет накоплен во входящей очереди и передан с заданной скоростью.
						</para>
					</listitem>
					<listitem>
						<para>
							Пакеты поступают со скоростью, превышающей скорость передачи их на исходящий интерфейс. В этом случае через некоторое время пакеты начнут сбрасываться.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Дисциплина имеет несколько параметров, позволяющих управлять её работой:
				</para>
				<figure>
					<title>Конфигурирования TBF</title>
					<graphic fileref="img/qos-tbf.png" width="6in" />
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Rate</emphasis> — скорость, с которой поступающий трафик передается на исходящий интерфейс.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Tocken Buffer</emphasis> — число байт, передаваемых в момент времени на исходящий интерфейс.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Limit</emphasis> — размер буфера в байтах, в который записываются поступающие пакеты, если скорость их поступления превышает скорость их передачи на исходящий интерфейс. При превышении этого параметра пакеты будут сбрасываться.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Latency</emphasis> — время, которое пакет может находиться, ожидая передачи на исходящий интерфейс. По истечении этого времени, пакет будет сброшен.
						</para>
					</listitem>
				</itemizedlist>
				<important>
					<para>
						Одновременно можно выставлять либо <emphasis>Limit</emphasis>, либо <emphasis>Latency.</emphasis>
					</para>
				</important>
			</section>
			<section id="htb">
				<title>Классовая дисциплина HTB</title>
				<para>
					Дисциплина HTB позволяет отдать предпочтение определенным пользователям или типам трафика, определяя их на основании IP-адресов или портов отправителя/получателя в разные классы трафика.
				</para>
				<para>
					В первую очередь следует отметить, что управлять скоростью можно только исходящего трафика (что, в общем, вполне разумно), поэтому при добавлении правил шейпинга необходимо определить интерфейс, на котором этот трафик будет исходящим.
				</para>
				<para>
					Реализация QoS на основе классовой дисциплины HTB состоит из двух этапов — создания класса и распределения трафика по классам в соответствии с определенными критериями с помощью фильтров. Классы, определяющие скорость трафика, могут добавляться как в корень, так и в другие подклассы, образуя иерархию классов. Фильтры добавляются в корень иерархии.
				</para>
				<tip>
					<para>
						Особенность подклассов в том, что скорость одного подкласса может быть увеличена (в пределах скорости родительского класса) за счет <emphasis>неиспользуемой</emphasis> скорости другого подкласса.
					</para>
				</tip>
				<figure id="qos_class">
					<title>Классы трафика</title>
					<graphic fileref="img/qos-class.png" width="6in" />
				</figure>
				<figure id="qos_filter">
					<title>Фильтры, направляющие трафик в классы</title>
					<graphic fileref="img/qos-filter.png" width="6in" />
				</figure>
				<para>
					Рассмотрим в качестве примера простую сеть, схема которой представлена ниже:
				</para>
				<figure>
					<title>Пример сети</title>
					<graphic fileref="img/tc-network.png" width="6in"/>
				</figure>
				<para>
					К примеру, если мы хотим ограничить пропускную способность канала для входящего трафика к хосту PC2, то нам необходимо работать с интерфейсом eth1 маршрутизатора, поскольку через него проходит исходящий трафик к хосту PC2. В качестве примера  ограничим весь трафик, поступающий на PC2, для этого нам необходимо создать класс, в который будет поступать трафик, идущий к хосту PC2:
				</para>
				<figure id="htb_class_add">
					<title>Добавление класса</title>
					<graphic fileref="img/qos-class-add.png" width="6in"/>
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Short name</emphasis> — имя добавляемого класса. Используется при классификации трафика в фильтре.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Enable</emphasis> — активен ли класс.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Parent class</emphasis> — родительский класс. root — корневой класс. При добавлении класса в некорневой класс — добавляемый класс будет <emphasis>подклассом</emphasis>.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Rate</emphasis> — пропускная способность, выделяемая классу.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Ceil</emphasis> — максимальная пропускная способность подкласса (в случае, если другой подкласс этого же класса использует не всю предоставленную ему пропускную способность).
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Чтобы избежать путаницы, заранее рассмотрим принятые сокращения, описывающие скорость:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							mbps = 1024 kbps = 1024 * 1024 bps => byte/s => 1024 килобайт в секунду.
						</para>
					</listitem>
					<listitem>
						<para>
							mbit = 1024 kbit => kilo bit/s => 1024 килобит в секунду.				    
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Теперь нам необходимо классифицировать трафик, идущий к хосту PC2. Для этого нам необходимо создать фильтр:
				</para>
				<figure id="htb_filter_add">
					<title>Добавление фильтра</title>
					<graphic fileref="img/qos-filter-add.png" width="6in"/>
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Short name</emphasis> — имя фильтра.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Enable</emphasis> — активен ли фильтр.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Prio</emphasis> — приоритет фильтра. Чем меньше значение приоритета — тем он выше.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Protocol</emphasis> — классификация трафика по используемому протоколу.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Src</emphasis> — классификация трафика по адресу отправителя пакета.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Dst</emphasis> — классификация трафика по адресу получателя пакета.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Src port</emphasis> — классификация трафика по номеру порта отправителя пакета.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Dst port</emphasis> — классификация трафика по номеру порта получателя пакета.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Class</emphasis> — в какой класс направить пакет.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					В приведённом выше примере мы ограничили входящую скорость для хоста PC2. Но исходящая осталась неограниченной. Чтобы исправить положение, необходимо определить, какой интерфейс является исходящем для трафика с PC2. Это зависит от того, кто запрашивает трафик с PC2, в нашем случае это может быть только PC1, следовательно интерфейс, через который пойдет трафик к PC1, будет eth0. Поэтому для ограничения исходящего трафика необходимо создать класс с требуемой скоростью и добавить фильтр, который будет отправлять трафик, идущий от хоста PC2 (src 192.168.90.2) направлять в нужный класс.
				</para>
			</section>
		</section>
		<section id="ipsec">
			<title>IPSec</title>
			<section id="ipsec.intro">
				<title>Введение</title>
				<para>
					<emphasis>IPSec</emphasis> является расширением протокола <emphasis>IP</emphasis>, предоставляет средства аутентификации и шифрования трафика. Данная реализация IPSec выполнена на основе KAME. Настройка IPSec выполняется на странице Network/IPSec.
				</para>
				<para>
					В IPSec предусмотрено два протокола — <emphasis>AH</emphasis> для аутентификации и <emphasis>ESP</emphasis> для шифрования трафика. Однако, протокол <emphasis>ESP</emphasis> имеет встроенные средства для проверки аутентичности пакета. Таким образом, есть несколько способов передачи трафика с разной степенью защиты:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Передача трафика только с проверкой аутентификации. В этом случае задействован протокол <emphasis>AH</emphasis>, трафик передаётся в открытом виде, гарантируется только подлинность отправителя пакета. Это наименее ресурсоёмкий способ защиты трафика.
						</para>
					</listitem>
					<listitem>
						<para>
							Передача трафика с его шифрованием. В этом случае используется протокол <emphasis>ESP</emphasis>, проверка подлинности отправителя не выполняется. Это гораздо более ресурсоёмкий способ защиты трафика.
						</para>
					</listitem>
					<listitem>
						<para>
							Передача трафика с аутентификацией и шифрованием, с использованием протоколов <emphasis>AH</emphasis> и <emphasis>ESP</emphasis>. Этот режим называется <emphasis>nested ESP in AH</emphasis>. Каждый протокол выполняет свою функцию. Это наиболее ресурсоёмкий режим.
						</para>
					</listitem>
					<listitem>
						<para>
							Передача трафика с аутентификацией и шифрованием, используя только протокол <emphasis>ESP</emphasis>. Этот режим называется <emphasis>authenticated ESP</emphasis>, он менее ресурсоёмок режима <emphasis>nested ESP in AH</emphasis>.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Протокол <emphasis>AH</emphasis> используется для аутентификации и проверки целостности пакета. Для этого он выполняет расчёт хэша пакета (HMAC) на основе секретного ключа, полезного содержимого пакета и его неизменяемой части — IP-адреса. Так как в расчёте HMAC участвует IP-адрес, протокол AH не допускает трансляцию адресов (NAT). Получатель пакета повторяет расчёт HMAC и сверяет его с переданным вместе с пакетом, если они отличаются — нарушена целостность пакета либо его аутентичность.
				</para>
				<para>
					Протокол <emphasis>ESP</emphasis> может быть использован как для шифровании пакета, так и для проверки его целостности и аутентичности. Шифрование производится блочными алгоритмами с использованием секретного ключа, аутентификация выполняется так же, как в <emphasis>AH</emphasis>. При использовании аутентификации, получатель пакета сперва проверяет корректность HMAC, и лишь затем дешифрует пакет.
				</para>
				<para>
					Есть два режима работы IPSec:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Транспортный режим</emphasis> — защищается только полезная нагрузка пакета — заголовок IPSec вставляется между заголовком IP и заголовком протокола верхнего уровня. Таким образом, видны адреса отправителя и получателя пакета.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Туннельный режим</emphasis> — оригинальный пакет инкапсулируется в новый пакет IPSec, таким образом полностью защищается исходный пакет, скрываются оригинальные адреса отправителя и получателя пакета.
						</para>
					</listitem>
				</itemizedlist>
				<figure>
					<title>Режимы работы IPSec</title>
					<graphic fileref="img/ipsec_tunnel_transport.png" />
				</figure>
				<para>
					Конфигурация IPSec заключается в создании защищённых виртуальных каналов (<emphasis>SA</emphasis>, security association, контекст безопасности) и политик безопасности (<emphasis>SP</emphasis>, security policy). Их конфигурация описывается в соответствующих разделах.
				</para>
			</section>
			<section id="ipsec.sa">
				<title>Контекст безопасности</title>
				<para>
					Создание и редактирование контекстов безопасности выполняется на вкладке Security Association. Каждый контекст безопасности определяет, как защищать передаваемый трафик, и характеризуется следующими параметрами:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							IP-адреса отправителя и получателя IPSec пакета (узлов, которые защищают трафик).
						</para>
					</listitem>
					<listitem>
						<para>
							Протокол IPSec: AH или ESP.
						</para>
					</listitem>
					<listitem>
						<para>
							Алгоритм и секретный ключ, используемый IPSec протоколом.
						</para>
					</listitem>
					<listitem>
						<para>
							Индекс контекста безопасности, SPI (Security Parameter Index).
						</para>
					</listitem>
					<listitem>
						<para>
							Режим IPSec (транспортный или туннельный).
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Так как в контексте безопасности указываются IP-адреса получателя и отправителя пакета, то один контекст безопасности способен передавать трафик только в одном направлении. Чтобы организовать полнодуплексную передачу, необходимо создать два контекста, по одному для каждого направления. Если используется оба протокола — AH и ESP — то необходимо создать 4 контекста безопасности — по каждому на каждый протокол и каждое направление.
				</para>
				<para>
					Пример создания контекста безопасности показан на рисунке.
				</para>
				<figure id="ipsec.sa.add">
					<title>Создание контекста безопасности</title>
					<graphic fileref="img/ipsec-create-sa.png" width="6in"/>
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>SPI</emphasis> — Security Parameter Index — индекс контекста безопасности, произвольное 32-х битное целое число (кроме значений от 0 до 255).
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Mode</emphasis> — режим работы: транспортный или туннельный.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Source</emphasis> — IP-адрес источника пакета IPSec.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Destination</emphasis> — IP-адрес получателя пакета IPSec.
						</para>
						<note>
							<para>
								<emphasis>Source</emphasis>, <emphasis>Destination</emphasis> — IP-адреса узлов, генерирующих IPSec пакеты, т.е. обеспечивающие безопасность соединения. Это не всегда IP-адреса узлов, являющиеся источниками незащищённого трафика.
							</para>
						</note>
					</listitem>
					<listitem>
						<para>
							<emphasis>AH Algorithm</emphasis> — алгоритм для проверки аутентичности пакета.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>AH Key</emphasis> — секретный ключ, используемый алгоритмом AH для вычисления хэша HMAC.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>ESP Algorithm</emphasis> — алгоритм для шифрования пакета.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>ESP Key</emphasis> — секретный ключ, используемый алгоритмом ESP для шифрования пакета.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Немного подробнее об алгоритмах AH и ESP:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Если выбран только алгоритм AH (ESP — none) — то протокол контекста безопасности будет установлен в AH.
						</para>
					</listitem>
					<listitem>
						<para>
							Если выбран только алгоритм ESP (AH — none) — то протокол контекста безопасности будет установлен в ESP.
						</para>
					</listitem>
					<listitem>
						<para>
							Если выбраны оба алгоритма (AH и ESP) — то протокол контекста безопасности будет установлен в ESP, и для пакета будет рассчитываться хэш HMAC (authenticated ESP).
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Рядом с названием алгоритма указана необходимая длина ключа. Ключи различной длины генерируются на вкладке Random keys, содержимое которой обновляется при каждой перезагрузке страницы.
				</para>
				<figure>
					<title>Random keys</title>
					<graphic fileref="img/ipsec-random-keys.png" width="6in"/>
				</figure>
			</section>
			<section id="ipsec.sp">
				<title>Политика безопасности</title>
				<para>
					Политика безопасности определяет, какой трафик следует защищать, т.е. использовать для него контекст безопасности. Настройка политики безопасности выполняется на вкладке Security Policy и характеризуется следующими основными параметрами:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							IP-адреса источника и получателя пакетов, которые следует защищать. В транспортном режиме это те же адреса, что и в контексте безопасности, в туннельном могут отличаться.
						</para>
					</listitem>
					<listitem>
						<para>
							Вышележащий протокол, подлежащий защите (tcp, udp, ...).
						</para>
					</listitem>
					<listitem>
						<para>
							Режим IPSec (транспортный или туннельный).
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Так же как и в контексте безопасности, политика безопасности определяет только одно направление трафика, поэтому для полнодуплексного обмена необходимо создать две политики безопасности. Ниже приведён пример создания политики безопасности.
				</para>
				<figure id="ipsec.sp.add">
					<title>Создание политики безопасности</title>
					<graphic fileref="img/ipsec-create-sp.png" width="6in"/>
				</figure>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>Source range</emphasis> — IP-адрес или сеть отправителя пакета, для которого надо применить контекст безопасности.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Destination</emphasis> — IP-адрес или сеть получателя пакета, для которого надо применить контекст безопасности.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Upper-layer</emphasis> — вышележащий протокол, для которого надо применить контекст безопасности.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Direction</emphasis> — направление трафика:
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<emphasis>In</emphasis> — входящий трафик.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>Out</emphasis> — исходящий трафик.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>Fwd</emphasis> — транзитный трафик.
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
					<listitem>
						<para>
							<emphasis>Policy</emphasis> — политика, применяемая к пакету, попавшему под критерии:
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<emphasis>ipsec</emphasis> — применять для пакета операции IPSec.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>none</emphasis> — не применять для пакета операции IPSec.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>discard</emphasis> — сбросить пакет.
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
					<listitem>
						<para>
							<emphasis>AH</emphasis> — использовать контекст безопасности с протоколом AH.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>ESP</emphasis> — использовать контекст безопасности с протоколом ESP.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Mode</emphasis> — транспортный или туннельный режим.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Source-Destination</emphasis> — IP-адрес отправителя-получателя пакета в контексте безопасности.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>Level</emphasis> — правило обработки пакета:
						</para>
						<itemizedlist>
							<listitem>
								<para>
									<emphasis>default</emphasis> — использовать системные настройки для выбранного протокола, например значение переменной sysctl <emphasis>esp_trans_deflev</emphasis>.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>use</emphasis> — использовать, если возможно, контекст безопасности, иначе обрабатывать пакет в обычном режиме (как обычный IP пакет).
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>require</emphasis> — всегда использовать контекст безопасности, если он не доступен — сбрасывать пакет.
								</para>
							</listitem>
							<listitem>
								<para>
									<emphasis>unique</emphasis> — не используется.
								</para>
							</listitem>
						</itemizedlist>
					</listitem>
				</itemizedlist>
			</section>
			<section id="ipsec.example">
				<title>Пример конфигурации</title>
				<para>
					В качестве примера рассмотрим настройку наиболее типичной конфигурации — authenticated ESP, т.е. передачи шифрованного трафика с помощью протокола ESP с проверкой аутентичности пакета. IPSec будет работать в туннельном режиме.
				</para>
				<para>
					В нашем примере есть две сети, соединённые маршрутизаторами, образующими между собой третью сеть. Стоит задача защиты трафика, передаваемого между узлами PC1 и PC2 на участке SG1-SG2, т.е. между маршрутизаторами. Пример сети представлен ниже.
				</para>
				<figure>
					<title>Пример конфигурации IPSec: схема сети</title>
					<graphic fileref="img/ipsec-example.png" width="6in"/>
				</figure>
				<para>
					Прежде всего необходимо настроить маршрутизацию, в общем виде следует выполнить следующие действия:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							<emphasis>PC1</emphasis> — добавить маршрут к сети 192.168.4.0/24 через маршрутизатор 192.168.5.100.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>PC2</emphasis> — добавить маршрут к сети 192.168.5.0/24 через маршрутизатор 192.168.4.101.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>SG1</emphasis> — добавить маршрут к сети 192.168.4.0/24 через маршрутизатор 192.168.3.101.
						</para>
					</listitem>
					<listitem>
						<para>
							<emphasis>SG2</emphasis> — добавить маршрут к сети 192.168.5.0/24 через маршрутизатор 192.168.3.100.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Как прописывать статические маршруты для маршрутизатора см. раздел <link linkend="routes" endterm="routes.title"/>.
				</para>
				<para>
					Без использования IPSec трафик на интерфейсе eth1 (192.168.3.100) маршрутизатора SG1 имеет следующий вид:
				</para>
				<screen>
	03:11:37.423594 IP 192.168.4.1 > 192.168.5.1:
		ICMP echo request, id 9596, seq 5, length 64
	03:11:37.424282 IP 192.168.5.1 > 192.168.4.1:
		ICMP echo reply, id 9596, seq 5, length 64
	03:11:38.421283 IP 192.168.4.1 > 192.168.5.1:
		ICMP echo request, id 9596, seq 6, length 64
	03:11:38.421947 IP 192.168.5.1 > 192.168.4.1:
		ICMP echo reply, id 9596, seq 6, length 64
				</screen>
				<para>
					Из вывода <emphasis>tcpdump</emphasis> видно, что по каналу идёт нешифрованный трафик — пинг от 192.168.4.1 к 192.168.5.1.
				</para>
				<para>
					Для конфигурации IPSec необходимо создать два контекста безопасности (по одному на каждое направление трафика), одинаковых для обоих маршрутизаторов.
				</para>
				<figure>
					<title>Создание контекста безопасности №1, направление 192.168.3.101-192.168.3.100</title>
					<graphic fileref="img/ipsec-ex-sa1.png" width="6in"/>
				</figure>
				<figure>
					<title>Создание контекста безопасности №2, направление 192.168.3.100-192.168.3.101</title>
					<graphic fileref="img/ipsec-ex-sa2.png" width="6in"/>
				</figure>
				<para>
					В контексте безопасности мы установили туннельный режим, задали алгоритмы AH и ESP, что означает authenticated ESP, и ввели номер SPI.
				</para>
				<para>
					Так же необходимо создать по две политики безопасности на каждом маршрутизаторе, отличающихся направлением трафика. Так, для маршрутизатора SG1 передача трафика 192.168.3.101-192.168.3.100 имеет направление <emphasis>IN</emphasis>, т.к. для него это входящий трафик, а для маршрутизатора SG2 — <emphasis>OUT</emphasis>, т.к. для него это исходящий трафик.
				</para>
				<figure>
					<title>Создание политики безопасности №1 для SG1</title>
					<graphic fileref="img/ipsec-ex-sg1-sp1.png" width="6in"/>
				</figure>
				<para>
					Данная политика безопасности требует (level — require), чтобы весь трафик (upper-layer — any), идущий от узлов  сети 192.168.4.0/24 (т.е. от PC2) к узлам в сети 192.168.5.0/24 (к PC1) обслуживался контекстом безопасности, созданном для направления 192.168.3.101-192.168.3.100 (source-destination). Т.к. мы используем authenticated ESP, то не активируем использование контекста безопасности для протокола AH.
				</para>
				<figure>
					<title>Создание политики безопасности №2 для SG1</title>
					<graphic fileref="img/ipsec-ex-sg1-sp2.png" width="6in"/>
				</figure>
				<para>
					Данная политика безопасности аналогична предыдущей, за исключением адресов назначения пакетов и направления трафика.
				</para>
				<figure>
					<title>Создание политики безопасности №1 для SG2</title>
					<graphic fileref="img/ipsec-ex-sg2-sp1.png" width="6in"/>
				</figure>
				<figure>
					<title>Создание политики безопасности №2 для SG2</title>
					<graphic fileref="img/ipsec-ex-sg2-sp2.png" width="6in"/>
				</figure>
				<para>
					Эти политики безопасности отличаются от аналогичных для маршрутизатора SG1 только направлением трафика.
				</para>
				<para>
					После конфигурации IPSec трафик на интерфейсе eth1 (192.168.2.100) маршрутизатора SG1 следующий:
				</para>
				<screen>
	1. 09:36:23.736136 IP 192.168.3.101 > 192.168.3.100:
		ESP(spi=0x00002774,seq=0x10), length 116
	2. 09:36:23.736136 IP 192.168.4.1 > 192.168.5.1:
		ICMP echo request, id 29460, seq 1, length 64
	3. 09:36:23.738225 IP 192.168.3.100 > 192.168.3.101:
		ESP(spi=0x00002775,seq=0x16f), length 116
	4. 09:36:24.732904 IP 192.168.3.101 > 192.168.3.100:
		ESP(spi=0x00002774,seq=0x11), length 116
	5. 09:36:24.732904 IP 192.168.4.1 > 192.168.5.1:
		ICMP echo request, id 29460, seq 2, length 64
	6. 09:36:24.734876 IP 192.168.3.100 > 192.168.3.101:
		ESP(spi=0x00002775,seq=0x170), length 116
				</screen>
				<para>
					Проведём небольшой анализ трафика. На интерфейс от маршрутизатора SG2 (192.168.3.101) приходит ESP пакет (строка 1), который после обработки IPSec выглядит, как ICMP запрос от PC2 к PC1 (строка 2). Следует заметить, что по ESP пакету нельзя сказать, между какими узлами идёт обмен информацией. ICMP запрос отправляется узлу PC1 через интерфейс eth0 (192.168.5.100), поэтому в данном листинге его не видно. На тот же интерфейс приходит ответ, который отправляется маршрутизатору SG2 после обработки IPSec в виде ESP пакета (строка 3).
				</para>
			</section>
		</section>
	</chapter>
  <chapter id="multiplexing">
	  <title>Мультиплексирование</title>
		<section>
			<title>Конфигурация</title>
			<para>
				Мультиплексирование используется для передачи трафика с одного интерфейса на другой, минуя центральный процессор. <emphasis>SG-17R</emphasis> позволяет одновременно мультиплексировать и маршрутизировать сетевой трафик.
			</para>
			<para>
				В общем виде это можно представить так:
			</para>
			<figure>
				<title>Схема сети</title>
				<graphic fileref="img/multiplexing1.png" width="6in" />
			</figure>
			<para>
				В приведенном примере к маршрутизаторам SG-17R подключено два канала Е1, а так же сеть TCP/IP по Ethernet. Два маршрутизатора соединены между собой через SHDSL. Максимальная скорость SHDSL составляет 5696 кбит/c, т.е. по одному каналу SHDSL можно передать два канала Е1 (2048 кбит/с каждый), и останется неиспользованными 1600 кбит/с.
			</para>
			<para>
				Для передачи потоков Е1 используется мультиплексирование: оба входных потока Е1 мультиплексируются в канал SHDSL, по которому они передаются на второй маршрутизатор, где происходит демультиплексирование, и потоки расходятся к клиентам. Оставшаяся полоса SHDSL используется для передачи TCP/IP трафика между двумя Ethernet сетями.
			</para>
			<para>
				Для мультиплексирования в маршрутизаторе выделена шина, состоящая из 16 линий, каждая из которых содержит 256 тайм-слотов. Каждый тайм-слот на линии соответствует тайм-слоту в Е1 или SHDSL, т.е. имеет скорость 64 кбит/с. E1 содержит 32 тайм-слота, SHDSL — 89 тайм-слотов. Интерфейсы E1 (hdlc) и SHDSL (dsl) могут выставлять на нее данные, полученные из физической линии, и принимать данные, выставленные другим интерфейсом.
			</para>
			<figure>
				<title>Физическая организация мультиплексирования</title>
				<graphic fileref="img/multiplexing-line.png" width="6in" />
			</figure>
			<para>
				Все устройства, участвующие в мультиплексировании трафика, должны тактироваться одним сигналом. Для этого при настройке мультиплексирования необходимо указать, какой интерфейс будет задавать тактовый сигнал на линию мультиплексирования.
			</para>
			<para>
				Маршрутизатор может иметь два задающих источника синхросигнала для мультиплексирования, каждый из которых определяет <emphasis>домен</emphasis>. Каждая линия относится либо к домену А, либо к домену В, соответственно, все интерфейсы, относящиеся к этой линии, так же относятся либо к домену А, либо к В. Задающий синхросигнал можно использовать либо локальный, либо удаленный.
			</para>
			<important>
				<para>
					В одном домене должно быть одно и только одно устройство (интерфейс), задающее тактовый сигнал! Все остальные устройства домена должны быть установлены в режим <emphasis>clock slave</emphasis>. Таким образом, от одного устройства тактируются все устройства, находящиеся в данном домене.
				</para>
			</important>
			<para>
				Для настройки мультиплексирования задаются следующие параметры (для каждого интерфейса, участвующего в мультиплексировании):
			</para>
			<itemizedlist>
				<listitem>
					<para>
						<emphasis>rline — </emphasis>номер линии, на которую интерфейс будет выставлять данные, полученные из физической линии
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>rfs — </emphasis>номер тайм-слота линии, начиная с которого на нее выставляются данные этим интерфейсом.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>tline — </emphasis>номер линии, с которой данный интерфейс забирает данные (выставленные другим интерфейсом, участвующим в мультиплексировании) для передачи в физическую линию.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>tfs — </emphasis>номер тайм-слота линии, начиная с которого с неё забираются данные.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>mxrate — </emphasis>число тайм-слотов, отводимых для  мультиплексирования (для интерфейсов SHDSL).
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>mxsmap — </emphasis>карта слотов, используемых для мультиплексирования (для интерфейсов Е1). Эта карта не должна пересекаться с картой, которая задается при конфигурации интерфейса Е1 для передачи IP трафика. Задается в виде "1-16", "16-31", ...
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>clkm — </emphasis>если 1, устройство является источником синхронизации для данного домена, если 0 —  приемником.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>clkab — </emphasis>0 — устройство принадлежит домену А, 1 — к домену B.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>clkr — </emphasis>1 — использовать для тактирования внешний клок, 0 — использовать для тактирования локальный клок.
					</para>
				</listitem>
				<listitem>
					<para>
						<emphasis>mxen — </emphasis>1 — устройство принимает участие в мультиплексировании, 0 — устройство используется только для IP трафика.
					</para>
				</listitem>
			</itemizedlist>
			<important>
				<para>
					Тайм-слот в Е1 может использоваться <emphasis>только</emphasis> либо для мультиплексирования, либо для маршрутизации, поэтому карта тайм-слотов, задаваемых для мультиплексирования параметром <parameter>mxsmap</parameter> не должна пересекаться с картой тайм-слотов, указанных при конфигурации Е1 для использования в передаче IP-трафика.
				</para>
			</important>
			<para>
				Настройка мультиплексирования выполняется на странице System/Multiplexing:
			</para>
			<figure>
				<title>Конфигурация мультиплексирования</title>
				<graphic fileref="img/mux-web.png" width="6in" />
			</figure>
			<para>
				Если при конфигурации были допущены ошибки, будет показана диагностическая информация:
			</para>
			<screen>
			Checking status:
			Errors detected:
				
			WARNING: Line2: timeslots 45 written but not read
			WARNING: Line3: timeslots 55 read but not written
			</screen>
		</section>
		<section>
			<title>Примеры конфигурации</title>
			<para>Рассмотрим работу мультиплексирования на примере следующей сети:</para>
			<figure>
				<title>Пример сети</title>
				<graphic fileref="img/multiplexing-ex1.png" width="6in" />
			</figure>
			<para>
				Требуется передать два канала Е1 (unframed mode) от АТС к Клиенту 1 и Клиенту 2 по каналу SHDSL.
			</para>
			<para>
				Т.к. источник сигнала для обоих каналов Е1 один — АТС, то не имеет значения, какой из интерфейсов Е1 будет тактировать линии мультиплексирования. В нашем распоряжении имеется 16 линий, имеющих по 256 тайм-слотов. Для удобства, мы задействуем две из них — одну для приема трафика, вторую — для передачи.
			</para>
			<para>
				Схема мультиплексирования будет выглядеть следующим образом:
			</para>
			<itemizedlist>
				<listitem>
					<para>
						Интерфейс Е1 <parameter>hdlc0</parameter> получает из физической лини данные и выставляет их на линию 0 (с нулевого тайм-слота). Для передачи в физическую линию данные берутся с линии 1, с нулевого тайм-слота. Так же этот интерфейс является источником синхронизации для данного домена.
					</para>
				</listitem>
				<listitem>
					<para>
						Интерфейс E1 <parameter>hdlc1</parameter> работает так же, как <parameter>hdlc0</parameter>, только выставляет и забирает данные начиная с 32 тайм-слота (и не подает синхросигнал, т.е. работает в режиме <emphasis>clock slave</emphasis>).
					</para>
				</listitem>
				<listitem>
					<para>
						Интерфейс SHDSL <parameter>dsl0</parameter> выставляет данные, полученные из физической линии, на линию 1 (откуда их заберут интерфейсы E1), а данные для передачи в физическую линию берет с линии 0 (куда их выставляют интерфейсы Е1). Число тайм-слотов, которые использует интерфейс для мультиплексирования, равно 64 (по 32 с каждого интерфейса Е1).
					</para>
				</listitem>
			</itemizedlist>
			<para>
				Описанная схема проиллюстрирована ниже:
			</para>
			<figure>
				<title>Взаимодействие интерфейсов на линии 0</title>
				<graphic fileref="img/multiplexing-ex1-1-line0.png" width="6in" />
			</figure>
			<figure>
				<title>Взаимодействие интерфейсов на линии 1</title>
				<graphic fileref="img/multiplexing-ex1-1-line1.png" width="6in" />
			</figure>
			<para>
				Для реализации этой схемы необходимо установить следующие параметры:
			</para>
			<itemizedlist>
				<listitem>
					<para>Интерфейс E1 <emphasis>hdlc0</emphasis></para>
					<itemizedlist>
						<listitem>
							<para><parameter>rline = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>rfs = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tline = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tfs = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>mxsmap = "0-31"</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkm = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkr = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkab = 0</parameter></para>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>Интерфейс E1 <emphasis>hdlc1</emphasis></para>
					<itemizedlist>
						<listitem>
							<para><parameter>rline = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>rfs = 32</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tline = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tfs = 32</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>mxsmap = "0-31"</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkm = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkr = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkab = 0</parameter></para>
						</listitem>
					</itemizedlist>
				</listitem>
				<listitem>
					<para>Интерфейс SHDSL <emphasis>dsl0</emphasis></para>
					<itemizedlist>
						<listitem>
							<para><parameter>rline = 1</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>rfs = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tline = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>tfs = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>mxrate = 64</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkm = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkr = 0</parameter></para>
						</listitem>
						<listitem>
							<para><parameter>clkab = 0</parameter></para>
						</listitem>
					</itemizedlist>
				</listitem>
			</itemizedlist>
			<note>
				<para>
					Так же для этих интерфейсов необходимо активировать мультиплексирование — установить параметр <parameter>mxen</parameter>.
				</para>
			</note>
			<para>
				Следуя этой логике, конфигурацию на втором маршрутизаторе можно выполнить аналогичным образом. Единственное отличие, в нашем случае, будет заключаться в изменении интерфейса, являющегося источником синхронизации. Эту функцию будет выполнять интерфейс SHDSL <parameter>dsl0</parameter>, т.к. именно он получает мультиплексированный поток от первого маршрутизатора, подключенного к АТС.
			</para>
			<tip>
				<para>
					Вообще, не обязательно для приема и отправки информации использовать разные линии. Для этих целей можно задействовать одну линию, правильно указав тайм-слоты, начиная с которых каждый интерфейс выставляет или забирает данные с линии. Пример такой конфигурации приведен ниже:
				</para>
			</tip>
			<figure>
				<title>Использование одной линии для выставления и получения данных</title>
				<graphic fileref="img/multiplexing-ex1-2-line.png" width="6in" />
			</figure>
		</section>
	</chapter>
	<chapter id="snmp">
		<title>SNMP</title>
		<section id="intro">
			<title>Введение в SNMP</title>
			<para>
				<emphasis>SNMP</emphasis> — Simple Network Management Protocol — простой протокол управления сетями. Протокол позволяет производить мониторинг сетевых устройств (маршрутизаторов, мультиплексоров, мостов и др.) и сервисов (веб-серверов, почтовых серверов, серверов DNS) и управлять их конфигурацией.
			</para>
			<para>
				Управление и мониторинг осуществляется по схеме агент-менеджер. Агент — ПО, работающее на сетевом устройстве, которое подлежит мониторингу или управлению, менеджер — ПО, собирающее информацию с агентов для мониторинга либо управления. Взаимодействие, как правило, осуществляется с помощью транспортного протокола UDP, порт 161. Так же возможно использование протокола TCP.
			</para>
			<para>
				Объекты, над которыми можно выполнять операции (чтения или записи) адресуются по уникальным номерам. Например, 1.3.6.1.2.1.1.1 соответствует объекту SysDescr — описанию системы, который может иметь следующее значение: <emphasis>STRING Linux gm-2-mpr 2.6.16 #1 Tue Nov 7 21:37:48 NOVT 2007 mips</emphasis>.
			</para>
			<para>
				<abbrev>MIB</abbrev> — Management Information Base — база данных информации управления. MIB описывает объекты и какие операции над ними можно выполнять. Если объект входит в состав MIB, то к нему можно обращаться по имени, а не по числовому индексу. 
			</para>
			<para>
				Аутентификации производится на основе "сообщества" — каждый агент относится к тому или иному сообществу. При получении команды производится проверка, принадлежит ли он к сообществу, указанному в команде. Если да — команда будет принята и обработана, иначе — проигнорирована. Сообщество представляет из себя простую строку, по-умолчанию используется два сообщества — public для просмотра объектов, private — для их изменения.
			</para>
		</section>
		<section id="support">
			<title>Уровень поддержки SNMP маршрутизатором</title>
			<para>
				Для поддержки протокола SNMP на маршрутизаторе используется свободный программный пакет <emphasis>net-snmp</emphasis>, поддерживающий все актуальные версии протокола SNMP, в состав которого входит демон <emphasis>snmpd</emphasis>, выполняющий функции агента.
			</para>
			<para>
				Маршрутизатором поддерживается <emphasis>MIB-2</emphasis>, предоставляющий общую информацию о системе (информацию о сетевых интерфейсах, таблицы маршрутизации, системную информацию), а так же <emphasis>HDSL2-SHDSL-LINE-MIB</emphasis>, содержащий объекты, используемые для мониторинга и управления каналами SHDSL.
			</para>
			<para>
				MIB-2 является стандартной MIB и входит в состав большинства менеджеров, в то время как HDSL2-SHDSL-LINE-MIB является специфичным для определённого типа устройств. Загрузить этот файл можно либо из источников в Интернете, либо по <ulink url="http://sigrand.ru/temp/HDSL2-SHDSL-LINE-MIB-rfc4319.txt">ссылке</ulink>.
			</para>
			<para>
				На данный момент по SNMP доступен только мониторинг маршрутизатора и SHDSL каналов и регенераторов, возможность управления будет добавлена в ближайшее время.
			</para>
		</section>
		<section id="snmpd">
			<title>Конфигурация SNMPD</title>
			<para>
				Конфигурация демона <emphasis>snmpd</emphasis> хранится в файле <emphasis>/etc/snmp/snmpd.conf</emphasis> и заключается в установлении прав доступа на получение и изменение объектов.
			</para>
			<para>
				Содержимое конфигурационного файла имеет следующий вид:
			</para>
			<programlisting>
				com2sec  ro  default    public
				com2sec  rw  localhost  private
				
				group  public   v1   ro
				group  public   v2c  ro
				group  public   usm  ro
				group  private  v1   rw
				group  private  v2c  rw
				group  private  usm  rw
				
				view  all  included  .1
				
				access  public   ""  any  noauth  exact  all  none  none
				access  private  ""  any  noauth  exact  all  all   all
			</programlisting>
			<para>
				Директива <emphasis>com2sec</emphasis> устанавливает соответствие между сообществом и именем безопасности, а так же устаналивает адреса, которые могут относится к этим сообществам. В приведенном выше конфигурационном файле первая директива определяет, что сообщество public соответствует безопасности ro, и ему соответствуют любые IP-адреса. Вторая директива определяет соответствие сообществу private безопасности rw, и ограничивают доступ только самим маршрутизатором.
			</para>
			<para>
				Директива <emphasis>group</emphasis> определяет, к какой группе какая безопасность относится. В нашем примере, к группе public относится безопасность ro, а к группе private — безопасность rw. v1, v2c, usm определяют модель безопасности. v1 относится к протоколу SNMP первой версии, v2c — ко второй, usm — SNMPv3.
			</para>
			<para>
				Директива <emphasis>view</emphasis> определяет имя области видимости, и что в неё входит. В нашем случае имя области видимости — all, и в неё входит всё дерево MIB.
			</para>
			<para>
				Последняя директива <emphasis>access</emphasis> определяет права доступа различных групп. В нашем примере обеим группам разрешён доступ без аутентификации, но группе public — только для чтения, а группе private — для чтения и записи.
			</para>
			<para>
				Более подробную информацию вы можете найти на сайте проекта net-snmp, в частности по <ulink url="http://net-snmp.sourceforge.net/wiki/index.php/Vacm">ссылке</ulink>.
			</para>
		</section>
		<section>
			<title>Связь SNMPD с EOCD</title>
			<para>
				<emphasis>SNMPD</emphasis> получает информацию о состоянии SHDSL-канала от демона <emphasis>EOCD</emphasis>. Таким образом, чтобы иметь возможность получать информацию о состоянии SHDSL-канала через SNMP, необходимо сконфигурировать демон EOCD. После того, как информация будет доступна через утилиту <command>eoc-info</command> — информацию можно будет получить через SNMP. Подробнее о назначении и конфигурации демона EOCD можно прочитать в разделе <link linkend="eoc" endterm="eoc.title" />.
			</para>
		</section>
		<section>
			<title>Пример использования</title>
			<para>
				В качестве примера рассмотрим мониторинг SHDSL-канала маршрутизатора. Для этого получим информацию о числе регенераторов, затухании сигнала и соотношении сигнал/шум.
			</para>
			<para>
				Числовое имя объекта, соответствующего числу регенераторов, обнаруженных на линии (Hdsl2ShdslStatusNumAvailRepeaters) равно 1.1.3.6.1.2.1.10.48.1.2.1.1.
				Для затухания сигнала (Hdsl2ShdslEndpointCurrAtn) это имя равно 1.1.3.6.1.2.1.10.48.1.5.1.1.11.1.2.1 для клиентской стороны (слейва) и 1.3.6.1.2.1.10.48.1.5.1.1.11.2.1.1 для мастера, а для соотношения сигнал/шум (Hdsl2ShdslEndpointCurrSnrMgn) — 1.3.6.1.2.1.10.48.1.5.1.2.11.1.2.1 и 1.3.6.1.2.1.10.48.1.5.1.2.11.2.1.1 соответственно. Значения этих параметров приведены ниже:
			</para>
			<programlisting>
				1.3.6.1.2.1.10.48.1.2.1.1.11 = Gauge32 0
				1.3.6.1.2.1.10.48.1.5.1.1.11.1.2.1 = INTEGER 0
				1.3.6.1.2.1.10.48.1.5.1.1.11.2.1.1 = INTEGER 0
				1.3.6.1.2.1.10.48.1.5.1.2.11.1.2.1 = INTEGER 19
				1.3.6.1.2.1.10.48.1.5.1.2.11.2.1.1 = INTEGER 17
			</programlisting>
			<para>
				Т.е. число регенераторов равно 0, затухание сигнала на обоих сторонах соединения — 0 dB, соотношение сигнал/шум на клиентской стороне 19 dB, на стороне мастера — 17 dB.
			</para>
			<para>
				При использовании специализированного ПО, поддерживающего загрузку MIB-ов, возможно получение информации в более удобной форме.
			</para>
		</section>
		<section>
			<title>Поддерживаемое ПО для управления по SNMP</title>
			<para>
				Для реализации поддержки протокола SNMP используется свободный программный пакет <emphasis>net-snmp</emphasis>, что позволяет работать со всеми программными продуктами, совместимыми с net-snmp.
			</para>
			<para>
				Дополнительно был проведён краткий обзор доступного программного обеспечения, результаты которого представлены ниже.
			</para>
			<section>
				<title>The Dude</title>
				<para>
					<emphasis>The Dude</emphasis> — бесплатный программный продукт для работы по протоколу SNMP, работает под ОС MS Windows.
				</para>
				<figure>
					<title>The Dude</title>
					<graphic fileref="img/thedude.png" width="6in" />
				</figure>
				<para>
					Достоинства:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Автоматически определяет устройства сети.
						</para>
					</listitem>
					<listitem>
						<para>
							Рисует карту сети, позволяет добавлять на карту новые устройства, выводить на карту значения SNMP-переменных.
						</para>
					</listitem>
					<listitem>
						<para>
							Выполняет мониторинг устройств, построение графиков в режиме реального времени.
						</para>
					</listitem>
					<listitem>
						<para>
							Имеет несколько удобных встроенных утилит для сетевого администрирования и мониторинга (терминалы, snmpwalk).
						</para>
					</listitem>
					<listitem>
						<para>
							Удобные режимы просмотра SNMP информации (список, дерево, таблица).
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Недостатки:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Неправильно отображаются индексы интерфейсов в табличном представлении.
						</para>
					</listitem>
					<listitem>
						<para>
							Возможно некорректное отображение SnmpAdminString для имён SHDSL профилей.
						</para>
					</listitem>
				</itemizedlist>
				<figure>
					<title>The Dude: маршрутизаторы Sigrand</title>
					<graphic fileref="img/thedude2.png" width="6in" />
				</figure>
				<para>
					Домашняя страница проекта: <ulink url="http://www.mikrotik.com/thedude.php">The Dude</ulink>.
				</para>
			</section>
			<section>
				<title>MIB Browser</title>
				<para>
					<emphasis>MIB Browser</emphasis>, разработка компании iReasoning, доступна в платной и бесплатной версии, различающихся лицензиями и функциональностью. Заявлена поддержка платформ Windows, Mac OS X и Linux.
				</para>
				<figure>
					<title>The Dude</title>
					<graphic fileref="img/mibbrowser.png" width="6in" />
				</figure>
				<para>
					Достоинства:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Удобный интерфейс.
						</para>
					</listitem>
					<listitem>
						<para>
							Табличный просмотр SNMP таблиц.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Недостатки:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Бесплатная версия не поддерживает SNMPv3, позволяет загружать дополнительно к имеющимся не более 5 MIB.
						</para>
					</listitem>
					<listitem>
						<para>
							Возможно некорректное отображение SnmpAdminString для имён SHDSL профилей.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Домашняя страница проекта: <ulink url="http://www.ireasoning.com/mibbrowser.shtml">MIB Browser</ulink>.
				</para>
			</section>
			<section>
				<title>OpenNMS</title>
				<para>
					<emphasis>OpenNMS</emphasis> — веб-приложение, написано на языке Java, использует для работы СУБД PostreSQL и Apache Tomcat, позволяет вести мониторинг промышленных сетей. Является свободным программным обеспечением (бесплатным), доступно для платформ, на которых работает Apache Tomcat (как правило, это Linux сервера).
				</para>
				<figure>
					<title>OpenNMS</title>
					<graphic fileref="img/opennms.png" width="6in" />
				</figure>
				<para>
					Достоинства:
				</para>
				<itemizedlist>
					<listitem>
						<para>
							Судя по всему, OpenNMS использует <emphasis>net-snmp</emphasis> для работы по протоколу SNMP, что даёт полную совместимость с оборудованием <emphasis>Sigrand</emphasis>.
						</para>
					</listitem>
				</itemizedlist>
				<para>
					Домашняя страница проекта: <ulink url="http://www.opennms.org/index.php/Main_Page">OpenNMS</ulink>.
				</para>
			</section>
		</section>
	</chapter>
	<chapter>
		<title>Примеры конфигурации</title>
		<section id="scheme1">
			<title>Организация независимых каналов между Ethernet-интерфейсами</title>
			<para>
				Данный пример рассматривает организацию независимых каналов между Ethernet-портами устройств, соединённых через SHDSL (функциональность 1 и 2).
			</para>
			<para>
				Рассмотрим организацию передачи данных с порта eth3 одного устройства на порт eth3 другого устройства через соединения SHDSL. При необходимости, можно задействовать все порты устройств (eth0, eth1, eth2). Схему взаимодействия между устройствами можно изобразить следующим образом:
			</para>
			<figure>
				<title>Схема взаимодействия устройств</title>
				<graphic fileref="img/scheme1-struct.png" width="6in" />
			</figure>
			<para>
				Устройства соединены двумя каналами SHDSL, которые объединены в бондинг. Поверх этого бондинга создан VLAN с VLAN ID равным 4. Бридж реализует передачу пакетов между интерфейсами bond0v4 (интерфейс VLAN) и eth3.
			</para>
			<para>
				Конфигурация начинается с настройки физического соединения между маршрутизаторами (см. <link linkend="dsl">настройку SHDSL</link>).
			</para>
			<para>
				Затем создадим бондинг из интерфейсов dsl0 и dsl1 (см. <link linkend="bonding">настройку Bonding</link>). В результате у нас будет интерфейс <emphasis>bond0</emphasis>.
			</para>
			<para>
				Далее, нам необходимо создать VLAN поверх бондинга. Число интерфейсов VLAN зависит от того, между сколькими портами ethernet мы будем организовывать независимую передачу данных — по одному VLAN на каждый порт. Детально процедура настройки интерфейса VLAN рассмотрена в соответствующем <link linkend="vlan">разделе</link>. Т.е. нам надо создать VLAN интерфейс поверх интерфейса bond0 с номером VLAN ID равным 4. В итоге мы получим интерфейс <emphasis>bond0v4</emphasis>.
			</para>
			<para>
				Заключительным этапом является создание моста (см. <link linkend="bridge">настройка моста</link>). Мост состоит из интерфейсов <emphasis>bond0v4</emphasis> и <emphasis>eth3</emphasis>, между которыми осуществляется передача трафика. Число интерфейсов моста так же зависит от числа портов, между которыми организуется обмен трафиком — на каждый порт один мост. Ниже приведена вкладка Specific страницы конфигурации интерфейса моста.
			</para>
			<figure>
				<title>Вкладка Specific интерфейса моста (br*)</title>
				<graphic fileref="img/scheme1-bridge.png" width="6in" />
			</figure>
			<para>
				Таким образом, если мы хотим организовать передачу между портами eth2, мы должны создать ещё один VLAN поверх интерфейса <emphasis>bond0</emphasis>, к примеру с VLAN ID 3, создать ещё один интерфейс моста, и добавить в него интерфейсы <emphasis>bond0v3</emphasis> и <emphasis>eth2</emphasis>.
			</para>
			<note>
				<para>
					Если необходимо организовать управление устройством по порту, который участвует в передачи данных (добавлен в мост), то его IP-адрес (по которому производится настройка) необходимо назначить интерфейсу моста, в который входит данный порт. Более подробно это описывается в соответствующей <link linkend="manage">главе</link>.
				</para>
			</note>
		</section>
		<section id="scheme3">
			<title>Распределение трафика по Ethernet-портам в зависимости от VLAN ID</title>
			<para>
				Допустим, мы хотим организовать передачу VLAN-трафика, поступающего на trunk-порт одного устройства через SHDSL-канал, а на втором устройстве, в зависимости от номера VLAN ID, передавать трафик (со снятым тегом VLAN) на соответствующий ethernet-порт. Это т.н. "функциональность 3".
			</para>
			<figure>
				<title>Структурная схема</title>
				<graphic fileref="img/scheme3-struct.png" width="6in" />
			</figure>
			<para>
				Идея построения схемы заключается в том, что на устройстве SG2, один из ethernet-портов которого выступает в роли trunk-порта, создаются интерфейсы VLAN, трафик которых надо передать на соответствующие порты другого устройства.
			</para>
			<para>
				К примеру, к устройству SG2 (например, к четвёртому ethernet-порту) подключена сеть, в которой работает несколько сетей VLAN с номерами 3 и 4. Нам необходимо соединить сеть с VLAN ID 3 с сетью, подключённой к третьему ethernet-порту устройства SG1. Так же необходимо соединить сеть с VLAN ID 4 с сетью, подключённой к четвёртому ethernet-порту устройства SG1. Следует заметить, что сети, подключённые к SG2 являются обычными LAN сетями, поэтому передаваемый туда трафик должен идти без заголовков VLAN.
			</para>
			<para>
				Настройка данной схемы разбивается на два этапа: конфигурация SG1 и конфигурация SG2. Подразумевается, что физическое соединение между устройствами (например, по SHDSL) уже настроено. В нашем примере мы используем бондинг поверх каналов SHDSL.
			</para>
			<section>
				<title>Конфигурация SG1</title>
				<para>
					В общем, конфигурация заключается в создании интерфейсов VLAN поверх интерфейса бондинга и создании моста между соответствующим интерфейсом ethernet и интерфейсом VLAN. Рассмотрим это более детально.
				</para>
				<para>
					Создадим на основе интерфейса <emphasis>bond0</emphasis> интерфейс VLAN с VLAN ID <emphasis>4</emphasis> (см. <link linkend="vlan">настройка VLAN</link>). Созданный интерфейс имеет имя <emphasis>bond0v4</emphasis>. Здесь же создадим интерфейс моста, к примеру, его имя будет <emphasis>br0</emphasis>.
				</para>
				<para>
					Настроим интерфейсы, которые войдут в состав моста: <emphasis>bond0v4</emphasis> и <emphasis>eth3</emphasis>. Настройка заключается в активации флажка Enabled на вкладке General страницы конфигурации интерфейса.
				</para>
				<para>
					Перейдём на страницу настройки моста, вкладку Specific. Укажем интерфейсы, между которыми будет передаваться трафик: <emphasis>bond0v4</emphasis> и <emphasis>eth3</emphasis>.
				</para>
				<figure>
					<title>Привязка к физическим интерфейсам</title>
					<graphic fileref="img/scheme3-sg1-br-specific.png" width="6in" />
				</figure>
				<para>
					На вкладке General активируем флажки Enabled и Auto.
				</para>
				<para>
					Если необходимо организовать передачу нескольких VLAN на порты SG1, то приведённая последовательность действий повторяется для каждой VLAN. В данной конфигурации максимальное число VLAN равно 4, оно ограничено числом ethernet-портов устройства.
				</para>
			</section>
			<section>
				<title>Конфигурация SG2</title>
				<para>
					Перед настройкой нам необходимо решить, какой из ethernet-портов устройства будет выполнять функции trunk-порта, т.е. к которому будут подключены сети VLAN.
				</para>
				<para>
					Для выбранного trunk-порта создаются интерфейс VLAN, и соответствующий ему интерфейс VLAN на основе интерфейса бондинга. Затем создаётся мост между соответствующим интерфейсом VLAN trunk-порта и интерфейсом VLAN бондинга. Идея заключается в том, что каждый интерфейс VLAN, созданный поверх trunk-порта, получает свой трафик и передаёт его "своему" интерфейсу бондинга. На втором устройстве (SG1) бондинг передаёт его соответствующему ethernet-порту. Рассмотрим эти действия подробнее.
				</para>
				<para>
					Конфигурация начинается с создания интерфейсов VLAN с одинаковыми VLAN ID на интерфейсах бондинга (к примеру, <emphasis>bond0</emphasis>) и ethernet-порта, выбранного в роли trunk-порта (<emphasis>eth3</emphasis>). Пусть созданные интерфейсы имеют имена <emphasis>bond0v4</emphasis> и <emphasis>eth3v4</emphasis>. Здесь же создадим интерфейсы моста, по одному на каждую пару интерфейсов VLAN.
				</para>
				<para>
					Настроим интерфейсы, входящие в состав моста. Для этого выставим флажки Enabled на вкладке General для интерфейсов <emphasis>eth3</emphasis> (т.к. это trunk-порт), <emphasis>bond0v4</emphasis> и <emphasis>eth3v4</emphasis>.
				</para>
				<para>
					Перейдём к настройке интерфейса моста: откроем вкладку Specific и укажем, из каких интерфейсов будет состоять мост, в нашем примере это интерфейсы <emphasis>bond0v4</emphasis> и <emphasis>eth3v4</emphasis>.
				</para>
				<para>
					На вкладке General активируем флажки Enabled и Auto. Таким образом, мы получаем один или несколько интерфейсов моста, передающих трафик между интерфейсами VLAN, созданными поверх trunk-порта и поверх бондинга.
				</para>
			</section>
		</section>
		<section id="manage">
			<title>Организация управления устройством через интерфейс, входящий в состав моста или бондинга</title>
			<para>
				В случае, если порт, через который осуществляется управление устройством, необходимо добавить в состав моста или бондинга, IP-адрес, используемый для управления, следует назначить интерфейсу, в состав которого включается порт. Например, порт eth0 используется для управления и ему назначен IP-адрес 192.168.2.100. Тогда, при включении этого порта в состав моста (интерфейса br0), то интерфейсу br0 назначается IP-адрес 192.168.2.100.
			</para>
			<para>
				Т.к. в случае непоследовательных действий есть вероятность потери управления над устройством, рассмотрим эту конфигурацию более подробно на примере <link linkend="scheme1">организации независимых каналов между Ethernet-интерфейсами</link>.
			</para>
			<para>
				Допустим, мы управляем устройством через порт <emphasis>eth0</emphasis> по IP-адресу 192.168.2.100, и хотим включить этот порт в мост для организации передачи данных, т.е. реализовать т.н. "функциональность 1". Но т.к. этот порт используется для управления, необходима другая последовательность действий по организации моста.
			</para>
			<para>
				Допустим, мы выполнили последовательность действий, описанных в приведённом выше разделе, а именно: настроили физическое соединение, создали бондинг и необходимый VLAN поверх него (<emphasis>bond0v1</emphasis>). Теперь нам необходимо создать мост. Здесь последовательность действий немного меняется. Создадим интерфейс моста, пусть у него будет имя <emphasis>br1</emphasis>. Перейдём на его страницу настройки, выберем вкладку Specific и пропишем нужные нам интерфейсы: eth0 и bond0v1.
			</para>
			<figure>
				<title>Добавление интерфейсов в мост</title>
				<graphic fileref="img/scheme1-mng-br-specific.png" width="6in" />
			</figure>
			<para>
				Затем перейдём на вкладку General и выберем статический (Static) метод назначения адреса. На данном этапе нельзя активировать интерфейс (выставлять флажки Enabled и Auto)!
			</para>
			<figure>
				<title>Установка метода назначения IP-адреса</title>
				<graphic fileref="img/scheme1-mng-br-general1.png" width="6in" />
			</figure>
			<para>
				Перейдём на вкладку Method, где пропишем нужный IP-адрес и маску сети.
			</para>
			<figure>
				<title>Назначение IP-адреса</title>
				<graphic fileref="img/scheme1-mng-br-method.png" width="6in" />
			</figure>
			<para>
				И в завершении вернёмся на вкладку General и активируем флажки Enabled и Auto.
			</para>
			<figure>
				<title>Запуск моста</title>
				<graphic fileref="img/scheme1-mng-br-general2.png" width="6in" />
			</figure>
			<para>
				После сохранения настроек с интерфейса eth0 будет снят IP-адрес, а на интерфейс моста будет назначен введённый нами IP-адрес, через который возможно дальнейшее управление устройством.
			</para>
			<tip>
				<para>
					В случае, если на интерфейс моста назначается тот же IP-адрес, что был на интерфейсе порта, возможно пропадание на некоторое время связи с устройством. Связано это с тем, что MAC-адрес моста соответствует одному из интерфейсов, которые в него входят, и если будет выбран MAC-адрес не интерфейса порта, которому принадлежал IP-адрес, то надо будет заместить в локальном ARP-кэше компьютера старое соответствие MAC-адреса IP-адресу. Сделать это можно либо вручную, удалив соответствующую запись из ARP-кэша, либо подождав некоторое время.
				</para>
			</tip>
		</section>
		<section id="manage_vlan">
			<title>Ограничение доступа к управлению устройством с помощью VLAN</title>
			<para>
				Для ограничения доступа к управлению устройством можно использовать технологию VLAN. Для этого на основе интерфейса, через который осуществляется управления, создаётся интерфейс VLAN, которому назначается IP-адрес, а адрес с нижележащего интерфейса снимается.
			</para>
			<para>
				Рассмотрим ограничение доступа по VLAN на том же примере <link linkend="scheme1">организации независимых каналов между Ethernet-интерфейсами</link>.
			</para>
			<para>
				Предположим, что мы управляем устройством через порт eth0 используя IP-адрес 192.168.2.100. Нам требуется использовать порт eth0 для передачи данных, как было рассмотрено в приведённом выше примере, и организовать управление устройством с компьютера, относящемуся к определённой сети VLAN.
			</para>
			<para>
				Выполним часть последовательности действий, описанных в приведённом выше разделе, а именно: настроим физическое соединение, создадим бондинг и необходимый VLAN поверх него (<emphasis>bond0v1</emphasis>). Теперь нам необходимо создать мост. Перейдём на страницу управления динамическими интерфейсами (Network/Interfaces) и создадим интерфейс моста, пусть у него будет имя <emphasis>br1</emphasis>. Тут же создадим на основе нового интерфейса моста <emphasis>br1</emphasis> VLAN с нужным нам VLAN ID, пусть имя нового интерфейса будет <emphasis>br1v7</emphasis>.
			</para>
			<figure>
				<title>Создание интерфейса VLAN на основе моста</title>
				<graphic fileref="img/scheme1-mng-vlan-add_br_vlan.png" width="6in" />
			</figure>
			<para>
				Перейдём на страницу настройки интерфейса моста <emphasis>br1</emphasis>, выберем вкладку Specific и пропишем нужные нам интерфейсы: eth0 и bond0v1.
			</para>
			<figure>
				<title>Добавление интерфейсов в мост</title>
				<graphic fileref="img/scheme1-mng-br-specific.png" width="6in" />
			</figure>
			<para>
				Затем перейдём на вкладку General и активируем интерфейс — поставим флажок Enabled (Auto выставлять не надо — это заблокирует доступ к устройству).
			</para>
			<figure>
				<title>Активация интерфейса моста</title>
				<graphic fileref="img/scheme1-mng-vlan-br-general.png" width="6in" />
			</figure>
			<para>
				Теперь перейдём к настройке интерфейса VLAN, созданного на основе сконфигурированного интерфейса моста. Для этого перейдём на его страницу конфигурации и выберем вкладку General, на которой выберем статический (Static) способ установки IP-адреса.
			</para>
			<figure>
				<title>Установка метода назначения IP-адреса</title>
				<graphic fileref="img/scheme1-mng-vlan-br_vlan-general1.png" width="6in" />
			</figure>
			<para>
				Перейдём на вкладку Method, где пропишем нужный IP-адрес и маску сети.
			</para>
			<figure>
				<title>Назначение IP-адреса</title>
				<graphic fileref="img/scheme1-mng-vlan-br_vlan-method.png" width="6in" />
			</figure>
			<para>
				И в завершении вернёмся на вкладку General и активируем флажки Enabled и Auto.
			</para>
			<figure>
				<title>Запуск интерфейса VLAN</title>
				<graphic fileref="img/scheme1-mng-vlan-br_vlan-general2.png" width="6in" />
			</figure>
			<para>
				Запуск интерфейса VLAN приведёт к запуску интерфейса моста, в итоге с интерфейса <emphasis>eth0</emphasis> будет снят IP-адрес, а на интерфейс VLAN, созданного на основе моста, будет назначен указанный нами IP-адрес.
			</para>
			<important>
				<para>
					После запуска интерфейса VLAN страница не будет загружена до конца, т.к. доступ к устройству без тега VLAN будет закрыт. С этого момента управлять устройством можно только с VLAN, номер которой совпадает с указанным при создании интерфейса VLAN <emphasis>VLAN ID</emphasis>.
				</para>
			</important>
		</section>
	</chapter>
	<chapter id="warranty">
		<title>Гарантия и обязательства</title>
		<para>
			Изготовитель гарантирует работоспособность маршрутизатора при соблюдением потребителем правил эксплуатации.
		</para>
		<para>
			Гарантийный срок устанавливается не менее 5 лет со дня продажи, отмеченного в паспорте, либо, при отсутствии отметки, с момента выпуска, указанного на маркировке.
		</para>
		<warning>
			<para>
				Гарантия на маршрутизаторы, эксплуатирующиеся на "воздушных" линиях, либо линиях с комбинированным способом прокладки, аннулируется.
			</para>
		</warning>
	</chapter>
</book>
