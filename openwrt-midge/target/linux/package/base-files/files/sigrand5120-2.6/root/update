#!/bin/sh

[ -z "$developer" ] && developer="vlad"
[ -z "$location" ] && location="home"
what="$1"
shift

case "$developer-$location" in
	vlad-home)
		method=dynamic
		ipaddr=192.168.1.20
		netmask=255.255.255.0
		gateway=192.168.1.1
		nameserver=90.0.0.1
		dev_server="192.168.100.11"
		ipkg_src="http://$dev_server/bin/packages"
	;;
	vlad-work)
		method=static
		ipaddr=194.54.152.50
		netmask=255.255.255.224
		gateway=194.54.152.33
		nameserver=194.54.152.35
		dev_server="midge.vlad.org.ua"
		ipkg_src="http://$dev_server/sigrand/20061209/packages"
	;;
	*)
		echo "unknown developer-location \"$developer-$location\""
		exit 1
	;;
esac

case "$what" in
	""|start)
		ifdown eth1
		kdb set sys_iface_eth1_auto=1
		kdb set sys_iface_eth1_enabled=1
		kdb set sys_iface_eth1_method=$method
		kdb set sys_iface_eth1_ipaddr=$ipaddr
		kdb set sys_iface_eth1_netmask=$netmask
		kdb set sys_iface_eth1_gateway=$gateway
		kdb set sys_dns_nameserver=$nameserver
		/etc/templates/Update dns
		ifup eth1
		cat /etc/ipkg.conf | grep -v ^src >/tmp/ipkg.conf
		echo "src sigrand $ipkg_src" >>/tmp/ipkg.conf
		mv /tmp/ipkg.conf /etc/ipkg.conf
	;;
	webface)
		ipkg update
		ipkg -force-reinstall install webface
	;;
	www)
		dirs="/www/controllers /www/lib /www/js /www/common"
		for dir in $dirs; do 
			cd $dir
			for i in *.sh; do
				wget http://$dev_server/sigrand/files/$dir/`basename $i` -O $i
			done
		done
	;;
	file)
		cwd=`pwd`
		file=$1
		wget http://$dev_server/sigrand/files/$cwd/$file -O $file
	;;
esac


