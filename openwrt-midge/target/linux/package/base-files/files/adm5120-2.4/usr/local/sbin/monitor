#!/bin/sh
# Reset switch monitor
# Copyright (C) by Edimax Technologies (original version)
# Modified 2006 by Lao (for EMLR)
#
# Covered by the GNU GPL v2.
# See the license file for details.
#
while [ 1 ]
do
    SW1=`cat /dev/switch`
    if [ $SW1 = 0 ]; then
	sleep 1
	SW2=`cat /dev/switch`
	if [ $SW2 = 0 ]; then
	    echo "led blink 1000" > /dev/led0
	    sleep 1
	    SW3=`cat /dev/switch`
	    if [ $SW3 = 0 ]; then
		sleep 1
		SW4=`cat /dev/switch`
		if [ $SW4 = 0 ]; then
		    sleep 1
		    SW5=`cat /dev/switch`
		    if [ $SW5 = 0 ]; then
			echo "led blink 50" > /dev/led0
			echo "Shutdown"
			umount -a 
			halt
		    fi
		fi
	    fi
	    echo "Reboot...."
	    reboot
	fi
    fi
echo "led off" > /dev/led0
sleep 3
done
