/**
 * @Code	L10N (Localization) By JavaScript
 * @Desc	This is a very useful script based on JavaScript and XML. You can use it to the localization of the webpage.
 * @Version	1.0 build 20080413
 * @Author	Hpyer <hpyer@yahoo.cn>
 * @Home	http://www.hpyer.cn/codes/l10n-by-javascript
 * @Usage	<See docs/ReadMe.txt>
 * @License	GNU GENERAL PUBLIC LICENSE (GPL) <See docs/License.txt>
 * @History	<See docs/History.txt>
 */

(function(A){A.extend({l10n:{opts:{dir:"./languages",lang:"en",cache:true},lang_msg:"",messages:[],__:function(B){if(!this.check()){return B}return this.messages[this.opts.lang][B]},_e:function(B){document.write(this.__(B));return""},check:function(){if(!this.opts.lang||this.opts.lang=="en"){return false}if(!this.messages[this.opts.lang]){this.load()}return true},init:function(B){if(typeof (B)!="object"){return false}for(opt in B){if(B[opt]){this.opts[opt]=B[opt]}}},load:function(){var B=this.opts.dir+"/"+this.opts.lang+".xml";A.ajax({url:B,cache:(this.opts.cache?true:false),async:false,success:function(C){A.l10n.callback(C)}})},callback:function(B){if(!B){return false}A.l10n.lang_msg=A.l10n.opts.lang;A.l10n.messages[A.l10n.opts.lang]=[];var C=A("message",B);A.each(C,function(){var E,G;try{E=A("msgid",this)[0].firstChild.nodeValue;G=A("msgstr",this)[0].firstChild.nodeValue;if(A.browser.msie){var D=E.match(/<(.+)>([^<]*)<\/\1>/g);if(D){A.each(D,function(){var I=/<(.+)>([^<]*)<\/\1>/g.exec(this);var H=I[1].toUpperCase();E=E.replace(new RegExp(I[0],"g"),"<"+H+">"+I[2]+"</"+H+">")})}}}catch(F){alert(F.message)}if(E&&G){A.l10n.messages[A.l10n.opts.lang][E]=G}})}}});A.fn.extend({l10n:function(B){A.l10n.init(B);this.each(function(){var C=A(this).attr("msgid");if(!C){C=A(this).html();A(this).attr("msgid",C)}A(this).html(A.l10n.__(C))})},l10n_picker:function(E,C){function G(M,O){var N=new RegExp(O,"gi");var I=M.match(N);if(I&&I.length>0){for(var L=0,J=I.length;L<J;L++){var K=new RegExp(O,"gi").exec(I[L]);if(K[2]&&!B(K[2])){F.push(K[2])}}}}function H(K){var L='<?xml version="1.0" encoding="'+K+'"?>\n\n<messages>\n';for(var J=0,I=F.length;J<I;J++){L+="\t<message>\n\t\t<msgid><![CDATA["+F[J]+"]]></msgid>\n\t\t<msgstr><![CDATA[]]></msgstr>\n\t</message>\n"}L+="</messages>";return L}function B(K){for(var J=0,I=F.length;J<I;J++){if(F[J]==K){return true}}return false}if(!E){E="UTF-8"}C=C||false;var F=[];this.each(function(){var I=A(this).attr("msgid");if(!I){I=A(this).html();A(this).attr("msgid",I)}if(I&&!B(I)){F.push(I)}});if(C){var D=A("html").html();G(D,"_e\\((\"|'){1}([^)]*)\\1(,s*.+)*\\)");G(D,"_{2}\\((\"|'){1}([^)]*)\\1(,s*.+)*\\)")}return H(E)}})})(jQuery);