diff -Naur linux-2.6.16-old/arch/mips/adm5120/Kconfig linux-2.6.16-new/arch/mips/adm5120/Kconfig
--- linux-2.6.16-old/arch/mips/adm5120/Kconfig	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/arch/mips/adm5120/Kconfig	2006-05-29 10:45:14.000000000 +0000
@@ -0,0 +1,4 @@
+config PCI_ADM5120
+	bool "Add PCI control support for ADM5120"
+	depends on MIPS_ADM5120 && HW_HAS_PCI
+	
diff -Naur linux-2.6.16-old/arch/mips/adm5120/Makefile linux-2.6.16-new/arch/mips/adm5120/Makefile
--- linux-2.6.16-old/arch/mips/adm5120/Makefile	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/arch/mips/adm5120/Makefile	2006-06-30 14:26:43.000000000 +0000
@@ -0,0 +1,2 @@
+
+obj-y	:= setup.o prom.o irq.o memory.o mipsIRQ.o altera.o
diff -Naur linux-2.6.16-old/arch/mips/Kconfig linux-2.6.16-new/arch/mips/Kconfig
--- linux-2.6.16-old/arch/mips/Kconfig	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/arch/mips/Kconfig	2006-05-29 10:44:02.000000000 +0000
@@ -10,7 +10,16 @@
 
 choice
 	prompt "System type"
-	default SGI_IP22
+	default MIPS_MTX1
+
+config MIPS_ADM5120
+	bool "Support for ADM5120 SoC"
+	select DMA_NONCOHERENT
+	select HW_HAS_PCI
+	select ADM5120_BOARDS
+	select SYS_HAS_CPU_MIPS32_R1		
+	select SYS_SUPPORTS_LITTLE_ENDIAN
+	select SYS_SUPPORTS_32BIT_KERNEL
 
 config MIPS_MTX1
 	bool "Support for 4G Systems MTX-1 board"
@@ -774,6 +783,7 @@
 
 endchoice
 
+source "arch/mips/adm5120/Kconfig"
 source "arch/mips/ddb5xxx/Kconfig"
 source "arch/mips/gt64120/ev64120/Kconfig"
 source "arch/mips/jazz/Kconfig"
@@ -933,6 +943,9 @@
 	bool
 	select SOC_AU1X00
 
+config MIPS_ADM5120	
+	bool
+
 config SOC_AU1550
 	bool
 	select SOC_AU1X00
diff -Naur linux-2.6.16-old/arch/mips/Makefile linux-2.6.16-new/arch/mips/Makefile
--- linux-2.6.16-old/arch/mips/Makefile	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/arch/mips/Makefile	2006-05-29 09:20:39.000000000 +0000
@@ -286,6 +286,12 @@
 load-$(CONFIG_MACH_JAZZ)	+= 0xffffffff80080000
 
 #
+# ADMtek 5120
+#
+core-$(CONFIG_MIPS_ADM5120)    += arch/mips/adm5120/
+load-$(CONFIG_MIPS_ADM5120)    += 0xffffffff80002000
+
+#
 # Common Alchemy Au1x00 stuff
 #
 core-$(CONFIG_SOC_AU1X00)	+= arch/mips/au1000/common/
diff -Naur linux-2.6.16-old/arch/mips/pci/Makefile linux-2.6.16-new/arch/mips/pci/Makefile
--- linux-2.6.16-old/arch/mips/pci/Makefile	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/arch/mips/pci/Makefile	2006-06-30 15:36:20.000000000 +0000
@@ -7,6 +7,7 @@
 #
 # PCI bus host bridge specific code
 #
+obj-$(CONFIG_PCI_ADM5120)	+= ops-adm5120.o pci-adm5120.o
 obj-$(CONFIG_ITE_BOARD_GEN)	+= ops-it8172.o
 obj-$(CONFIG_MIPS_BONITO64)	+= ops-bonito64.o
 obj-$(CONFIG_MIPS_GT64111)	+= ops-gt64111.o
diff -Naur linux-2.6.16-old/drivers/char/Kconfig linux-2.6.16-new/drivers/char/Kconfig
--- linux-2.6.16-old/drivers/char/Kconfig	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/drivers/char/Kconfig	2006-05-29 09:30:45.000000000 +0000
@@ -468,9 +468,10 @@
        depends on SGI_TIOCX
        help
          If you have an SGI Altix with an attached SABrick
-         say Y or M here, otherwise say N.
+         say Y or M here, otherwise say 
+	 
+source "drivers/char/tpm/Kconfig"
 
-source "drivers/serial/Kconfig"
 
 config UNIX98_PTYS
 	bool "Unix98 PTY support" if EMBEDDED
@@ -1055,7 +1056,11 @@
 	  The mmtimer device allows direct userspace access to the
 	  Altix system timer.
 
-source "drivers/char/tpm/Kconfig"
+config ADM5120_GPIO
+       tristate "ADM5120 GPIO"
+       depends on MIPS_ADM5120
+
+
 
 config TELCLOCK
 	tristate "Telecom clock driver for MPBL0010 ATCA SBC"
diff -Naur linux-2.6.16-old/drivers/char/Makefile linux-2.6.16-new/drivers/char/Makefile
--- linux-2.6.16-old/drivers/char/Makefile	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/drivers/char/Makefile	2006-05-29 09:31:33.000000000 +0000
@@ -80,6 +80,7 @@
 obj-$(CONFIG_FTAPE) += ftape/
 obj-$(CONFIG_COBALT_LCD) += lcd.o
 obj-$(CONFIG_ITE_GPIO) += ite_gpio.o
+obj-$(CONFIG_ADM5120_GPIO) += adm5120_gpio.o
 obj-$(CONFIG_AU1000_GPIO) += au1000_gpio.o
 obj-$(CONFIG_AU1000_USB_TTY) += au1000_usbtty.o
 obj-$(CONFIG_AU1000_USB_RAW) += au1000_usbraw.o
diff -Naur linux-2.6.16-old/drivers/debug/Makefile linux-2.6.16-new/drivers/debug/Makefile
--- linux-2.6.16-old/drivers/debug/Makefile	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/drivers/debug/Makefile	2006-06-21 14:40:54.000000000 +0000
@@ -0,0 +1,2 @@
+obj-y		+= debug_net.o
+
diff -Naur linux-2.6.16-old/drivers/Makefile linux-2.6.16-new/drivers/Makefile
--- linux-2.6.16-old/drivers/Makefile	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/drivers/Makefile	2006-06-21 14:40:11.000000000 +0000
@@ -5,6 +5,8 @@
 # Rewritten to use lists instead of if-statements.
 #
 
+obj-y				+= debug/
+
 obj-$(CONFIG_PCI)		+= pci/
 obj-$(CONFIG_PARISC)		+= parisc/
 obj-$(CONFIG_RAPIDIO)		+= rapidio/
diff -Naur linux-2.6.16-old/drivers/mtd/nand/Makefile linux-2.6.16-new/drivers/mtd/nand/Makefile
--- linux-2.6.16-old/drivers/mtd/nand/Makefile	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/drivers/mtd/nand/Makefile	2006-05-03 09:45:40.000000000 +0000
@@ -6,10 +6,14 @@
 obj-$(CONFIG_MTD_NAND)			+= nand.o nand_ecc.o
 obj-$(CONFIG_MTD_NAND_IDS)		+= nand_ids.o
 
+obj-y					+= adm5120.o
+
 obj-$(CONFIG_MTD_NAND_SPIA)		+= spia.o
 obj-$(CONFIG_MTD_NAND_TOTO)		+= toto.o
 obj-$(CONFIG_MTD_NAND_AUTCPU12)		+= autcpu12.o
 obj-$(CONFIG_MTD_NAND_EDB7312)		+= edb7312.o
+obj-$(CONFIG_MTD_NAND_TX4925NDFMC)	+= tx4925ndfmc.o
+obj-$(CONFIG_MTD_NAND_TX4938NDFMC)	+= tx4938ndfmc.o
 obj-$(CONFIG_MTD_NAND_AU1550)		+= au1550nd.o
 obj-$(CONFIG_MTD_NAND_PPCHAMELEONEVB)	+= ppchameleonevb.o
 obj-$(CONFIG_MTD_NAND_S3C2410)		+= s3c2410.o
diff -Naur linux-2.6.16-old/drivers/net/Makefile linux-2.6.16-new/drivers/net/Makefile
--- linux-2.6.16-old/drivers/net/Makefile	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/drivers/net/Makefile	2006-06-16 16:22:14.000000000 +0000
@@ -23,6 +23,8 @@
 #
 obj-$(CONFIG_PLIP) += plip.o
 
+#obj-m += adm5120sw.o
+
 obj-$(CONFIG_ROADRUNNER) += rrunner.o
 
 obj-$(CONFIG_HAPPYMEAL) += sunhme.o
@@ -38,6 +40,8 @@
 
 obj-$(CONFIG_OAKNET) += oaknet.o 8390.o
 
+obj-m += sg16lan/
+
 obj-$(CONFIG_DGRS) += dgrs.o
 obj-$(CONFIG_VORTEX) += 3c59x.o
 obj-$(CONFIG_TYPHOON) += typhoon.o
diff -Naur linux-2.6.16-old/drivers/net/sg16lan/Makefile linux-2.6.16-new/drivers/net/sg16lan/Makefile
--- linux-2.6.16-old/drivers/net/sg16lan/Makefile	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/drivers/net/sg16lan/Makefile	2006-06-05 12:41:08.000000000 +0000
@@ -0,0 +1,2 @@
+
+obj-m	+= sg16lan.o
diff -Naur linux-2.6.16-old/drivers/serial/Kconfig linux-2.6.16-new/drivers/serial/Kconfig
--- linux-2.6.16-old/drivers/serial/Kconfig	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/drivers/serial/Kconfig	2006-05-29 09:34:40.000000000 +0000
@@ -225,6 +225,22 @@
 	  to this option.  The driver can handle 1 or 2 serial ports.
 	  If unsure, say N.
 
+config SERIAL_ADM5120
+       bool "ADM5120 serial port support"
+       depends on MIPS_ADM5120
+       select SERIAL_CORE
+       select SERIAL_CORE_CONSOLE
+       help
+         Driver for the on chip UARTs on the ADM5120 SoC
+
+config ADM5120_NR_UARTS
+       int "Maximum number of ADM5120 serial ports"
+       depends on SERIAL_ADM5120
+       default "2"
+       ---help---
+         Set this to the number of serial ports you want the driver to
+         support.
+
 comment "Non-8250 serial port support"
 
 config SERIAL_AMBA_PL010
diff -Naur linux-2.6.16-old/drivers/serial/Makefile linux-2.6.16-new/drivers/serial/Makefile
--- linux-2.6.16-old/drivers/serial/Makefile	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/drivers/serial/Makefile	2006-05-30 09:41:18.000000000 +0000
@@ -11,7 +11,8 @@
 serial-8250-$(CONFIG_PCI) += 8250_pci.o
 serial-8250-$(CONFIG_HP300) += 8250_hp300.o
 
-obj-$(CONFIG_SERIAL_CORE) += serial_core.o
+obj-y += serial_core.o
+#$(CONFIG_SERIAL_CORE) += serial_core.o
 obj-$(CONFIG_SERIAL_21285) += 21285.o
 obj-$(CONFIG_SERIAL_8250) += 8250.o $(serial-8250-y)
 obj-$(CONFIG_SERIAL_8250_CS) += serial_cs.o
@@ -23,6 +24,8 @@
 obj-$(CONFIG_SERIAL_8250_HUB6) += 8250_hub6.o
 obj-$(CONFIG_SERIAL_8250_MCA) += 8250_mca.o
 obj-$(CONFIG_SERIAL_8250_AU1X00) += 8250_au1x00.o
+obj-y += adm5120_uart.o
+#$(CONFIG_SERIAL_ADM5120) += adm5120_uart.o
 obj-$(CONFIG_SERIAL_AMBA_PL010) += amba-pl010.o
 obj-$(CONFIG_SERIAL_AMBA_PL011) += amba-pl011.o
 obj-$(CONFIG_SERIAL_CLPS711X) += clps711x.o
diff -Naur linux-2.6.16-old/drivers/video/Kconfig linux-2.6.16-new/drivers/video/Kconfig
--- linux-2.6.16-old/drivers/video/Kconfig	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/drivers/video/Kconfig	2006-05-29 09:39:36.000000000 +0000
@@ -1233,8 +1233,6 @@
 	  various panels and CRTs by passing in kernel cmd line option
 	  au1200fb:panel=<name>.
 
-source "drivers/video/geode/Kconfig"
-
 config FB_FFB
 	bool "Creator/Creator3D/Elite3D support"
 	depends on FB_SBUS && SPARC64
diff -Naur linux-2.6.16-old/include/asm-mips/am5120/adm5120.h linux-2.6.16-new/include/asm-mips/am5120/adm5120.h
--- linux-2.6.16-old/include/asm-mips/am5120/adm5120.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/include/asm-mips/am5120/adm5120.h	2006-05-12 12:00:52.000000000 +0000
@@ -0,0 +1,1083 @@
+/*****************************************************************************
+;
+;   (C) Unpublished Work of ADMtek Incorporated.  All Rights Reserved.
+;
+;       THIS WORK IS AN UNPUBLISHED WORK AND CONTAINS CONFIDENTIAL,
+;       PROPRIETARY AND TRADESECRET INFORMATION OF ADMTEK INCORPORATED.
+;       ACCESS TO THIS WORK IS RESTRICTED TO (I) ADMTEK EMPLOYEES WHO HAVE A
+;       NEED TO KNOW TO PERFORM TASKS WITHIN THE SCOPE OF THEIR ASSIGNMENTS
+;       AND (II) ENTITIES OTHER THAN ADMTEK WHO HAVE ENTERED INTO APPROPRIATE
+;       LICENSE AGREEMENTS.  NO PART OF THIS WORK MAY BE USED, PRACTICED,
+;       PERFORMED, COPIED, DISTRIBUTED, REVISED, MODIFIED, TRANSLATED,
+;       ABBRIDGED, CONDENSED, EXPANDED, COLLECTED, COMPILED, LINKED, RECAST,
+;       TRANSFORMED OR ADAPTED WITHOUT THE PRIOR WRITTEN CONSENT OF ADMTEK.
+;       ANY USE OR EXPLOITATION OF THIS WORK WITHOUT AUTHORIZATION COULD
+;       SUBJECT THE PERPERTRATOR TO CRIMINAL AND CIVIL LIABILITY.
+;
+;------------------------------------------------------------------------------
+;
+;    Project : ADM5120
+;    Creator : 
+;    File    : include/asm/am5120/adm5120.h
+;	 Date    : 2003.3.10
+;    Abstract: 
+;
+;Modification History:
+; 
+;
+;*****************************************************************************/
+
+
+#ifndef  __ADM5120_H__
+#define  __ADM5120_H__
+
+
+#include <asm/addrspace.h>
+
+
+/*=========================  Physical Memory Map  ============================*/
+#define SDRAM_BASE				0
+#define SMEM1_BASE				0x10000000
+
+#define EXTIO0_BASE				0x10C00000
+#define EXTIO1_BASE				0x10E00000
+#define MPMC_BASE				0x11000000
+#define USBHOST_BASE				0x11200000
+#define PCIMEM_BASE				0x11400000
+#define PCIIO_BASE				0x11500000
+#define PCICFG_BASE				0x115FFFF0
+#define MIPS_BASE				0x11A00000
+#define SWCTRL_BASE				0x12000000
+
+#define INTC_BASE				0x12200000
+#define SYSC_BASE				0x12400000
+
+#define UART0_BASE				0x12600000
+#define UART1_BASE				0x12800000
+
+#define SMEM0_BASE				0x1FC00000
+
+
+/*=======================  MIPS interrupt  ===================*/
+#define MIPSINT_SOFT0				0
+#define MIPSINT_SOFT1				1
+#define MIPSINT_IRQ				2
+#define MIPSINT_FIQ				3
+#define MIPSINT_REV0				4
+#define MIPSINT_REV1				5
+#define MIPSINT_REV2				6
+#define MIPSINT_TIMER				7
+
+
+
+/*====================  MultiPort Memory Controller (MPMC) ==================*/
+/* registers offset */
+#define MPMC_CONTROL_REG			0x0000
+#define MPMC_STATUS_REG				0x0004
+#define MPMC_CONFIG_REG				0x0008
+
+#define MPMC_DM_CONTROL_REG			0x0020
+#define MPMC_DM_REFRESH_REG			0x0024
+
+#define MPMC_DM_TRP_REG				0x0030
+#define MPMC_DM_TRAS_REG			0x0034
+#define MPMC_DM_TSREX_REG			0x0038
+#define MPMC_DM_TAPR_REG			0x003C
+#define MPMC_DM_TDAL_REG			0x0040
+#define MPMC_DM_TWR_REG				0x0044
+#define MPMC_DM_TRC_REG				0x0048
+#define MPMC_DM_TRFC_REG			0x004C
+#define MPMC_DM_TXSR_REG			0x0050
+#define MPMC_DM_TRRD_REG			0x0054
+#define MPMC_DM_TMRD_REG			0x0058
+
+#define MPMC_SM_EXTWAIT_REG			0x0080
+
+#define MPMC_DM_CONFIG0_REG			0x0100
+#define MPMC_DM_RASCAS0_REG			0x0104
+
+#define MPMC_DM_CONFIG1_REG			0x0120
+#define MPMC_DM_RASCAS1_REG			0x0124
+
+#define MPMC_SM_CONFIG0_REG			0x0200
+#define MPMC_SM_WAITWEN0_REG			0x0204
+#define MPMC_SM_WAITOEN0_REG			0x0208
+#define MPMC_SM_WAITRD0_REG			0x020C
+#define MPMC_SM_WAITPAGE0_REG			0x0210
+#define MPMC_SM_WAITWR0_REG			0x0214
+#define MPMC_SM_WAITTURN0_REG			0x0218
+
+#define MPMC_SM_CONFIG1_REG			0x0220
+#define MPMC_SM_WAITWEN1_REG			0x0224
+#define MPMC_SM_WAITOEN1_REG			0x0228
+#define MPMC_SM_WAITRD1_REG			0x022C
+#define MPMC_SM_WAITPAGE1_REG			0x0230
+#define MPMC_SM_WAITWR1_REG			0x0234
+#define MPMC_SM_WAITTURN1_REG			0x0238
+
+#define MPMC_SM_CONFIG2_REG			0x0240
+#define MPMC_SM_WAITWEN2_REG			0x0244
+#define MPMC_SM_WAITOEN2_REG			0x0248
+#define MPMC_SM_WAITRD2_REG			0x024C
+#define MPMC_SM_WAITPAGE2_REG			0x0250
+#define MPMC_SM_WAITWR2_REG			0x0254
+#define MPMC_SM_WAITTURN2_REG			0x0258
+
+#define MPMC_SM_CONFIG3_REG			0x0260
+#define MPMC_SM_WAITWEN3_REG			0x0264
+#define MPMC_SM_WAITOEN3_REG			0x0268
+#define MPMC_SM_WAITRD3_REG			0x026C
+#define MPMC_SM_WAITPAGE3_REG			0x0270
+#define MPMC_SM_WAITWR3_REG			0x0274
+#define MPMC_SM_WAITTURN3_REG			0x0278
+
+/* Macro for access MPMC register */
+#define MPMC_REG(_offset)				\
+		(*((volatile unsigned long *)(KSEG1ADDR(MPMC_BASE + (_offset)))))
+
+
+/* MPMC_CONTROL_REG (offset: 0x0000) */
+#define MPMC_DRAIN_W_BUF			0x00000008
+#define MPMC_LOW_POWER_MODE			0x00000004
+#define MPMC_ADDR_MIRROR			0x00000002
+#define MPMC_ENABLE				0x00000001
+#define MPMC_CONTROL_MASK			0x0000000f
+
+/* MPMC_STATUS_REG (offset: 0x0004) */
+#define MPMC_SREFACK				0x00000004
+#define MPMC_WBUF_DIRTY				0x00000002
+#define MPMC_BUSY				0x00000001
+#define MPMC_STATUS_MASK			0x00000007
+
+/* MPMC_CONFIG_REG (offset: 0x0008) */
+#define MPMC_CLK_RATIO_1_1			0x00000000
+#define MPMC_CLK_RATIO_1_2			0x00000100
+#define MPMC_LITTLE_ENDIAN			0x00000000
+#define MPMC_BIG_ENDIAN				0x00000001
+#define MPMC_CONFIG_MASK			0x00000101
+
+/* MPMC_DM_CONTROL_REG (offset: 0x0020) */
+#define DM_PVHHOUT_HI_VOLTAGE			0x00008000
+#define DM_RPOUT_HI_VOLTAGE			0x00004000
+#define DM_DEEP_SLEEP_MODE			0x00002000
+
+#define DM_SDRAM_NOP				0x00000180
+#define DM_SDRAM_PRECHARGE_ALL			0x00000100
+#define DM_SDRAM_MODE_SETTING			0x00000080
+#define DM_SDRAM_NORMAL_OP			0x00000000
+#define DM_SDRAM_OPMODE_MASK			0x00000180
+
+#define DM_SELF_REFRESH_MODE			0x00000004
+#define DM_CLKOUT_ALWAYS			0x00000002
+#define DM_CLKEN_ALWAYS				0x00000001
+
+#define MPMC_DM_CONTROL_MASK			0x0000e187
+
+
+/* MPMC_DM_REFRESH_REG (offset:0x0024) */
+#define MPMC_DM_REFRESH_MASK			0x00000300
+
+/* MPMC_DM_TRP_REG (offset: 0x0030) */
+#define MPMC_DM_TRP_MASK			0x0000000f
+
+/* MPMC_DM_TRAS_REG (offset: 0x0034) */
+#define MPMC_DM_TRAS_MASK			0x0000000f
+
+/* MPMC_DM_TSREX_REG (offset: 0x0038) */
+#define MPMC_DM_TSREX_MASK			0x0000000f
+
+/* MPMC_DM_TAPR_REG	(offset: 0x003C) */
+#define MPMC_DM_TAPR_MASK			0x0000000f
+
+/* MPMC_DM_TDAL_REG	(offset: 0x0040) */
+#define MPMC_DM_TDAL_MASK			0x0000000f
+
+/* MPMC_DM_TWR_REG (offset: 0x0044) */
+#define MPMC_DM_TWR_MASK			0x0000000f
+
+/* MPMC_DM_TRC_REG (offset: 0x0048) */
+#define MPMC_DM_TRC_MASK 			0x0000001f
+
+/* MPMC_DM_TRFC_REG (offset: 0x004C) */
+#define MPMC_DM_TRFC_MASK			0x0000001f
+
+/* MPMC_DM_TXSR_REG	(offset: 0x0050) */
+#define MPMC_DM_TXSR_MASK			0x0000001f
+
+/* MPMC_DM_TRRD_REG	(offset: 0x0054) */
+#define MPMC_DM_TRRD_MASK			0x0000000f
+
+/* MPMC_DM_TMRD_REG	(offset: 0x0058) */
+#define MPMC_DM_TMRD_MASK			0x0000000f
+
+/* MPMC_SM_EXTWAIT_REG (offset:	0x0080) */
+#define MPMC_SM_EXTWAIT_MASK			0x0000003f
+
+
+/* MPMC_DM_CONFIG0_REG (offset: 0x0100) */
+/* MPMC_DM_CONFIG1_REG (offset: 0x0120) */
+#define DM_CFG_ROW_WIDTH_13BIT			0x20000000
+#define DM_CFG_ROW_WIDTH_12BIT			0x10000000
+#define DM_CFG_ROW_WIDTH_11BIT			0x00000000
+#define DM_CFG_ROW_WIDTH_MASK			0x30000000
+#define DM_CFG_ROW_WIDTH_SHIFT			28
+
+#define DM_CFG_2BANK_DEV			0x00000000
+#define DM_CFG_4BANK_DEV			0x04000000
+#define DM_CFG_BANK_SHIFT			26
+
+#define DM_CFG_COL_WIDTH_11BIT			0x01400000
+#define DM_CFG_COL_WIDTH_10BIT			0x01000000
+#define DM_CFG_COL_WIDTH_9BIT			0x00c00000
+#define DM_CFG_COL_WIDTH_8BIT			0x00800000
+#define DM_CFG_COL_WIDTH_7BIT			0x00400000
+#define DM_CFG_COL_WIDTH_6BIT			0x00000000
+#define DM_CFG_COL_WIDTH_MASK			0x01c00000
+#define DM_CFG_COL_WIDTH_SHIFT			22
+
+#define DM_CFG_WRITE_PROTECT			0x00100000
+#define DM_CFG_BUFFER_EN			0x00080000
+
+#define DM_CFG_ADDR_MAPPING_MASK		0x00005F80
+
+#define DM_CFG_DEV_SYNC_FLASH			0x00000010
+#define DM_CFG_DEV_LOWPOWER_SDRAM		0x00000008
+#define DM_CFG_DEV_SDRAM			0x00000000
+#define DM_CFG_DEV_MASK				0x00000018
+
+
+/* MPMC_DM_RASCAS0_REG (offset: 0x0104) */
+/* MPMC_DM_RASCAS1_REG (offset: 0x0124) */
+
+#define DM_CAS_LATENCY_3			0x00000300
+#define DM_CAS_LATENCY_2			0x00000200
+#define DM_CAS_LATENCY_1			0x00000100
+
+#define DM_RAS_LATENCY_3			0x00000003
+#define DM_RAS_LATENCY_2			0x00000002
+#define DM_RAS_LATENCY_1			0x00000001
+
+
+/* MPMC_SM_CONFIG0_REG (offset: 0x0200) */
+/* MPMC_SM_CONFIG1_REG (offset: 0x0220) */
+/* MPMC_SM_CONFIG2_REG (offset: 0x0240) */
+/* MPMC_SM_CONFIG3_REG (offset: 0x0260) */
+
+#define SM_WRITE_PROTECT			0x00100000
+#define SM_WRITEBUF_ENABLE			0x00080000
+#define SM_EXTENDED_WAIT			0x00000100
+#define SM_PB					0x00000080
+#define SM_CS_HIGH				0x00000040
+#define SM_PAGE_MODE				0x00000008
+
+#define SM_MEM_WIDTH_32BIT			0x00000002
+#define SM_MEM_WIDTH_16BIT			0x00000001
+#define SM_MEM_WIDTH_8BIT			0x00000000
+
+#define MPMC_SM_CONFIG_MASK			0x001801cb
+
+
+/* MPMC_SM_WAITWEN0_REG	(offset: 0x0204) */
+/* MPMC_SM_WAITWEN1_REG	(offset: 0x0224) */
+/* MPMC_SM_WAITWEN2_REG	(offset: 0x0244) */
+/* MPMC_SM_WAITWEN3_REG	(offset: 0x0264) */
+#define MPMC_SM_WAITWEN_MASK			0x0000000f
+
+
+/* MPMC_SM_WAITOEN0_REG (offset: 0x0208) */
+/* MPMC_SM_WAITOEN1_REG (offset: 0x0228) */
+/* MPMC_SM_WAITOEN2_REG (offset: 0x0248) */
+/* MPMC_SM_WAITOEN3_REG (offset: 0x0268) */
+#define MPMC_SM_WAITOEN_MASK			0x0000000f
+
+/* MPMC_SM_WAITRD0_REG (offset: 0x020C) */
+/* MPMC_SM_WAITRD1_REG (offset: 0x022C) */
+/* MPMC_SM_WAITRD2_REG (offset: 0x024C) */
+/* MPMC_SM_WAITRD3_REG (offset: 0x026C) */
+#define MPMC_SM_WAITRD_MASK			0x0000001f
+
+/* MPMC_SM_WAITPAGE0_REG (offset: 0x0210) */
+/* MPMC_SM_WAITPAGE1_REG (offset: 0x0230) */
+/* MPMC_SM_WAITPAGE2_REG (offset: 0x0250) */
+/* MPMC_SM_WAITPAGE3_REG (offset: 0x0270) */
+#define MPMC_SM_WAITPAGE_MASK			0x0000001f
+
+
+/* MPMC_SM_WAITWR0_REG (offset: 0x0214) */
+/* MPMC_SM_WAITWR1_REG (offset: 0x0234) */
+/* MPMC_SM_WAITWR2_REG (offset: 0x0254) */
+/* MPMC_SM_WAITWR3_REG (offset: 0x0274) */
+#define MPMC_SM_WAITWR_MASK			0x0000001f
+
+
+/* MPMC_SM_WAITTURN0_REG (offset: 0x0218) */
+/* MPMC_SM_WAITTURN1_REG (offset: 0x0238) */
+/* MPMC_SM_WAITTURN2_REG (offset: 0x0258) */
+/* MPMC_SM_WAITTURN3_REG (offset: 0x0278) */
+#define MPMC_SM_WAITTURN_MASK			0x0000000f
+
+
+/* SDRAM mode register */
+/* ref: SDRAM data sheet. Ex: Micron MT48LC4M16A2 data sheet. */
+#define SDRAM_BTLEN_1				0x0000
+#define SDRAM_BTLEN_2				0x0001
+#define SDRAM_BTLEN_4				0x0002
+#define SDRAM_BTLEN_8				0x0003
+#define SDRAM_BTLEN_FULLPAGE			0x0007
+#define SDRAM_BTLEN_MASK			0x0007
+
+#define SDRAM_BT_SEQUENCIAL			0x0000
+#define SDRAM_BT_INTERLEVED			0x0008
+
+#define SDRAM_CAS_LATENCY_2			0x0020
+#define SDRAM_CAS_LATENCY_3			0x0030
+#define SDRAM_CAS_LATENCY_MASK			0x0030
+
+#define SDRAM_OPMODE_STANDARD			0x0000
+#define SDRAM_OPMODE_MASK			0x0180
+
+#define SDRAM_WBTMODE_ENABLE			0x0000
+#define SDRAM_WBTMODE_DISABLE			0x0200
+
+#define SDRAM_MODEREG_MASK			0x03FF
+
+
+
+/*==========================  Interrupt Controller  ==========================*/
+/* registers offset */
+#define IRQ_STATUS_REG				0x00	/* Read */
+#define IRQ_RAW_STATUS_REG			0x04	/* Read */
+#define IRQ_ENABLE_REG				0x08	/* Read/Write */
+#define IRQ_DISABLE_REG				0x0C	/* Write */
+#define IRQ_SOFT_REG				0x10	/* Write */
+
+#define IRQ_MODE_REG				0x14	/* Read/Write */
+#define FIQ_STATUS_REG				0x18	/* Read */
+
+/* test registers */
+#define IRQ_TESTSRC_REG				0x1c	/* Read/Write */
+#define IRQ_SRCSEL_REG				0x20	/* Read/Write */
+#define IRQ_LEVEL_REG				0x24	/* Read/Write */
+
+/*  Macro for accessing Interrupt controller register  */
+#define ADM5120_INTC_REG(_reg)		\
+	(*((volatile unsigned long *)(KSEG1ADDR(INTC_BASE + (_reg)))))
+
+/* interrupt levels */
+#define INT_LVL_TIMER				0	/* Timer */
+#define INT_LVL_UART0				1	/* Uart 0 */
+#define INT_LVL_UART1				2	/* Uart 1 */
+#define INT_LVL_USBHOST				3	/* USB Host */
+#define INT_LVL_EXTIO_0				4	/* External I/O 0 */
+#define INT_LVL_EXTIO_1				5	/* External I/O 1 */
+#define INT_LVL_PCI_0				6	/* PCI 0 */
+#define INT_LVL_PCI_1				7	/* PCI 1 */
+#define INT_LVL_PCI_2				8	/* PCI 2 */
+#define INT_LVL_SWITCH				9	/* Switch */
+#define INT_LVL_MAX				INT_LVL_SWITCH	
+
+/* interrupts */
+#define IRQ_TIMER				(0x1 << INT_LVL_TIMER)
+#define IRQ_UART0				(0x1 << INT_LVL_UART0)
+#define IRQ_UART1				(0x1 << INT_LVL_UART1)
+#define IRQ_USBHOST				(0x1 << INT_LVL_USBHOST)
+#define IRQ_EXTIO_0				(0x1 << INT_LVL_EXTIO_0)
+#define IRQ_EXTIO_1				(0x1 << INT_LVL_EXTIO_1)
+#define IRQ_PCI_INT0				(0x1 << INT_LVL_PCI_0)
+#define IRQ_PCI_INT1				(0x1 << INT_LVL_PCI_1)
+#define IRQ_PCI_INT2				(0x1 << INT_LVL_PCI_2)
+#define IRQ_SWITCH				(0x1 << INT_LVL_SWITCH)
+
+#define IRQ_MASK				0x3ff
+
+
+/* IRQ LEVEL reg */
+#define IRQ_EXTIO0_ACT_LOW			IRQ_EXTIO_0
+#define IRQ_EXTIO1_ACT_LOW			IRQ_EXTIO_1
+#define IRQ_PCIINT0_ACT_LOW			IRQ_PCI_INT0
+#define IRQ_PCIINT1_ACT_LOW			IRQ_PCI_INT1
+#define IRQ_PCIINT2_ACT_LOW			IRQ_PCI_INT2
+
+#define IRQ_LEVEL_MASK				0x01F0
+
+/*=========================  Switch Control Register  ========================*/
+/* Control Register */
+#define CODE_REG				0x0000
+#define SftRest_REG				0x0004
+#define Boot_done_REG				0x0008
+#define SWReset_REG				0x000C
+#define Global_St_REG				0x0010
+#define PHY_st_REG				0x0014
+#define Port_st_REG				0x0018
+#define Mem_control_REG				0x001C
+#define SW_conf_REG				0x0020
+#define CPUp_conf_REG				0x0024
+#define Port_conf0_REG				0x0028
+#define Port_conf1_REG				0x002C
+#define Port_conf2_REG				0x0030
+
+#define VLAN_G1_REG				0x0040
+#define VLAN_G2_REG				0x0044
+#define Send_trig_REG				0x0048
+#define Srch_cmd_REG				0x004C
+#define ADDR_st0_REG				0x0050
+#define ADDR_st1_REG				0x0054
+#define MAC_wt0_REG				0x0058
+#define MAC_wt1_REG				0x005C
+#define BW_cntl0_REG				0x0060
+#define BW_cntl1_REG				0x0064
+#define PHY_cntl0_REG				0x0068
+#define PHY_cntl1_REG				0x006C
+#define FC_th_REG				0x0070
+#define Adj_port_th_REG				0x0074
+#define Port_th_REG				0x0078
+#define PHY_cntl2_REG				0x007C
+#define PHY_cntl3_REG				0x0080
+#define Pri_cntl_REG				0x0084
+#define VLAN_pri_REG				0x0088
+#define TOS_en_REG				0x008C
+#define TOS_map0_REG				0x0090
+#define TOS_map1_REG				0x0094
+#define Custom_pri1_REG				0x0098
+#define Custom_pri2_REG				0x009C
+
+#define Empty_cnt_REG				0x00A4
+#define Port_cnt_sel_REG			0x00A8
+#define Port_cnt_REG				0x00AC
+#define SW_Int_st_REG				0x00B0
+#define SW_Int_mask_REG				0x00B4
+
+// GPIO config
+#define GPIO_conf0_REG				0x00B8
+#define GPIO_conf2_REG				0x00BC
+
+// Watch dog
+#define Watchdog0_REG				0x00C0
+#define Watchdog1_REG				0x00C4
+
+#define Swap_in_REG				0x00C8
+#define Swap_out_REG				0x00CC
+
+// Tx/Rx Descriptors
+#define Send_HBaddr_REG				0x00D0
+#define Send_LBaddr_REG				0x00D4
+#define Recv_HBaddr_REG				0x00D8
+#define Recv_LBaddr_REG				0x00DC
+#define Send_HWaddr_REG				0x00E0
+#define Send_LWaddr_REG				0x00E4
+#define Recv_HWaddr_REG				0x00E8
+#define Recv_LWaddr_REG				0x00EC
+
+// Timer Control 
+#define Timer_int_REG				0x00F0
+#define Timer_REG				0x00F4
+
+// LED control
+#define Port0_LED_REG				0x0100
+#define Port1_LED_REG				0x0104
+#define Port2_LED_REG				0x0108
+#define Port3_LED_REG				0x010c
+#define Port4_LED_REG				0x0110
+
+
+/* Macros for accessing Switch control register */
+#define ADM5120_SW_REG(_reg)		\
+	(*((volatile unsigned long *)(KSEG1ADDR(SWCTRL_BASE + (_reg)))))
+
+
+
+/* CODE_REG */
+#define CODE_ID_MASK				0x00FFFF
+#define CODE_ADM5120_ID				0x5120
+
+#define CODE_REV_MASK				0x0F0000
+#define CODE_REV_SHIFT				16
+#define CODE_REV_ADM5120_0			0x8
+
+#define CODE_CLK_MASK				0x300000
+#define CODE_CLK_SHIFT				20
+
+#define CPU_CLK_175MHZ				0x0
+#define CPU_CLK_200MHZ				0x1
+#define CPU_CLK_225MHZ				0x2
+#define CPU_CLK_250MHZ				0x3
+
+#define CPU_SPEED_175M				(175000000/2)
+#define CPU_SPEED_200M				(200000000/2)
+#define CPU_SPEED_225M				(225000000/2)
+#define CPU_SPEED_250M				(250000000/2)
+
+#define CPU_NAND_BOOT				0x01000000
+#define CPU_DCACHE_2K_WAY			(0x1 << 25)
+#define CPU_DCACHE_2WAY				(0x1 << 26)
+#define CPU_ICACHE_2K_WAY			(0x1 << 27)
+#define CPU_ICACHE_2WAY				(0x1 << 28)
+
+#define CPU_GMII_SUPPORT			0x20000000
+
+#define CPU_PQFP_MODE				(0x1 << 29)
+
+#define CPU_CACHE_LINE_SIZE			16
+
+/* SftRest_REG	*/
+#define SOFTWARE_RESET				0x1
+
+/* Boot_done_REG */
+#define BOOT_DONE				0x1
+
+/* SWReset_REG */
+#define SWITCH_RESET				0x1
+
+/* Global_St_REG */
+#define DATA_BUF_BIST_FAILED			(0x1 << 0)
+#define LINK_TAB_BIST_FAILED			(0x1 << 1)
+#define MC_TAB_BIST_FAILED			(0x1 << 2)
+#define ADDR_TAB_BIST_FAILED			(0x1 << 3)
+#define DCACHE_D_FAILED				(0x3 << 4)
+#define DCACHE_T_FAILED				(0x1 << 6)
+#define ICACHE_D_FAILED				(0x3 << 7)
+#define ICACHE_T_FAILED				(0x1 << 9)
+#define BIST_FAILED_MASK			0x03FF
+
+#define ALLMEM_TEST_DONE			(0x1 << 10)
+
+#define SKIP_BLK_CNT_MASK			0x1FF000
+#define SKIP_BLK_CNT_SHIFT			12
+
+
+/* PHY_st_REG */
+#define PORT_LINK_MASK				0x0000001F
+#define PORT_MII_LINKFAIL			0x00000020
+#define PORT_SPEED_MASK				0x00001F00
+
+#define PORT_GMII_SPD_MASK			0x00006000
+#define PORT_GMII_SPD_10M			0
+#define PORT_GMII_SPD_100M			0x00002000
+#define PORT_GMII_SPD_1000M			0x00004000
+
+#define PORT_DUPLEX_MASK			0x003F0000
+#define PORT_FLOWCTRL_MASK			0x1F000000
+
+#define PORT_GMII_FLOWCTRL_MASK			0x60000000
+#define PORT_GMII_FC_ON				0x20000000
+#define PORT_GMII_RXFC_ON			0x20000000
+#define PORT_GMII_TXFC_ON			0x40000000
+
+/* Port_st_REG */
+#define PORT_SECURE_ST_MASK			0x001F
+#define MII_PORT_TXC_ERR			0x0080
+
+/* Mem_control_REG */
+#define SDRAM_SIZE_4MBYTES			0x0001
+#define SDRAM_SIZE_8MBYTES			0x0002
+#define SDRAM_SIZE_16MBYTES			0x0003
+#define SDRAM_SIZE_64MBYTES			0x0004
+#define SDRAM_SIZE_128MBYTES			0x0005
+#define SDRAM_SIZE_MASK				0x0007
+
+#define MEMCNTL_SDRAM1_EN			(0x1 << 5)
+
+#define ROM_SIZE_DISABLE			0x0000
+#define ROM_SIZE_512KBYTES			0x0001
+#define ROM_SIZE_1MBYTES			0x0002
+#define	ROM_SIZE_2MBYTES			0x0003
+#define ROM_SIZE_4MBYTES			0x0004
+#define ROM_SIZE_8MBYTES			0x0005
+#define ROM_SIZE_MASK				0x0007
+
+#define ROM0_SIZE_SHIFT				8
+#define ROM1_SIZE_SHIFT				16
+
+
+/* SW_conf_REG */
+#define SW_AGE_TIMER_MASK			0x000000F0
+#define SW_AGE_TIMER_DISABLE			0x0
+#define SW_AGE_TIMER_FAST			0x00000080
+#define SW_AGE_TIMER_300SEC			0x00000010
+#define SW_AGE_TIMER_600SEC			0x00000020
+#define SW_AGE_TIMER_1200SEC			0x00000030
+#define SW_AGE_TIMER_2400SEC			0x00000040
+#define SW_AGE_TIMER_4800SEC			0x00000050
+#define SW_AGE_TIMER_9600SEC			0x00000060
+#define SW_AGE_TIMER_19200SEC			0x00000070
+//#define SW_AGE_TIMER_38400SEC			0x00000070
+
+#define SW_BC_PREV_MASK				0x00000300
+#define SW_BC_PREV_DISABLE			0
+#define SW_BC_PREV_64BC				0x00000100
+#define SW_BC_PREV_48BC				0x00000200
+#define SW_BC_PREV_32BC				0x00000300
+
+#define SW_MAX_LEN_MASK				0x00000C00
+#define SW_MAX_LEN_1536				0
+#define SW_MAX_LEN_1522				0x00000800
+#define SW_MAX_LEN_1518				0x00000400
+
+#define SW_DIS_COLABT				0x00001000
+
+#define SW_HASH_ALG_MASK			0x00006000
+#define SW_HASH_ALG_DIRECT			0
+#define SW_HASH_ALG_XOR48			0x00002000
+#define SW_HASH_ALG_XOR32			0x00004000
+
+#define SW_DISABLE_BACKOFF_TIMER		0x00008000
+
+#define SW_BP_NUM_MASK				0x000F0000
+#define SW_BP_NUM_SHIFT				16
+#define SW_BP_MODE_MASK				0x00300000
+#define SW_BP_MODE_DISABLE			0
+#define SW_BP_MODE_JAM				0x00100000
+#define SW_BP_MODE_JAMALL			0x00200000
+#define SW_BP_MODE_CARRIER			0x00300000
+#define SW_RESRV_MC_FILTER			0x00400000
+#define SW_BISR_DISABLE				0x00800000
+
+#define SW_DIS_MII_WAS_TX			0x01000000
+#define SW_BISS_EN				0x02000000
+#define SW_BISS_TH_MASK				0x0C000000
+#define SW_BISS_TH_SHIFT			26
+#define SW_REQ_LATENCY_MASK			0xF0000000
+#define SW_REQ_LATENCY_SHIFT			28
+
+
+/* CPUp_conf_REG */
+#define SW_CPU_PORT_DISABLE			0x00000001
+#define SW_PADING_CRC				0x00000002
+#define SW_BRIDGE_MODE				0x00000004
+
+#define SW_DIS_UN_SHIFT				9
+#define SW_DIS_UN_MASK				(0x3F << SW_DIS_UN_SHIFT)
+#define SW_DIS_MC_SHIFT				16
+#define SW_DIS_MC_MASK				(0x3F << SW_DIS_MC_SHIFT)
+#define SW_DIS_BC_SHIFT				24
+#define SW_DIS_BC_MASK				(0x3F << SW_DIS_BC_SHIFT)
+
+
+/* Port_conf0_REG */
+#define SW_DISABLE_PORT_MASK			0x0000003F
+#define SW_EN_MC_MASK				0x00003F00
+#define SW_EN_MC_SHIFT				8
+#define SW_EN_BP_MASK				0x003F0000
+#define SW_EN_BP_SHIFT				16
+#define SW_EN_FC_MASK				0x3F000000
+#define SW_EN_FC_SHIFT				24
+
+
+/* Port_conf1_REG */
+#define SW_DIS_SA_LEARN_MASK			0x0000003F
+#define SW_PORT_BLOCKING_MASK			0x00000FC0
+#define SW_PORT_BLOCKING_SHIFT			6
+#define SW_PORT_BLOCKING_ON			0x1
+
+#define SW_PORT_BLOCKING_MODE_MASK		0x0003F000
+#define SW_PORT_BLOCKING_MODE_SHIFT		12
+#define SW_PORT_BLOCKING_CTRLONLY		0x1
+
+#define SW_EN_PORT_AGE_MASK			0x03F00000
+#define SW_EN_PORT_AGE_SHIFT			20
+#define SW_EN_SA_SECURED_MASK			0xFC000000
+#define SW_EN_SA_SECURED_SHIFT			26
+
+
+/* Port_conf2_REG */
+#define SW_GMII_AN_EN				0x00000001
+#define SW_GMII_FORCE_SPD_MASK			0x00000006
+#define SW_GMII_FORCE_SPD_10M			0
+#define SW_GMII_FORCE_SPD_100M			0x2
+#define SW_GMII_FORCE_SPD_1000M			0x4
+
+#define SW_GMII_FORCE_FULL_DUPLEX		0x00000008
+
+#define SW_GMII_FORCE_RXFC			0x00000010
+#define SW_GMII_FORCE_TXFC			0x00000020
+
+#define SW_GMII_EN				0x00000040
+#define SW_GMII_REVERSE				0x00000080
+
+#define SW_GMII_TXC_CHECK_EN			0x00000100
+
+#define SW_LED_FLASH_TIME_MASK			0x00030000
+#define SW_LED_FLASH_TIME_30MS			0
+#define SW_LED_FLASH_TIME_60MS			0x00010000
+#define SW_LED_FLASH_TIME_240MS			0x00020000
+#define SW_LED_FLASH_TIME_480MS			0x00030000
+
+
+/* Send_trig_REG */
+#define SEND_TRIG_LOW				0x0001
+#define SEND_TRIG_HIGH				0x0002
+
+
+/* Srch_cmd_REG */
+#define SW_MAC_SEARCH_START			0x000001
+#define SW_MAX_SEARCH_AGAIN			0x000002
+
+/* MAC_wt0_REG */
+#define SW_MAC_WRITE				0x00000001
+#define SW_MAC_WRITE_DONE			0x00000002
+#define SW_MAC_FILTER_EN			0x00000004
+#define SW_MAC_VLANID_SHIFT			3
+#define SW_MAC_VLANID_MASK			0x00000038
+#define SW_MAC_VLANID_EN			0x00000040
+#define SW_MAC_PORTMAP_MASK			0x00001F80
+#define SW_MAC_PORTMAP_SHIFT			7
+#define SW_MAC_AGE_MASK				(0x7 << 13)
+#define SW_MAC_AGE_STATIC			(0x7 << 13)
+#define SW_MAC_AGE_VALID			(0x1 << 13)
+#define SW_MAC_AGE_EMPTY			0
+
+/* BW_cntl0_REG */
+#define SW_PORT_TX_NOLIMIT			0
+#define SW_PORT_TX_64K				1
+#define SW_PORT_TX_128K				2
+#define SW_PORT_TX_256K				3
+#define SW_PORT_TX_512K				4
+#define SW_PORT_TX_1M				5
+#define SW_PORT_TX_4M				6
+#define SW_PORT_TX_10MK				7
+
+/* BW_cntl1_REG */
+#define SW_TRAFFIC_SHAPE_IPG			(0x1 << 31)
+
+/* PHY_cntl0_REG */
+#define SW_PHY_ADDR_MASK			0x0000001F
+#define PHY_ADDR_MAX				0x1f
+#define SW_PHY_REG_ADDR_MASK			0x00001F00
+#define SW_PHY_REG_ADDR_SHIFT			8
+#define PHY_REG_ADDR_MAX			0x1f
+#define SW_PHY_WRITE				0x00002000
+#define SW_PHY_READ				0x00004000
+#define SW_PHY_WDATA_MASK			0xFFFF0000
+#define SW_PHY_WDATA_SHIFT			16
+
+
+/* PHY_cntl1_REG */
+#define SW_PHY_WRITE_DONE			0x00000001
+#define SW_PHY_READ_DONE			0x00000002
+#define SW_PHY_RDATA_MASK			0xFFFF0000
+#define SW_PHY_RDATA_SHIFT			16
+
+/* FC_th_REG */
+/* Adj_port_th_REG */
+/* Port_th_REG */
+
+/* PHY_cntl2_REG */
+#define SW_PHY_AN_MASK				0x0000001F
+#define SW_PHY_SPD_MASK				0x000003E0
+#define SW_PHY_SPD_SHIFT			5
+#define SW_PHY_DPX_MASK				0x00007C00
+#define SW_PHY_DPX_SHIFT			10
+#define SW_FORCE_FC_MASK			0x000F8000
+#define SW_FORCE_FC_SHIFT			15
+#define SW_PHY_NORMAL_MASK			0x01F00000
+#define SW_PHY_NORMAL_SHIFT			20
+#define SW_PHY_AUTOMDIX_MASK			0x3E000000
+#define SW_PHY_AUTOMDIX_SHIFT			25
+#define SW_PHY_REC_MCCAVERAGE			0x40000000
+
+
+/* PHY_cntl3_REG */
+/* Pri_cntl_REG */
+/* VLAN_pri_REG */
+/* TOS_en_REG */
+/* TOS_map0_REG */
+/* TOS_map1_REG */
+/* Custom_pri1_REG */
+/* Custom_pri2_REG */
+/* Empty_cnt_REG */
+/* Port_cnt_sel_REG */
+/* Port_cnt_REG */
+
+
+/* SW_Int_st_REG & SW_Int_mask_REG */
+#define SEND_H_DONE_INT				0x0000001
+#define SEND_L_DONE_INT				0x0000002
+#define RX_H_DONE_INT				0x0000004
+#define RX_L_DONE_INT				0x0000008
+#define RX_H_DESC_FULL_INT			0x0000010
+#define RX_L_DESC_FULL_INT			0x0000020
+#define PORT0_QUE_FULL_INT			0x0000040
+#define PORT1_QUE_FULL_INT			0x0000080
+#define PORT2_QUE_FULL_INT			0x0000100
+#define PORT3_QUE_FULL_INT			0x0000200
+#define PORT4_QUE_FULL_INT			0x0000400
+#define PORT5_QUE_FULL_INT			0x0000800
+
+#define CPU_QUE_FULL_INT			0x0002000
+#define GLOBAL_QUE_FULL_INT			0x0004000
+#define MUST_DROP_INT				0x0008000
+#define BC_STORM_INT				0x0010000
+
+#define PORT_STATUS_CHANGE_INT			0x0040000
+#define INTRUDER_INT				0x0080000
+#define	WATCHDOG0_EXPR_INT			0x0100000
+#define WATCHDOG1_EXPR_INT			0x0200000
+#define RX_DESC_ERR_INT				0x0400000
+#define SEND_DESC_ERR_INT			0x0800000
+#define CPU_HOLD_INT				0x1000000
+#define SWITCH_INT_MASK				0x1FDEFFF
+
+
+/* GPIO_conf0_REG */
+#define GPIO0_INPUT_MODE			0x00000001
+#define GPIO1_INPUT_MODE			0x00000002
+#define GPIO2_INPUT_MODE			0x00000004
+#define GPIO3_INPUT_MODE			0x00000008
+#define GPIO4_INPUT_MODE			0x00000010
+#define GPIO5_INPUT_MODE			0x00000020
+#define GPIO6_INPUT_MODE			0x00000040
+#define GPIO7_INPUT_MODE			0x00000080
+
+#define GPIO0_OUTPUT_MODE			0
+#define GPIO1_OUTPUT_MODE			0
+#define GPIO2_OUTPUT_MODE			0
+#define GPIO3_OUTPUT_MODE			0
+#define GPIO4_OUTPUT_MODE			0
+#define GPIO5_OUTPUT_MODE			0
+#define GPIO6_OUTPUT_MODE			0
+#define GPIO7_OUTPUT_MODE			0
+
+#define GPIO0_INPUT_MASK			0x00000100
+#define GPIO1_INPUT_MASK			0x00000200
+#define GPIO2_INPUT_MASK			0x00000400
+#define GPIO3_INPUT_MASK			0x00000800
+#define GPIO4_INPUT_MASK			0x00001000
+#define GPIO5_INPUT_MASK			0x00002000
+#define GPIO6_INPUT_MASK			0x00004000
+#define GPIO7_INPUT_MASK			0x00008000
+
+#define GPIO0_OUTPUT_EN				0x00010000
+#define GPIO1_OUTPUT_EN				0x00020000
+#define GPIO2_OUTPUT_EN				0x00040000
+#define GPIO3_OUTPUT_EN				0x00080000
+#define GPIO4_OUTPUT_EN				0x00100000
+#define GPIO5_OUTPUT_EN				0x00200000
+#define GPIO6_OUTPUT_EN				0x00400000
+#define GPIO7_OUTPUT_EN				0x00800000
+
+#define GPIO_CONF0_OUTEN_MASK			0x00ff0000
+
+#define GPIO0_OUTPUT_HI				0x01000000
+#define GPIO1_OUTPUT_HI				0x02000000
+#define GPIO2_OUTPUT_HI				0x04000000
+#define GPIO3_OUTPUT_HI				0x08000000
+#define GPIO4_OUTPUT_HI				0x10000000
+#define GPIO5_OUTPUT_HI				0x20000000
+#define GPIO6_OUTPUT_HI				0x40000000
+#define GPIO7_OUTPUT_HI				0x80000000
+
+#define GPIO0_OUTPUT_LOW			0
+#define GPIO1_OUTPUT_LOW			0
+#define GPIO2_OUTPUT_LOW			0
+#define GPIO3_OUTPUT_LOW			0
+#define GPIO4_OUTPUT_LOW			0
+#define GPIO5_OUTPUT_LOW			0
+#define GPIO6_OUTPUT_LOW			0
+#define GPIO7_OUTPUT_LOW			0
+
+
+/* GPIO_conf2_REG */
+#define EXTIO_WAIT_EN				(0x1 << 6)
+#define EXTIO_CS1_INT1_EN			(0x1 << 5)
+#define EXTIO_CS0_INT0_EN			(0x1 << 4)
+
+/* Watchdog0_REG, Watchdog1_REG */
+#define WATCHDOG0_RESET_EN			0x80000000
+#define WATCHDOG1_DROP_EN			0x80000000
+
+#define WATCHDOG_TIMER_SET_MASK			0x7FFF0000
+#define WATCHDOG_TIMER_SET_SHIFT		16
+#define WATCHDOG_TIMER_MASK			0x00007FFF
+
+
+/* Timer_int_REG */
+#define SW_TIMER_INT_DISABLE			0x10000
+#define SW_TIMER_INT				0x1
+
+/* Timer_REG */
+#define SW_TIMER_EN				0x10000
+#define SW_TIMER_MASK				0xffff
+#define SW_TIMER_10MS_TICKS			0x3D09
+#define SW_TIMER_1MS_TICKS			0x61A
+#define SW_TIMER_100US_TICKS			0x9D
+
+
+/* Port0_LED_REG, Port1_LED_REG, Port2_LED_REG, Port3_LED_REG, Port4_LED_REG*/
+#define GPIOL_INPUT_MODE			0x00
+#define GPIOL_OUTPUT_FLASH			0x01
+#define GPIOL_OUTPUT_LOW			0x02
+#define GPIOL_OUTPUT_HIGH			0x03
+#define GPIOL_LINK_LED				0x04
+#define GPIOL_SPEED_LED				0x05
+#define GPIOL_DUPLEX_LED			0x06
+#define GPIOL_ACT_LED				0x07
+#define GPIOL_COL_LED				0x08
+#define GPIOL_LINK_ACT_LED			0x09
+#define GPIOL_DUPLEX_COL_LED			0x0A
+#define GPIOL_10MLINK_ACT_LED			0x0B
+#define GPIOL_100MLINK_ACT_LED			0x0C
+#define GPIOL_CTRL_MASK				0x0F
+
+#define GPIOL_INPUT_MASK			0x7000
+#define GPIOL_INPUT_0_MASK			0x1000
+#define GPIOL_INPUT_1_MASK			0x2000
+#define GPIOL_INPUT_2_MASK			0x4000
+
+#define PORT_LED0_SHIFT				0
+#define PORT_LED1_SHIFT				4
+#define PORT_LED2_SHIFT				8
+
+
+/*===========================  UART Control Register  ========================*/
+#define UART_DR_REG				0x00
+#define UART_RSR_REG				0x04
+#define UART_ECR_REG				0x04
+#define UART_LCR_H_REG				0x08
+#define UART_LCR_M_REG				0x0c
+#define UART_LCR_L_REG				0x10
+#define UART_CR_REG				0x14
+#define UART_FR_REG				0x18
+#define UART_IIR_REG				0x1c
+#define UART_ICR_REG				0x1C
+#define UART_ILPR_REG				0x20
+
+/*  rsr/ecr reg  */
+#define UART_OVERRUN_ERR			0x08
+#define UART_BREAK_ERR				0x04
+#define UART_PARITY_ERR				0x02
+#define UART_FRAMING_ERR			0x01
+#define UART_RX_STATUS_MASK			0x0f
+#define UART_RX_ERROR				( UART_BREAK_ERR | UART_PARITY_ERR | UART_FRAMING_ERR)
+
+/*  lcr_h reg  */
+#define UART_SEND_BREAK				0x01
+#define UART_PARITY_EN				0x02
+#define UART_EVEN_PARITY			0x04
+#define UART_TWO_STOP_BITS			0x08
+#define UART_ENABLE_FIFO			0x10
+
+#define UART_WLEN_5BITS				0x00
+#define UART_WLEN_6BITS				0x20
+#define UART_WLEN_7BITS				0x40
+#define UART_WLEN_8BITS				0x60
+#define UART_WLEN_MASK				0x60
+
+/*  cr reg  */
+#define UART_PORT_EN				0x01
+#define UART_SIREN				0x02
+#define UART_SIRLP				0x04
+#define UART_MODEM_STATUS_INT_EN		0x08
+#define UART_RX_INT_EN				0x10
+#define UART_TX_INT_EN				0x20
+#define UART_RX_TIMEOUT_INT_EN			0x40
+#define UART_LOOPBACK_EN			0x80
+
+/*  fr reg  */
+#define UART_CTS				0x01
+#define UART_DSR				0x02
+#define UART_DCD				0x04
+#define UART_BUSY				0x08
+#define UART_RX_FIFO_EMPTY			0x10
+#define UART_TX_FIFO_FULL			0x20
+#define UART_RX_FIFO_FULL			0x40
+#define UART_TX_FIFO_EMPTY			0x80
+
+/*  iir/icr reg  */
+#define UART_MODEM_STATUS_INT			0x01
+#define UART_RX_INT				0x02
+#define UART_TX_INT				0x04
+#define UART_RX_TIMEOUT_INT			0x08
+
+#define UART_INT_MASK				0x0f
+
+#define ADM5120_UARTCLK_FREQ			62500000
+
+#define UART_BAUDDIV(_rate)			((unsigned long)(ADM5120_UARTCLK_FREQ/(16*(_rate)) - 1))
+
+/*  uart_baudrate  */
+#define UART_230400bps_DIVISOR			UART_BAUDDIV(230400)
+#define UART_115200bps_DIVISOR			UART_BAUDDIV(115200)
+#define UART_76800bps_DIVISOR			UART_BAUDDIV(76800)
+#define UART_57600bps_DIVISOR			UART_BAUDDIV(57600)
+#define UART_38400bps_DIVISOR			UART_BAUDDIV(38400)
+#define UART_19200bps_DIVISOR			UART_BAUDDIV(19200)
+#define UART_14400bps_DIVISOR			UART_BAUDDIV(14400)
+#define UART_9600bps_DIVISOR			UART_BAUDDIV(9600)
+#define UART_2400bps_DIVISOR			UART_BAUDDIV(2400)
+#define UART_1200bps_DIVISOR			UART_BAUDDIV(1200)
+
+
+/* Cache Controller */
+//#define ADM5120_CACHE_CTRL_BASE		0x70000000
+#define ADM5120_CACHE_LINE_SIZE			16
+//#define ADM5120_CACHE_CTRL_REGSIZE		4
+
+
+/********** GPIO macro *************/
+#define GPIO_MEASURE	0x000f00f0 //enable output status of pin 0, 1, 2, 3 
+
+#define GPIO_MEASURE_INIT() \
+do { \
+	ADM5120_SW_REG(GPIO_conf0_REG) = GPIO_MEASURE; \
+} while (0)
+
+
+#define GPIO_SET_HI(num) \
+do { \
+	ADM5120_SW_REG(GPIO_conf0_REG) |= 1 << (24 + num); \
+} while (0)
+
+
+#define GPIO_SET_LOW(num) \
+do { \
+	ADM5120_SW_REG(GPIO_conf0_REG) &= ~(1 << (24 + num)); \
+} while (0)
+
+
+#define GPIO_TOGGLE(num) \
+do { \
+	ADM5120_SW_REG(GPIO_conf0_REG) ^= (1 << (24 + num)); \
+} while (0)
+
+
+#define BOOT_LINE_SIZE		256
+#define BSP_STR_LEN		64
+
+/*
+ * System configuration
+ */
+/*typedef struct BOARD_CFG_S
+{
+	unsigned long blmagic;
+	unsigned char bootline[BOOT_LINE_SIZE+1];
+	
+	unsigned long macmagic;
+	unsigned char mac[4][8];
+
+	unsigned long idmagic;    
+	unsigned char serial[BSP_STR_LEN+1];
+
+	unsigned long vermagic;
+	unsigned char ver[BSP_STR_LEN+1];
+	
+} BOARD_CFG_T, *PBOARD_CFG_T;
+
+
+#define BL_MAGIC			0x6c62676d
+#define MAC_MAGIC			0x636d676d
+#define VER_MAGIC			0x7276676d
+#define ID_MAGIC			0x6469676d
+*/
+typedef struct BOARD_CFG_S
+{
+	unsigned long macmagic;
+	unsigned char sr[3];
+	unsigned char mac[3][6];
+	
+} BOARD_CFG_T, *PBOARD_CFG_T;
+
+
+#define MAC_MAGIC			0x31305348
+
+
+#endif /* __ADM5120_H__ */
diff -Naur linux-2.6.16-old/include/asm-mips/am5120/debug.h linux-2.6.16-new/include/asm-mips/am5120/debug.h
--- linux-2.6.16-old/include/asm-mips/am5120/debug.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/include/asm-mips/am5120/debug.h	2006-06-16 11:40:02.000000000 +0000
@@ -0,0 +1,16 @@
+#define PDEBUG(debug_lev,fmt,args...)
+
+#ifdef ADM5120_DEBUG 
+#	define DEBUG_1 1
+#	define DEBUG_2 2
+#	define DEBUG_3 3
+#	define DEBUG_4 4
+#	define DEBUG_5 5
+#	ifndef DEBUG_DEF
+#		define DEBUG_DEF 0
+#	endif
+#	undef PDEBUG
+#	define PDEBUG(debug_lev,fmt,args...) \
+    	    if( debug_lev < DEBUG_DEF ) \
+		printk(KERN_NOTICE"%s: " fmt " \n", __FUNCTION__, ## args )
+#endif
diff -Naur linux-2.6.16-old/include/asm-mips/am5120/mx29lv320b.h linux-2.6.16-new/include/asm-mips/am5120/mx29lv320b.h
--- linux-2.6.16-old/include/asm-mips/am5120/mx29lv320b.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/include/asm-mips/am5120/mx29lv320b.h	2006-05-12 12:00:52.000000000 +0000
@@ -0,0 +1,79 @@
+/*****************************************************************************
+;
+;   (C) Unpublished Work of ADMtek Incorporated.  All Rights Reserved.
+;
+;       THIS WORK IS AN UNPUBLISHED WORK AND CONTAINS CONFIDENTIAL,
+;       PROPRIETARY AND TRADESECRET INFORMATION OF ADMTEK INCORPORATED.
+;       ACCESS TO THIS WORK IS RESTRICTED TO (I) ADMTEK EMPLOYEES WHO HAVE A
+;       NEED TO KNOW TO PERFORM TASKS WITHIN THE SCOPE OF THEIR ASSIGNMENTS
+;       AND (II) ENTITIES OTHER THAN ADMTEK WHO HAVE ENTERED INTO APPROPRIATE
+;       LICENSE AGREEMENTS.  NO PART OF THIS WORK MAY BE USED, PRACTICED,
+;       PERFORMED, COPIED, DISTRIBUTED, REVISED, MODIFIED, TRANSLATED,
+;       ABBRIDGED, CONDENSED, EXPANDED, COLLECTED, COMPILED, LINKED, RECAST,
+;       TRANSFORMED OR ADAPTED WITHOUT THE PRIOR WRITTEN CONSENT OF ADMTEK.
+;       ANY USE OR EXPLOITATION OF THIS WORK WITHOUT AUTHORIZATION COULD
+;       SUBJECT THE PERPERTRATOR TO CRIMINAL AND CIVIL LIABILITY.
+;
+;------------------------------------------------------------------------------
+;
+;    Project : ADM5120
+;    Creator : 
+;    File    : include/asm/am5120/mx29lv320b.h
+;    Date    : 2003.07.30
+;    Abstract: 
+;
+;Modification History:
+; 
+;
+;*****************************************************************************/
+
+
+#ifndef  __MX29LV320B_H__
+#define  __MX29LV320B_H__
+
+#include <linux/mtd/mtd.h>
+#include <linux/mtd/map.h>
+#include <linux/mtd/partitions.h>
+
+#define FLASH_PHYS_ADDR 	0x1FC00000
+
+#include<asm/am5120/mx_parts.h>
+
+#define FLASH_PART_ROOT_ADDR (FLASH_PART_KERNEL_ADDR + FLASH_PART_KERNEL_SIZE)
+#define FLASH_PART_DATA_ADDR (FLASH_PART_ROOT_ADDR + FLASH_PART_ROOT_SIZE)
+#define FLASH_PART_DATA_SIZE (FLASH_SIZE - FLASH_PART_DATA_ADDR)
+
+
+struct mtd_partition mx29lv320b_parts[] = {
+	{
+		.name =		"Boot Partition",
+		.offset =	FLASH_PART_BOOT_ADDR,
+		.size =		FLASH_PART_BOOT_SIZE,
+		.mask_flags =   MTD_WRITEABLE
+	},
+	{
+		.name =		"Kernel",
+		.offset =	FLASH_PART_KERNEL_ADDR,
+		.size =		FLASH_PART_KERNEL_SIZE
+	},
+	{
+		.name =		"Root",
+		.offset =	FLASH_PART_ROOT_ADDR,
+		.size =		FLASH_PART_ROOT_SIZE
+	},
+	{
+		.name =		"Data",
+		.offset =	FLASH_PART_DATA_ADDR,
+		.size =		FLASH_PART_DATA_SIZE
+	},
+	{
+		.name =		"WholeFlash",
+		.offset =	FLASH_PART_KERNEL_ADDR,
+		.size =		0x1F0000
+	}
+};
+
+#define PARTITION_COUNT (sizeof(mx29lv320b_parts)/sizeof(struct mtd_partition))
+
+#endif /* __MX29LV320B_H__ */
+
diff -Naur linux-2.6.16-old/include/asm-mips/am5120/mx_parts.h linux-2.6.16-new/include/asm-mips/am5120/mx_parts.h
--- linux-2.6.16-old/include/asm-mips/am5120/mx_parts.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/include/asm-mips/am5120/mx_parts.h	2006-05-12 12:00:52.000000000 +0000
@@ -0,0 +1,10 @@
+/**********************************************************************************
+;   Auto generated by target/linux/linux-2.4/adm5120.mk
+;   DO NOT EDIT!!!
+;**********************************************************************************/
+#define FLASH_SIZE      0x00200000
+#define FLASH_PART_BOOT_ADDR    0x00000000
+#define FLASH_PART_BOOT_SIZE    0x00008000
+#define FLASH_PART_KERNEL_ADDR  0x00010000
+#define FLASH_PART_KERNEL_SIZE  0x000A0000
+#define FLASH_PART_ROOT_SIZE    0x00140000
diff -Naur linux-2.6.16-old/include/asm-mips/am5120/prom.h linux-2.6.16-new/include/asm-mips/am5120/prom.h
--- linux-2.6.16-old/include/asm-mips/am5120/prom.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/include/asm-mips/am5120/prom.h	2006-05-12 12:00:52.000000000 +0000
@@ -0,0 +1,49 @@
+/*
+ * Carsten Langgaard, carstenl@mips.com
+ * Copyright (C) 2000 MIPS Technologies, Inc.  All rights reserved.
+ *
+ * ########################################################################
+ *
+ *  This program is free software; you can distribute it and/or modify it
+ *  under the terms of the GNU General Public License (Version 2) as
+ *  published by the Free Software Foundation.
+ *
+ *  This program is distributed in the hope it will be useful, but WITHOUT
+ *  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
+ *  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+ *  for more details.
+ *
+ *  You should have received a copy of the GNU General Public License along
+ *  with this program; if not, write to the Free Software Foundation, Inc.,
+ *  59 Temple Place - Suite 330, Boston MA 02111-1307, USA.
+ *
+ * ########################################################################
+ *
+ * MIPS boards bootprom interface for the Linux kernel.
+ *
+ */
+
+#ifndef _MIPS_PROM_H
+#define _MIPS_PROM_H
+
+extern char *prom_getcmdline(void);
+extern char *prom_getenv(char *name);
+extern void setup_prom_printf(int tty_no);
+extern void prom_printf(char *fmt, ...);
+extern void prom_init_cmdline(void);
+extern void prom_meminit(void);
+extern void prom_fixup_mem_map(unsigned long start_mem, unsigned long end_mem);
+extern void prom_free_prom_memory (void);
+extern void mips_display_message(const char *str);
+extern void mips_display_word(unsigned int num);
+extern int get_ethernet_addr(char *ethernet_addr);
+
+/* Memory descriptor management. */
+#define PROM_MAX_PMEMBLOCKS    32
+struct prom_pmemblock {
+        unsigned long base; /* Within KSEG0. */
+        unsigned int size;  /* In bytes. */
+        unsigned int type;  /* free or prom memory */
+};
+
+#endif /* !(_MIPS_PROM_H) */
diff -Naur linux-2.6.16-old/include/asm-mips/asm.h linux-2.6.16-new/include/asm-mips/asm.h
--- linux-2.6.16-old/include/asm-mips/asm.h	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/include/asm-mips/asm.h	2006-05-29 16:27:58.000000000 +0000
@@ -107,7 +107,7 @@
 /*
  * Print formatted string
  */
-#ifdef CONFIG_PRINTK
+//#ifdef CONFIG_PRINTK
 #define PRINT(string)                                   \
 		.set	push;				\
 		.set	reorder;                        \
@@ -115,10 +115,11 @@
 		jal	printk;                         \
 		.set	pop;				\
 		TEXT(string)
+/*
 #else
 #define PRINT(string)
 #endif
-
+*/
 #define	TEXT(msg)                                       \
 		.pushsection .data;			\
 8:		.asciiz	msg;                            \
diff -Naur linux-2.6.16-old/include/asm-mips/bootinfo.h linux-2.6.16-new/include/asm-mips/bootinfo.h
--- linux-2.6.16-old/include/asm-mips/bootinfo.h	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/include/asm-mips/bootinfo.h	2006-05-29 09:15:08.000000000 +0000
@@ -218,6 +218,13 @@
 #define MACH_GROUP_TITAN       22	/* PMC-Sierra Titan		*/
 #define  MACH_TITAN_YOSEMITE	1	/* PMC-Sierra Yosemite		*/
 
+/*
+ * Valid machtype for group ADMtek
+ */
+#define MACH_GROUP_ADM_GW      23
+#define MACH_ADM_GW_5120       0
+
+
 #define CL_SIZE			COMMAND_LINE_SIZE
 
 const char *get_system_type(void);
diff -Naur linux-2.6.16-old/include/asm-mips/system.h linux-2.6.16-new/include/asm-mips/system.h
--- linux-2.6.16-old/include/asm-mips/system.h	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/include/asm-mips/system.h	2006-05-31 13:42:54.000000000 +0000
@@ -442,6 +442,7 @@
 extern void *set_vi_handler (int n, void *addr);
 extern void *set_vi_srs_handler (int n, void *addr, int regset);
 extern void *set_except_vector(int n, void *addr);
+extern unsigned long ebase;
 extern void per_cpu_trap_init(void);
 
 extern NORET_TYPE void die(const char *, struct pt_regs *);
diff -Naur linux-2.6.16-old/include/linux/debug_net.h linux-2.6.16-new/include/linux/debug_net.h
--- linux-2.6.16-old/include/linux/debug_net.h	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/include/linux/debug_net.h	2006-06-23 14:39:57.000000000 +0000
@@ -0,0 +1,111 @@
+#include<linux/time.h>
+#include<linux/delay.h>
+#include<linux/interrupt.h>
+#include<linux/netfilter.h>
+
+/* functions */
+void debug_count_delta(struct timeval *tv1,struct timeval tv2);
+void debug_print_tv(struct timeval *tv,u32 cnt,struct timeval *tv1,char *str);
+void debug_div_tv(struct timeval *tv1,u32 z);
+void debug_sum_tv(struct timeval *tv1,struct timeval tv2);
+
+
+
+/* debug macroses */
+#define DEBUG_NET
+
+#ifdef DEBUG_NET
+
+#define DEBUG_NF_HOOK(pf, hook, skb, indev, outdev, okfn,counter_var)	\
+({int __ret; 								\
+struct timeval tv1,tv2; 						\
+disable_irq(9); 							\
+do_gettimeofday(&tv1); 							\
+__ret=nf_hook_thresh(pf, hook, &(skb), indev, outdev, okfn,INT_MIN, 1); \
+do_gettimeofday(&tv2); 							\
+if( __ret == 1 ) 							\
+	__ret = (okfn)(skb);                                            \
+enable_irq(9); 								\
+debug_count_delta(&tv1,tv2); 						\
+debug_sum_tv(& debug_ip_##counter_var,tv1); 				\
+debug_ip_##counter_var##_cnt+=1;  					\
+__ret; })
+
+#define DEBUG_NF_HOOK_COND(pf, hook, skb, indev, outdev, okfn, cond,counter_var) \
+({int __ret; \
+struct timeval tv1,tv2; \
+disable_irq(9); \
+do_gettimeofday(&tv1); \
+__ret=NF_HOOK_COND(pf, hook, skb, indev, outdev, okfn, cond); \
+do_gettimeofday(&tv2); \
+enable_irq(9); \
+debug_count_delta(&tv1,tv2); \
+debug_sum_tv(& debug_ip_ ## counter_var,tv1); \
+debug_ip_##counter_var##_cnt+=1 ;\
+__ret; })
+
+
+#define DEBUG_ADD_NEW_DELTA(tv1,tv2,counter_var) 	\
+({ 								\
+debug_count_delta(&tv1,tv2); 					\
+debug_sum_tv(& debug_ip_ ## counter_var,tv1); 			\
+debug_ip_##counter_var##_cnt+=1 ;				\
+})
+
+#else /* Not defined DEBUG_NET */
+
+#define DEBUG_NF_HOOK(pf, hook, skb, indev, outdev, okfn,counter_var) \
+({int __ret; \
+__ret=NF_HOOK(pf, hook, skb, indev, outdev, okfn); \
+__ret; })
+
+#define DEBUG_NF_HOOK_COND(pf, hook, skb, indev, outdev, okfn, cond,counter_var) \
+({ int __ret; \
+__ret=NF_HOOK_COND(pf, hook, skb, indev, outdev, okfn, cond); \
+__ret; })
+
+#endif /* DEBUG_NET */
+
+
+#define DEBUG_NET_OUTPUT(counter_var,str) \
+({	struct timeval rez;\
+	memset(&rez,0,sizeof(struct timeval)); \
+	if ( debug_ip_##counter_var##_cnt ){ \
+		rez.tv_sec=debug_ip_##counter_var.tv_sec; \
+		rez.tv_usec=debug_ip_##counter_var.tv_usec; \
+		debug_div_tv(&rez, debug_ip_##counter_var##_cnt ); \
+	} \
+	debug_print_tv(&rez,debug_ip_##counter_var##_cnt,&debug_ip_##counter_var,str);\
+})
+
+
+
+/* counters */
+	
+
+extern struct timeval debug_ip_arp;
+extern struct timeval debug_ip_igmp;
+extern struct timeval debug_ip_input;
+extern struct timeval debug_ip_output;
+extern struct timeval debug_ip_forward;
+extern struct timeval debug_ip_hook;
+extern struct timeval debug_ip_test;
+
+extern struct timeval debug_ip_vs_xmit;
+extern struct timeval debug_ip_ipt_REJECT;
+extern struct timeval debug_ip_raw;
+extern struct timeval debug_ip_xfrm4_input;
+extern struct timeval debug_ip_xfrm4_output;
+extern struct timeval debug_ip_ipmr;
+
+
+
+extern u32 debug_ip_arp_cnt;
+extern u32 debug_ip_igmp_cnt;
+extern u32 debug_ip_input_cnt;
+extern u32 debug_ip_output_cnt;
+extern u32  debug_ip_ipmr_cnt;
+extern u32  debug_ip_forward_cnt;
+extern u32  debug_ip_hook_cnt;
+extern u32  debug_ip_test_cnt;
+
diff -Naur linux-2.6.16-old/include/linux/debug_net.h_pr linux-2.6.16-new/include/linux/debug_net.h_pr
--- linux-2.6.16-old/include/linux/debug_net.h_pr	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.16-new/include/linux/debug_net.h_pr	2006-06-22 12:39:05.000000000 +0000
@@ -0,0 +1,292 @@
+# 1 "debug_net.h"
+# 1 "<built-in>"
+# 1 "<command line>"
+# 1 "debug_net.h"
+# 1 "/usr/include/linux/time.h" 1 3 4
+
+
+
+# 1 "/usr/include/linux/types.h" 1 3 4
+# 13 "/usr/include/linux/types.h" 3 4
+# 1 "/usr/include/linux/posix_types.h" 1 3 4
+
+
+
+# 1 "/usr/include/linux/stddef.h" 1 3 4
+
+
+
+# 1 "/usr/include/linux/compiler.h" 1 3 4
+# 5 "/usr/include/linux/stddef.h" 2 3 4
+# 5 "/usr/include/linux/posix_types.h" 2 3 4
+# 36 "/usr/include/linux/posix_types.h" 3 4
+typedef struct {
+        unsigned long fds_bits [(1024/(8 * sizeof(unsigned long)))];
+} __kernel_fd_set;
+
+
+typedef void (*__kernel_sighandler_t)(int);
+
+
+typedef int __kernel_key_t;
+typedef int __kernel_mqd_t;
+
+# 1 "/usr/include/asm/posix_types.h" 1 3 4
+# 10 "/usr/include/asm/posix_types.h" 3 4
+typedef unsigned long __kernel_ino_t;
+typedef unsigned short __kernel_mode_t;
+typedef unsigned short __kernel_nlink_t;
+typedef long __kernel_off_t;
+typedef int __kernel_pid_t;
+typedef unsigned short __kernel_ipc_pid_t;
+typedef unsigned short __kernel_uid_t;
+typedef unsigned short __kernel_gid_t;
+typedef unsigned int __kernel_size_t;
+typedef int __kernel_ssize_t;
+typedef int __kernel_ptrdiff_t;
+typedef long __kernel_time_t;
+typedef long __kernel_suseconds_t;
+typedef long __kernel_clock_t;
+typedef int __kernel_timer_t;
+typedef int __kernel_clockid_t;
+typedef int __kernel_daddr_t;
+typedef char * __kernel_caddr_t;
+typedef unsigned short __kernel_uid16_t;
+typedef unsigned short __kernel_gid16_t;
+typedef unsigned int __kernel_uid32_t;
+typedef unsigned int __kernel_gid32_t;
+
+typedef unsigned short __kernel_old_uid_t;
+typedef unsigned short __kernel_old_gid_t;
+typedef unsigned short __kernel_old_dev_t;
+
+
+typedef long long __kernel_loff_t;
+
+
+typedef struct {
+
+
+
+        int __val[2];
+
+} __kernel_fsid_t;
+# 48 "/usr/include/linux/posix_types.h" 2 3 4
+# 14 "/usr/include/linux/types.h" 2 3 4
+
+# 1 "/usr/include/asm/types.h" 1 3 4
+
+
+
+
+
+typedef unsigned short umode_t;
+
+
+
+
+
+
+typedef __signed__ char __s8;
+typedef unsigned char __u8;
+
+typedef __signed__ short __s16;
+typedef unsigned short __u16;
+
+typedef __signed__ int __s32;
+typedef unsigned int __u32;
+
+
+
+
+
+
+
+__extension__ typedef __signed__ long long __s64;
+__extension__ typedef unsigned long long __u64;
+# 16 "/usr/include/linux/types.h" 2 3 4
+
+
+
+typedef __u32 __kernel_dev_t;
+
+
+typedef __kernel_fd_set fd_set;
+
+
+typedef __kernel_dev_t dev_t;
+
+
+typedef __kernel_ino_t ino_t;
+
+
+typedef __kernel_mode_t mode_t;
+
+
+typedef __kernel_nlink_t nlink_t;
+
+
+typedef __kernel_off_t off_t;
+
+typedef __kernel_pid_t pid_t;
+typedef __kernel_daddr_t daddr_t;
+typedef __kernel_key_t key_t;
+typedef __kernel_suseconds_t suseconds_t;
+typedef __kernel_timer_t timer_t;
+typedef __kernel_clockid_t clockid_t;
+typedef __kernel_mqd_t mqd_t;
+# 65 "/usr/include/linux/types.h" 3 4
+typedef __kernel_uid_t uid_t;
+
+typedef __kernel_gid_t gid_t;
+
+
+
+
+typedef __kernel_loff_t loff_t;
+# 81 "/usr/include/linux/types.h" 3 4
+typedef __kernel_size_t size_t;
+
+
+
+
+typedef __kernel_ssize_t ssize_t;
+
+
+
+
+typedef __kernel_ptrdiff_t ptrdiff_t;
+
+
+
+
+typedef __kernel_time_t time_t;
+
+
+
+
+typedef __kernel_clock_t clock_t;
+
+
+
+
+typedef __kernel_caddr_t caddr_t;
+
+
+
+typedef unsigned char u_char;
+typedef unsigned short u_short;
+typedef unsigned int u_int;
+typedef unsigned long u_long;
+
+
+typedef unsigned char unchar;
+typedef unsigned short ushort;
+typedef unsigned int uint;
+typedef unsigned long ulong;
+
+
+
+
+typedef __u8 u_int8_t;
+typedef __s8 int8_t;
+typedef __u16 u_int16_t;
+typedef __s16 int16_t;
+typedef __u32 u_int32_t;
+typedef __s32 int32_t;
+
+
+
+typedef __u8 uint8_t;
+typedef __u16 uint16_t;
+typedef __u32 uint32_t;
+
+
+typedef __u64 uint64_t;
+typedef __u64 u_int64_t;
+typedef __s64 int64_t;
+# 149 "/usr/include/linux/types.h" 3 4
+typedef unsigned long sector_t;
+# 175 "/usr/include/linux/types.h" 3 4
+typedef __u16 __le16;
+typedef __u16 __be16;
+typedef __u32 __le32;
+typedef __u32 __be32;
+typedef __u64 __le64;
+typedef __u64 __be64;
+
+
+struct ustat {
+        __kernel_daddr_t f_tfree;
+        __kernel_ino_t f_tinode;
+        char f_fname[6];
+        char f_fpack[6];
+};
+# 5 "/usr/include/linux/time.h" 2 3 4
+# 14 "/usr/include/linux/time.h" 3 4
+struct timespec {
+        time_t tv_sec;
+        long tv_nsec;
+};
+
+
+
+
+struct timeval {
+        time_t tv_sec;
+        suseconds_t tv_usec;
+};
+
+
+struct timezone {
+        int tz_minuteswest;
+        int tz_dsttime;
+};
+# 153 "/usr/include/linux/time.h" 3 4
+struct itimerspec {
+        struct timespec it_interval;
+        struct timespec it_value;
+};
+
+
+
+struct itimerval {
+        struct timeval it_interval;
+        struct timeval it_value;
+};
+# 2 "debug_net.h" 2
+
+
+void count_delta(struct timeval *tv1,struct timeval tv2);
+void debug_print_tv(struct timeval *tv,char *str);
+void debug_div_tv(struct timeval *tv1,u32 z);
+void debug_sum_tv(struct timeval *tv1,struct timeval tv2);
+# 63 "debug_net.h"
+({int __ret; struct timeval tv1,tv2; do_gettimeofday(&tv1); __ret=NF_HOOK(a, b, c, d, e, f); do_gettimeofday(&tv2); debug_count_delta(&tv1,tv2); debug_sum_tv(&debug_ip_a,tv1); debug_ip_a_cnt+=1; __ret; });
+({ rez.tv_sec=counter_var.tv_sec; rez.tv_usec=counter_var.tv_usec; debug_div_tv(rez, counter_var_cnt ); });
+
+extern struct timeval debug_ip_arp;
+extern struct timeval debug_ip_igmp;
+extern struct timeval debug_ip_input;
+extern struct timeval debug_ip_output_1;
+extern struct timeval debug_ip_output_2;
+extern struct timeval debug_ip_output_3;
+extern struct timeval debug_ip_output_4;
+extern struct timeval debug_ip_output_5;
+extern struct timeval debug_ip_output_6;
+extern struct timeval debug_ip_ipmp;
+extern struct timeval debug_ip_vs_xmit;
+extern struct timeval debug_ip_ipt_REJECT;
+extern struct timeval debug_ip_raw;
+extern struct timeval debug_ip_xfrm4_input;
+extern struct timeval debug_ip_xfrm4_output;
+
+extern u32 debug_ip_arp_cnt;
+extern u32 debug_ip_igmp_cnt;
+extern u32 debug_ip_input_cnt;
+extern u32 debug_ip_output_1_cnt;
+extern u32 debug_ip_output_2_cnt;
+extern u32 debug_ip_output_3_cnt;
+extern u32 debug_ip_output_4_cnt;
+extern u32 debug_ip_output_5_cnt;
+extern u32 debug_ip_output_6_cnt;
diff -Naur linux-2.6.16-old/include/linux/serial_core.h linux-2.6.16-new/include/linux/serial_core.h
--- linux-2.6.16-old/include/linux/serial_core.h	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/include/linux/serial_core.h	2006-05-30 09:37:50.000000000 +0000
@@ -82,6 +82,11 @@
 /* Samsung S3C2410 SoC and derivatives thereof */
 #define PORT_S3C2410    55
 
+/* ADMtek ADM5120 SoC */
+#define PORT_ADM5120   68
+
+
+
 /* SGI IP22 aka Indy / Challenge S / Indigo 2 */
 #define PORT_IP22ZILOG	56
 
diff -Naur linux-2.6.16-old/Makefile linux-2.6.16-new/Makefile
--- linux-2.6.16-old/Makefile	2006-03-20 11:35:39.000000000 +0000
+++ linux-2.6.16-new/Makefile	2006-05-29 09:48:28.000000000 +0000
@@ -315,7 +315,7 @@
 DEPMOD		= /sbin/depmod
 KALLSYMS	= scripts/kallsyms
 PERL		= perl
-CHECK		= sparse
+CHECK		= sparse -Wbitwise
 
 CHECKFLAGS     := -D__linux__ -Dlinux -D__STDC__ -Dunix -D__unix__ -Wbitwise $(CF)
 MODFLAGS	= -DMODULE
@@ -739,6 +739,11 @@
 	$(call if_changed_rule,vmlinux__)
 	$(Q)rm -f .old_version
 
+vmlinuz: vmlinux
+	$(OBJCOPY) -O binary vmlinux vmlinux.bin
+	gzip vmlinux.bin -c >vmlinuz
+
+
 # The actual objects are generated when descending, 
 # make sure no implicit rule kicks in
 $(sort $(vmlinux-init) $(vmlinux-main)) $(vmlinux-lds): $(vmlinux-dirs) ;

